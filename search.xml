<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>æ‰©æ•£æ¨¡å‹(Diffusion Model)åŸç†è¯¦è§£</title>
      <link href="/2025/02/19/computervision/kuo-san-mo-xing-diffusion-model-yuan-li-xiang-jie/"/>
      <url>/2025/02/19/computervision/kuo-san-mo-xing-diffusion-model-yuan-li-xiang-jie/</url>
      
        <content type="html"><![CDATA[<h1><span id="diffusionmodelçš„åŸºæœ¬åŸç†ddpm">DiffusionModelçš„åŸºæœ¬åŸç†(DDPM)</span></h1><p>Denoising Diffusion Probabilistic Models(DDPM)åœ¨æµç¨‹ä¸Šåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ -Forward (diffusion) process: åœ¨è¾“å…¥çš„æ•°æ®ä¸Šé€æ­¥çš„å¢åŠ å™ªå£° - Backward(denoising) process: åœ¨å™ªå£°å›¾ä¸Šè¿›è¡Œé™å™ªï¼Œä»å™ªå£°ä¸­æ¢å¤å‡ºåŸæ¥çš„å›¾åƒ</p><span id="more"></span><figure><img src="https://s2.loli.net/2024/05/06/wMiEscWqSGf2zrb.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h2><span id="diffusion-process">Diffusion Process</span></h2><p>DiffusionProcessæ˜¯åœ¨åŸå§‹æ•°æ®çš„åŸºç¡€ä¸Šé€æ­¥å¢åŠ å™ªå£°ï¼Œé€šè¿‡è¶…å‚æ•°è¿­ä»£æ¬¡æ•°<span class="math inline">\(T\)</span>å’Œvariance schedule <span class="math inline">\(\beta_{t} \in (0,1)\)</span>æ§åˆ¶ã€‚å› æ­¤ï¼Œæœ‰ä»¥ä¸‹æ¡ä»¶æ¦‚ç‡ <span class="math display">\[q(\mathbf{x}_{t}| \mathbf{x}_{t-1})=\mathcal{N}(\mathbf{x}_{t} |\sqrt{1-\beta_{t}}\mathbf{x}_{t-1},\beta_{t} \mathbf{I})\]</span> å…¶ä¸­variance scheduleæ»¡è¶³ <span class="math display">\[0 &lt; \beta_{1} &lt; \beta_{2} &lt; \cdots &lt; \beta_{T} &lt; 1\]</span> è¿™é‡Œé‡‡æ ·æ—¶å€™éœ€è¦é‡‡ç”¨ReparameterizationTrickï¼Œå› ä¸ºé‡‡æ ·æ˜¯æ— æ³•è¿›è¡Œåå‘ä¼ æ’­çš„ã€‚æ‰€ä»¥å¼•å…¥ä¸€ä¸ªæ–°çš„å˜é‡<span class="math inline">\(\epsilon\)</span>å°†éšæœºæ€§å’Œä¼ æ’­è¿‡ç¨‹åˆ†ç¦»å¼€ <span class="math display">\[\begin{align*}\mathcal{N}(\mu,\sigma^{2})&amp;= \mu+\sigma \cdot \epsilon\\\epsilon &amp;\sim \mathcal{N}(0, \mathbf{I})\end{align*}\]</span> æ‰€ä»¥ï¼Œdiffusionæ¯ä¸€æ­¥å¢åŠ å™ªå£°å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ“ä½œ <span class="math display">\[\mathbf{x}_{t}=\sqrt{1-\beta_{t}} \mathbf{x}_{t-1} + \sqrt{\beta_{t}}\epsilon\]</span> ç”±äºdiffusionprocessæ˜¯ç¡®å®šçš„ï¼Œåœ¨å®é™…è¿‡ç¨‹ä¸­å¹¶ä¸éœ€è¦è¿›è¡Œæ¯ä¸€æ­¥è¿­ä»£ï¼Œå¯ä»¥ç›´æ¥è®¡ç®—å‡ºä»åŸå§‹æ•°æ®åˆ°è¿­ä»£<span class="math inline">\(T\)</span>æ­¥åçš„ç»“æœ</p><figure><img src="https://s2.loli.net/2024/05/06/k7jxUXSfrqPeb3m.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>ä»ä¸Šé¢çš„æ¡ä»¶æ¦‚ç‡ä¸­ï¼Œå¯ä»¥å¾—åˆ°diffusion processçš„closed form <span class="math display">\[\begin{align*}\mathbf{x}_{t} &amp;= \sqrt{\bar{\alpha_{t}}}\mathbf{x}_{0} +\sqrt{1-\bar{\alpha}_{t}} \epsilon\\\alpha_{t} &amp;= 1-\beta_{t}\\\bar{\alpha}_{t} &amp;= \prod_{i=1}^{t} \alpha_{i}\\\epsilon &amp;\sim \mathcal{N}(0, \mathbf{I})\end{align*}\]</span></p><h2><span id="denoise-process">Denoise Process</span></h2><p>Denoiseprocessæ˜¯ä»å™ªå£°å›¾ä¸­ç§»é™¤å™ªå£°æ¥æ¢å¤åŸå›¾ã€‚è¿™ä¸ªè¿‡ç¨‹éœ€è¦æˆ‘ä»¬çŸ¥é“æ¦‚ç‡åˆ†å¸ƒ<span class="math inline">\(q(\mathbf{x}_{t-1} |\mathbf{x}_{t})\)</span>ï¼Œä¹Ÿå°±æ˜¯ä»æŸä¸€æ—¶åˆ»çš„æ•°æ®åæ¨ä¸Šä¸€æ—¶åˆ»çš„æ•°æ®ï¼Œè¿›è¡Œå¤šæ¬¡è¿­ä»£åæ¢å¤æœ€åˆçš„æ•°æ®<span class="math inline">\(\mathbf{x}_{0}\)</span>ã€‚æ ¹æ®Bayes Ruleï¼Œ <span class="math display">\[q(\mathbf{x}_{t-1}|\mathbf{x}_{t})=q(\mathbf{x}_{t}|\mathbf{x}_{t-1})\frac{q(\mathbf{x}_{t-1})}{q(\mathbf{x}_{t})}\]</span> å…¶ä¸­ <span class="math inline">\(q(\mathbf{x}_{t})=\intq(\mathbf{x}_{t} | \mathbf{x}_{0}) q(\mathbf{x}_{0}) \mathrm{d}\mathbf{x}_{0}\)</span>ï¼Œä½†æ˜¯è¿™ä¸€é¡¹ç§¯åˆ†æ˜¯æ— æ³•è®¡ç®—çš„ã€‚å› æ­¤ï¼ŒDDPMé‡‡ç”¨äº†ç¥ç»ç½‘ç»œå»å­¦ä¹ ä¸€ä¸ªæ¨¡å‹<span class="math inline">\(p_{\theta}(\mathbf{x}_{t-1} |\mathbf{x}_{t})\)</span> è¿‘ä¼¼ä¼°è®¡<span class="math inline">\(q(\mathbf{x}_{t-1} | \mathbf{x}_{t},\mathbf{x}_{0})\)</span>ã€‚é€šè¿‡æ¨å¯¼ï¼Œå¯ä»¥å¾—åˆ° <span class="math inline">\(q(\mathbf{x}_{t-1} | \mathbf{x}_{t},\mathbf{x}_{0})\)</span> ä¹Ÿæ˜¯ä¸€ä¸ªé«˜æ–¯åˆ†å¸ƒï¼Œå¹¶ä¸”é«˜æ–¯åˆ†å¸ƒçš„å‡å€¼å’Œæ–¹å·®å¦‚ä¸‹<span class="math display">\[\begin{align*}\boldsymbol{\mu}_q(\boldsymbol{x}_t, \boldsymbol{x}_0) &amp;=\frac{\sqrt{\alpha_t}(1 - \bar{\alpha}_{t-1})\boldsymbol{x}_t +\sqrt{\bar{\alpha}_{t-1}}(1 - \alpha_t)\boldsymbol{x}_0}{1 -\bar{\alpha}_t} \\\sigma_q^2 &amp;= \frac{(1 - \alpha_t)(1 - \bar{\alpha}_{t-1})}{1 -\bar{\alpha}_t}\end{align*}\]</span> æ›´è¿›ä¸€æ­¥çš„å°† <span class="math inline">\(x_0 =\frac{1}{\sqrt{a_t}} \left( x_t - \sqrt{1 - \bar{a}_t} \epsilon\right)\)</span> å¸¦å…¥ï¼Œå¯ä»¥å¾—åˆ° <span class="math display">\[\mu_q(x_t, x_0) = \frac{1}{\sqrt{\alpha_t}} x_t - \frac{1 -\alpha_t}{\sqrt{1 - \bar{\alpha}_t} \sqrt{\alpha_t}} \epsilon\]</span> ä¸ªäººå¯¹ä¸ºä»€ä¹ˆç”¨<span class="math inline">\(p_{\theta}(\mathbf{x}_{t-1} |\mathbf{x}_{t})\)</span>æ‹Ÿåˆ<span class="math inline">\(q(\mathbf{x}_{t-1} | \mathbf{x}_{t},\mathbf{x}_{0})\)</span>çš„ç†è§£æ˜¯ï¼Œå½“æœ‰åŸå§‹æ•°æ®å’Œæœ€ç»ˆçš„å™ªå£°ç»“æœçš„æ—¶å€™ï¼Œé™å™ªè¿‡ç¨‹æ˜¯å¯ä»¥è®¡ç®—å¾—åˆ°çš„ã€‚ä½†æ˜¯inferenceçš„è¿‡ç¨‹ä¸­æˆ‘ä»¬æ˜¾ç„¶æ˜¯ä¸çŸ¥é“åŸå§‹æ•°æ®çš„ï¼Œæ‰€ä»¥å¸Œæœ›é€šè¿‡ç¥ç»ç½‘ç»œä»åŸå§‹æ•°æ®ä¸­å­¦ä¹ ä¸€ä¸ªé‡‡æ ·åˆ†å¸ƒè¿‘ä¼¼çš„æ‹Ÿåˆã€‚å…·ä½“çš„ï¼Œç»™å®šåŠ å™ªåçš„ç»“æœ<span class="math inline">\(x_{t}\)</span>å’Œæ—¶é—´æ­¥é•¿<span class="math inline">\(t\)</span>ï¼Œç”¨ç½‘ç»œé¢„æµ‹ä»<span class="math inline">\(x_{0}\)</span>åˆ°<span class="math inline">\(x_{t}\)</span>è¿‡ç¨‹ä¸­æ·»åŠ çš„å™ªå£°<span class="math inline">\(\epsilon(x_{t},t)\)</span>ï¼Œé¢„æµ‹å™ªå£°åŒæ—¶ä¹Ÿç­‰ä»·äºé¢„æµ‹åŸå§‹å›¾åƒ<span class="math inline">\(x_{0}\)</span>ï¼Œæœ‰äº†<span class="math inline">\(x_{0}\)</span>å°±å¯ä»¥ç”¨<span class="math inline">\(q(\mathbf{x}_{t-1} | \mathbf{x}_{t},\mathbf{x}_{0})\)</span>è¿›è¡Œé‡‡æ ·ã€‚ <span class="math display">\[p_{\theta}(x_{t-1} | x_{t}) = \mathcal{N}(x_{t-1}; \mu_{\theta}(x_{t},t), \sigma_t I) \approx q(x_{t-1} | x_{t}, x_0)\]</span></p><h2><span id="training-process">Training Process</span></h2><p>DDPMçš„æŸå¤±å‡½æ•°ç±»ä¼¼äºVAEï¼Œä½¿ç”¨äº†ELBOçš„æ–¹æ³•ï¼Œå®Œæ•´æ¨å¯¼å‚è§<a href="https://arxiv.org/pdf/2208.11970">Understanding Diffusion Models:A Unified Perspective</a></p><figure><img src="https://s2.loli.net/2025/02/01/USZLYBskHTh92NQ.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p><span class="math display">\[\begin{align*}\log p(\boldsymbol{x}) \geq&amp; \mathbb{E}_q(\boldsymbol{x}_{1:T} |\boldsymbol{x}_0) \left[ \log\frac{p(\boldsymbol{x}_{0:T})}{q(\boldsymbol{x}_{1:T} |\boldsymbol{x}_0)} \right] \\=&amp;\underbrace{\mathbb{E}_{q\left(\boldsymbol{x}_1 \mid\boldsymbol{x}_0\right)}\left[\logp_{\boldsymbol{\theta}}\left(\boldsymbol{x}_0 \mid\boldsymbol{x}_1\right)\right]}_{\text {reconstruction term}}-\underbrace{D_{\mathrm{KL}}\left(q\left(\boldsymbol{x}_T \mid\boldsymbol{x}_0\right) \| p\left(\boldsymbol{x}_T\right)\right)}_{\text{prior matching term }}\\&amp;-\sum_{t=2}^T \underbrace{\mathbb{E}_{q\left(\boldsymbol{x}_t \mid\boldsymbol{x}_0\right)}\left[D_{\mathrm{KL}}\left(q\left(\boldsymbol{x}_{t-1}\mid \boldsymbol{x}_t, \boldsymbol{x}_0\right) \|p_{\boldsymbol{\theta}}\left(\boldsymbol{x}_{t-1} \mid\boldsymbol{x}_t\right)\right)\right]}_{\text {denoising matching term}}\end{align*}\]</span></p><ul><li>Reconstruction term: <span class="math inline">\(\mathbb{E}_{q\left(\boldsymbol{x}_1 \mid\boldsymbol{x}_0\right)}\left[\logp_{\boldsymbol{\theta}}\left(\boldsymbol{x}_0 \mid\boldsymbol{x}_1\right)\right]\)</span></li><li>Prior matching term: <span class="math inline">\(D_{\mathrm{KL}}\left(q\left(\boldsymbol{x}_T \mid\boldsymbol{x}_0\right) \|p\left(\boldsymbol{x}_T\right)\right)\)</span></li><li>Denoising matching term: <span class="math inline">\(\mathbb{E}_{q\left(\boldsymbol{x}_t \mid\boldsymbol{x}_0\right)}\left[D_{\mathrm{KL}}\left(q\left(\boldsymbol{x}_{t-1}\mid \boldsymbol{x}_t, \boldsymbol{x}_0\right) \|p_{\boldsymbol{\theta}}\left(\boldsymbol{x}_{t-1} \mid\boldsymbol{x}_t\right)\right)\right]\)</span></li></ul><p>æ³¨æ„åˆ°è¿™é‡Œreconstruction termå’Œprior matching termå®é™…ä¸Šå°±æ˜¯VAElossï¼Œç”±äºè¿™ä¸¤é¡¹æ˜¯åœ¨diffusionprocessä¸­æ²¡æœ‰ä»»ä½•ç½‘ç»œå‚æ•°å‚ä¸ï¼Œæ‰€ä»¥å¯ä»¥çœ‹ä½œæ˜¯å¸¸æ•°å¿½ç•¥ä¸è®¡ã€‚</p><p>ç”±äº<span class="math inline">\(q\left(\boldsymbol{x}_{t-1} \mid\boldsymbol{x}_t, \boldsymbol{x}_0\right)\)</span>å’Œ<span class="math inline">\(p_{\boldsymbol{\theta}}\left(\boldsymbol{x}_{t-1}\mid \boldsymbol{x}_t\right)\)</span> éƒ½æ˜¯é«˜æ–¯åˆ†å¸ƒï¼Œæ‰€ä»¥denoisingmatching termå¯ä»¥å®é™…ä¸Šè½¬åŒ–ä¸º <span class="math display">\[\arg \min_{\theta} D_{KL}(q(x_{t-1}|x_t, x_0) \parallelp_\theta(x_{t-1}|x_t)) = \arg \min_{\theta} \frac{1}{2\sigma_q^2(t)}\left[ \| \mu_\theta - \mu_q \|_2^2 \right]\]</span> <span class="math inline">\(\mu_{q}\)</span>åœ¨ä¹‹å‰å·²ç»æ¨å¯¼è¿‡äº†ï¼ŒåŒæ ·çš„æˆ‘ä»¬å¯ä»¥æŠŠæ¨¡å‹é¢„æµ‹çš„é«˜æ–¯å‚æ•°<span class="math inline">\(\mu_{\theta}\)</span>å†™ä½œ <span class="math display">\[\mu_\theta(x_t, t) = \frac{1}{\sqrt{\alpha_t}} x_t - \frac{1 -\alpha_t}{\sqrt{1 - \bar{\alpha}_t} \sqrt{\alpha_t}}\hat\epsilon(x_{t},t)\]</span> å…¶ä¸­<span class="math inline">\(\hat\epsilon(x_{t},t)\)</span>æ˜¯æ¨¡å‹é¢„æµ‹çš„å™ªå£°ï¼Œå› æ­¤æœ€ç»ˆçš„æŸå¤±å‡½æ•°å°±å˜æˆäº†åŒ¹é…éšæœºç”Ÿæˆçš„å™ªå£°å’Œæ¨¡å‹é¢„æµ‹çš„å™ªå£°<span class="math inline">\(\|\epsilon-\epsilon_{\theta}(\sqrt{\bar{\alpha}_{t}}\mathbf{x}_{0}+\sqrt{1-\bar{\alpha}_{t}}\epsilon,t)\|\)</span>ã€‚</p><figure><img src="https://s2.loli.net/2025/01/26/vzLjD5mJ6ZMIRnP.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h2><span id="network-architecture">Network Architecture</span></h2><p>Diffusion Modelç›®å‰å¸¸è§çš„ç½‘ç»œç»“æ„ä¸»è¦é‡‡ç”¨äº†U-Net +Attentionçš„ç»“æ„</p><figure><img src="https://s2.loli.net/2024/05/06/2rOQx3Hl7kqVGEs.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h1><span id="denosing-diffusionimplicit-model-ddim">Denosing DiffusionImplicit Model (DDIM)</span></h1><p>DDPMå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯éœ€è¦è®¾ç½®æ¯”è¾ƒé•¿çš„æ‰©æ•£æ­¥é•¿æ‰èƒ½å¾—åˆ°æ¯”è¾ƒå¥½çš„ç”Ÿæˆç»“æœï¼Œå› æ­¤ç”Ÿæˆçš„é€Ÿåº¦æ¯”è¾ƒæ…¢ã€‚DDIMé€šè¿‡è§£é™¤DDPMä¸­æ‰©æ•£è¿‡ç¨‹çš„é©¬å°”å¯å¤«é“¾çš„é™åˆ¶ï¼Œç”¨éé©¬å°”å¯å¤«è¿‡ç¨‹è¿›è¡Œç”Ÿæˆï¼Œå¤§å¤§æé«˜äº†DDPMçš„ç”Ÿæˆæ•ˆç‡ã€‚</p><p>DDIMæ³¨æ„åˆ°äº†DDPMä¸­çš„ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å™ªå£°ç”Ÿæˆçš„è¿‡ç¨‹<span class="math inline">\(q(x_{t} | x_{0})\)</span>å®é™…ä¸Šåªç”¨äº†marginaldistributionå¹¶æ²¡æœ‰ç”¨åˆ°join distribution <span class="math inline">\(q(x_{1:T}|x_{0})\)</span>ï¼Œä¹Ÿå°±æ˜¯ç»™å®š<span class="math inline">\(x_0\)</span>å’Œæ—¶é—´<span class="math inline">\(t\)</span>ï¼ŒåŠ å™ªçš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯ç¡®å®šçš„ <span class="math display">\[q(\mathbf{x}_{t} | \mathbf{x}_{0}) = \mathcal{N}(\mathbf{x}_{t};\sqrt{\alpha_{t}}\mathbf{x_{0}}, (1-\alpha_{t}) \mathbf{I})\]</span> å› æ­¤ï¼Œå¦‚æœå¯ä»¥åœ¨å°†é©¬å°”ç§‘å¤«é“¾é™åˆ¶å»é™¤çš„åŒæ—¶ï¼Œèƒ½å¤Ÿä¿æŒ<span class="math inline">\(q(x_{t}|x_0)\)</span>æœ‰ç€ç›¸åŒçš„æ¦‚ç‡åˆ†å¸ƒï¼Œä¹Ÿå°±æ˜¯å¯¹ä»»æ„æ—¶é—´æ­¥é•¿<span class="math inline">\(t\)</span>ï¼Œä½¿å¾—<span class="math inline">\(q(x_{t}|x_{0})\)</span>éƒ½æ»¡è¶³ä»¥ä¸Šçš„æ¦‚ç‡åˆ†å¸ƒã€‚DDIMæå‡ºäº†ä»¥ä¸‹é‡‡æ ·æ¦‚ç‡åˆ†å¸ƒ <span class="math display">\[\begin{align*}q_{\sigma}(x_{t-1}|x_t,x_0) = \mathcal{N}\left(  \sqrt{\alpha_{t-1}}x_0 + \sqrt{1 - \alpha_{t-1} - \sigma_t^2} \cdot\frac{x_t - \sqrt{\alpha_t}x_0}{\sqrt{1 - \alpha_t}}, \  \sigma_{t}^2I\right). \tag{1}\end{align*}\]</span> å…¶ä¸­è¿™é‡Œçš„ç¬¦å·<span class="math inline">\(\alpha_{t}\)</span>å°±æ˜¯DDPMä¸­çš„<span class="math inline">\(\bar \alpha\)</span></p><h2><span id="å¾…å®šç³»æ•°">å¾…å®šç³»æ•°</span></h2><p>åœ¨DDPMä¸­ï¼Œæ ¹æ®è´å¶æ–¯å…¬å¼ï¼Œæœ‰ä»¥ä¸‹ç»“è®º <span class="math display">\[p(x_{t-1} | x_{t}, x_{0})=\frac{p(x_{t} | x_{t-1}) p(x_{t-1} |x_{0})}{p(x_{t} | x_{0})}\]</span> å…¶ä¸­æˆ‘ä»¬å·²çŸ¥ <span class="math display">\[\begin{align*}p(x_{t} | x_{0}) &amp;= \mathcal{N}(\sqrt{\bar \alpha_{t}} x_{0},(1-\bar \alpha_{t}) \mathbf{I}) \\x_{t} &amp;= \sqrt{\bar \alpha_{t}} x_{0} + \sqrt{1 - \bar{\alpha_{t}}}\epsilon &#39;&#39;, \textbf{ where } \epsilon&#39;&#39; \sim\mathcal{N}(0, \mathbf{I}) \tag{2}\end{align*}\]</span>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œæ¨å¹¿ï¼Œå°†DDPMä¸­çš„é©¬å°”å¯å¤«é“¾é™åˆ¶å»é™¤ï¼Œæˆ‘ä»¬å¯ä»¥å°† <span class="math inline">\(t-1\)</span> å’Œ <span class="math inline">\(t\)</span> æ›¿æ¢ä¸º<span class="math inline">\(s,k\)</span> å…¶ä¸­ <span class="math inline">\(s&lt;k\)</span>ï¼Œå¾—åˆ° <span class="math display">\[p(x_{s} | x_{k}, x_{0})=\frac{p(x_{k} | x_{s}) p(x_{s} | x_{0})}{p(x_{k}| x_{0})}\]</span> è¿™é‡Œ<span class="math inline">\(p(x_{s}|x_{0}),p(x_{k}|x_{0})\)</span>æ˜¯å·²çŸ¥å›ºå®šçš„ï¼Œä½†æ˜¯<span class="math inline">\(p(x_{k}|x_{s})\)</span>æ˜¯æœªçŸ¥çš„ã€‚å¦‚ä½•è®¾å®šé‡‡æ ·åˆ†å¸ƒçš„å½¢å¼å‘¢ï¼Ÿè¿™é‡Œå¯ä»¥ä½¿ç”¨å¾…å®šç³»æ•°æ³•ï¼Œå°†<span class="math inline">\(p(x_{s}|x_{k},x_{0})\)</span>è®¾å®šä¸ºå’ŒæœªçŸ¥å˜é‡<span class="math inline">\(k,m,\alpha\)</span>æœ‰å…³çš„é«˜æ–¯åˆ†å¸ƒ <span class="math display">\[p(x_{s}| x_{k},x_{0}) \sim \mathcal{N}(k x_{0} + m x_{k}, \sigma^{2}\mathbf{I}) \tag{3}\]</span> é‡å‚æ•°åŒ–å¹¶å¸¦å…¥å·²çŸ¥ç»“è®º(2) <span class="math display">\[\begin{align*}x_{s} &amp;=  kx_{0} + m x_{k} + \alpha \epsilon&#39;\\&amp;= kx_{0} + m \left(\sqrt{\bar \alpha_{k}} x_{0} + \sqrt{1 -\bar{\alpha_{k}}} \epsilon &#39;&#39;\right) + \sigma \epsilon&#39;\\&amp;= \left(k+m \sqrt{\bar \alpha_{k}}\right)x_{0} + m\sqrt{1-\bar\alpha_{k}} \epsilon&#39;&#39; + \sigma \epsilon&#39;\end{align*}\]</span> å…¶ä¸­<span class="math inline">\(\epsilon&#39; \sim\mathcal{N}(0,\mathbf{I})\)</span>ï¼Œæ‰€ä»¥è¿™å°±æ˜¯ä¸¤ä¸ªç‹¬ç«‹é«˜æ–¯åˆ†å¸ƒ <span class="math inline">\(\epsilon&#39;\)</span> å’Œ <span class="math inline">\(\epsilon&#39;&#39;\)</span> çš„å’Œã€‚å› æ­¤<span class="math inline">\(x_{s}\)</span>æ»¡è¶³é«˜æ–¯åˆ†å¸ƒ <span class="math display">\[\begin{align*}x_{s} \sim \mathcal{N}\left(\left(k+m \sqrt{\bar\alpha_{k}}\right)x_{0},m^{2}(1-\bar \alpha_{k})+\sigma^{2}\right)\end{align*}\]</span> é‡å‚æ•°åŒ–åå·²çŸ¥ç»“è®ºè¿›è¡Œå¯¹æ¯” <span class="math display">\[\begin{align*}x_{s} &amp;= \left(k+m\sqrt{\bar \alpha_{k}}x_{0}\right) +\sqrt{m^{2}(1-\bar \alpha_{k}) + \sigma^{2}} \epsilon \\x_{s} &amp;= \sqrt{\bar \alpha_{s}} x_{0} + \sqrt{1 - \bar \alpha_{s}}\epsilon&#39;&#39;\end{align*}\]</span> æ ¹æ®å¾…å®šç³»æ•°å¾—å‡ºä»¥ä¸‹ä¸¤ä¸ªæ–¹ç¨‹ <span class="math display">\[\begin{align*}k + m \sqrt{\bar \alpha_{k}} &amp;= \sqrt{\bar \alpha_{s}}\\\sqrt{m^{2}(1-\bar \alpha_{k}) + \sigma^{2}} &amp;= \sqrt{1 - \bar\alpha_{s}}\end{align*}\]</span> é€šè¿‡ä¸¤ä¸ªæ–¹ç¨‹æˆ‘ä»¬å¯ä»¥å°†<span class="math inline">\(m,k\)</span>è§£å‡º <span class="math display">\[\begin{align*}m &amp;= \sqrt{\frac{1 - \bar \alpha_{s} - \sigma^{2}}{1 - \bar\alpha_{k}}}\\k &amp;= \sqrt{\bar \alpha_{s}} - \sqrt{\frac{(1 - \bar \alpha_{s} -\sigma^{2})\bar \alpha_{k}}{1 - \bar \alpha_{k}}}\end{align*}\]</span> å¸¦å…¥åˆ°å…¬å¼(3)ä¸­ï¼Œå¯ä»¥å¾—åˆ° <span class="math display">\[p(x_{s}| x_{k},x_{0}) \sim \mathcal{N}\left(\left(\sqrt{\bar \alpha_{s}}- \sqrt{\frac{(1 - \bar \alpha_{s} - \sigma^{2})\bar \alpha_{k}}{1 -\bar \alpha_{k}}}\right) x_{0} + \sqrt{\frac{1 - \bar \alpha_{s} -\sigma^{2}}{1 - \bar \alpha_{k}}} x_{k}, \sigma^{2} \mathbf{I}\right)\tag{3}\]</span> é‡æ–°æ•´ç†å¹¶è®©<span class="math inline">\(s=t-1,k=t\)</span>æ—¶ï¼Œå°±å¯ä»¥æ¨å‡ºå…¬å¼(1)</p><p>åœ¨DDIMçš„é™„å½•ä¸­é€šè¿‡æ•°å­¦å½’çº³æ³•è¯æ˜äº†ï¼Œå½“ä½¿ç”¨ç»™å‡ºçš„é‡‡æ ·æ¦‚ç‡åˆ†å¸ƒæ—¶ï¼Œæ˜¯èƒ½å¤Ÿæ»¡è¶³<span class="math inline">\(q(x_{t}|x_{0})\)</span>éœ€è¦çš„æ¦‚ç‡åˆ†å¸ƒçš„ï¼Œå¦‚ä¸‹ä¸¤å¼ å›¾æ‰€ç¤º</p><figure><img src="https://s2.loli.net/2025/02/01/jUeBrI6V3tPdy9N.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><figure><img src="https://s2.loli.net/2025/02/01/tUdTDaHVRzMgYFJ.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>è¿™é‡Œåˆ©ç”¨äº†ç»“è®º(2.115) <img src="https://s2.loli.net/2025/02/01/mkv8KPCtj16N2F3.png" alt="image.png"></p><h2><span id="ç”Ÿæˆè¿‡ç¨‹">ç”Ÿæˆè¿‡ç¨‹</span></h2><p>DDIMçš„ç”Ÿæˆè¿‡ç¨‹å’ŒDDPMæ˜¯ä¸€è‡´çš„ï¼ŒåŒæ ·æ˜¯é€šè¿‡ç¥ç»ç½‘ç»œå­¦ä¹ é¢„æµ‹å™ªå£°ï¼Œå†é€šè¿‡é‡‡æ ·åˆ†å¸ƒè¿›è¡Œé‡‡æ ·è¿›è€Œè¿­ä»£ç”Ÿæˆç»“æœã€‚DDIMè®ºæ–‡é‡Œé€šè¿‡Theorem1è¯´æ˜äº†DDIMå’ŒDDPMçš„å˜åˆ†ç›®æ ‡æ˜¯ä¸€è‡´çš„</p><figure><img src="https://s2.loli.net/2025/02/01/3jHcfplT29bCWPq.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å› æ­¤å¯ä»¥é‡‡ç”¨åŒæ ·çš„ä¼˜åŒ–ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯å¯¹é¢„æµ‹çš„å™ªå£°å’Œå®é™…çš„å™ªå£°è¿›è¡ŒåŒ¹é…<span class="math display">\[\begin{align*}L_{\gamma}(\epsilon_\theta):= \sum_{t=1}^T \gamma_t \mathbb{E}_{\\x_0 \sim q(x_0),\epsilon_t \sim \mathcal{N}({\bf 0}, I)} \left[  \left\|    \epsilon_\theta^{(t)}\left(      \sqrt{\alpha_t}x_0 + \sqrt{1-\alpha_t}\epsilon_t    \right) - \epsilon_t  \right\|_2^2\right]\end{align*}\]</span> (æ³¨ï¼šè¿™é‡Œå¼€å§‹ç”¨çš„éƒ½æ˜¯DDIMè®ºæ–‡ä¸­çš„è¡¨ç¤ºï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(\alpha_{t}=\bar \alpha_{t}\)</span>)æ‰€ä»¥ï¼Œç”±äºä¼˜åŒ–ç›®æ ‡å’Œç”Ÿæˆè¿‡ç¨‹çš„ä¸€è‡´æ€§ï¼ŒDDIMå¯ä»¥åˆ©ç”¨é¢„è®­ç»ƒå¥½çš„DDPMæ¨¡å‹ä½œä¸ºä¼˜åŒ–ç›®æ ‡çš„æ±‚è§£ç»“æœï¼Œä¹Ÿå°±æ˜¯ç›¸åŒçš„å™ªå£°é¢„æµ‹ç½‘ç»œï¼Œåªéœ€è¦è°ƒæ•´é‡‡æ ·çš„è¿‡ç¨‹ä»¥åŠå‚æ•°<span class="math inline">\(\sigma\)</span>å¾—åˆ°æ›´å¥½çš„ç”Ÿæˆè¿‡ç¨‹ã€‚</p><p>é€šè¿‡å°†å…¬å¼(1)è¿›è¡Œé‡å‚æ•°åŒ–å±•å¼€ï¼Œä»¥åŠå°†<span class="math inline">\(x_{0}\)</span>æ›¿æ¢ä¸ºç½‘ç»œé¢„æµ‹ç»“æœï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹é‡‡æ ·è¿‡ç¨‹<span class="math display">\[\begin{align*}\boldsymbol{x}_{t-1} = \sqrt{\alpha_{t-1}} \underbrace{\left(\frac{\boldsymbol{x}_t - \sqrt{1 - \alpha_t}\epsilon^{(t)}_{\theta}(\boldsymbol{x}_t)}{\sqrt{\alpha_t}}\right)}_{\text{&quot;predicted $\boldsymbol{x}_0$&quot;}} +\underbrace{\sqrt{1 - \alpha_{t-1} - \sigma^2_t \cdot\epsilon^{(t)}_{\theta}(\boldsymbol{x}_t)}}_{\text{&quot;directionpointing to $\boldsymbol{x}_t$&quot;}} + \underbrace{\sigma_t\epsilon_t}_{\text{random noise}}\end{align*}\]</span> å…¶ä¸­ï¼Œå½“<span class="math inline">\(\sigma_t = \sqrt{\frac{1 -\alpha_{t-1}}{1 - \alpha_t}} \sqrt{1 -\frac{\alpha_t}{\alpha_{t-1}}}\)</span>æ—¶ï¼Œç”Ÿæˆè¿‡ç¨‹ç­‰ä»·äºDDPMï¼›è€Œå½“<span class="math inline">\(\sigma_{t}=0\)</span>æ—¶ï¼Œè¿™æ—¶randomnoiseå°±æ˜¯0ï¼Œæ‰€ä»¥ç”Ÿæˆè¿‡ç¨‹å°±å¤±å»äº†éšæœºæ€§å˜æˆäº†ä¸€ä¸ªç¡®å®šçš„è¿‡ç¨‹ï¼Œè®ºæ–‡ä¸­å°†è¿™ç§æƒ…å†µç§°ä¹‹ä¸º<em>denoisingdiffusion implicit model</em> (DDIM)</p><p><span class="math inline">\(\sigma_{t}\)</span>å¯ä»¥å†™æˆæ˜¯<span class="math inline">\(\eta (\sqrt{\frac{1 - \alpha_{t-1}}{1 - \alpha_t}}\sqrt{1 - \frac{\alpha_t}{\alpha_{t-1}}})\)</span>çš„å½¢å¼ï¼Œå…¶ä¸­<span class="math inline">\(0 \leq \eta \leq 1\)</span>ç”¨äºæ§åˆ¶ç”Ÿæˆè¿‡ç¨‹</p><h2><span id="åŠ é€Ÿç”Ÿæˆæ¨¡å‹">åŠ é€Ÿç”Ÿæˆæ¨¡å‹</span></h2><p>DDIMè®ºæ–‡æå‡ºäº†è¿™æ ·ä¸€ä¸ªè§‚ç‚¹ï¼šDDPMçš„è®­ç»ƒç»“æœå®è´¨ä¸ŠåŒ…å«äº†å®ƒçš„ä»»æ„å­åºåˆ—å‚æ•°çš„è®­ç»ƒç»“æœã€‚å› æ­¤ï¼Œç”Ÿæˆè¿‡ç¨‹ä¸éœ€è¦ä¸¥æ ¼éµå¾ª<span class="math inline">\((x_{T}, \cdots,x_{1})\)</span>çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯å¯ä»¥è¿›è¡Œè·³è·ƒæ­¥ï¼Œé€‰æ‹©å…¶ä¸­çš„ä¸€ä¸ªé•¿åº¦ä¸º<span class="math inline">\(S\)</span>çš„å­åºåˆ—<span class="math inline">\((x_{\tau_{S}},\cdots,x_{\tau_{1}})\)</span>åšç”Ÿæˆï¼Œåªéœ€è¦æ»¡è¶³<span class="math display">\[q(x_{\tau_{i}} | x_{0}) =\mathcal{N}(x_{\tau_{i}};\sqrt{\alpha_{\tau_{i}}x_{0}}, (1-\alpha_{\tau_{i}}) \mathbf{I})\]</span> å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæœ¬æ¥ç”Ÿæˆè¿‡ç¨‹æ˜¯<span class="math inline">\(x_{3}\rightarrow x_{2} \rightarrow x_{1} \rightarrow x_{0}\)</span>ï¼Œç°åœ¨å¯ä»¥è·³æ­¥ï¼Œå˜æˆäº†<span class="math inline">\(x_{3}  \rightarrowx_{1} \rightarrow x_{0}\)</span></p><figure><img src="https://s2.loli.net/2025/02/01/L6X3GFI9Eh2lT1i.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><div class="note info no-icon"><h2><span id="æ–¹å·®é€‰æ‹©æ•´ç†ddpm-amp-ddim">ğŸ“Œæ–¹å·®é€‰æ‹©æ•´ç†(DDPM &amp; DDIM)</span></h2><p><strong>DDPM</strong> çš„æ–¹å·®é€‰æ‹©<a href="https://zhuanlan.zhihu.com/p/525106459">1</a>ï¼š</p><ol type="1"><li><strong><span class="math inline">\(\sigma_{t, \theta}^2 =\Sigma_{\theta}(x_t, t)\)</span></strong><ul><li>æ¨¡å‹å­¦ä¹ çš„æ–¹å·®ï¼ˆç§°ä¸º <code>learned</code>ï¼‰<br></li><li>å®é™…æœªåœ¨ DDPM ä¸­ä½¿ç”¨ï¼Œä½†è¢« GLIDE é‡‡ç”¨ã€‚</li></ul></li><li><strong><span class="math inline">\(\sigma_{t, s}^2 = \beta_t =\frac{1 - \alpha_{t-1}}{1 - \alpha_t} \beta_t\)</span></strong><ul><li>ç”±å…¬å¼ (8-1) æ¨å¯¼å¾—å‡ºï¼ˆç§°ä¸º <code>fixedsmall</code>ï¼‰<br></li><li>ç”¨äº <code>celebahq</code> å’Œ <code>lsun</code> æ•°æ®é›†ã€‚</li></ul></li><li><strong><span class="math inline">\(\sigma_{t, l}^2 =\beta_t\)</span></strong><ul><li>ç§°ä¸º <code>fixedlarge</code>ï¼Œç”¨äº <code>cifar10</code> æ•°æ®é›†<br></li><li>æ»¡è¶³ <span class="math inline">\(\sigma_{t,l} &gt;\sigma_{t,s}\)</span>ï¼Œå³æ–¹å·®æ›´å¤§ã€‚</li></ul></li></ol><p><strong>DDIM</strong> çš„æ–¹å·®é€‰æ‹©ï¼š - <strong><span class="math inline">\(\sigma_t(\eta)^2 = \eta \cdot\hat{\beta}_t\)</span></strong><br>- åŸºäº DDPM çš„ <code>fixedsmall</code> ç‰ˆæœ¬ï¼Œé¢å¤–ä¹˜ä»¥ç³»æ•° <span class="math inline">\(\eta\)</span>ã€‚</p></div><h1><span id="latent-diffusion-modelstable-diffusion">Latent Diffusion Model(Stable Diffusion)</span></h1><p>DDPMè¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯éœ€è¦å¤§é‡çš„è®¡ç®—èµ„æºã€‚ç”±äºDDPMç›´æ¥åœ¨å›¾åƒç©ºé—´ä¸Šè¿›è¡Œè®­ç»ƒå’Œæ¨ç†ï¼Œå¯¼è‡´äº†éå¸¸è€—æ—¶ã€‚LDM(Latent Diffusion Model)ä¹Ÿå°±æ˜¯StableDiffusionæå‡ºäº†ä¸€ç§æ–¹æ³•ï¼Œé¦–å…ˆå°†å›¾åƒç”¨VAE encodeä¸ºä¸€ä¸ªä½åˆ†è¾¨ç‡çš„latentspaceï¼Œåœ¨latent spaceä¸Šè¿›è¡Œç”Ÿæˆï¼Œç„¶åå†å°†latent spacedecodeè¿˜åŸä¸ºå›¾åƒç©ºé—´ï¼Œèƒ½å¤Ÿå¤§å¤§é™ä½è®­ç»ƒæ¨ç†æ‰€éœ€çš„è®¡ç®—èµ„æºã€‚</p><p><img src="https://s2.loli.net/2024/05/06/kYpVcjCnD8HMLsU.png" alt="image.png"> <img src="https://s2.loli.net/2024/05/06/4LaDJd8OYxzNyrR.png" alt="image.png"></p><p>LDMè®ºæ–‡è§‚å¯Ÿåˆ°ï¼ŒDDPMæ¨¡å‹å¯¹å›¾åƒçš„å‹ç¼©é€šå¸¸ç”±perceptualcompressionå’Œsemanticcompressionç»„æˆã€‚å› æ­¤ï¼ŒLDMæå‡ºå¯ä»¥ç”¨Autoencoderå°†å›¾åƒçš„perceptualinformationåœ¨è®­ç»ƒä¸­å‰”é™¤æ‰ï¼Œåªè®©Diffusion Modelå¯¹semanticçš„éƒ¨åˆ†å‹ç¼©ã€‚</p><figure><img src="https://s2.loli.net/2025/02/02/7iBW56zIRHwujoe.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>LDMé‡‡ç”¨çš„ç½‘ç»œæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶ä¸­<span class="math inline">\(\varepsilon\)</span> å’Œ<span class="math inline">\(\mathcal{D}\)</span>åˆ†åˆ«æ˜¯é¢„è®­ç»ƒå¥½çš„Autoencoderä¸­çš„Encoderå’ŒDecoderã€‚é€šè¿‡Encoderé¦–å…ˆå°†å›¾ç‰‡è¿›è¡Œperceptualcompressionå¾—åˆ°latent space <span class="math inline">\(z\)</span>ï¼Œç„¶ååœ¨latent spaceé€šè¿‡diffutionprocessè¿›è¡ŒåŠ å™ªã€‚Denoise processé‡‡ç”¨äº†å¸¦æœ‰Attentionçš„UNetæ¶æ„ï¼Œé€šè¿‡CrossAttentionæ³¨å…¥conditioningä¿¡æ¯ã€‚</p><figure><img src="https://s2.loli.net/2025/02/02/dVxjIQYXLRefzU9.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>Attentionç”±å¾ˆå¤šå˜ç§ï¼Œåœ¨LDMä¸­ä¸»è¦æœ‰Self Attentionå’ŒCrossAttentionä¸¤ç§ã€‚</p><ul><li>Cross Attention<ul><li><span class="math inline">\(CrossAttn(A,B)=Attentino(W_{Q} \cdot A,W_{K} \cdot B, W_{V} \cdot B)\)</span></li><li>å¯ä»¥ç†è§£ä¸ºåˆ©ç”¨Aå¯¹Bä¸Šçš„ä¿¡æ¯è¿›è¡ŒQueryï¼Œæ¯”å¦‚åœ¨ä¸‹å›¾ä¸­ï¼Œä¸åŒçš„æ–‡æœ¬tokenä¼šäº§ç”Ÿä¸åŒçš„attentionmap <img src="https://s2.loli.net/2025/02/02/TrSogKQdJaFP8Ul.png" alt="image.png"></li></ul></li><li>Self Attention<ul><li><span class="math inline">\(SelfAttn(A)=Attention(W_{Q} \cdot A,W_{K} \cdot A, W_{V} \cdot A)\)</span></li><li>å¯ä»¥ç†è§£ä¸ºAè‡ªå·±ä½œäº†ä¸€æ¬¡ç‰¹å¾æå–ï¼Œå°†é‡è¦çš„ä¿¡æ¯æå–å‡ºæ¥</li></ul></li></ul><figure><img src="https://s2.loli.net/2025/02/02/X67Cj9gVvFNSBmH.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>æ€»ç»“ä¸€ä¸‹ï¼ŒLDMæœ€ä¸»è¦çš„æ˜¯ä¸¤ä¸ªè´¡çŒ®</p><ol type="1"><li>åœ¨diffusion modelçš„åŸºç¡€ä¸Šï¼Œå¯¹å›¾åƒç©ºé—´è¿›è¡Œå‹ç¼©ï¼Œåœ¨å‹ç¼©åçš„latentspaceä¸Šè¿›è¡Œdiffusionç”Ÿæˆ</li><li>ä½¿ç”¨cross attentionå°†conditioningä¿¡æ¯æ³¨å…¥åˆ°ç½‘ç»œä¸­</li></ol><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><ol type="1"><li><a href="https://zhuanlan.zhihu.com/p/525106459">ç”±æµ…å…¥æ·±äº†è§£DiffusionModel - çŸ¥ä¹</a></li><li><a href="https://zhuanlan.zhihu.com/p/599160988">ä¸€æ–‡è¯»æ‡‚DiffusionModel - çŸ¥ä¹</a></li><li><a href="https://arxiv.org/pdf/2208.11970">Understanding DiffusionModels: A Unified Perspective</a></li><li><a href="https://zhuanlan.zhihu.com/p/565698027">æ‰©æ•£æ¨¡å‹ä¹‹DDIM -çŸ¥ä¹</a></li><li><a href="https://kexue.fm/archives/9181">ç”Ÿæˆæ‰©æ•£æ¨¡å‹æ¼«è°ˆï¼ˆå››ï¼‰ï¼šDDIM =é«˜è§‚ç‚¹DDPM - ç§‘å­¦ç©ºé—´|Scientific Spaces</a></li><li><a href="https://www.bilibili.com/video/BV1YS421d7DN">ã€è®ºæ–‡ç²¾è¯»ã€‘DENOISINGDIFFUSION IMPLICIT MODELSã€DDIMçš„èƒŒæ™¯ä»‹ç»ã€‘</a></li><li><a href="https://zhouyifan.net/2024/01/23/20230709-SD2/">StableDiffusion è§£è¯»ï¼ˆäºŒï¼‰ï¼šè®ºæ–‡ç²¾è¯» | å‘¨å¼ˆå¸†çš„åšå®¢</a></li><li><a href="https://zhouyifan.net/2024/01/23/20230713-SD3/">StableDiffusion è§£è¯»ï¼ˆä¸‰ï¼‰ï¼šåŸç‰ˆå®ç°åŠDiffuserså®ç°æºç è§£è¯» |å‘¨å¼ˆå¸†çš„åšå®¢</a></li><li><a href="https://arxiv.org/pdf/2403.03431">Towards UnderstandingCross and Self-Attention in Stable Diffusion for Text-Guided ImageEditing</a></li><li><a href="https://arxiv.org/abs/2208.01626">Prompt-to-Prompt ImageEditing with Cross Attention Control</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ComputerVision </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CV </tag>
            
            <tag> Diffusion </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®æ—¶æ¸²æŸ“ç¬”è®°-Importance Resampling and ReSTIR</title>
      <link href="/2025/01/04/gamegraphics/shi-shi-xuan-ran-bi-ji-importance-resampling-and-restir/"/>
      <url>/2025/01/04/gamegraphics/shi-shi-xuan-ran-bi-ji-importance-resampling-and-restir/</url>
      
        <content type="html"><![CDATA[<h2><span id="resampled-importance-samplingris">Resampled importance sampling(RIS)</span></h2><h3><span id="risç®—æ³•æµç¨‹">RISç®—æ³•æµç¨‹</span></h3><p>RISæµç¨‹:</p><ol type="1"><li>ä»ä¸€ä¸ªæ˜“äºé‡‡æ ·çš„åˆ†å¸ƒ(<strong>proposal PDF</strong>) <span class="math inline">\(p(x)\)</span>ä¸Šï¼Œè¿›è¡Œé‡‡æ ·ï¼ŒæŠ½å–<span class="math inline">\(M\)</span>ä¸ªæ ·æœ¬</li><li>å¾—åˆ°ä¸€ä¸ªæœŸæœ›è¿›è¡Œæ‹Ÿåˆçš„çœŸå®ç›®æ ‡æ¦‚ç‡åˆ†å¸ƒ(<strong>target PDF</strong>)<span class="math inline">\(\hat p(x)\)</span></li><li>å¯¹äºæ¯ä¸€ä¸ªæŠ½å–çš„æ ·æœ¬ï¼Œåˆ†é…æƒé‡<span class="math inline">\(w(x)={\hatp(x)}/{p(x)}\)</span>ï¼Œè¿›è€Œå¾—åˆ°æ¯ä¸ªæ ·æœ¬çš„æ¡ä»¶æ¦‚ç‡ï¼Œé€šè¿‡è¿™ç§æ–¹å¼è¿›è¡Œé‡‡æ ·çš„æ–¹æ³•å«åšé‡è¦æ€§é‡é‡‡æ ·Samplingimportance resampling (SIR)</li><li>é‡‡æ ·å‡ºæ¥çš„ç»“æœå¯ä»¥ç”¨äº1-sample RIS estimator</li></ol><p><span class="math display">\[\langle L \rangle = \frac{f(y)}{\hat p(y)} \cdot \left(\frac{1}{M}\sum\limits_{j=1}^{M}w(x_{j}) \right)\]</span></p><ol start="5" type="1"><li>å¤šæ¬¡è¿›è¡ŒRISé‡‡æ ·ï¼Œä»æ ·æœ¬æ± ä¸­çš„<span class="math inline">\(M\)</span>ä¸ªæ ·æœ¬ï¼ˆå¯ä»¥é‡æ–°ç”Ÿæˆæ ·æœ¬æ± ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨åŒä¸€ä¸ªæ ·æœ¬æ± ä¸­è¿›è¡Œé‡‡æ ·è¿›è¡Œç®€åŒ–ï¼‰ä¸­æœ‰æ”¾å›çš„é‡‡æ ·<span class="math inline">\(N\)</span>ä¸ªæ ·æœ¬ï¼Œå¾—åˆ°æœ€ç»ˆçš„ç»“æœ</li></ol><p><span class="math display">\[\langle L \rangle = \frac{1}{N}\sum\limits_{i=1}^{N}\left(\frac{f(y_{i})}{\hat p(y_{i})} \cdot \left(\frac{1}{M}\sum\limits_{j=1}^{M}w_{i}(x_{ij}) \right) \right)\]</span> <span id="more"></span></p><p>å…¶ä¸­<span class="math inline">\(\hat{p}(y)/\frac{1}{M}\sum\limits_{j=1}^{M}w(x_{j})\)</span>æ˜¯<strong>SIR PDF</strong>ï¼Œä¹Ÿå°±æ˜¯ä¿®æ­£è¿‡åçš„çœŸå®çš„é‡‡æ ·çš„PDF</p><p>é€šè¿‡RISæ–¹æ³•è¿›è¡Œé‡‡æ ·å¥½å¤„æ˜¯å¯ä»¥è¿‘ä¼¼çš„é‡‡æ ·ä»»æ„çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ReSTIRç®—æ³•ä¸­å¯ä»¥å°†<span class="math inline">\(L(\omega)f_{r}(\omega_{o},\omega_{i})\cos{\theta_{i}}\)</span>ï¼Œä¹Ÿå°±æ˜¯renderingequationä¸­é™¤å»visibilityçš„å…‰ç…§è´¡çŒ®ï¼Œè®ºæ–‡ä¸­ç§°ä¹‹ä¸º<em>unshadowedillumination</em>ä½œä¸ºç›®æ ‡å‡½æ•°ï¼ˆå¯¹è¿™ä¸ªæ¦‚ç‡åˆ†å¸ƒé‡‡ç”¨ä¼ ç»Ÿé‡‡æ ·æ–¹æ³•æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºæ— æ³•è¿›è¡Œå½’ä¸€åŒ–ï¼ŒPDFæ˜¯æ— æ³•è®¡ç®—å‡ºæ¥çš„ï¼‰</p><p>ä¸‹é¢ä¸¤å¼ å›¾å±•ç¤ºäº†RISçš„ä¼ªä»£ç å’Œæµç¨‹</p><figure><img src="https://s2.loli.net/2025/01/04/FbSWmNk8jGDxhlq.png" alt="image-20250104021443035"><figcaption aria-hidden="true">image-20250104021443035</figcaption></figure><figure><img src="https://s2.loli.net/2024/12/26/Vy3fwR1AgBmqsl9.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h3><span id="riså’Œmisç›¸ç»“åˆ">RISå’ŒMISç›¸ç»“åˆ</span></h3><p>åœ¨ä½¿ç”¨RISçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨MISï¼Œè¿›ä¸€æ­¥é™ä½æ–¹å·®ï¼Œè¾¾åˆ°æ›´å¥½çš„æ•ˆæœã€‚è¿™é‡Œé€šå¸¸æœ‰ä¸¤ç§ç»“åˆçš„æ–¹å¼ã€‚</p><p><strong>ç¬¬ä¸€ç§æ–¹æ³•</strong>ç¬¬ä¸€æ­¥çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥é‡‡ç”¨MISçš„æ–¹å¼åœ¨ä¸¤ä¸ªæ¦‚ç‡åˆ†å¸ƒä¸Šè¿›è¡Œé‡‡æ ·ï¼Œå¾—åˆ°ä¸¤ç»„é‡‡æ ·åçš„ç»“æœã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåˆ†é…æƒé‡çš„æ—¶å€™å°±éœ€è¦è€ƒè™‘ä½¿ç”¨MISçš„ç»“æœã€‚æ­£å¦‚GRISÂ <a href="https://research.nvidia.com/publication/2022-07_generalized-resampled-importance-sampling-foundations-restir">è®ºæ–‡</a>ä¸­æŒ‡å‡ºçš„ï¼Œæ¯ä¸ªproposalPDF çš„æƒé‡å¯ä»¥æ¨å¹¿åˆ°è¿™ç§å½¢å¼ <span class="math display">\[w_{i}(x)=m_{i}(x)\frac{\hat p(x)}{p_{i}(x)}\]</span> å…¶ä¸­<span class="math inline">\(m_{i}(x)\)</span>ä»£è¡¨çš„æ˜¯MISä¸­é‡‡ç”¨çš„æƒé‡ï¼Œä¸€èˆ¬å¸¸ç”¨çš„æ˜¯balancedheuristic [[Computer Graphics Review#Multiple Importancesampling]]ï¼Œå½¢å¼å¦‚ä¸‹ï¼š <span class="math display">\[w_{s}(x)=\frac{N_{s}p_{s}(x)}{\sum\nolimits_{j}N_{j}p_{j}(x)}\]</span></p><figure><img src="https://s2.loli.net/2024/12/26/42CTh9gFWils5bD.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><div class="note info no-icon"><p>Luckily, Talbot [2005] showed how to leverage multiple competingtechniques using MIS within RIS to reduce variance: generate the pool ofproposals using MIS and use the effective MIS (mixture) PDF as thesource PDF in the rest of the RIS procedure.</p></div><p><strong>ç¬¬äºŒç§æ–¹æ³•</strong></p><p>å¦å¤–æˆ‘ä»¬è¿˜å¯ä»¥æŠŠSIRè§†ä½œä¸€ç§å•ç‹¬çš„é‡‡æ ·æ–¹æ³•ï¼Œç„¶åå¯¹äºSIRå¾—åˆ°çš„ç»“æœä¹‹åå†è¿›è¡ŒMIS</p><figure><img src="https://s2.loli.net/2024/12/27/OKDh7cBasIMvwmQ.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h3><span id="risçš„æ— åæ€§æ¨å¯¼">RISçš„æ— åæ€§æ¨å¯¼</span></h3><p>é¦–å…ˆéœ€è¦è¯æ˜RISæ˜¯æ— åçš„ï¼Œæˆ‘ä»¬åªéœ€è¦è¯æ˜ä¸€ä¸‹ç»“è®ºæˆç«‹ <span class="math display">\[\mathbb{E}\left( \frac{1}{N}\sum\nolimits_{i=1}^{N}\frac{f(y_{i})}{\hat{p}(y_{i})} \left(\frac{1}{M}\sum\limits_{j=1}^{M}w(x_{ij}) \right) \right) = \int{f(x)}{\mathrm{d}{x}}\]</span>ä¸ºäº†æ¨å¯¼æ–¹ä¾¿ï¼Œè¿™é‡Œå®šä¹‰ä¸€äº›ç®€åŒ–çš„è¡¨ç¤ºä»¥åŠå›é¡¾ä¹‹å‰çš„ä¸€äº›å…¬å¼ä»¥åŠä¸€äº›éœ€è¦ç”¨åˆ°çš„ç»“è®º<span class="math display">\[\begin{align*}W&amp;= \sum\limits_{i=1}^{M}w_{i}(x_{i})\\w_{i}(x)&amp;= m_{i}(x)\frac{\hat p(x)}{p_{i}(x)}\\\mathbb{E}\left( X \right) &amp;= \mathbb{E}\left( \mathbb{E}(X|Y)\right)\end{align*}\]</span> å¹¶ä¸”ç”±äºå¼•å…¥äº†GRISï¼Œè¿™é‡Œæ–°å¼•å…¥çš„æƒé‡<span class="math inline">\(m(x)\)</span>ä¸­åŒ…å«äº†å½’ä¸€åŒ–çš„<span class="math inline">\(1/M\)</span>ï¼Œå› æ­¤è¿™é‡Œéœ€è¦å¿½ç•¥ <span class="math display">\[\mathbb{E}\left( \frac{1}{N}\sum\nolimits_{i=1}^{N}\frac{f(y_{i})}{\hat{p}(y_{i})} \left( \sum\limits_{j=1}^{M}w(x_{ij})\right) \right) = \int{f(x)} {\mathrm{d}{x}}\]</span> è¯¦ç»†æ¨å¯¼è¿‡ç¨‹ï¼Œåœ¨<a href="https://agraphicsguynotes.com/posts/understanding_the_math_behind_restir_di/#resampled-importance-sampling-ris">UnderstandingThe Math Behind ReStir DI Â· A Graphics Guy'sNote</a>æ¨å¯¼çš„åŸºç¡€ä¸Šæ·»åŠ äº†ä¸€äº›ä¸­é—´æ­¥éª¤ï¼Œä¸çŸ¥é“ç†è§£æ˜¯å¦æ­£ç¡®ã€‚ <span class="math display">\[\begin{align*}&amp;\mathbb{E}\left( \frac{1}{N}\sum\nolimits_{i=1}^{N}\frac{f(y_{i})}{\hat{p}(y_{i})} \left( \sum\limits_{j=1}^{M}w(x_{ij})\right) \right) \\=&amp; \frac{1}{N}\sum\limits_{i=1}^{N}\mathbb{E}\left(\frac{f(y_{i})}{\hat{p}(y_{i})} \left(\sum\limits_{j=1}^{M}w(x_{ij})\right) \right)\\=&amp; \mathbb{E}\left( \frac{f(y)}{\hat p(y)}\left(\sum\limits_{j=1}^{M}w(x_{j}) \right) \right) = \mathbb{E}\left(\frac{f(y)}{\hat p(y)} W\right)\\=&amp; \mathbb{E}\left( \mathbb{E}\left( \frac{f(y)}{\hat p(y)}W\middle|x_{1},\cdots x_{k} \right) \right)\\=&amp; \underbrace{\int \cdots\int}_{M}\mathbb{E}\left(\frac{f(x_{k})}{\hat p(x_{k})}W  \right) \prod_{i=1}^{M}p(x_{i})\mathrm{d}{x_{1}}\cdots \mathrm{d}{x_{M}}\\=&amp; \underbrace{\int \cdots\int}_{M} \left(\sum\limits_{k=1}^{M}\frac{f(x_{k})}{\hat p(x_{k})}W \cdotp(y=x_{k}\vert x_{1},\cdots, x_{k})\right)\prod_{i=1}^{M}p(x_{i})\mathrm{d}{x_{1}}\cdots \mathrm{d}{x_{M}} \\=&amp; \underbrace{\int \cdots\int}_{M} \left(\sum\limits_{k=1}^{M}\frac{f(x_{k})}{\hat p(x_{k})}W\frac{w(x_{k})}{W}\right)\prod_{i=1}^{M}p(x_{i}) \mathrm{d}{x_{1}}\cdots\mathrm{d}{x_{M}} \\=&amp; \sum\limits_{k=1}^{M}\underbrace{\int \cdots\int}_{M} \left(m_{k}(x_{k}) f(x_{k}) \right)\prod_{i=1\&amp;i \ne k}^{M}p(x_{i})\mathrm{d}{x_{1}}\cdots \mathrm{d}{x_{M}} \\=&amp; \sum\limits_{k=1}^{M}\intm_{k}(x_{k})f(x_{k})\mathrm{d}x_{k}\prod_{i=1\&amp;i \ne k}^{M}\intp(x_{i})\mathrm{d}x_{i}  \\=&amp; \int \sum\limits_{k=1}^{M}m_{k}(x)f(x) \mathrm{d}x_{k}=\int f(x)\mathrm{d}x_{k}\end{align*}\]</span></p><h2><span id="weighted-reservoir-samplingwrs">Weighted Reservoir Sampling(WRS)</span></h2><h3><span id="wrsç®—æ³•æµç¨‹">WRSç®—æ³•æµç¨‹</span></h3><p>WRSæ˜¯ä¸€ç§ä»ä¸€ä¸ªæµ(stream)<span class="math inline">\(\{x_{1}, x_{2},\cdots,x_{M}\}\)</span>è¿›è¡Œæµå¼é‡‡æ ·çš„ç®—æ³•ï¼Œæ¯ä¸ªå…ƒç´ æœ‰ä¸€ä¸ªå¯¹åº”çš„æƒé‡<span class="math inline">\(w(x_{i})\)</span>ï¼Œæ‰€ä»¥<span class="math inline">\(x_{i}\)</span>è¢«é€‰ä¸­çš„æ¦‚ç‡æ˜¯ <span class="math display">\[P_{i}=\frac{w(x_{i})}{\sum\limits_{j=1}^{M}w(x_{j})}\]</span> <img src="https://s2.loli.net/2025/01/04/YywevT6aHLkQ9gj.png" alt="image-20250104022122055"></p><p>æ•°æ®ç»“æ„</p><ul><li>æœ€ç»ˆè¾“å‡ºçš„é‡‡æ ·çš„æ ·æœ¬</li><li>å½“å‰æƒé‡ä¹‹å’Œ</li><li>å½“å‰å¤„ç†è¿‡çš„æ ·æœ¬æ•°é‡<span class="math inline">\(M\)</span></li></ul><p>è¾“å…¥ï¼šåŠ æƒæ ·æœ¬é›†åˆ(<span class="math inline">\(\mathbb{S}\)</span>)ä»¥åŠå¯¹åº”æƒé‡</p><p>æµç¨‹:ä¾æ¬¡éå†é›†åˆä¸­æ‰€æœ‰æ ·æœ¬ï¼Œæ¯æ¬¡updateæ—¶æ›´æ–°æƒé‡ä¹‹å’Œï¼Œå¹¶å¯¹å½“å‰æ ·æœ¬ä»¥<span class="math inline">\(w_{i}/w_{\text{sum}}\)</span>çš„æ¦‚ç‡è¿›è¡Œæ ·æœ¬çš„æ›¿æ¢æˆ–ä¿ç•™ã€‚</p><p>WRSç®—æ³•å¯ä»¥ä¿è¯åœ¨æ¯ä¸€æ¬¡å¤„ç†ä¸€ä¸ªæ–°çš„æ ·æœ¬æ—¶ï¼Œé€‰æ‹©æ¯ä¸€ä¸ªæ ·æœ¬çš„æ¦‚ç‡éƒ½æ˜¯æ»¡è¶³åŠ æƒæ¦‚ç‡çš„ã€‚åœ¨å¤„ç†å®Œç¬¬<span class="math inline">\(m+1\)</span>ä¸ªæ ·æœ¬çš„æ—¶å€™ï¼Œå‰<span class="math inline">\(m\)</span>ä¸ªæ ·æœ¬ä¸­<span class="math inline">\(x_{i}\)</span>è¢«ä¿ç•™çš„æ¦‚ç‡æ˜¯ <span class="math display">\[\frac{w(x_{i})}{\sum\nolimits_{j=1}^{m}w({x_{j}})}\left(1-\frac{w(x_{m+1})}{\sum\nolimits_{j=1}^{m+1}w({x_{j}})}\right)=\frac{w(x_{i})}{\sum\nolimits_{j=1}^{m+1}w({x_{j}})}\]</span> è¿™ä¸ªæ¦‚ç‡ä»ç„¶æ»¡è¶³åŠ æƒæ¦‚ç‡çš„è¦æ±‚ã€‚</p><h3><span id="reservoirçš„åˆå¹¶">Reservoirçš„åˆå¹¶</span></h3><p>å‡å¦‚æˆ‘ä»¬ç°åœ¨æœ‰ä¸¤ä¸ªReservoirï¼Œå…¶ä¸­<span class="math inline">\(A\)</span>å·²ç»å¤„ç†äº†<span class="math inline">\(N\)</span>ä¸ªæ ·æœ¬ï¼Œ<span class="math inline">\(B\)</span>å¤„ç†äº†<span class="math inline">\(M\)</span>ä¸ªæ ·æœ¬ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸¤ä¸ªReservoirè¿›è¡Œåˆå¹¶ï¼Œå¾—åˆ°ä¸€ä¸ªå¤„ç†äº†<span class="math inline">\(N+M\)</span>æ ·æœ¬çš„å¤§Reservoirã€‚</p><p>é€‰æ‹©<span class="math inline">\(A\)</span>çš„æ¦‚ç‡: <span class="math inline">\(w_{sum}^{A}/(w_{sum}^{A}+w_{sum}^{B})\)</span>é€‰æ‹©<span class="math inline">\(B\)</span>çš„æ¦‚ç‡: <span class="math inline">\(w_{sum}^{B}/(w_{sum}^{A}+w_{sum}^{B})\)</span>é€‰æ‹©<span class="math inline">\(A\)</span>ä¸­æ ·æœ¬<span class="math inline">\(x^{A}_{i}\)</span>çš„æ¦‚ç‡ <span class="math display">\[\frac{w_{i}^{A}}{w^{A}_{sum}}\cdot\frac{w_{sum}^{A}}{(w_{sum}^{A}+w_{sum}^{B})}=\frac{w_{i}^{A}}{(w_{sum}^{A}+w_{sum}^{B})}\]</span> é€‰æ‹©<span class="math inline">\(B\)</span>ä¸­æ ·æœ¬<span class="math inline">\(x^{B}_{i}\)</span>çš„æ¦‚ç‡</p><p><span class="math display">\[\frac{w_{i}^{B}}{w^{B}_{sum}}\cdot\left(1-\frac{w_{sum}^{A}}{(w_{sum}^{A}+w_{sum}^{B})}\right)=\frac{w_{i}^{B}}{(w_{sum}^{A}+w_{sum}^{B})}\]</span></p><p>ä»ç„¶ç¬¦åˆåŠ æƒæ¦‚ç‡çš„è¦æ±‚ã€‚</p><figure><img src="https://s2.loli.net/2025/01/04/gJVKGQuo9Cn82MP.png" alt="image-20250104022139413"><figcaption aria-hidden="true">image-20250104022139413</figcaption></figure><p>WRSçš„å¥½å¤„</p><ol type="1"><li>é‡‡æ ·åŠ æƒçš„ç¦»æ•£å€¼æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œé¢„å¤„ç†ä»¥åŠé¢å¤–çš„å­˜å‚¨</li><li>ä¸å…³å¿ƒæ ·æœ¬æ€»æ•°</li><li>çµæ´»çš„é‡‡æ ·æ—¶æœºï¼Œæ¯”å¦‚åœ¨ç©ºé—´ä¸Šã€åœ¨æ—¶é—´ä¸Šæˆ–è€…æ˜¯å¤šçº¿ç¨‹ä¸Šè¿›è¡Œé‡‡æ ·</li><li>å…·æœ‰å±‚æ¬¡ç»“æ„ï¼Œå¯ä»¥åˆ†è€Œæ²»ä¹‹çš„è¿›è¡Œé‡‡æ ·</li></ol><h2><span id="åœ¨risä¸­ä½¿ç”¨wrsè¿›è¡Œé‡‡æ ·">åœ¨RISä¸­ä½¿ç”¨WRSè¿›è¡Œé‡‡æ ·</span></h2><p>æœ‰äº†RISå’ŒWRSä¹‹åï¼Œå¯ä»¥å°†ä¸¤è€…ç»“åˆï¼Œæ¯ä¸€æ¬¡ç”Ÿæˆä¸€ä¸ªRISçš„æ ·æœ¬æ± ä¸­çš„æ ·æœ¬åï¼Œç›´æ¥è®¡ç®—æƒé‡åˆ©ç”¨Reservoirè¿›è¡Œé‡‡æ ·ï¼Œçœå»äº†é¢„å¤„ç†çš„ä»¥åŠæŸ¥æ‰¾é‡‡æ ·çš„æ­¥éª¤</p><figure><img src="https://s2.loli.net/2025/01/04/8LH2ZMPqpxFXsW1.png" alt="image-20250104022157281"><figcaption aria-hidden="true">image-20250104022157281</figcaption></figure><p>ReSTIRç®—æ³•é™¤äº†å°†RISå’ŒMRSç»“åˆèµ·æ¥ä»¥å¤–ï¼Œè¿˜å¼•å…¥äº†ç©ºé—´(Spatio)å’Œæ—¶é—´(Temporal)ä¸Šçš„æ ·æœ¬çš„é‡å¤åˆ©ç”¨ã€‚åœ¨ç©ºé—´ä¸Šï¼ŒReSTIRä¼šcombineå½“å‰åƒç´ ç‚¹å’Œé‚»å±…åƒç´ çš„reservoirsã€‚åœ¨æ—¶é—´ä¸Šï¼ŒReSTIRä¼šå­˜å‚¨ä¸Šä¸€å¸§çš„æ¯ä¸€ä¸ªåƒç´ çš„reservoirï¼Œå’Œå½“å‰å¸§å¯¹åº”åƒç´ çš„reservoirè¿›è¡Œcombineã€‚</p><p>ä½¿ç”¨spatialtemporalreuseçš„åŸå› æ˜¯å› ä¸ºåœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿‘é‚»åƒç´ çš„å‡ ä½•æè´¨ç­‰ç›¸å…³ä¿¡æ¯å’Œè¯¥åƒç´ å…·æœ‰ç›¸ä¼¼æ€§ï¼Œå¹¶ä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸Šä¸€å¸§çš„ä¿¡æ¯ä¹Ÿå¯ä»¥åœ¨ä¸‹ä¸€å¸§ä¸Šè¿›è¡Œåˆ©ç”¨ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå¯ä»¥æ‰©å¤§åˆç†çš„æ ·æœ¬é‡ï¼Œä»è€Œè¿›ä¸€æ­¥é™ä½æ–¹å·®ã€‚ä»¥ä¸‹æ˜¯ReSTIRå®Œæ•´çš„ä¼ªä»£ç ã€‚</p><figure><img src="https://s2.loli.net/2025/01/04/9pKyxtMiB4ObeT2.png" alt="image-20250104022219028"><figcaption aria-hidden="true">image-20250104022219028</figcaption></figure><h3><span id="ä¸€äº›ç–‘é—®">ä¸€äº›ç–‘é—®</span></h3><p>é¦–å…ˆæ³¨æ„åˆ°ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨äº†é‚»å±…åƒç´ çš„reservoirè¿›è¡Œåˆå¹¶ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾é‚»å±…åƒç´ çš„targetPDFå’Œå½“å‰åƒç´ çš„æ˜¾ç„¶æ˜¯ä¸ä¸€è‡´çš„ã€‚è¿™é‡Œåº”è¯¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºè¿™é‡Œåªæ˜¯å°†é‚»å±…åƒç´ çš„SIRPDFä½œä¸ºäº†ä¸€ä¸ªæ–°çš„proposal PDFå¼•å…¥äº†ï¼Œå®é™…æ‹Ÿåˆçš„targetPDFä»ç„¶æ˜¯å½“å‰åƒç´ çš„æ¦‚ç‡åˆ†å¸ƒï¼Œæ‰€ä»¥å¹¶ä¸ä¼šé€ æˆé—®é¢˜ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œåœ¨å°†RISå’ŒMISç»“åˆèµ·æ¥çš„æ—¶å€™ï¼ŒMISçš„æƒé‡é€‰æ‹©ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼ŒMISçš„æƒé‡é‡‡ç”¨çš„æ˜¯heuristicweightsï¼Œä½†æ˜¯åœ¨è¿™é‡Œç”±äºæ— æ³•å¾ˆæ–¹ä¾¿çš„è®¡ç®—ä¸€ä¸ªç»™å®šæ–¹å‘ä¸Šçš„SIRPDFï¼Œæ‰€ä»¥æ— æ³•å®ç°ã€‚å› æ­¤ï¼Œè®ºæ–‡ä¸­é‡‡ç”¨äº†uniformçš„æƒé‡ï¼Œä»ç„¶æ»¡è¶³MISçš„æ¡ä»¶ã€‚</p><h2><span id="reference">Reference</span></h2><ol type="1"><li><a href="https://blog.traverseresearch.nl/dynamic-diffuse-global-illumination-b56dc0525a0a">Dynamicdiffuse global illumination | by Darius Bouma | Dec, 2023 | TraverseResearch</a></li><li><a href="https://research.nvidia.com/sites/default/files/pubs/2020-07_Spatiotemporal-reservoir-resampling/ReSTIR.pdf">research.nvidia.com/sites/default/files/pubs/2020-07_Spatiotemporal-reservoir-resampling/ReSTIR.pdf</a></li><li><a href="https://agraphicsguynotes.com/posts/understanding_the_math_behind_restir_di/">UnderstandingThe Math Behind ReStir DI Â· A Graphics Guy's Note</a></li><li><a href="https://graphics.cs.utah.edu/research/projects/gris/sig22_GRIS.pdf">graphics.cs.utah.edu/research/projects/gris/sig22_GRIS.pdf</a></li><li><a href="https://github.com/DQLin/ReSTIR_PT">GitHub -DQLin/ReSTIR_PT: Source Code for SIGGRAPH 2022 Paper "GeneralizedResampled Importance Sampling: Foundations of ReSTIR"</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å½¢å­¦ </tag>
            
            <tag> å®æ—¶æ¸²æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®æ—¶æ¸²æŸ“ç¬”è®°-Global Illumination</title>
      <link href="/2025/01/04/gamegraphics/shi-shi-xuan-ran-bi-ji-global-illumination/"/>
      <url>/2025/01/04/gamegraphics/shi-shi-xuan-ran-bi-ji-global-illumination/</url>
      
        <content type="html"><![CDATA[<figure><img src="https://s2.loli.net/2024/12/31/dL9xGh2gctreIkK.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å…¨å±€å…‰ç…§å¯¹äºæ¸²æŸ“çœŸå®çš„åœºæ™¯èµ·åˆ°è‡³å…³é‡è¦çš„ä½œç”¨ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæ•´ä¸ªåœºæ™¯è¢«ç…§äº®æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¿‡ç¨‹ï¼Œä¸€ä¸ªshadingpointå¯èƒ½ä¼šå—åˆ°ç›´æ¥å…‰ç…§ã€é—´æ¥å…‰ç…§ã€æ•£å°„ã€ç„¦æ•£ã€é˜´å½±ç­‰ç­‰çš„å½±å“ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚æ‰€ä»¥æ²¡æœ‰å…¨å±€å…‰ç…§åªæœ‰ç›´æ¥å…‰ç…§ä¼šå¯¼è‡´æ¸²æŸ“çš„ç»“æœä¸çœŸå®ï¼Œæœ€ç›´è§‚çš„æ•ˆæœå°±æ˜¯é˜´å½±åŒºåŸŸéå¸¸é»‘ï¼Œè€Œæœ‰äº†é—´æ¥å…‰ç…§ï¼Œé˜´å½±åŒºåŸŸå°±ä¼šæœ‰ä¸€ä¸ªåˆç†çš„äº®åº¦ã€‚</p><span id="more"></span><p><img src="https://s2.loli.net/2025/01/03/KZO1jtoplkLRVXz.png" alt="image.png"> # Reflective Shadow Maps (RSM)</p><p>Reflective Shadow Map (RSM)ä»åç§°ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™ç§æ–¹æ³•çš„æ€è·¯å’ŒShadow Mapæ˜¯ä¸€è‡´çš„ï¼ŒåŒºåˆ«æ˜¯ShadowMapåªè®°å½•ä»å…‰æºå‡ºæ¸²æŸ“çš„æ·±åº¦ï¼Œè€ŒRSMè¿˜ä¼šå­˜å‚¨åŒ…æ‹¬æ·±åº¦ã€ä¸–ç•Œåæ ‡ã€æ³•çº¿ã€å…‰ç…§èƒ½é‡ç­‰ä¿¡æ¯</p><figure><img src="https://s2.loli.net/2025/01/03/CqjGMkEu2dRihPr.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å®ƒçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œä»å…‰æºè§†è§’å‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æ‰€æœ‰å¯ä»¥è¢«å…‰æºç…§äº®çš„åŒºåŸŸï¼Œè¿™äº›åŒºåŸŸå°±å¯ä»¥å½“ä½œæ˜¯æ¬¡çº§å…‰çš„å‘å‡ºå…‰æºã€‚åœ¨ShadowMapä¸Šçš„æ¯ä¸€ä¸ªåƒç´ å¯ä»¥è§†ä½œæ˜¯ä¸€å°ç‰‡é—´æ¥å…‰çš„å…‰æºpatchï¼Œæˆ‘ä»¬çŸ¥é“å…‰å…¥å°„çš„æ–¹å‘ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“å…‰å‡ºå°„çš„æ–¹å‘ã€‚å› æ­¤ï¼ŒRSMä½œå‡ºäº†ä¸€ä¸ªå‡è®¾ï¼Œå‡è®¾è¿™äº›patchçš„surfaceéƒ½æ˜¯diffuseçš„ï¼Œå› æ­¤å‡ºå°„å…‰æ˜¯æœç€åŠçƒé¢å„ä¸ªæ–¹å‘å‘æ•£çš„ã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦çŸ¥é“æ¯ä¸€ç‰‡é—´æ¥å…‰å…‰æºpatchå¯¹shadingpointçš„è´¡çŒ®ã€‚å›é¡¾æ¸²æŸ“æ–¹ç¨‹ï¼Œå¯ä»¥é€šè¿‡æ¢å…ƒå°†å•ä½ç«‹ä½“è§’ä¸Šçš„ç§¯åˆ†è½¬åŒ–ä¸ºå¯¹å…‰æºé¢ç§¯çš„ç§¯åˆ†ï¼Œä¸‹é¢æ˜¯è¡¨ç¤ºpç‚¹ç…§äº®qç‚¹åå°„çš„æ¸²æŸ“æ–¹ç¨‹ã€‚<span class="math display">\[\begin{align*}L_o(q, \omega_o) &amp;= \int_{\Omega_\text{patch}} L_i(q, \omega_i) V(q,\omega_i) f_r(q, \omega_i, \omega_o) \cos \theta_i \, d\omega_{i}\\&amp;= \int_{A_\text{patch}} L_i(p \to q) V(q, \omega_i) f_r(q, p \to q,\omega_o) \frac{\cos \theta_p \cos \theta_q}{\|q - p\|^2} \, dA\end{align*}\]</span></p><p>ç”±äºæˆ‘ä»¬å‡è®¾æ¬¡çº§å…‰æºè¡¨é¢æ˜¯diffuseçš„ï¼Œæ‰€ä»¥æœ‰ <span class="math display">\[f_{r}(p)=\frac{\rho}{\pi}\]</span> Shadingpointæ¥æ”¶åˆ°çš„radianceå°±æ˜¯è¿™ä¸€ä¸ªpatchåå°„å‡ºçš„å…‰å¼ºï¼Œè¿™é‡Œä»å…‰æºåˆ°æ¬¡çº§å…‰æºçš„radianceå¯ä»¥å†™ä½œfluxå’Œé¢ç§¯çš„æ¯”å€¼ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯é¢ç§¯å¯ä»¥å’Œç§¯åˆ†ä¸­çš„é¢ç§¯çº¦æ‰ï¼Œè¿™æ ·å­åœ¨å­˜å‚¨çš„æ—¶å€™åªéœ€è¦å­˜å‚¨ä¸€ä¸ªfluxå°±å¯ä»¥äº†ï¼Œè€Œä¸ç”¨è€ƒè™‘é¢ç§¯ã€‚<span class="math display">\[L_{i}(p)=f_{r}(p)\cdot E(l \rightarrow p)=f_{r} \cdot\frac{\Phi}{\mathrm{d}A}\]</span>å­˜å‚¨äº†æ¬¡çº§å…‰æºå¤„çš„fluxï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ¸²æŸ“qç‚¹çš„æ—¶å€™åˆ©ç”¨å­˜å‚¨çš„fluxé€šè¿‡ä»¥ä¸‹å…¬å¼è®¡ç®—å‡ºpç‚¹å¯¹qç‚¹è´¡çŒ®çš„irradianceå¤§å°ã€‚è¿™é‡Œå¿½ç•¥äº†ä»pç‚¹åˆ°qç‚¹çš„visibilityçš„è®¡ç®—ï¼Œå› ä¸ºå¦‚æœæ¯ä¸€ä¸ªå…‰çº¿éƒ½è®¡ç®—çš„è¯è®¡ç®—é‡å¤ªå¤§ï¼Œå¾ˆéš¾ç®—ã€‚æ‰€ä»¥RSMç›´æ¥å‡è®¾æ‰€æœ‰çš„æ¬¡çº§å…‰æºå¯¹äºshadingpointéƒ½æ˜¯å¯è§çš„ã€‚</p><figure><img src="https://s2.loli.net/2025/01/03/PxILc9eBNYfJoKS.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å½“ç„¶ï¼Œåœ¨å®é™…å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠshadowmapä¸Šæ‰€æœ‰çš„åƒç´ éƒ½è¿›è¡Œè®¡ç®—ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è¿›è¡Œé‡‡æ ·ã€‚æ€»ä½“ä¸Šçœ‹ï¼Œç¦»shadingpointæ›´è¿‘çš„æ¬¡çº§å…‰æºå¯¹äºshadingpointä¼šæ›´å¤§ã€‚è¿™é‡ŒRSMå†æ¬¡ä½œå‡ºå‡è®¾ï¼Œæ ¹æ®shading pointåœ¨shadowmapä¸Šçš„ä½ç½®å’Œæ¬¡çº§å…‰æºåœ¨åƒç´ ä¸Šçš„ä½ç½®çš„è·ç¦»è¿›è¡Œä¸åŒå¯†åº¦çš„é‡‡æ ·ï¼Œè·ç¦»è¿‘çš„é‡‡æ ·å¯†åº¦å¤§ï¼Œè¿œçš„é‡‡æ ·å¯†åº¦å°ã€‚å¯¹äºé‡‡æ ·çš„ç»“æœï¼ŒRSMå¼•å…¥äº†æƒé‡ï¼Œæƒé‡åŒæ ·é€šè¿‡è·ç¦»å†³å®šï¼Œè¶Šè¿‘æƒé‡è¶Šå°ï¼Œè¶Šè¿œæƒé‡è¶Šå¤§ã€‚</p><figure><img src="https://s2.loli.net/2025/01/03/ovFrZlMXyAz86si.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>RSMå¥½å¤„åœ¨äºå®ç°éå¸¸ç®€å•ï¼Œå®Œå…¨æŒ‰ç…§ShadowMapçš„ä¸€å¥—æµç¨‹ï¼Œä½†æ˜¯æ€§èƒ½æœ‰å¾…æé«˜ï¼Œå› ä¸ºå¯¹äºæ¯ä¸€ä¸ªå…‰æºéƒ½éœ€è¦ç”Ÿæˆç›¸åº”çš„RSMï¼Œè€Œä¸”ç”±äºå­˜åœ¨å¾ˆå¤šå‡è®¾ï¼Œå¹¶ä¸”åªè€ƒè™‘äº†ä¸€æ¬¡åå°„çš„é—´æ¥å…‰ï¼Œæ‰€ä»¥æ•ˆæœè‚¯å®šæ˜¯å±€é™çš„ã€‚</p><h1><span id="light-propagation-volumeslpv">Light Propagation Volumes(LPV)</span></h1><p>åœ¨å…¨å±€å…‰ç…§ä¸­ï¼Œæˆ‘ä»¬æ ¸å¿ƒè¦è§£å†³çš„é—®é¢˜æ˜¯åœ¨shadingpointä¸Šè·å¾—ä»ä»»æ„ä¸€ä¸ªæ–¹å‘ä¸Šæ¥æ”¶åˆ°çš„radianceå¤§å°ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½ä¼šé‡‡ç”¨ä¸€ä¸ªåŸºæœ¬å‡è®¾ï¼Œä¹Ÿå°±æ˜¯radianceåœ¨ä¼ æ’­è¿‡ç¨‹ä¸­å¤§å°æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚LPVä»åç§°ä¸Šçœ‹ï¼Œé‡‡ç”¨äº†Volumeçš„æ–¹å¼ï¼Œè®©å…‰çº¿åœ¨volumeä¸­è¿›è¡Œä¼ æ’­ã€‚å…·ä½“å®ç°ä¸­ï¼Œåˆ†ä¸ºä»¥ä¸‹æ­¥éª¤</p><ol type="1"><li>ç”Ÿæˆç›´æ¥å…‰ç…§çš„åœºæ™¯è¡¨ç¤º<ul><li>ç¬¬ä¸€æ­¥é‡‡ç”¨äº†Reflective ShadowMapçš„åŠæ³•ï¼Œç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿæ¬¡çº§å…‰æºçš„é›†åˆï¼ŒåŒæ ·çš„ï¼Œå°†æ¬¡çº§å…‰æºçš„è¡¨é¢å‡è®¾ä¸ºdiffuseæè´¨ã€‚</li></ul></li><li>æ¬¡çº§è™šæ‹Ÿå…‰æºåœ¨åœºæ™¯ä½“ç´ ä¸­çš„æ³¨å…¥<ul><li>å°†æ•´ä¸ªåœºæ™¯åˆ’åˆ†ä¸ºä¸‰ç»´ç½‘æ ¼</li><li>å¯¹äºæ¯ä¸€ä¸ªæ ¼ç‚¹ï¼Œæ‰¾åˆ°å…¶ä¸­æ‰€æœ‰çš„è™šæ‹Ÿå…‰æºï¼Œå°†è™šæ‹Ÿå…‰æºçš„æœ‰å‘radianceè´¡çŒ®ç›¸åŠ </li><li>å¯¹äºæœ‰å‘radianceï¼Œå¯ä»¥ä½¿ç”¨SphericalHarmonicsè¿›è¡Œå‹ç¼©ï¼Œå¸¸ç”¨çš„åšæ³•æ˜¯æ˜ å°„åˆ°äºŒé˜¶SHä¸Š</li></ul></li><li>ä½“ç´ ä¸­çš„radianceä¼ æ’­<ul><li>å¯¹äºæ¯ä¸€ä¸ªæ ¼ç‚¹ï¼Œè®¡ç®—ä¸Šä¸‹å·¦å³å‰åçš„å…­ä¸ªæ ¼ç‚¹ä¸­å…‰æºçš„å¯¹è¯¥æ ¼ç‚¹çš„è´¡çŒ®ï¼Œå¹¶é‡æ–°æ˜ å°„åˆ°SHä¸Š</li><li>è¿­ä»£è‹¥å¹²æ¬¡ï¼Œä½¿å¾—LPVè¾¾åˆ°ç¨³å®šçš„çŠ¶æ€ï¼ˆè¿™æœ‰ç‚¹ç±»ä¼¼æµä½“ä¸­çš„æ ¼ç‚¹æ³•ï¼‰ <img src="https://s2.loli.net/2025/01/03/JPIdVvefhWsG5Rm.png" alt="image.png"></li></ul></li><li>ä½¿ç”¨æœ€ç»ˆçš„light propagation volumeè¿›è¡Œåœºæ™¯æ¸²æŸ“<ul><li>åœ¨æœ€åæ¸²æŸ“æ—¶ï¼Œå¯¹äºæ¯ä¸€ä¸ªshadingpointï¼Œæ‰¾åˆ°å®ƒæ‰€åœ¨çš„æ ¼ç‚¹ï¼Œåˆ©ç”¨æ ¼ç‚¹ä¸­å­˜å‚¨çš„radianceè¿›è¡Œæ¸²æŸ“</li></ul></li></ol><figure><img src="https://s2.loli.net/2025/01/03/UNszdfMlIOPHCjB.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>è¿™æ ·çš„æ–¹æ³•åœ¨æœ€åæ¸²æŸ“æ—¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸Šå›¾ä¸­ï¼Œå¦‚æœä¸‰ç»´ç½‘æ ¼çš„åˆ’åˆ†è¿‡äºç¨€ç–ï¼Œå°±ä¼šå­˜åœ¨è™½ç„¶ä¸€ä¸ªæ¬¡çº§å…‰æºæœ¬ä¸è¯¥ç…§äº®ä¸€ä¸ªè¢«é®æŒ¡çš„shadingpointï¼Œä½†æ˜¯ç”±äºä»–ä»¬åœ¨åŒä¸€ä¸ªç½‘æ ¼ä¹‹ä¸­ï¼Œå®é™…è®¡ç®—ä¼šè€ƒè™‘è¿™ä¸ªæ¬¡çº§å…‰æºçš„è´¡çŒ®çš„ã€‚å› æ­¤ï¼Œå°±ä¼šæœ‰ä¸‹é¢çš„ç»“æœçš„å‡ºç°</p><figure><img src="https://s2.loli.net/2025/01/03/NGo6u3XxfSqgZT7.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>åœ¨å·¥ä¸šç•Œçš„å…·ä½“å®ç°ä¸­ï¼Œå¯èƒ½ä¼šå­˜åœ¨ä¸€äº›è‡ªé€‚åº”ç½‘æ ¼çš„æ–¹æ³•ï¼Œä½¿ç”¨ä¸è§„åˆ™çš„ç½‘æ ¼å¤§å°é€‚åº”ä¸åŒåŒºåŸŸå†…çš„ç‰©ä½“å¤§å°ï¼Œå¸¦æ¥çš„æŸå¤±å°±æ˜¯éœ€è¦è¾ƒä¸ºå¤æ‚çš„è®¡ç®—ã€‚æ›´å¸¸è§çš„åšæ³•æ—¶Cascadedçš„LPVï¼Œé‡‡ç”¨å±‚çº§ç½‘æ ¼å¯¹ä¸åŒè·ç¦»çš„ç‰©ä½“ç”¨ä¸åŒå¤§å°çš„ç½‘æ ¼ã€‚</p><figure><img src="https://s2.loli.net/2025/01/03/S2RmAbiEgN1o6MD.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h1><span id="voxel-global-illuminationvxgi">Voxel Global Illumination(VXGI)</span></h1><p>VXGIä¹Ÿæ˜¯ä¸€ä¸ª2passçš„ç®—æ³•ï¼Œä½†æ˜¯åŒºåˆ«äºReflective ShadowMapï¼ŒVXGIé‡‡ç”¨äº†Voxelå¯¹radianceä¿¡æ¯è¿›è¡Œå­˜å‚¨ã€‚æ€»ä½“ä¸ŠVXGIåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ 1.lightpassï¼šä»å…‰æºè§†è§’å‡ºå‘ï¼Œå‘å‡ºå…‰çº¿ï¼ŒåŒæ ·çš„ç”Ÿæˆæ¬¡çº§å…‰æºçš„patchï¼Œå­˜å‚¨åœ¨å…«å‰æ ‘çš„ç½‘æ ¼ç»“æ„ä¸­2. camera passï¼šä»æ‘„åƒæœºå‡ºå‘ï¼Œæ ¹æ®shadingpointçš„BRDFé‡‡æ ·ä¸€ä¸ªåå°„çš„coneï¼Œå¹¶è®¡ç®—å…¶è´¡çŒ® <img src="https://s2.loli.net/2025/01/03/9zXMbmZJsaxYEFB.png" alt="image.png"></p><p>å…·ä½“çš„ï¼Œé¦–å…ˆVXGIå°†æ•´ä¸ªåœºæ™¯åˆ’åˆ†ä¸ºä¸€ä¸ªå±‚æ¬¡åŒ–ç»“æ„ï¼Œä½¿ç”¨å…«å‰æ ‘è¿›è¡Œç½‘æ ¼åˆ’åˆ†ã€‚ä½¿ç”¨å±‚æ¬¡ç»“æ„(Hierachicalstructure)çš„å¥½å¤„æ˜¯æˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªç±»ä¼¼mipmapçš„ç»“æ„ï¼Œåœ¨æœ€åçš„æ¸²æŸ“ä¸­å¯ä»¥ä½¿ç”¨æ›´é«˜çº§çš„èŠ‚ç‚¹è¿›è¡Œä¼°ç®—ã€‚åœ¨lightpassä¸­ï¼Œé¦–å…ˆä»å…‰æºå‡ºå‘ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¯ä¸ªå…‰æºpatchçš„radianceè®¡ç®—å‡ºæ¥ï¼Œå­˜å‚¨åœ¨å…«å‰æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ã€‚ä¸ºäº†å®ç°mipmapçš„æ•ˆæœï¼Œéœ€è¦ç»§ç»­è¿›è¡Œfilteringï¼Œé€å±‚çš„æ›´æ–°çˆ¶çº§èŠ‚ç‚¹çš„radianceã€‚å…·ä½“ç»†èŠ‚å‚è§paperã€‚</p><figure><img src="https://s2.loli.net/2025/01/03/Mo94ZOlSAc6kgzn.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>æœ‰äº†å­˜å‚¨çš„radianceä¹‹åï¼Œåœ¨conetracingçš„æ—¶å€™å°±å¯ä»¥è¿›è¡ŒåŠ é€Ÿã€‚æœ€ç›´è§‚çš„æ€è·¯æ˜¯æ‰¾åˆ°coneå†…æ‰€æœ‰ç›¸äº¤çš„voxelï¼Œå°†æ‰€æœ‰çš„è´¡çŒ®ç›¸åŠ ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸æ˜¾ç¤ºçš„ã€‚VXGIæå‡ºçš„æ–¹æ³•ç±»ä¼¼äºraymarchingï¼Œä»shadingpointå‡ºå‘é€çº§æ­¥è¿›ï¼Œåœ¨ä¹‹å‰å­˜å‚¨çš„å±‚æ¬¡åŒ–ç»“æ„ä¸Šé€çº§æŸ¥è¯¢ï¼Œé€šè¿‡æ’å€¼å¾—åˆ°è´¡çŒ®çš„radianceå¤§å°ã€‚</p><figure><img src="https://s2.loli.net/2025/01/04/bWTDn3rhYKZJwaC.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å¯¹äºglossyæè´¨çš„ç‰©ä½“ï¼Œåªéœ€è¦é‡‡æ ·ä¸€ä¸ªconeï¼Œè€Œå¯¹äºdiffuseçš„ç‰©ä½“ï¼Œç†è®ºä¸Šæˆ‘ä»¬éœ€è¦è®¡ç®—æ•´ä¸ªåŠçƒé¢ä¸Šæ‰€æœ‰çš„æ¬¡çº§å…‰æºçš„è´¡çŒ®ã€‚VXGIæå‡ºæˆ‘ä»¬å¯ä»¥è¿‘ä¼¼çš„ç”¨å¤šä¸ªconeå»è¿‘ä¼¼çš„è¦†ç›–æ•´ä¸ªåŠçƒé¢ï¼ˆ8ä¸ªï¼‰</p><figure><img src="https://s2.loli.net/2025/01/04/tGZc1JDEv53Xiq6.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h1><span id="screen-space">Screen Space</span></h1><p>RSMã€LPVã€VXGIéƒ½æ˜¯ç›´æ¥åˆ©ç”¨ä¸‰ç»´ç©ºé—´ä¸­çš„ä¿¡æ¯è®¡ç®—GlobalIlluminationï¼Œè¿™äº›æ–¹æ³•åŸºæœ¬ä¸Šéƒ½æœ‰ä¸€ä¸ªç¼ºé™·ï¼Œå°±æ˜¯æ€§èƒ½æ¶ˆè€—æ¯”è¾ƒå¤§ã€‚ScreenSpaceçš„æ–¹æ³•æ€§èƒ½ç›¸æ¯”äºä¸‰ç»´ç©ºé—´ä¼šæ›´å¥½ï¼Œè¿™ç±»æ–¹æ³•çš„åŸºæœ¬æ€æƒ³æ˜¯ä»screenspaceä¸Šçš„ç›´æ¥å…‰ç…§ä¿¡æ¯é€šè¿‡åæœŸå¤„ç†è®¡ç®—å‡ºé—´æ¥å…‰ç…§ã€‚ ## Screen SpaceAmbient Occulusion (SSAO)</p><p>ç¯å¢ƒå…‰é®è”½(AO)æŒ‡çš„æ˜¯ç¯å¢ƒä¸­çš„é—´æ¥å…‰ç”±äºç‰©ä½“çš„å‡ ä½•å…³ç³»äº§ç”Ÿé®æŒ¡äº§ç”Ÿçš„è§†è§‰æ•ˆæœï¼ŒAOå¾€å¾€èƒ½å¸¦æ¥æ›´çœŸå®çš„è§†è§‰æ•ˆæœã€‚SSAOæ˜¯ä¸€ç§åœ¨å±å¹•ç©ºé—´ä¸­å¯¹å…¨å±€å…‰ç…§ä¼°è®¡çš„ä¸€ç§æ–¹æ³•ã€‚</p><p>SSAOåšäº†ä»¥ä¸‹å‡è®¾ 1.ä»»æ„ä¸€ç‚¹çš„é—´æ¥å…‰ç…§çš„å¼ºåº¦éƒ½æ˜¯å¸¸æ•°ï¼ˆç±»ä¼¼äºPhongå…‰ç…§æ¨¡å‹ä¸­çš„ambienté¡¹ï¼‰ 2.æˆ‘ä»¬åªéœ€è¦è€ƒè™‘åœ¨æ¯ä¸ªshading pointåœ¨å„ä¸ªæ–¹å‘ä¸Šçš„å¯è§æ€§ 3.åŒæ ·çš„ï¼Œå‡å®šè¡¨é¢éƒ½æ˜¯diffuseæè´¨</p><p>åœ¨ç†è®ºä¸Šä¸ºä»€ä¹ˆæˆ‘ä»¬åªéœ€è¦è€ƒè™‘shadingpointçš„visibilityå‘¢ï¼Ÿé¦–å…ˆï¼Œä»rendering equationå‡ºå‘ <span class="math display">\[L_{o}(p.\omega_{o})=\int_{\Omega+}L_{i}(p,\omega_{i})f_{r}(p,\omega_{i},\omega_{o})V(p,\omega_{i})\cos{\theta_{i}}\mathrm{d}\omega_{i}\]</span> åˆ©ç”¨ç»“è®º <span class="math display">\[\int_{\Omega}f(x)g(x)\mathrm{d}x\approx\frac{\int_{\Omega_{G}}f(x)\mathrm{d}x}{\int_{\Omega_{G}}\mathrm{d}x}\cdot \int_{\Omega}g(x)\mathrm{d}x\]</span> åˆ†ç¦»visibilityé¡¹</p><p><span class="math display">\[L_{o}^{\text{indir}}(p, \omega_{o}) \approx \frac{\int_{\Omega_{+}}V(p,\omega_{i})\cos{\theta_{i}}\mathrm{d}\omega_{i}}{\int_{\Omega_{+}}\cos{\theta_{i}}\mathrm{d}\omega_{i}}\cdot \int_{\Omega_{+}}L_{i}(p, \omega_{i})f_{r}(p, \omega_{i},\omega_{o})\cos{\theta_{i}}\mathrm{d}\omega_{i}\]</span> è¿™é‡Œåˆ©ç”¨äº†<span class="math inline">\(\mathrm{d}x_\perp=\cos{\theta_{i}}\mathrm{d}\omega_{i}\)</span>çš„ç»“è®ºï¼Œä»åŠçƒé¢ä¸Šçš„ç§¯åˆ†è½¬åŒ–åˆ°äº†å¹³é¢ä¸Šçš„ç§¯åˆ†</p><p>å…¶ä¸­ç¬¬ä¸€é¡¹ç»è¿‡åŒ–ç®€ä¹‹åå°±æ˜¯æ‰€æœ‰æ–¹å‘ä¸Šçš„visibility cosåŠ æƒå¹³å‡ <span class="math display">\[k_{A}=\frac{\int_{\Omega_{+}}V(p, \omega_{i})\cos{\theta_{i}}\mathrm{d}\omega_{i}}{\pi}\]</span> ç¬¬äºŒé¡¹æ˜¯é—´æ¥å…‰ç…§ï¼Œç”±äºSSAOä½œå‡ºçš„å‡è®¾ï¼Œè¿™ä¸€é¡¹å°±æ˜¯å¸¸æ•° <span class="math display">\[L_{i}^{\text{indir}}(p) \cdot \frac{\rho}{\pi} \cdot\pi=L_{i}^{\text{indir}}(p) \cdot \rho\]</span> æ‰€ä»¥ç°åœ¨çš„é—®é¢˜å°±æ˜¯æˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¡ç®—shading pointçš„é®ç½©<span class="math inline">\(k_{A}(p)\)</span>ã€‚</p><p>SSAOåˆ©ç”¨å±å¹•ç©ºé—´ä¸­å­˜å‚¨çš„depthbufferæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬éœ€è¦è®¡ç®—shadingpointåœ¨å„ä¸ªæ–¹å‘ä¸Šçš„visibilityçš„å‡å€¼ï¼Œå¾ˆè‡ªç„¶çš„æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œé‡‡æ ·å¯¹è¿™ä¸ªå€¼è¿›è¡Œä¼°ç®—ï¼Œå…·ä½“çš„æˆ‘ä»¬ä¼šåœ¨shadingpointçš„ä¸€å®šåŠå¾„çš„çƒé¢æˆ–è€…åŠçƒé¢è¿›è¡Œé‡‡æ ·ã€‚æˆ‘ä»¬å¯ä»¥åˆ†æˆshadingpointä¸Šæœ‰æ³•çº¿å’Œæ²¡æœ‰æ³•çº¿ä¸¤ç§æƒ…å†µ - SSAO(æœ‰æ³•çº¿) - åœ¨shadingpointä¸€å®šåŠå¾„èŒƒå›´å†…çš„çƒå†…è¿›è¡Œé‡‡æ ·ï¼Œé‡‡æ ·ç‚¹æŠ•å½±åˆ°cameraï¼Œå¾—åˆ°é‡‡æ ·ç‚¹çš„æ·±åº¦- é‡‡æ ·ç‚¹çš„æ·±åº¦å’Œå±å¹•ç©ºé—´è®°å½•çš„æ·±åº¦ä½œå¯¹æ¯”ï¼Œå°äºscreenspaceæ·±åº¦å³ä¸ºå¯è§ï¼Œå¤§äºscreen spaceæ·±åº¦å³ä¸ºä¸å¯è§ -å› ä¸ºæ²¡æœ‰æ³•çº¿ä¿¡æ¯ï¼Œæ‰€ä»¥åªèƒ½åœ¨æ•´ä¸ªçƒé‡Œè¿›è¡Œé‡‡æ ·ã€‚å½“è¿‡åŠçš„é‡‡æ ·ç‚¹åœ¨ç‰©ä½“å†…éƒ¨ï¼Œè¯´æ˜æœ‰AOï¼Œå¦åˆ™å°±ä¸éœ€è¦AO<img src="https://s2.loli.net/2025/01/04/W5nKyxajANLgrvt.png" alt="image.png"> - é—®é¢˜ï¼šä¼šå‡ºç°false occulusionçš„é—®é¢˜ <img src="https://s2.loli.net/2025/01/04/dkRG96uAqrQcpia.png" alt="image.png"> - Horizon based ambient occulusion (HBAO) æœ‰æ³•çº¿ä¿¡æ¯- åœ¨æ³•çº¿æ‰€åœ¨çš„åŠçƒé¢ä¸Šè¿›è¡Œé‡‡æ · - æœ‰äº†æ³•çº¿ä¿¡æ¯å¯ä»¥åŠ å…¥cosineæƒé‡ <img src="https://s2.loli.net/2025/01/04/2tMB87aqOJTd3Nb.png" alt="image.png"> ## Screen Space Directional Occlusion (SSDO)</p><p>SSAOä¸­å‡è®¾æ‰€æœ‰çš„indirect illuminationæ˜¯ç›¸åŒçš„ï¼Œä½†å®é™…ä¸Šåœ¨screenspaceä¸Šæˆ‘ä»¬ä¹Ÿæœ‰å¯ä»¥ç›´æ¥åˆ©ç”¨çš„é—´æ¥å…‰ç…§ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯ä»cameraè§†è§’ä¸‹å·²ç»æ¸²æŸ“å¥½çš„å›¾åƒã€‚SSDOå°±æ˜¯åœ¨æ­¤åŸºç¡€ä¸Šå¯¹SSAOçš„æ”¹è¿›ã€‚SSDOçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œä»shadingpointå‡ºå‘ï¼Œéšæœºå°„å‡ºå…‰çº¿ï¼Œå‡»ä¸­éšœç¢ç‰©ï¼Œè¯´æ˜æ˜¯é—´æ¥å…‰ç…§ï¼Œæœªå‡»ä¸­åˆ™æ˜¯ç›´æ¥å…‰ç…§ã€‚</p><figure><img src="https://s2.loli.net/2025/01/04/ZJkazHGgjCOeNv1.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>ç±»ä¼¼äºSSAOï¼ŒSSDOä»shadingpointæ‰€åœ¨çš„åŠçƒé¢ä¸Šè¿›è¡Œé‡‡æ ·ï¼Œä»é‡‡æ ·ç‚¹åˆ°Pç‚¹çš„visibilityåŒæ ·çš„åˆ©ç”¨æ·±åº¦è¿›è¡Œä¼°è®¡ã€‚å¦‚æœåœ¨ç‰©ä½“å¤–éƒ¨æ²¡æœ‰é®æŒ¡ï¼Œé‡‡ç”¨ç¯å¢ƒå…‰è´´å›¾çš„ç›´æ¥å…‰ç…§ï¼›å¦‚æœåœ¨ç‰©ä½“å†…éƒ¨ï¼Œé‚£ä¹ˆåˆ©ç”¨ä»æ‘„åƒæœºå‡ºå‘çœ‹åˆ°çš„surfacepatchä½œä¸ºæ¬¡çº§å…‰æºè®¡ç®—ç®€ä»‹å…‰çš„è´¡çŒ®ï¼ˆå…·ä½“æ–¹æ³•å’ŒRSMç±»ä¼¼ï¼‰ã€‚å½“ç„¶å› ä¸ºvisibilityæ˜¯é€šè¿‡æ‘„åƒæœºçš„visibilityè¿‘ä¼¼å¾—åˆ°çš„ï¼Œæ‰€ä»¥å®é™…æƒ…å†µä¸‹ä¼šæœ‰ä¸ç¬¦åˆçš„æƒ…å†µï¼ˆä¸Šå›¾å³ï¼‰ã€‚</p><p>SSDOçš„é—®é¢˜æ˜¯ï¼Œç”±äºé‡‡æ ·ç‚¹çš„åŠçƒèŒƒå›´é™åˆ¶ï¼Œé—´æ¥å…‰ç…§åªèƒ½è®¡ç®—åœ¨ä¸€å®šèŒƒå›´å†…çš„ï¼Œæ— æ³•è®¡ç®—è¿œè·ç¦»çš„ã€‚è¿™ä¸€ç‚¹å’ŒSSAOåˆšå¥½ç›¸åï¼ŒSSAOå‡è®¾å¯è§éƒ¨åˆ†å¯ä»¥è¢«è¿œè·ç¦»çš„ç¯å¢ƒå…‰ç…§äº®ï¼Œè¢«é®æŒ¡çš„æ— æ³•ç…§äº®ï¼›SSDOåˆ™æ˜¯è¢«é®æŒ¡éƒ¨åˆ†ä¼šè´¡çŒ®é—´æ¥å…‰ç…§ï¼Œè¿œè·ç¦»æ— é—´æ¥å…‰è´¡çŒ®ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯screenspaceå­˜åœ¨çš„é—®é¢˜ï¼Œç”±äºscreenspaceåªè®°å½•äº†ä»æ‘„åƒæœºè§†è§’çœ‹åˆ°çš„ä¿¡æ¯ï¼Œä¼šå¿½ç•¥æ‘„åƒæœºæ²¡æœ‰çœ‹åˆ°çš„ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“å·¦ä¾§çš„è¡¨é¢æ¶ˆå¤±åœ¨æ‘„åƒæœºè§†é‡å†…æ—¶ï¼Œå®ƒåœ¨åœ°é¢çš„é—´æ¥å…‰ç…§è´¡çŒ®å°±ä¼šè¢«å¿½ç•¥ã€‚</p><figure><img src="https://s2.loli.net/2025/01/04/kjRBFePKfQ5Jd61.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h2><span id="screen-space-reflection-ssr">Screen Space Reflection (SSR)</span></h2><p>SSRæ˜¯ä¸€ç§åœ¨å±å¹•ç©ºé—´ä½œçš„raytracingï¼Œå› æ­¤ä¸éœ€è¦ä¸‰ç»´ç©ºé—´ä¸­çš„meshä¿¡æ¯ï¼Œè€Œæ˜¯åˆ©ç”¨å±å¹•ç©ºé—´ä¸­çš„æ³•çº¿ã€æ·±åº¦ã€å›¾åƒä¿¡æ¯ã€‚SSRçš„åŸºæœ¬æ€è·¯æ—¶ï¼Œå¯¹äºä¸€ä¸ªshadingpointï¼Œå»traceå®ƒçš„åå°„å…‰çº¿ã€‚è¿™é‡Œä¸éœ€è¦å¯¹shadingpointçš„æè´¨ä½œå‡ºé™åˆ¶ï¼Œæ— è®ºæ—¶specularè¿˜æ˜¯glossyçš„æè´¨ï¼Œéƒ½å¯ä»¥ä½¿ç”¨pathtracingä¸­ç±»ä¼¼çš„æ–¹æ³•å»sampleä¸€æ ¹å…‰çº¿ã€‚</p><figure><img src="https://s2.loli.net/2025/01/04/q7oT51afDYSP8Ak.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>åœ¨traceåå°„å…‰çº¿çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆé€‚çš„æ­¥é•¿ï¼Œå¦‚æœæ­¥é•¿å¤ªå¤§æˆ–è€…æ­¥é•¿å¤ªå°éƒ½ä¼šå¯¼è‡´é—®é¢˜ã€‚å› æ­¤SSRæå‡ºäº†Hierarchicalray traceçš„æ–¹å¼ã€‚è¿™ç§æ–¹æ³•éœ€è¦ä½¿ç”¨åˆ°Depth Mip-Map(HiZ)ï¼Œå’Œæ™®é€šMipmapä¸åŒçš„æ˜¯HiZåœ¨filteringçš„æ™‚å€™ç”¨çš„æ˜¯minpoolingè€Œä¸æ˜¯å¹³å‡ï¼Œè¿™æ ·å¯ä»¥ä¿è¯å¦‚æœä¸€ä¸ªå…‰çº¿æ²¡æœ‰å’Œä¸€ä¸ªé«˜å±‚çº§çš„èŠ‚ç‚¹ç›¸äº¤ï¼Œé‚£å®ƒè‚¯å®šä¹Ÿä¸ä¼šå’Œä½å±‚çº§çš„èŠ‚ç‚¹ç›¸äº¤ã€‚å…·ä½“çš„traceä¼ªä»£ç å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mip = 0;</span><br><span class="line">while (level &gt; -1)</span><br><span class="line">step through current cell;</span><br><span class="line">if (above Z plane) ++level;</span><br><span class="line">if (below Z plane) --level;</span><br></pre></td></tr></table></figure><p>åœ¨SSRä¸­ï¼Œç”±äºæˆ‘ä»¬ä»ç„¶éœ€è¦çŸ¥é“æ¬¡çº§å…‰æºçš„å‡ºå°„radianceï¼Œæ‰€ä»¥æ¬¡çº§å…‰æºè¡¨é¢çš„æè´¨ä»ç„¶å‡è®¾æ˜¯diffuseçš„ã€‚ä½†æ˜¯SSRå¾ˆå¥½çš„è§£å†³äº†shadingpointå’Œæ¬¡çº§å…‰æºçš„å¯è§æ€§é—®é¢˜ï¼Œå› ä¸ºæ˜¯ä¸¥æ ¼çš„è¿›è¡Œray traceå¾—åˆ°çš„ç»“æœã€‚</p><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><ol type="1"><li><p><a href="https://advances.realtimerendering.com/s2009/Light_Propagation_Volumes.pdf">advances.realtimerendering.com/s2009/Light_Propagation_Volumes.pdf</a></p></li><li><p><a href="https://dl.acm.org/doi/10.1145/1053427.1053460">Reflective shadowmaps | Proceedings of the 2005 symposium on Interactive 3D graphics andgames</a></p></li><li><p><a href="https://research.nvidia.com/sites/default/files/publications/GIVoxels-pg2011-authors.pdf">research.nvidia.com/sites/default/files/publications/GIVoxels-pg2011-authors.pdf</a></p></li><li><p><a href="https://dl.acm.org/doi/pdf/10.1145/1507149.1507161">Approximatingdynamic global illumination in image space | Proceedings of the 2009symposium on Interactive 3D graphics and games</a></p></li><li><p><a href="https://www.ea.com/frostbite/news/stochastic-screen-space-reflections">StochasticScreen-Space Reflections - Frostbite</a></p></li><li><p>Games 202 Lecture 7, 8, 9</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å½¢å­¦ </tag>
            
            <tag> å®æ—¶æ¸²æŸ“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Geometry Processing Project</title>
      <link href="/2024/09/22/gamegraphics/geometryprocessingproject/"/>
      <url>/2024/09/22/gamegraphics/geometryprocessingproject/</url>
      
        <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#implicit-surface-reconstruction">Implicit SurfaceReconstruction</a></li><li><a href="#mesh-parameterization">Mesh Parameterization</a><ul><li><a href="#uniform-and-cotangent-laplacian">Uniform and cotangentLaplacian</a></li><li><a href="#lscm">LSCM</a></li><li><a href="#arap">ARAP</a></li></ul></li><li><a href="#shape-deformation">Shape Deformation</a></li><li><a href="#skinning-and-skeletal-animation">Skinning and SkeletalAnimation</a><ul><li><a href="#rotation-representation">Rotation Representation</a></li><li><a href="#harmonic-skinning-weights-on-selected-handles">Harmonicskinning weights on selected handles</a><ul><li><a href="#handle-selection">Handle selection</a></li><li><a href="#skinning-weights-visualization">Skinning weightsvisualization</a></li></ul></li><li><a href="#skeletal-animation">Skeletal animation</a></li><li><a href="#context-aware-per-vertex-lbs">Context-aware per-vertexLBS</a></li></ul></li></ul><!-- tocstop --><span id="more"></span><h2><span id="implicit-surfacereconstruction">Implicit SurfaceReconstruction</span></h2><ul><li>Compute an implicit MLS function approximating a 3D point cloud withgiven normals.</li><li>Sample the implicit function on a 3D volumetric grid.</li><li>Apply the marching cubes algorithm to extract a triangle mesh fromthe zero level set.</li></ul><p><img src="https://s2.loli.net/2024/09/21/zedTcXsnWpYtMxK.png" alt="Image 1" style="width: 45%; object-fit: contain;"></p><h2><span id="mesh-parameterization">Mesh Parameterization</span></h2><ul><li>Parameterize a mesh by minimizing four different distortion measureswith fixed or free boundaries.<ul><li>Spring energy (uniform Laplacian)</li><li>Dirichlet/harmonic energy (cotangent Laplacian)</li><li>Least Squares Conformal Maps (LSCM)</li><li>As-Rigid-As-Possible (ARAP)</li></ul></li><li>Visualize the distortion by color coding.</li></ul><h3><span id="uniform-and-cotangentlaplacian">Uniform and cotangentLaplacian</span></h3><p>Spring energy is defined as <span class="math display">\[\frac{1}{2}k_{i,j}\Vert \mathbf{u}_{i}-\mathbf{u}_{j} \Vert^{2}\]</span> Minimizing the spring enegy <span class="math display">\[\begin{align*}E(\mathbf{u}_{1}, \cdots, \mathbf{u}_{n})&amp;=\sum\limits\frac{1}{2}k_{i,j}\Vert \mathbf{u}_{i}-\mathbf{u}_{j} \Vert^{2}\\\frac{\partial{E(\mathbf{u}_{1},\cdots,\mathbf{u}_{n})}}{\partial\mathbf{u}_{i}}&amp;=\sum\limitsk_{i,j}(\mathbf{u}_{i}-\mathbf{u}_{j})=0 \\\sum\limits_{j \in \mathcal{N}(i)\cap \mathcal{B}}k_{ij}\mathbf{u}_{i}+\sum\limits_{j \in \mathcal{N}(i) \backslash\mathcal{B}} k_{i,j}(\mathbf{u}_{i}-\mathbf{u}_{j})&amp;= \sum\limits_{j\in \mathcal{N}(i)\cap \mathcal{B}} k_{i,j}\mathbf{u}_{j}\end{align*}\]</span></p><figure><img src="https://s2.loli.net/2024/04/25/7VlIFtjNv5zsaSR.png" alt="Solve linear system"><figcaption aria-hidden="true">Solve linear system</figcaption></figure><ul><li>Two choices of spring constants<ul><li>Uniform <span class="math inline">\(k_{i,j}=1\)</span></li><li>Cotan <span class="math inline">\(k_{i,j}=\cot{\phi_{i,j}}+\cot{\phi_{j,i}}\)</span></li></ul></li></ul><figure style="text-align: center"><img src="https://s2.loli.net/2024/09/22/tYRwjISQlyW2J1f.png" alt="Uniform Laplacian"><figcaption>Uniform Laplacian</figcaption></figure><figure style="text-align: center"><img src="https://s2.loli.net/2024/09/22/znycJjoqNCtbK19.png" alt="Cotan Laplacian"><figcaption>Cotan Laplacian</figcaption></figure><h3><span id="lscm">LSCM</span></h3>The LSCM distortion measure can be defined as <span class="math display">\[D(J) = \| J + J^T - (\text{tr}\, J) I \|_F^2\]</span><figure style="text-align: center"><img src="https://s2.loli.net/2024/09/22/Yyz2u4bKoF1q5Cw.png" alt="LSCM"><figcaption>Cotan Laplacian</figcaption></figure><h3><span id="arap">ARAP</span></h3><p>The ARAP distortion is defined as <span class="math display">\[D(J) = \| J - R\|_F^2\]</span> where <span class="math inline">\(R\)</span> is the cloestrotation matrix to <span class="math inline">\(J\)</span>. The ARAPprocedure follows the steps below: - Local step: The Jacobians for eachface of the current iterate are computed. Then for each Jacobian theclosest rotation matrix is found. This can be done using the SVD of<span class="math inline">\(J\)</span>. - Global step: Then for eachJacobian the closest rotation matrix is found, they are all assumed tobe fixed, and then minimize the ARAP distortion measure by solving alinear system.</p><figure style="text-align: center"><img src="https://s2.loli.net/2024/09/21/bQjHe6omEWdcXkS.png" alt="LSCM"><figcaption>ARAP</figcaption></figure><h2><span id="shape-deformation">Shape Deformation</span></h2><p>Implement multiresolution mesh editing algorithm to interactivelydeform 3D models. Construct a two-level multi-resolution surfacerepresentation and use naive Laplacian editing to deform it.</p><p><img src="https://s2.loli.net/2024/09/22/OXJNh1mUl3wf9v6.png"></p><p>Multiresolution mesh editing algorithm: 1. Remove high-frequencydetails by surface smoothing 2. Deform the smooth mesh 3. Transferhigh-frequency details back to the deformed surface</p><p><video src="videos/mesh_edit.mp4" controls><a href="videos/mesh_edit.mp4">Video</a></video></p><h2><span id="skinning-and-skeletalanimation">Skinning and SkeletalAnimation</span></h2><h3><span id="rotation-representation">Rotation Representation</span></h3><table><colgroup><col style="width: 7%"><col style="width: 30%"><col style="width: 30%"><col style="width: 30%"></colgroup><thead><tr><th style="text-align: center;">Representions</th><th style="text-align: center;">Short Description</th><th style="text-align: center;">pros</th><th style="text-align: center;">cons</th></tr></thead><tbody><tr><td style="text-align: center;">rotation matrix</td><td style="text-align: center;">3x3 Matrix to represent rotation in3D</td><td style="text-align: center;">Simple to use directly.</td><td style="text-align: center;">Requires 9 elements to compute. Hard tointerpolation. Direct interpolation leads to artifact.</td></tr><tr><td style="text-align: center;">euler angles</td><td style="text-align: center;">Use three angles (yaw, pitch, roll) torepresent 3D representation</td><td style="text-align: center;">Only three parameters needed torepresent rotations. Intuitive. Easy to transformed to rotationmatrix</td><td style="text-align: center;">The gimbal lock problem. Can result ininterpolation problems</td></tr><tr><td style="text-align: center;">axis angle</td><td style="text-align: center;">Rotation defined by an rotation axis andan angle</td><td style="text-align: center;">straightforward and intuitive, easily beconverted to and from a matrix</td><td style="text-align: center;">Angle choices is not unique. Cannotperform interpolation directly</td></tr><tr><td style="text-align: center;">quaternions</td><td style="text-align: center;">Use a four-tuple of real number(x,y,z,w)</td><td style="text-align: center;">very efficient for interpolation.Without gimbal lock. Only 4 parameters required.</td><td style="text-align: center;">Less intuitive. more complex totransformed to rotation matrix. Double cover problem</td></tr></tbody></table><h3><span id="harmonic-skinningweights-on-selected-handles">Harmonic skinningweights on selected handles</span></h3><h4><span id="handle-selection">Handle selection</span></h4><table><colgroup><col style="width: 5%"><col style="width: 30%"><col style="width: 32%"><col style="width: 32%"></colgroup><thead><tr><th style="text-align: center;">shape name</th><th style="text-align: center;">joint 1</th><th style="text-align: center;">joint 2</th><th style="text-align: center;">joint 3</th></tr></thead><tbody><tr><td style="text-align: center;">hand</td><td style="text-align: center;"><img align="center" src="res/handle0.png" width="300"></td><td style="text-align: center;"><img align="center" src="./res/handle10.png" width="300"></td><td style="text-align: center;"><img align="center" src="./res/handle12.png" width="300"></td></tr></tbody></table><h4><span id="skinning-weightsvisualization">Skinning weightsvisualization</span></h4><table><colgroup><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"><col style="width: 25%"></colgroup><thead><tr><th style="text-align: center;">shape name</th><th style="text-align: center;">joint 1</th><th style="text-align: center;">joint 2</th><th style="text-align: center;">joint 3</th></tr></thead><tbody><tr><td style="text-align: center;">hand</td><td style="text-align: center;"><img align="center" src="./res/weight0.png" width="300"></td><td style="text-align: center;"><img align="center" src="./res/weight10.png" width="300"></td><td style="text-align: center;"><img align="center" src="./res/weight12.png" width="300"></td></tr></tbody></table><h3><span id="skeletal-animation">Skeletal animation</span></h3><table><colgroup><col style="width: 32%"><col style="width: 32%"><col style="width: 34%"></colgroup><thead><tr><th style="text-align: center;">Linear Blend Skinning</th><th style="text-align: center;">Dual Quaternion Skinning</th><th style="text-align: center;">per-face + averaging quaternions</th></tr></thead><tbody><tr><td style="text-align: center;"><img align="center" src="./res/hand_lbs.gif" width="300"></td><td style="text-align: center;"><img align="center" src="./res/hand_dqs.gif" width="300"></td><td style="text-align: center;"><img align="center" src="./res/hand_perface.gif" width="300"></td></tr></tbody></table><h3><span id="context-aware-per-vertex-lbs">Context-aware per-vertex LBS</span></h3><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr><th style="text-align: center;">without context</th><th style="text-align: center;">with context</th></tr></thead><tbody><tr><td style="text-align: center;"><img align="center" src="./res/eg_lbs.gif" width="300"></td><td style="text-align: center;"><img align="center" src="./res/eg_contextaware.gif" width="300"></td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Graphics </tag>
            
            <tag> Project </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾å½¢å­¦å…¥é—¨ç¬”è®°5: ç©ºé—´åŠ é€Ÿç»“æ„</title>
      <link href="/2024/09/18/gamegraphics/tu-xing-xue-ru-men-bi-ji-5-kong-jian-jia-su-jie-gou/"/>
      <url>/2024/09/18/gamegraphics/tu-xing-xue-ru-men-bi-ji-5-kong-jian-jia-su-jie-gou/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å…‰è¿½æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç‰©ä½“å’Œå°„çº¿çš„ç›¸äº¤è¿›è¡Œåˆ¤æ–­ï¼›åœ¨ç‰©ç†æ¨¡æ‹Ÿä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç‰©ä½“ä¹‹é—´çš„ç¢°æ’è¿›è¡Œæ£€æµ‹ã€‚å¦‚æœæˆ‘ä»¬é‡‡ç”¨æš´åŠ›ç®—æ³•ï¼Œé‚£ä¹ˆæ¯ä¸€å¸§éƒ½éœ€è¦å¤§é‡æ—¶é—´è®¡ç®—å°„çº¿æˆ–è€…ç¢°æ’æ£€æµ‹ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€äº›æ›´åŠ é«˜æ•ˆçš„æ–¹å¼æ¥è¿›è¡Œæ£€æµ‹ï¼Œè¿™å°±éœ€è¦æˆ‘ä»¬ç”¨ç©ºé—´åŠ é€Ÿç»“æ„è¿›è¡ŒåŠ é€Ÿã€‚ä»Šå¤©ä¸»è¦è®°å½•å‡ ç§åœ¨æ¸²æŸ“å’Œæ¨¡æ‹Ÿä¸­æ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•</p><ul><li>Spatial Hashing (Uniform Grid)</li><li>Spatial Hierarchy (Octree, Kd Tree, BSP tree)</li><li>Bounding Box Hierachy (BVH) <span id="more"></span></li></ul><h2><span id="spatial-hashing">Spatial Hashing</span></h2><p>Spatial Hashingçš„æ€è·¯æ˜¯å°†ç©ºé—´åˆ’åˆ†ä¸ºUniformGridï¼Œæ¯ä¸ªGridä¸­å­˜å‚¨ç€ä¸å…¶ç›¸äº¤çš„ä¸‰è§’å½¢æˆ–è€…ç²’å­ã€‚è¿™é‡Œæˆ‘æœ‰çœ‹åˆ°ä¸¤ç§åœ¨ä¸åŒæƒ…å†µä¸‹ä½¿ç”¨SpatialHashingçš„æƒ…å½¢ï¼Œç¬¬ä¸€ç§æ˜¯ä¸‰è§’å½¢ï¼Œç¬¬äºŒç§æ˜¯ç²’å­ã€‚å¯¹äºä¸‰è§’å½¢æ¥è¯´ï¼ŒåŒä¸€ä¸ªä¸‰è§’å½¢å¯èƒ½å­˜åœ¨äºå¤šä¸ªGridå½“ä¸­ï¼Œè€Œä¸€ä¸ªGridå¯èƒ½ä¹Ÿä¼šå­˜åœ¨å¤šä¸ªä¸‰è§’å½¢ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://s2.loli.net/2024/02/17/NTOxbhg9AoCRPS3.png" alt="image.png">å½“ç„¶ï¼Œä¸Šé¢è¿™ç§å­˜å‚¨æ–¹å¼ï¼Œæ˜¯ä¼šé€ æˆé—®é¢˜çš„ã€‚ç”±äºå¾ˆå¤šæ ¼å­ä¸­å¯èƒ½æ²¡æœ‰ä¸‰è§’å½¢ï¼Œæ‰€ä»¥ä¼šé€ æˆä¸å¿…è¦çš„ç©ºé—´åˆ†é…ã€‚å› æ­¤ï¼Œæ­£å¦‚åç§°ä¸­çš„å“ˆå¸Œæ‰€è¡¨ç¤ºçš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™ç§ç©ºé—´åˆ’åˆ†è¡¨ç¤ºä¸ºobject-cellé”®å€¼å¯¹çš„listï¼Œç„¶åæ ¹æ®cellçš„IDè¿›è¡Œæ’åºï¼Œç„¶åå°±å¯ä»¥å½¢æˆä¸‹é¢çš„ç»“æ„ã€‚åœ¨æŸ¥æ‰¾çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®cellçš„ä¸‹æ ‡ã€‚åœ¨å¯»æ‰¾å’Œä¸‰è§’å½¢overlapçš„cellçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ä¸‰è§’å½¢çš„boundingboxå’Œç©ºé—´ä¸­çš„cellsè¿›è¡Œè®¡ç®—ã€‚åœ¨ç¢°æ’æ£€æµ‹æ—¶ï¼Œé¦–å…ˆè®¡ç®—å‡ºå½“å‰ä¸‰è§’å½¢æ‰€ç›¸äº¤çš„åŒºåŸŸï¼Œç„¶åé€šè¿‡SpatialHashingè®¿é—®åˆ°è¿™äº›åŒºåŸŸä¸­çš„ä¸‰è§’å½¢ï¼Œè¿™äº›ä¸‰è§’å½¢å°±æ˜¯æœ‰å¯èƒ½äº§ç”Ÿç¢°æ’çš„ä¸‰è§’å½¢å¯¹ï¼Œä¹‹åç”¨äºåšåç»­çš„æ£€æµ‹ã€‚<img src="https://s2.loli.net/2024/09/16/wePfqOhyt5nr7Js.png" alt="image.png">ç°åœ¨è¿™ç§æ’å¸ƒä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚å› ä¸ºCellçš„IDæ˜¯æŒ‰ç…§é¡ºåºå®šä¹‰çš„ï¼Œåœ¨è®¿é—®çš„æ—¶å€™ä¼šå­˜åœ¨cachelocalityçš„é—®é¢˜ã€‚å½“è®¿é—®å·¦å³ä¸¤ä¾§çš„Cellä¸­çš„ä¸‰è§’å½¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬åœ¨è®¿é—®ä¸€äº›è¿ç»­çš„å†…å­˜ï¼Œå¯ä»¥æˆåŠŸåˆ©ç”¨cacheç¼“å­˜ã€‚ä½†æ˜¯å½“æˆ‘ä»¬è®¿é—®ä¸Šä¸‹çš„Cellçš„æ—¶å€™ï¼ŒSpatialLocalityå°±æ¯”è¾ƒå·®ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰äººæå‡ºäº†MortonCodeçš„æ–¹æ³•ï¼Œç”¨ä¸€ç§ç»†åˆ†çš„Zå­—å‹ç»“æ„æŒ‡å®šCellçš„IDï¼Œå¯ä»¥æœ‰æ•ˆæé«˜SpatialLocalityã€‚ <img src="https://s2.loli.net/2024/09/16/ur5mfJX12dtRSOL.png" alt="image.png">ç°åœ¨æˆ‘ä»¬çš„Cellçš„IDæ˜¯æˆ‘ä»¬é¢„å…ˆç¡®å®šå¥½çš„ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªç©ºé—´æ˜¯ä¸€ä¸ªboundedçš„ç©ºé—´ã€‚ä½†æ˜¯åœ¨å®é™…æƒ…å†µä¸­ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘unboundedçš„ç©ºé—´ï¼Œä¸€ä¸ªç†è®ºä¸Šæ— é™çš„ç©ºé—´ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œå‡½æ•°å»ç”ŸæˆCellçš„IDï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªå‡½æ•°ï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">hashCoords</span>(<span class="params">xi, yi, zi</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> h = (xi * <span class="number">92837111</span>) ^ (yi * <span class="number">689287499</span>) ^ (zi * <span class="number">283923481</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">abs</span>(h) % <span class="variable language_">this</span>.<span class="property">tableSize</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>å¯¹äºå…·ä½“çš„å®ç°ï¼Œæˆ‘ä»¬åŒæ ·å¸Œæœ›èƒ½å¤Ÿå®ç°ä¸€ç§Denseçš„æ•°æ®ç»“æ„ç”¨äºå­˜å‚¨å’Œè®¿é—®ã€‚éœ€è¦åˆ›å»ºä¸€ä¸‹æ•°ç»„- <code>cellStart</code>ï¼Œå¤§å°ä¸ºå“ˆå¸Œè¡¨çš„å¤§å°+1; -<code>cellEntries</code>ï¼Œå¤§å°ä¸ºæ‰€æœ‰ç‰©ä½“çš„æ•°é‡ ç®—æ³•æµç¨‹å¦‚ä¸‹ï¼š 1.å°†æ¯ä¸ªCellä¸­çš„ç‰©ä½“æ•°é‡å†™å…¥<code>cellStart</code>æ•°ç»„ä¸­ 2.<code>cellStart</code>è®¡ç®—å‰ç¼€å’Œ 3. å¡«å…¥<code>cellEntries</code>æ•°ç»„<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">h =&gt; objectæ‰€åœ¨Cellçš„å“ˆå¸Œå€¼</span><br><span class="line">cellStart[h]--</span><br><span class="line">cellEntries[cellStart[h]] = object</span><br></pre></td></tr></table></figure> è®¿é—®Cellä¸­çš„ç‰©ä½“æ—¶ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h =&gt; cell id</span><br><span class="line">int start = cellStart[h]</span><br><span class="line">int end = cellStart[h+1]</span><br><span class="line">for (int i = start; i &lt; end; i++)</span><br><span class="line">object = cellEntries[i]</span><br></pre></td></tr></table></figure></p><figure><img src="https://s2.loli.net/2024/09/16/RmDnQLebFgJ8tdV.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å…·ä½“çš„ä»£ç å®ç°å‚è€ƒ<a href="https://github.com/matthias-research/pages/blob/master/tenMinutePhysics/11-hashing.html">pages/tenMinutePhysics/11-hashing.html</a></p><h2><span id="spatial-hierarchies">Spatial Hierarchies</span></h2><p>é‡‡ç”¨UniformGridçš„æ–¹æ³•åœ¨å…‰çº¿æ±‚äº¤çš„æ—¶å€™æ•ˆç‡ä¸é«˜ï¼Œå› ä¸ºæ²¡æœ‰hierarchyçš„ç»“æ„ï¼Œæ‰€ä»¥åœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸­ä»ç„¶ä¼šæœ‰å¾ˆå¤šä¸å¿…è¦çš„è®¡ç®—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç©ºé—´åˆ’åˆ†ä¸ºæ ‘çŠ¶ç»“æ„ï¼Œå¯ä»¥äº§ç”Ÿä»¥ä¸‹ä¸‰ç§åˆ’åˆ†çš„æ–¹å¼</p><ul><li>Octree(å…«å‰æ ‘)ï¼šå°†ç©ºé—´é€’å½’çš„ç»†åˆ†ä¸ºç­‰å¤§çš„å…«ä¸ªå­ç©ºé—´</li><li>Kd-treeï¼šäº¤æ›¿çš„æŒ‰ç…§è½´å¯¹ç©ºé—´è¿›è¡Œåˆ’åˆ†</li><li>Bsp-treeï¼šKd-treeåœ¨Kd-treeçš„åŸºç¡€ä¸Šï¼Œç§»é™¤äº†axis-alignedçš„é™åˆ¶ï¼Œä»¥ä»»æ„æ–¹å‘å¯¹ç©ºé—´è¿›è¡Œé€’å½’çš„åˆ’åˆ†<img src="https://s2.loli.net/2024/01/15/fA7ctpDxzBUqZVl.png" alt="image.png"></li></ul><h2><span id="bounding-box-hierachy-bvh">Bounding Box Hierachy (BVH)</span></h2><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20230216234700.png">BVHæ˜¯ä¸€ç§æŒ‰ç…§ç‰©ä½“è¿›è¡Œåˆ’åˆ†çš„ç©ºé—´åŠ é€Ÿç®—æ³•ã€‚é¦–å…ˆæ‰¾åˆ°æ‰€æœ‰ç‰©ä½“çš„ä¸€ä¸ªåŒ…å›´ç›’ï¼Œç„¶åé€’å½’çš„å°†ç‰©ä½“åˆ†æˆä¸¤ä¸ªå­é›†ï¼Œå¹¶è®¡ç®—æ–°çš„åŒ…å›´ç›’ï¼Œå½“åŒ…å›´ç›’ä¸­çš„ç‰©ä½“è¾¾åˆ°ä¸€å®šçš„æ•°é‡çš„æ—¶å€™ï¼Œåœæ­¢ç»§ç»­ç»†åˆ†ï¼Œå°†æ‰€æœ‰ç‰©ä½“å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹å½“ä¸­ã€‚ä½¿ç”¨BVHä¹Ÿå¯ä»¥è¿›è¡Œç¢°æ’æ£€æµ‹ï¼Œæµç¨‹å¦‚ä¸‹ã€‚ä»å¶å­èŠ‚ç‚¹å¼€å§‹ï¼Œå‘ä¸Šä¸€å±‚ä¸€å±‚è¿›è¡Œç¢°æ’æ£€æµ‹ã€‚<img src="https://s2.loli.net/2024/02/17/RghClODsLVZbF8e.png" alt="image.png"></p><div class="note info no-icon"><ul><li>SpatialHashingç›¸å¯¹æ¥è¯´å®ç°æ›´å®¹æ˜“ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒGPUå¹¶è¡Œè®¡ç®—ï¼Œä½†æ˜¯éœ€è¦æ¯æ¬¡updateä¹‹åéƒ½é‡æ–°è®¡ç®—Hash</li><li>BVHå®ç°èµ·æ¥ä¼šæ›´å¤æ‚ï¼Œå¹¶ä¸”ç”±äºå…¶æ ‘çŠ¶çš„é€’å½’ç»“æ„ï¼Œå¹¶ä¸åˆ©äºåœ¨GPUä¸Šè®¡ç®—ï¼Œä½†æ˜¯å¯¹äºBVHï¼Œåªéœ€è¦æ›´æ–°BoundingBoxå³å¯</li><li>SpatialHierarchyçš„ç»“æ„åŒæ ·ä¸åˆ©äºåœ¨GPUä¸Šè¿›è¡Œè®¡ç®—ï¼ŒåŒæ—¶ï¼Œç”±äºæ˜¯ä»¥ç©ºé—´ä¸ºåŸºç¡€è¿›è¡Œåˆ’åˆ†ï¼Œéš¾å…ä¼šæœ‰ä¸€ä¸ªç‰©ä½“å‡ºç°åœ¨å¤šä¸ªå­ç©ºé—´ä¸­çš„æƒ…å†µå­˜åœ¨</li></ul></div><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><ul><li><a href="https://matthias-research.github.io/pages/tenMinutePhysics/11-hashing.pdf">TenMinutesPhysics-SpatialHashing</a></li><li><a href="https://www.bilibili.com/video/BV12Q4y1S73g?p=9&amp;vd_source=4363d4cc2554c5f82c74408e68eb7dc0">Games103Lecture 09 Collision Handling</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å½¢å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Quaternionå››å…ƒæ•°è¯¦è§£</title>
      <link href="/2024/02/19/gamegraphics/quaternion-si-yuan-shu-xiang-jie/"/>
      <url>/2024/02/19/gamegraphics/quaternion-si-yuan-shu-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>å››å…ƒæ•°(Quaternion)æ˜¯ç”¨äºè¡¨ç¤ºæ—‹è½¬çš„ä¸€ç§æ–¹å¼ï¼Œå…¶ç›¸æ¯”äºRotationMatrixçš„å¥½å¤„åœ¨äºèƒ½å¤Ÿæ›´è½»æ¾çš„æ’å€¼ã€ä¸å­˜åœ¨ä¸‡å‘èŠ‚(gimballock)çš„é—®é¢˜ã€‚å…¶å®šä¹‰å¦‚ä¸‹ï¼š <span class="math display">\[q=a+bi+cj+dk\]</span> å…¶ä¸­<span class="math inline">\(i^{2}=j^{2}=k^{2}=ijk=-1\)</span>ã€‚åŒæ—¶ä¹Ÿå¯ä»¥ç”¨ä»¥ä¸‹æ–¹å¼è¡¨ç¤ºï¼š<span class="math display">\[q=\left(a, \mathbf{v}\right), \text{where}\mathbf{v}=\begin{bmatrix}b\\c\\d\end{bmatrix}\]</span> <span class="math inline">\(a\)</span>æ˜¯å®éƒ¨ï¼Œ<span class="math inline">\(\mathbf{v}\)</span>æ˜¯å‘é‡ã€‚å››å…ƒæ•°çš„æ—‹è½¬å¯ä»¥ç†è§£ä¸ºå››ç»´åæ ‡åœ¨ä¸‰ç»´ç©ºé—´ä¸­çš„æŠ•å½±ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://www.youtube.com/watch?v=zjMuIxRvygQ">3b1bçš„è§†é¢‘</a><span id="more"></span></p><h1><span id="å››å…ƒæ•°çš„åŸºæœ¬è¿ç®—">å››å…ƒæ•°çš„åŸºæœ¬è¿ç®—</span></h1><ul><li><p>å…±è½­ (Conjugate) <span class="math display">\[q^{*}=a-bi-ci-dk\]</span></p></li><li><p>é€† (Inverse) <span class="math display">\[\begin{align*}q^{-1}=\frac{q^{*}}{\Vert q \Vert}\\q^{-1}q=qq^{-1}=1\end{align*}\]</span></p></li><li><p>æ¨¡ (Norm) <span class="math display">\[\Vert q \Vert=\sqrt{a^{2}+b^{2}+c^{2}+d^{2}}\]</span></p></li><li><p>ä¹˜æ³• <span class="math display">\[pq=\begin{bmatrix}(p_{a}\mathbf{q}_{V}+q_{a}\mathbf{p}_{V}+\mathbf{p}_{V}\times\mathbf{q}_{V})&amp;(p_{a}q_{a}-\mathbf{p}_{V}\cdot\mathbf{q}_{V})\end{bmatrix}\]</span></p></li><li><p>å½“<span class="math inline">\(\Vert q \Vert=1\)</span>æ—¶ï¼Œ<span class="math inline">\(q^{-1}=q^{*}\)</span></p></li><li><p><span class="math inline">\((pq)^{*}=q^{*}p^{*}\)</span></p></li><li><p><span class="math inline">\((pq)^{-1}=q^{-1}p^{-1}\)</span></p></li></ul><h1><span id="å¦‚ä½•ä½¿ç”¨å››å…ƒæ•°è¡¨ç¤ºæ—‹è½¬">å¦‚ä½•ä½¿ç”¨å››å…ƒæ•°è¡¨ç¤ºæ—‹è½¬</span></h1><p>å››å…ƒæ•°è¡¨ç¤ºæ—‹è½¬æ—¶å¿…é¡»æ—¶unit quaternionï¼Œè¡¨ç¤ºå¦‚ä¸‹ <span class="math display">\[\begin{align*}q&amp;=\begin{bmatrix}q_{a}&amp;\mathbf{q}_{V}\end{bmatrix}\\&amp;=\begin{bmatrix}\cos{\frac{\theta}{2}} &amp; \mathbf{v}\sin{\frac{\theta}{2}}\end{bmatrix}\end{align*}\]</span> å…¶ä¸­<span class="math inline">\(a^{2}+b^{2}+c^{2}+d^{2}=1\)</span></p><p>å¦‚æœæƒ³è¦å¯¹ç©ºé—´ä¸­çš„ç‚¹è¿›è¡Œæ—‹è½¬ï¼Œéœ€è¦å…ˆå°†ç‚¹(æˆ–å‘é‡)çš„ä¸‰ç»´åæ ‡å½¢å¼è½¬åŒ–ä¸ºquaternionçš„å½¢å¼ï¼š<span class="math display">\[v=\begin{bmatrix}0&amp;\mathbf{v}\end{bmatrix}=\begin{bmatrix}0&amp;v_{x}&amp;v_{y}&amp;v_{z}\end{bmatrix}=bi+cj+dk\]</span> å¯¹è¯¥ç‚¹çš„å››å…ƒæ•°æ—‹è½¬è¡¨ç¤ºå¦‚ä¸‹ï¼š <span class="math display">\[v&#39;=qvq^{-1}=qvq^{*}\]</span></p><h1><span id="å››å…ƒæ•°å’Œæ—‹è½¬çŸ©é˜µçš„ç›¸äº’è½¬åŒ–">å››å…ƒæ•°å’Œæ—‹è½¬çŸ©é˜µçš„ç›¸äº’è½¬åŒ–</span></h1><ul><li>Quaternion to Matrix <img src="https://s2.loli.net/2024/02/19/tdy1F3zHupTXPJV.png" alt="image.png"></li><li>Rotation Matrix to Quaternion <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// From Game Engine Architecture</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">matrixToQuaternion</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">const</span> <span class="type">float</span> R[<span class="number">3</span>][<span class="number">3</span>],</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">float</span>       q[<span class="comment">/*4*/</span>])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="type">float</span> trace = R[<span class="number">0</span>][<span class="number">0</span>]+R[<span class="number">1</span>][<span class="number">1</span>]+R[<span class="number">2</span>][<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// check the diagonal</span></span><br><span class="line"><span class="keyword">if</span> (trace &gt; <span class="number">0.0f</span>)</span><br><span class="line">&#123;</span><br><span class="line">flaot s = <span class="built_in">sqrt</span>(trace + <span class="number">1.0f</span>);</span><br><span class="line">q[<span class="number">3</span>] = s * <span class="number">0.5f</span>;</span><br><span class="line"><span class="type">float</span> t = <span class="number">0.5f</span> / s;</span><br><span class="line">q[<span class="number">0</span>] = (R[<span class="number">2</span>][<span class="number">1</span>] - R[<span class="number">1</span>][<span class="number">2</span>]) * t;</span><br><span class="line">q[<span class="number">1</span>] = (R[<span class="number">0</span>][<span class="number">2</span>] - R[<span class="number">2</span>][<span class="number">0</span>]) * t;</span><br><span class="line">q[<span class="number">2</span>] = (R[<span class="number">1</span>][<span class="number">0</span>] - R[<span class="number">0</span>][<span class="number">1</span>]) * t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// diagonal is negative</span></span><br><span class="line"><span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span> (R[<span class="number">1</span>][<span class="number">1</span>] &gt; R[<span class="number">0</span>][<span class="number">0</span>]) i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (R[<span class="number">2</span>][<span class="number">2</span>] &gt; R[i][i]) i = <span class="number">2</span>;</span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">int</span> NEXT[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>&#125;;</span><br><span class="line"><span class="type">int</span> j = NEXT[i];</span><br><span class="line"><span class="type">int</span> k = NEXT[j];</span><br><span class="line"><span class="type">float</span> s = <span class="built_in">sqrt</span>((R[i][j] - (R[j][j]+R[k][k])) + <span class="number">1.0f</span>);</span><br><span class="line">q[i] = s * <span class="number">0.5f</span>;</span><br><span class="line"><span class="type">float</span> t;</span><br><span class="line"><span class="keyword">if</span> (s != <span class="number">0.0f</span>) t = <span class="number">0.5f</span> / s;</span><br><span class="line"><span class="keyword">else</span>           t = s;</span><br><span class="line">q[<span class="number">3</span>] = (R[k][j] - R[j][k]) * t;</span><br><span class="line">q[j] = (R[j][i] - R[i][j]) * t;</span><br><span class="line">q[k] = (R[k][i] - R[i][k]) * t;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h1><span id="å››å…ƒæ•°çš„æ’å€¼">å››å…ƒæ•°çš„æ’å€¼</span></h1><ul><li>Linear Interpolation (Lerp) <span class="math display">\[q_{\text{LERP}}=\text{LERP}(\mathbf{q}_{A},\mathbf{q}_{b},\beta)=\frac{(1-\beta)\mathbf{q}_{A}+\beta\mathbf{q}_{B}}{\vert(1-\beta)\mathbf{q}_{A}+\beta \mathbf{q}_{B}\vert}\]</span></li><li>Spherical Linear Interpolation (Slerp) <span class="math display">\[\text{SLERP}(\mathbf{p},\mathbf{q},\beta)=w_{p}\mathbf{p}+w_{q}\mathbf{q}\]</span> å…¶ä¸­ <span class="math display">\[\begin{align*}w_{p}&amp;=\frac{\sin(1-\beta)\theta}{\sin \theta} \\w_{q}&amp;=\frac{\sin\beta\theta}{\sin \theta}\end{align*}    \]</span> <span class="math inline">\(\mathbf{p}\)</span>å’Œ<span class="math inline">\(\mathbf{q}\)</span>çš„å¤¹è§’å¯ä»¥é€šè¿‡å››å…ƒæ•°çš„ç‚¹ä¹˜æ¥è®¡ç®—<span class="math display">\[\begin{align*}\cos \theta&amp;=\mathbf{p} \cdot\mathbf{q}=p_{x}q_{x}+p_{y}q_{y}+p_{z}q_{z}+p_{w}q_{w}\\\theta&amp;=\cos^{-1}(\mathbf{p} \cdot \mathbf{q})\end{align*}\]</span></li></ul><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><ol type="1"><li><a href="https://eater.net/quaternions">Visualizing quaternions, anexplorable video series</a></li><li><a href="https://www.youtube.com/watch?v=zjMuIxRvygQ">Quaternionsand 3d rotation, explained interactively - YouTube</a></li><li>Game Engine Architecture 4.4 Quaternions</li><li>Games104 Lecture 08</li></ol>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> Simulation </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Postion Based Dynamicsè½¯ä½“æ¨¡æ‹Ÿ</title>
      <link href="/2024/02/19/gamegraphics/pbdsimulator/"/>
      <url>/2024/02/19/gamegraphics/pbdsimulator/</url>
      
        <content type="html"><![CDATA[<p>åœ¨position baseddynamicsä¸­ï¼Œç‰©ä½“ç”±è®¸å¤šçš„ç²’å­ç»„æˆï¼Œè¿™äº›ç²’å­ä¹‹é—´æœ‰è®¸å¤šçº¦æŸï¼Œæ¯”å¦‚è¯´è·ç¦»çº¦æŸã€ä½“ç§¯çº¦æŸç­‰ç­‰ã€‚åœ¨ç‰©ä½“è¿åŠ¨çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡è§£è¿™äº›çº¦æŸæ¥æ›´æ–°ç²’å­çš„ä½ç½®ã€‚å¤§è‡´çš„ä¼ªä»£ç å¦‚ä¸‹ï¼ˆè¿™æ˜¯XPBDçš„ä¼ªä»£ç ï¼ŒXPBDçš„åŒºåˆ«åœ¨äºXPBDä½¿ç”¨äº†substepåŠ é€Ÿæ”¶æ•›ï¼‰<span id="more"></span></p><figure><img src="https://s2.loli.net/2024/02/15/xAoRjMfCFsmJXa7.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h1><span id="solve-constraint">Solve Constraint</span></h1><p>å¯¹äºæ¯ä¸ªConstraintï¼Œè®¡ç®—å…¶ä½ç½®çš„ä¾¿å®œé‡<span class="math inline">\(\Delta\mathbf{x}_{i}=\lambda w_{i} \nablaC_{i}\)</span> <span class="math display">\[\lambda=\frac{-C}{w_{1}\vert\nabla C_{1}\vert^{2}+w_{1}\vert\nablaC_{1}\vert^{2}+\cdots+w_{n}\vert\nabla C_{n}\vert^{2}+\frac{\alpha}{\Delta t^{2}}}\]</span></p><ul><li><span class="math inline">\(C\)</span> æ˜¯çº¦æŸå‡½æ•°</li><li><span class="math inline">\(\nabla C_{i}\)</span>æ˜¯çº¦æŸå‡½æ•°å…³äº<span class="math inline">\(x_{i}\)</span> çš„gradient</li><li><span class="math inline">\(w_{i}\)</span>æ˜¯ç²’å­çš„è´¨é‡çš„å€’æ•°</li><li><span class="math inline">\(\alpha\)</span> æ˜¯stiffnesså‚æ•°</li></ul><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr><th>Distance</th><th>Volume</th></tr></thead><tbody><tr><td><img src="https://s2.loli.net/2024/02/15/K5DSaifQrMbTZsy.png" alt="image.png"><br></td><td><img src="https://s2.loli.net/2024/02/15/V3NLxolERuedIt1.png" alt="image.png"><br></td></tr></tbody></table><h1><span id="ç¢°æ’æ£€æµ‹">ç¢°æ’æ£€æµ‹</span></h1><p>ç¢°æ’æ£€æµ‹åˆ†ä¸ºbroad phaseå’Œnarrow phaseï¼Œåœ¨broad phaseä½¿ç”¨BVHå’ŒSpatialHashç­‰ç©ºé—´åŠ é€Ÿç®—æ³•æ’é™¤æ‰å¤§éƒ¨åˆ†ä¸éœ€è¦è¿›è¡Œæ£€æµ‹çš„ä¸‰è§’å½¢ï¼ˆç”±äºæ—¶é—´é™åˆ¶ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å®Œæˆè¿™ä¸€éƒ¨åˆ†ï¼Œè¿™ä¹Ÿå°±å¯¼è‡´æœ€åçš„simulatoræ— æ³•å®æ—¶è¿è¡Œï¼‰ã€‚å¯¹äºæœ‰å¯èƒ½ç›¸äº¤çš„ä¸‰è§’å½¢è¿›è¡Œä¸¤ä¸¤æ£€æµ‹ï¼Œç„¶åé€šè¿‡CollisionConstraintä¿®æ­£é¡¶ç‚¹çš„ä½ç½®ã€‚</p><p>æ ¹æ®<a href="https://www.sciencedirect.com/science/article/pii/S1047320307000065">Paper</a>ä¸­çš„æè¿°ï¼ŒCollisionConstraintå®šä¹‰ä¸º <span class="math display">\[C(\mathbf{p})=(\mathbf{p}-\mathbf{q}_{c}) \cdot \mathbf{n}_{c}\]</span> <span class="math inline">\(\mathbf{q}_{c}\)</span>æ˜¯ä»<span class="math inline">\(p_{t-1}\rightarrow p_{t}\)</span>çš„çº¿æ®µå’Œtriangleçš„ç›¸äº¤ç‚¹(entry point)ï¼Œ<span class="math inline">\(\mathbf{n}_{c}\)</span>æ˜¯ç›¸äº¤ç‚¹å¤„çš„æ³•çº¿ã€‚CollisionConstrainté€šæ±‚è§£æ˜¾ç„¶å°±æ˜¯<span class="math inline">\(p_{t}\)</span>åœ¨ç›¸äº¤å¹³é¢ä¸Šçš„æŠ•å½±(æ²¿ç€gradientæ–¹å‘è¿›è¡Œç§»åŠ¨)ã€‚</p><p>å½“ç„¶è¿˜æœ‰ç‰¹æ®Šæƒ…å†µæ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬åœ¨æŸä¸€æ—¶åˆ»ç¢°æ’æ£€æµ‹å¤±æ•ˆäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™<span class="math inline">\(p_{t-1}\)</span>å’Œ <span class="math inline">\(p_{t}\)</span>å°±éƒ½åœ¨å¦ä¸€ä¸ªmeshå†…éƒ¨äº†ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼ŒPaperä¸­è¯´è¿™ä¸ªæ—¶å€™çš„Constaintå°±å˜æˆäº†<span class="math display">\[C(\mathbf{p})=(\mathbf{p}-\mathbf{q}_{s}) \cdot \mathbf{n}_{s}\]</span> <span class="math inline">\(\mathbf{q}_{s}\)</span>æ˜¯<span class="math inline">\(p_{t}\)</span>æœ€è¿‘å¹³é¢çš„æŠ•å½±ç‚¹ï¼Œ<span class="math inline">\(\mathbf{n}_{s}\)</span>æ˜¯æ³•çº¿ï¼Œç±»ä¼¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬éœ€è¦æ‰¾åˆ°å½“å‰é¡¶ç‚¹ä½ç½®çš„æœ€è¿‘å¹³é¢ç„¶åæŠ•å½±è¿‡å»ã€‚</p><p>å¯¹äºåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨meshå†…éƒ¨ï¼Œå¯ä»¥é‡‡ç”¨å°„çº¿æ³•ï¼Œè®¡ç®—å‡ºç›¸äº¤ç‚¹çš„ä¸ªæ•°è¿›è¡Œåˆ¤æ–­ã€‚è¿™é‡Œå°±äº§ç”Ÿäº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„Tetrahedronçš„ç”Ÿæˆè²Œä¼¼æœ‰ç‚¹ç‚¹é—®é¢˜ï¼Œæ‰€ä»¥å¯¼è‡´æˆ‘ä»¬æ— æ³•è·å¾—è¡¨é¢çš„ä¸‰è§’å½¢ï¼ˆåœ¨Tetrahedronå†…éƒ¨æœ‰ä¸€äº›ä¸‰è§’å½¢çš„æ®‹ä½™ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼‰ã€‚</p><h1><span id="tetrahedronçš„ç”Ÿæˆ">Tetrahedronçš„ç”Ÿæˆ</span></h1><p>Tetrahedronçš„ç”Ÿæˆå¯ä»¥ä½¿ç”¨Incremental DelaunayMethodç”Ÿæˆã€‚å››é¢ä½“å¯ä»¥è¿‘ä¼¼çš„ä½¿ç”¨å¹³é¢çš„ä¸‰è§’å½¢è¿›è¡Œç±»æ¯”ï¼Œåªéœ€è¦å°†å››é¢ä½“çš„å››ä¸ªé¡¶ç‚¹æ¢æˆä¸‰ä¸ªé¡¶ç‚¹ã€‚ä¸€ä¸ªDelaunayç½‘æ ¼ä¸­çš„ä»»æ„ä¸€ä¸ªç‚¹éƒ½ä¸åœ¨é™¤äº†ä»–ååœ¨çš„ä¸‰è§’å½¢å…¶ä»–çš„ä¸‰è§’å½¢çš„å¤–æ¥åœ†ä¸­ã€‚</p><blockquote><p><strong>Wiki</strong> InÂ <a href="https://en.wikipedia.org/wiki/Mathematics" title="Mathematics">mathematics</a>Â andÂ <a href="https://en.wikipedia.org/wiki/Computational_geometry" title="Computational geometry">computational geometry</a>,aÂ <strong>Delaunay triangulation</strong>Â (<strong>DT</strong>), alsoknown as aÂ <strong>Delone triangulation</strong>, for a givensetÂ {<em>p_i</em>} ofÂ <a href="https://en.wikipedia.org/wiki/Isolated_point" title="Isolated point">discrete points</a>Â <em>p_i</em>Â inÂ <a href="https://en.wikipedia.org/wiki/General_position" title="General position">general position</a>Â is aÂ <a href="https://en.wikipedia.org/wiki/Point-set_triangulation" title="Point-set triangulation">triangulation</a>Â such that nopointÂ <em>p_i</em>Â is inside theÂ <a href="https://en.wikipedia.org/wiki/Circumcircle#Triangles" title="Circumcircle">circumcircle</a>Â of anyÂ <a href="https://en.wikipedia.org/wiki/Triangle" title="Triangle">triangle</a>Â in the DT. Delaunay triangulationsmaximize the minimum of all the angles of the triangles in thetriangulation; they tend to avoidÂ <a href="https://en.wikipedia.org/wiki/Sliver_triangle" title="Sliver triangle">sliver triangles</a>.</p></blockquote><p>Delaunayç®—æ³•æµç¨‹å¦‚ä¸‹</p><ol type="1"><li>è¾“å…¥ï¼šmeshçš„é¡¶ç‚¹åæ ‡</li><li>é¦–å…ˆç”¨å››ä¸ªä¸´æ—¶åæ ‡ç”Ÿæˆä¸€ä¸ªå¤§çš„å››é¢ä½“å°†æ‰€æœ‰çš„ç‚¹å›´èµ·æ¥</li><li>ç„¶åé‡å¤ä»¥ä¸‹æµç¨‹<ol type="1"><li>å°†ä¸€ä¸ªæ–°çš„vertexæ·»åŠ è¿›å»</li><li>ç§»é™¤æ‰€æœ‰çš„å¤–æ¥åœ†åŒ…å«è¿™ä¸ªvertexçš„å››é¢ä½“</li><li>ä»¥è¿™ä¸ªvertexä¸ºä¸­å¿ƒï¼Œç”Ÿæˆç¯åœ¨å…¶å‘¨å›´çš„å››é¢ä½“ï¼Œå¡«è¡¥å°†ä¸Šä¸€æ­¥ç§»é™¤é€ æˆçš„ç©ºç¼º</li></ol></li><li>æœ€åå°†ä¸´æ—¶ç‚¹ç§»é™¤å³å¯</li></ol><p>ç§»é™¤å››é¢ä½“æ—¶ï¼Œéœ€è¦å…ˆæ‰¾åˆ°è¿™ä¸ªç‚¹åœ¨å“ªä¸ªtetrahedronå†…éƒ¨ã€‚è¿™å¯ä»¥é€šè¿‡è¯¥ç‚¹å‘å‡ºä¸€æ¡åˆ°ä¸Šä¸€ä¸ªæ·»åŠ çš„ç‚¹çš„å°„çº¿ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªç›¸äº¤çš„surfaceã€‚ç„¶åé€šè¿‡flood-fillå»æ‰¾åˆ°é™„è¿‘çš„ä¸ç¬¦åˆæ¡ä»¶çš„å››é¢ä½“ã€‚# å¹¶è¡ŒåŒ– ç”±äºPosition Based Dynamicsé‡‡ç”¨çš„æ˜¯Gauss-SiedelIterationï¼Œè¿™å¯¼è‡´äº†å¾ˆéš¾å°†å…¶å¹¶è¡ŒåŒ–ï¼Œæ‰€ä»¥æ— æ³•åœ¨taichiçš„gpumodeä¸‹è¿è¡Œã€‚å¦‚æœæƒ³è¦å¹¶è¡ŒåŒ–çš„è¯ï¼Œéœ€è¦ä½¿ç”¨JacobiIterationã€‚ç„¶è€Œä»æ•ˆç‡ä¸Šæ¥è¯´ï¼ŒJacobiIterationçš„æ”¶æ•›é€Ÿåº¦æ˜¯è¿œè¿œä¸å¦‚Gauss-Sidelçš„ã€‚è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯Graph-ColoringMethodsã€‚</p><p>GraphColoringçš„æ€æƒ³æ˜¯ï¼Œå°†æ‰€æœ‰çš„constaintåˆ†æˆå¤šä¸ªphaseè¿›è¡Œæ±‚è§£ã€‚åœ¨æ¯ä¸€ä¸ªphaseï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æ²¡æœ‰ä»»ä½•ä¸€ä¸ªcostraintå…±äº«ä¸€ä¸ªé¡¶ç‚¹ã€‚è¿™å°±å¯¹åº”ç€graphcoloringé—®é¢˜ã€‚</p><h1><span id="æœ€ç»ˆæ•ˆæœ">æœ€ç»ˆæ•ˆæœ</span></h1><p>ç”±äºBlenderçš„Tetrahedralizeç®—æ³•ç”Ÿæˆçš„å››é¢ä½“ä¼¼ä¹æœ‰ç‚¹é—®é¢˜ï¼Œå¯¼è‡´ç¢°æ’æ£€æµ‹å¹¶ä¸robustã€‚æœ€åæ—¶é—´é—®é¢˜ï¼Œå¹¶è¡ŒåŒ–åªå®ç°äº†Jacobiï¼Œä½†æ˜¯æ•ˆæœè¿˜æ˜¯æ²¡æœ‰Gauss-Siedelå¥½ã€‚BroadPhaseçš„ç¢°æ’æ£€æµ‹ä¹Ÿæœ‰å¾…å®Œæˆã€‚å‚æ•°ä¹Ÿè°ƒæ•´çš„æ¯”è¾ƒstiffï¼Œæ•ˆæœå¦‚ä¸‹</p><p><img src="results.gif"></p><h1><span id="reference">Reference</span></h1><ol type="1"><li><a href="https://www.sciencedirect.com/science/article/pii/S1047320307000065">Positionbased dynamics - ScienceDirect</a></li><li><a href="https://matthias-research.github.io/pages/tenMinutePhysics/index.html">TenMinute Physics</a> Tutorial 10 and 11</li><li><a href="https://www.cs.umd.edu/class/fall2019/cmsc828X/LEC/PBD.pdf">cs.umd.edu/class/fall2019/cmsc828X/LEC/PBD.pdf</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Project </tag>
            
            <tag> Simulation </tag>
            
            <tag> Taichi </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ray Tracing Renderer (Course Project)</title>
      <link href="/2023/12/24/gamegraphics/noriproject/"/>
      <url>/2023/12/24/gamegraphics/noriproject/</url>
      
        <content type="html"><![CDATA[<h1><span id="motivational-image">Motivational Image</span></h1><p>The scene that we want to render is a dimly lit, smoky bar, inspiredby the following two images. Rows of exquisite liquor bottles line theshelves, their labels veiled in the subtle play of light and shadow. Anashtray rests nearby, adorned with an unlit cigarette. A dim spotlightbathes the ashtray and the wine bottles. The scene is to capture theessence of the bar's mystique, inviting participants to let theirimagination run wild as they bring out the richness of the hiddenstories within the rendering. The following two images are ourmotivation images.</p><p><img src="https://s2.loli.net/2024/01/02/FHRUOCLqBpaJQgw.jpg"> <img src="https://s2.loli.net/2024/01/02/fexQVhryYm2gdnl.jpg"></p><h1><span id="final-images">Final Images</span></h1><p>Based on the motivation images, we rendered our final images.</p><p><img src="https://s2.loli.net/2024/01/02/SVn3gKIpMBth4ND.png"></p><span id="more"></span><h1><span id="features-implemented">Features implemented</span></h1><h2><span id="images-as-texture">Images as Texture</span></h2><p><strong>Relevant Code</strong></p><ul><li><code>imagetexture.cpp</code></li></ul><h3><span id="implementation-details">Implementation Details</span></h3><p>To load the texture from external files, I used<code>stb_image</code> to read the image data. I defined a<code>ImageData</code> class similar to <code>Bitmap</code> class, whichis drived from <code>Eigen::Array</code> to store the image data. Theread image data is probably in sRGB color space. Therefore, we providean option boolean field <code>raw</code> in the <code>img_texture</code>property to indicate whether use raw image color space or convert it tolinear color space with <code>toLinearRGB()</code> function. We alsoprovide two difference filter modes, <code>nearest</code> and<code>bilinear</code>.</p><h3><span id="validation">Validation</span></h3><p>To validate the results, we used a texture from the website <a href="https://www.artstation.com/blogs/zeeshannasir/peYz/reference-uv-map-grids">Reference:UV Map Grids</a> and the scenes in assignment for rendering. The resultslook right. We also compared our results with mitsuba. Since thecoordinate used in mitsuba is right-handed while nori's is left-handed,the up axis coordinate is inversed so that the scene representation isthe same. The results are quite similar, while the results of mitsubaseem to be more vivid than ours. I think this may due to the usage ofmipmap in mitsuba. The overall results are correct.</p><div class="twentytwenty-container" style="max-width:720px"><img src="plane-texture-nori.png" data-width="720"><img src="plane-texture-v06.png" data-width="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="floor-texture-nori-nearest.png" data-width="720"><img src="floor-texture-v06-nearest.png" data-width="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="mesh-texture-nori-bilinear.png" data-width="720"><img src="mesh-texture-v06-bilinear.png" data-width="720"></div><h2><span id="normal-mapping">Normal Mapping</span></h2><p><strong>Relevant Code</strong></p><ul><li><code>mesh.h</code></li><li><code>mesh.cpp</code></li><li><code>shape.h</code></li><li><code>shape.cpp</code></li></ul><h3><span id="implementation-details">Implementation Details</span></h3><p>Normal mapping requires us to update the mesh normal with the normalsprovided in the normal textures. Since the frame normal is calculated inthe <code>setHitInformation()</code> function in <code>Shape</code>, Idecided to read the normal map and update the normals here. I added afield of type <code>Texture&lt;Color3f&gt; m_normalMap</code>. Thenormal map can be loaded with the Image as Texture implemented before.After reading the texture evaled value, it has to be converted to range[-1, 1]. Currently, only <code>Mesh</code> supports computing shaingframe with normal mapping. In the <code>setHitInformation()</code>function in <code>Mesh</code>, the local normal read from the normalmapping needs to be converted to the world normal using the local framefirst. However, if the default frame setup is used, the result isdiscontinuous and is absolutely wrong. Therefore, I need to constructthe right local frame first. I followed the formula in <a href="https://learnopengl.com/Advanced-Lighting/Normal-Mapping">learnopengl</a>.</p><p><span class="math display">\[\begin{bmatrix}T_{x}&amp;T_{y}&amp;T_{z}\\B_{x}&amp;B_{y}&amp;B_{z}\end{bmatrix}=\frac{1}{\Delta U_{1}\DeltaV_{2}-\Delta U_{2}\Delta V_{1}}\begin{bmatrix}\Delta V_{2}&amp;-\DeltaV_{1} \\ -\Delta U_{2} &amp; \Delta U_{1}\end{bmatrix}\begin{bmatrix}E_{1x}&amp;E_{1y}&amp;E_{1z}\\E_{2x}&amp;E_{2y}&amp;E_{2z}\end{bmatrix}\]</span></p><p>where <span class="math inline">\(E_{1}\)</span> and <span class="math inline">\(E_{2}\)</span> are two edges of the triangle, and<span class="math inline">\(\Delta U, \Delta V\)</span> are thecorresponding uv offsets of the edges. <span class="math inline">\(T\)</span> and <span class="math inline">\(B\)</span> is <code>dpdv</code> and<code>dpdu</code>. Then, we can construct the local frame correctly with<code>dpdv</code> and <code>dpdu</code>.</p><h3><span id="validation">Validation</span></h3><p>To validate the results, the results of nori are compared to theresults of mitsuba.</p><div class="twentytwenty-container" style="max-width:720px"><img src="plane-normalmap-c-nori.png" data-width="720" data-height="720"><img src="plane-normalmap-c-v06.png" data-width="720" data-height="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="plane-normalmap-t-nori.png" data-width="720" data-height="720"><img src="plane-normalmap-t-v06.png" data-width="720" data-height="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="floor-normalmap-c-nori.png" data-width="720" data-height="720"><img src="floor-normalmap-c-v06.png" data-width="720" data-height="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="floor-normalmap-t-nori.png" data-width="720" data-height="720"><img src="floor-normalmap-t-v06.png" data-width="720" data-height="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="sphere-mesh-normalmap-c-nori.png" data-width="720" data-height="720"><img src="sphere-mesh-normalmap-c-v06.png" data-width="720" data-height="720"></div><div class="twentytwenty-container" style="max-width:720px"><img src="sphere-mesh-normalmap-t-nori.png" data-width="720" data-height="720"><img src="sphere-mesh-normalmap-t-v06.png" data-width="720" data-height="720"></div><h2><span id="emitter-spotlight-5pt">Emitter (Spotlight) (5pt)</span></h2><p><strong>Relevant Code</strong></p><ul><li><code>spotlight.cpp</code></li><li><code>path_mis.cpp</code></li><li><code>direct_mis.cpp</code></li></ul><h3><span id="implementation-details">Implementation Details</span></h3><p>The implementation of the spotlight follows the mistuba designs. Ithas three properties, <code>intensity</code>, <code>maxAngle</code> and<code>beamAngle</code>. <code>intensity</code> is the max irridiance ofemitter at the center. All the ray emitted within the beamAngle has anirridiance of <code>intensity</code>. The emitted intensity of the raybegins to attenuate linearly between beamAngle and maxAngle. All the rayoutside <code>maxAngle</code> is evaluated to be zero, meaning no lightcan be emitted in that direction. The <code>FallOff</code> functioncalculates that attenuation giving the sampled outgoing light direction.I also implemented the <code>samplePhoton</code> function in order toapply spotlight in photon mapper. The sampled power is simply<code>I * falloff / pdf</code>, following implementation in mitsuba. Pdfof the sampled photon uses<code>Warp::squareToUniformSphereCapPdf(cosMaxAngle)</code> since thesampled ray can only exist in the cone area contrained by<code>maxAnlge</code>.</p><p>One problem is that since the spotlight is a delta emitter, theoriginal implementation of multiple importance sampling does not work onspotlight. So I added a flag <code>isDeltaEmitter</code> in<code>EmitterRecord</code>. Everytime a delta emitter is sampled, theweight of the emitter sampling should be 1 while weight of bsdf is 0. Imodified <code>direct_mis</code> and <code>path_mis</code> based on thisrule to fix the problem.</p><h3><span id="validation">Validation</span></h3><p>To validate the correctness of the spotlight and the modification onthe integrator, I compared several rendered scenes in differentintegrator with mitsuba. The first scene is a simple floor withspotlight shooting from the above, rendered in direct integrator.</p><div class="twentytwenty-container" style="max-width:720px"><img src="floor-spotlight-nori.png" data-width="720"><img src="floor-spotlight-v06.png" data-width="720"></div><p>To validate the correctness in direct, path and photonmapperintegrator, I put a spotlight in the cbox scene. The noise level may beslightly different from mitsuba, but the overall brightness is correct.This can successfully validate the correctness of spotlight</p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_spotlight_direct_nori.png" data-width="600" data-height="600"><img src="cbox_spotlight_direct_v06.png" data-width="600" data-height="600"></div><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_spotlight_path_nori.png" data-width="600" data-height="600"><img src="cbox_spotlight_path_v06.png" data-width="600" data-height="600"></div><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_spotlight_pm_nori.png" data-width="600" data-height="600"><img src="cbox_spotlight_pm_v06.png" data-width="600" data-height="600"></div><h2><span id="stratified-sampling">Stratified Sampling</span></h2><p><strong>Relevant Code</strong></p><ul><li><code>stratified.cpp</code></li><li><code>render.cpp</code></li></ul><h3><span id="implementation-details">Implementation Details</span></h3><p><code>Stratified</code> class is derived from <code>Sampler</code>and implemented the stratified sampling. <code>prepare()</code> functionis used to initialize the sampler before start sampling. It is calledbefore the first sample starts. <code>generate()</code> function is usedto prepare for the sampling of the next image pixel.<code>advanced()</code> function is called every time before the nextsampling starts. <code>next1D</code> and <code>next2D</code> is used toretrieve the next 1d or 2d samples.</p><p>To enable sampling multiple dimensions, a <code>dimensionIndex</code>is maintained in the class. Similarly, <code>sampleIndex</code> and<code>pixelIndex</code> records the number of samples that are alreadysampled and the number of pixels sampled. When a sample is needed, firsta seed will be calculated based on a permutation base seed, dimensionindex and pixel index. The permutation sequences are thus the same forall the samples with the same <code>dimensionIndex</code> and<code>pixelIndex</code>, while different <code>dimensionIndex</code> and<code>pixelIndex</code> will have different sequences. Then, theposition of the current sampled region is retrieved with<code>sampleIndex</code>. Then a random offset is added according towhether the sampled is jittered or not.</p><p>In the <code>prepare()</code> function, I initialize the<code>sampleIndex</code> and the random number generators. A basepermutation seed is generated randomly. It can then be used to generatea permuation sequence of size <code>sampleCount</code>.<code>generate()</code> resets the dimension index and increment thepixelIndex. <code>advance</code> resets the pixel index and incrementthe sample index.</p><h3><span id="validation">Validation</span></h3><p>In th warptest, I visualize the results of the stratified sampler andgrid sampler to show the difference between them. The result is shownbelow.</p><div class="twentytwenty-container" style="max-width:700px"><img src="stratified-sampler.png" data-width="700"><img src="grid-sampler.png" data-width="700"></div><p>I also rendered a simple scene which consists of a plane and a sphereto see the actual effects of the stratified sampler. The result is shownbelow. The stratified sampler can reduce the noise level in .</p><div class="twentytwenty-container" style="max-width:720px"><img src="sphere-independent-nori.png" data-width="720"><img src="sphere-stratified-nori.png" data-width="720"></div><h2><span id="disneybsdf-metallic-specular-roughness-specular-tint-clearcoat">DisneyBSDF (metallic, specular, roughness, specular tint, clearcoat)</span></h2><p><strong>Relevant Code</strong></p><ul><li><code>disney.cpp</code></li><li><code>warp.h</code></li><li><code>warp.cpp</code></li><li><code>warptest.cpp</code></li></ul><h3><span id="implementation-details">Implementation Details:</span></h3><p>The disney BSDF is implemented based on the paper <a href="https://media.disneyanimation.com/uploads/production/publication_asset/48/asset/s2012_pbs_disney_brdf_notes_v3.pdf">Physically-BasedShading at Disney</a>. The code basically refers to the implementationof <a href="https://github.com/wdas/brdf/blob/main/src/brdfs/disney.brdf">DisneyBRDF explorer</a>.</p><p>There are ten parameters in Disney BRDF. Five of them, metallic,specular, roughness, specular tint and clearcoat graded. Disney BRDF isconsisted of three parts, which are diffuse, specular and clearcoat.Diffuse is influenced by metallic and roughness. Specular is influencedby specular, metallic, roughness and specular tint. Clearcoat isinfluenced by clearcoat. (Only graded ones are listed here) The specularand clearcoat are two microfacet models. The normal distribution ofspecular is GGX (GTR2), and the normal distribution of clearcoat isGTR1. The <code>squareToGTR2()</code>, <code>squareToGTR1()</code> andtheir pdf uses the formula derived in the appendix of the paper. The pdfare essentially the cosine weighted pdf of the normal distribution. The<code>eval()</code> function follows exactly the same as BRDF explorer.The choice of the sampling lobe refers to the implementation inmitsuba.</p><h3><span id="validation">Validation</span></h3><p>The GTR1 and GTR2 are tested in the warptest. The results are shownbelow.</p><p><img src="warptest-GTR1-v.png"> <img src="warptest-GTR1.png"><img src="warptest-GTR2-v.png"> <img src="warptest-GTR2.png"></p><p>To validate the correctness of disney BSDF, I used the scene<code>cbox</code> for test. For each test, only the parameter beingtested is changed, with all other graded parameters fixed and all otherungraded parameters being 0. The results are shown below.</p><p><strong>Metallic=0 vs Metallic=1</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_disney_nori-m0.png" data-width="600"><img src="cbox_disney_nori-m1.png" data-width="600"></div><p><strong>Roughness=0 vs Roughness=1</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_disney_nori-r0.png" data-width="600"><img src="cbox_disney_nori-r1.png" data-width="600"></div><p><strong>Specular=0.1 vs Specular=1</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_disney_nori-s01.png" data-width="600"><img src="cbox_disney_nori-s1.png" data-width="600"></div><p><strong>Specular tint=0 vs Specular tint=1</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_disney_nori-st0.png" data-width="600"><img src="cbox_disney_nori-st1.png" data-width="600"></div><p><strong>Clearcoat=0 vs Clearcoat=1</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_disney_nori-c0.png" data-width="600"><img src="cbox_disney_nori-c1.png" data-width="600"></div><h2><span id="progressive-photon-mapping">Progressive Photon Mapping</span></h2><p><strong>Relevant Code</strong></p><ul><li><code>progressivepm.cpp</code></li></ul><h3><span id="implementation-details">Implementation Details</span></h3><p>The implementation of progressive photon mapping is basically basedon the paper <a href="http://graphics.ucsd.edu/~henrik/papers/progressive_photon_mapping/progressive_photon_mapping.pdf">ProgressivePhoton Mapping</a>. The algorithm is consisted of two passes. In thefirst pass, we need to generate the visible hit points from the cameraand store them. In the second pass, we need to generate the photon maprepeated. After each photon map generation, we need to update the hitpoints with radius reduction and flux correction. A new rendered imagecan be generated right after eahc photon map generation process.</p><p>To make use of the current multiple thread rendering framework, theexecution process of the progressive photon mapper is a little differentfrom other integrators. In the <code>process()</code> function, weiterate all the image pixels and shoot <code>sampleCount</code> rays andperform path tracing for each ray and get the hit point on the diffusesurfaces. I define a function <code>persamplePreprocess()</code>. Thisfunction is called everytime a new sample starts. In this way, the<code>sampleCount</code> defined in the <code>sampler</code> is actuallythe number of photon map generation passes, while the actual number ofsamples for each pixel is the <code>sampleCount</code> defined in theprogressive photon mapper. Then in the<code>persamplePreprocess()</code> function, a new photon map isgenerated. Then, a new image is rendered in <code>Li()</code> function.Since now the pixel is needed to find the corresponding hit pointsstored, a new parameter <code>pixel</code> is added to the<code>Li()</code> function. First, the hit points information is updatedwith the new photon map. Then, the image is rendered with the updatedhit points. Doing these two steps at the same time in <code>Li()</code>function can make the best of the rendering framework to accelerate therendering process and is easy to implement even though it is a littleunintuitive.</p><h3><span id="validation">Validation</span></h3><p>To validate the progressive photon mapper, I rendered cbox withprogressive photon mapper of 1 photon map generation pass and 1000photon map generation passes. I also used the same setting on mitsubafor comparison. Even though the results are not exactly the same, itproves that the progressive photon mapper is converging to the correctresults.</p><p><strong>My results</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_pmap_nori_mp1.png" data-width="600"><img src="cbox_pmap_nori_mp100.png" data-width="600"></div><p><strong>Mistuba results</strong></p><div class="twentytwenty-container" style="max-width:600px"><img src="cbox_pmap_v06_mp1.png" data-width="600"><img src="cbox_pmap_v06_mp100.png" data-width="600"></div>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Graphics </tag>
            
            <tag> Project </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GANè®ºæ–‡ç²¾è¯»</title>
      <link href="/2023/07/09/computervision/gan-lun-wen-jing-du/"/>
      <url>/2023/07/09/computervision/gan-lun-wen-jing-du/</url>
      
        <content type="html"><![CDATA[<h2><span id="introduction">Introduction</span></h2><p>GANçš„å…¨ç§°æ˜¯Generative AdversarialNetsï¼Œæ˜¯ä¸€ç§ç”Ÿæˆæ¨¡å‹ï¼Œç›®çš„æ˜¯ä¸ºäº†è®­ç»ƒå‡ºä¸€ä¸ªç”Ÿæˆå™¨ï¼Œä½¿å¾—ç”Ÿæˆå™¨èƒ½å¤Ÿç”Ÿæˆæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œæ¯”å¦‚è¯´ä¸€å¼ å›¾ç‰‡ã€‚GANåœ¨åˆšæ¨å‡ºçš„æ—¶å€™æˆåŠŸç”Ÿæˆäº†ç®€å•çš„æ‰‹å†™æ•°å­—å’Œäººè„¸ç…§ç‰‡ï¼Œè™½ç„¶ç°åœ¨çœ‹æ¥ç”Ÿæˆçš„å›¾ç‰‡è´¨é‡ä¹Ÿæ¯”è¾ƒä¸€èˆ¬ï¼Œä½†æ˜¯ä¹Ÿå¼€åˆ›äº†ä¸€ä¸ªç”Ÿæˆæ¨¡å‹çš„æ–°æ—¶ä»£ã€‚</p><p>åœ¨ä»¥å‰çš„ç”Ÿæˆç½‘ç»œä¸­ï¼Œéœ€è¦æœ‰å¤§é‡çš„æ¦‚ç‡è®¡ç®—, æå¤§ä¼¼ç„¶ä¼°è®¡,æ¯”è¾ƒéº»çƒ¦iã€‚GANå°±æˆåŠŸçš„é¿å…äº†æ¦‚ç‡è®¡ç®—çš„é—®é¢˜ï¼Œä¸éœ€è¦é©¬å°”ç§‘å¤«é“¾ã€æå¤§ä¼¼ç„¶ä¼°è®¡ç­‰ç­‰ã€‚GANçš„æ€æƒ³éå¸¸ç®€å•ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨å’Œä¸€ä¸ªåˆ¤åˆ«å™¨è¿›è¡Œå¯¹æŠ—ï¼Œæœ€ç»ˆè¾¾åˆ°ä¸€ä¸ªçº³ä»€å‡è¡¡çš„çŠ¶æ€ã€‚</p><span id="more"></span><h2><span id="ganå’Œå¯¹æŠ—æ ·æœ¬adversarialexamplesçš„åŒºåˆ«">GANå’Œå¯¹æŠ—æ ·æœ¬(Adversarialexamples)çš„åŒºåˆ«</span></h2><p>å¯¹æŠ—æ ·æœ¬æ˜¯æŒ‡é€šè¿‡æ·»åŠ å™ªå£°çš„æ–¹å¼è¿·æƒ‘æ·±åº¦ç¥ç»ç½‘ç»œï¼Œè®©VGGç­‰åˆ¤åˆ«æ¨¡å‹é”™è¯¯çš„å¯¹å›¾åƒè¿›è¡Œåˆ¤æ–­ã€‚ä¸‹å›¾ä¸­åœ¨ç†ŠçŒ«çš„å›¾ç‰‡ä¸Šå¢åŠ äº†ä¸€ä¸ªå™ªå£°ï¼Œå°½ç®¡ç”Ÿæˆçš„å›¾ç‰‡åœ¨äººçœ¼çœ‹æ¥è¿˜æ˜¯ä¸€ä¸ªç†ŠçŒ«å¾ˆéš¾çœ‹å‡ºåŒºåˆ«ï¼Œä½†æ˜¯ä½¿ç”¨æ·±åº¦ç¥ç»ç½‘ç»œè¿›è¡Œåˆ¤æ–­çš„è¯å°±ä¼šé”™è¯¯çš„å°†ç†ŠçŒ«åˆ¤æ–­ä¸ºé•¿è‡‚çŒ¿ã€‚å¯¹æŠ—æ ·æœ¬é€šè¿‡è®­ç»ƒï¼ˆåå‘ä¼ æ’­æ¢¯åº¦ä¸‹é™ï¼‰å¯ä»¥æ‰¾åˆ°èƒ½å¤Ÿè¯¯å¯¼ç½‘ç»œçš„å™ªå£°å›¾ã€‚GANå’Œå¯¹æŠ—æ ·æœ¬çš„åŒºåˆ«åœ¨äºï¼Œå¯¹æŠ—æ ·æœ¬ä¸æ˜¯ç”¨æ¥è®­ç»ƒç”Ÿæˆæ¨¡å‹çš„ï¼Œè€Œæ˜¯ç”¨æ¥ç›´æ¥ä¿®æ”¹è¾“å…¥æ¥è¾¾åˆ°è¯¯å¯¼ç½‘ç»œçš„ç›®çš„ï¼ŒäºŒè€…çš„ç›®çš„æ˜¯ä¸ä¸€æ ·çš„ã€‚<img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20221204204717.png"></p><h2><span id="adversarial-nets">Adversarial Nets</span></h2><p>GANé¦–æ¬¡æå‡ºäº†å¯¹æŠ—æŸå¤±å‡½æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤º <span class="math display">\[\min_G \max_D V(D, G)=\mathbb{E_{x\sim p_{data}(x)}}[\logD(x)]+\mathbb{E_{z\sim p_{z}(z)}}[\log(1-D(G(z)))]\]</span>å…¶ä¸­Gä»£è¡¨ä½¿ç”¨å¤šå±‚æ„ŸçŸ¥å™¨çš„ç”Ÿæˆå™¨ï¼ŒDä»£è¡¨ä½¿ç”¨å¦ä¸€ä¸ªå¤šå±‚æ„ŸçŸ¥å™¨çš„åˆ¤åˆ«å™¨ï¼Œzä»£è¡¨è¾“å…¥çš„å™ªå£°ï¼Œ<span class="math inline">\(p_z(z)\)</span>è¡¨ç¤ºzçš„åˆ†å¸ƒå‡½æ•°ï¼Œxæ˜¯çœŸå®çš„æ•°æ®ï¼Œ<span class="math inline">\(D(x)\)</span>ä»£è¡¨åˆ¤åˆ«å™¨åˆ¤æ–­xæ¥è‡ªçœŸå®æ•°æ®çš„æ¦‚ç‡ã€‚é€šè¿‡è®­ç»ƒDæ¥æœ€å¤§åŒ–åˆ¤åˆ«æˆåŠŸçš„å¯èƒ½æ€§ï¼ˆmaxåˆ¤åˆ«å™¨ï¼‰ï¼Œç¬¬ä¸€é¡¹è¡¨ç¤ºåˆ¤åˆ«å™¨è¾“å…¥çœŸå®æ•°æ®æ—¶ï¼Œåˆ¤åˆ«å™¨çš„è¾“å‡ºè¶Šå¤§è¶Šå¥½ï¼Œåä¸€é¡¹ä»£è¡¨åˆ¤åˆ«å™¨è¾“å…¥å‡æ•°æ®æ—¶åˆ¤åˆ«å™¨è¾“å‡ºè¶Šå°è¶Šå¥½ã€‚åŒæ—¶é€šè¿‡è®­ç»ƒGæ¥æœ€å°åŒ–ç¬¬äºŒé¡¹ï¼Œä½¿å¾—ç”Ÿæˆå™¨ç”Ÿæˆçš„å›¾ç‰‡æ›´åŠ ä¸å®¹æ˜“è¢«åˆ¤åˆ«å™¨è¾¨åˆ«ã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒæ˜¯ä¸€ä¸ªåŒäººæå¤§æå°åšå¼ˆæ¸¸æˆ(two-player minimax game)ï¼ŒGå’ŒDåœ¨äº’ç›¸å¯¹æŠ—çš„åŒæ—¶å…±åŒè¿›æ­¥ã€‚ <img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20221204212017.png">åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒGANé‡‡ç”¨äº†åŒæ—¶è®­ç»ƒç”Ÿæˆå™¨å’Œåˆ¤åˆ«å™¨çš„æ–¹å¼ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚å…¶ä¸­è“è‰²è™šçº¿ä»£è¡¨åˆ¤åˆ«å™¨çš„åˆ†å¸ƒï¼Œé»‘è‰²è™šçº¿ä»£è¡¨çœŸå®æ•°æ®åˆ†å¸ƒï¼Œç»¿è‰²è™šçº¿ä»£è¡¨ç”Ÿæˆå™¨ç”Ÿæˆçš„æ•°æ®åˆ†å¸ƒï¼Œzä»£è¡¨è¾“å…¥çš„å™ªå£°ã€‚åœ¨å›¾(a)ä¸­ï¼Œå™ªå£°zæ˜ å°„åˆ°ç»¿è‰²çº¿ä¸Šï¼Œåˆ¤åˆ«å™¨ç›®å‰åˆ†è¾¨å‡ºå‡æ•°æ®å’ŒçœŸæ•°æ®çš„èƒ½åŠ›å¹¶ä¸å¥½ã€‚é€šè¿‡ä¸€æ¬¡åˆ¤åˆ«å™¨çš„è®­ç»ƒï¼Œæ¥åˆ°(b)çŠ¶æ€ï¼Œæ­¤æ—¶çš„åˆ¤åˆ«å™¨å¯ä»¥æ¯”è¾ƒå¥½çš„åˆ†è¾¨å‡ºçœŸå®æ•°æ®å’Œå‡æ•°æ®ï¼Œæ¥ç€è®­ç»ƒç”Ÿæˆå™¨ï¼Œç”Ÿæˆå™¨çš„åˆ†å¸ƒä¼šå‘ç€è¾¨åˆ«å™¨åˆ¤å®šçœŸæ•°æ®çš„åˆ†å¸ƒä¸Šé æ‹¢ï¼Œè¿™æ ·å­ä¸æ–­è¿­ä»£ä¹‹åï¼Œæœ€ç»ˆæˆ‘ä»¬å¯ä»¥è¾¾åˆ°(d)çŠ¶æ€ï¼Œè¾¾åˆ°ä¸€ä¸ªå¹³è¡¡çŠ¶æ€ï¼Œåˆ¤åˆ«å™¨åˆ¤å®šçœŸå‡æ•°æ®çš„æ¦‚ç‡éƒ½ä¸º1/2ï¼Œæ— æ³•å†åŒºåˆ†å‡ºçœŸå‡æ•°æ®ã€‚ä¸‹å›¾æ˜¯GANç®—æ³•çš„ä¼ªä»£ç ã€‚<img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20221204212814.png"></p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><ul><li><a href="https://www.bilibili.com/video/BV1oi4y1m7np/?spm_id_from=333.788.recommend_more_video.0&amp;vd_source=4363d4cc2554c5f82c74408e68eb7dc0">GANè®ºæ–‡ç²¾è¯»-åŒæµå­è±ªå…„</a></li><li><a href="https://proceedings.neurips.cc/paper/2014/hash/5ca3e9b122f61f8f06494c97b1afccf3-Abstract.htmla">GANè®ºæ–‡åŸæ–‡åœ°å€</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ComputerVision </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CycleGANè®ºæ–‡ç²¾è¯»</title>
      <link href="/2023/07/09/computervision/cyclegan-lun-wen-jing-du/"/>
      <url>/2023/07/09/computervision/cyclegan-lun-wen-jing-du/</url>
      
        <content type="html"><![CDATA[<h2><span id="ç›®çš„">ç›®çš„</span></h2><p>CycleGANä¸»è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸€ä¸ªImage to ImageTranslationçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯ä»ä¸€ä¸ªå›¾åƒåŸŸè½¬åŒ–åˆ°å¦ä¸€ä¸ªå›¾åƒåŸŸçš„é—®é¢˜ï¼Œæ¯”å¦‚è¯´ç»™ä¸€å¼ äººè„¸å›¾ç‰‡ï¼Œç”Ÿæˆå¯¹åº”çš„åŠ¨æ¼«å¤´åƒï¼Œè¿˜æœ‰æ¯”å¦‚è¯´æˆ‘ä»¬ç»™ä¸€ä¸ªcartoonçš„å›¾åƒï¼Œéœ€è¦ç”Ÿæˆå¯¹åº”çš„åƒç´ åŒ–åçš„å›¾åƒ(pixel image)ã€‚ å…¶æ¬¡ï¼Œä¼ ç»Ÿçš„Image to ImageTranslationçš„ç®—æ³•é€šå¸¸éœ€è¦æˆ‘ä»¬æœ‰é…å¯¹çš„å›¾åƒç»„ï¼Œä½†æ˜¯å¾ˆæ˜¾ç„¶è¿™æ˜¯å¾ˆè€—è´¹æ—¶é—´çš„ï¼Œä¹Ÿå¾ˆéš¾è·å¾—é…å¯¹å›¾åƒã€‚æ‰€ä»¥CycleGANæå‡ºäº†ä¸€ç§ä½¿ç”¨unpairedtrainingsetçš„æ–¹æ³•ï¼Œåªéœ€è¦ç»™å®šå¯¹åº”ä¸¤ä¸ªå›¾åƒåŸŸè€Œä¸éœ€è¦é…å¯¹çš„å›¾åƒï¼Œæˆ‘ä»¬å°±å¯ä»¥å®ç°Imageto Imageçš„è½¬åŒ–ã€‚</p><span id="more"></span><h2><span id="ç®—æ³•">ç®—æ³•</span></h2><p>CycleGANåœ¨GANçš„åŸºç¡€ä¸Šæå‡ºäº†å¾ªç¯ä¸€è‡´æ€§æŸå¤± (cycle consistencyloss)[[GANè®ºæ–‡ç²¾è¯»]]ï¼Œä¸åŒäºGANä»å™ªå£°ç”Ÿæˆç›¸åº”çš„å›¾ç‰‡ï¼ŒCycleGANçš„åšæ³•æ˜¯å‡†å¤‡éé…å¯¹çš„ä¸¤ä¸ªå›¾åƒåŸŸçš„æ•°æ®é›†ï¼Œè®­ç»ƒä¸¤ä¸ªGANç½‘ç»œï¼Œä¸€ä¸ªç”¨æ¥å°†å›¾åƒä»AåŸŸè½¬åŒ–åˆ°BåŸŸï¼Œå¦ä¸€ä¸ªç”¨æ¥å°†å›¾åƒä»BåŸŸè½¬åŒ–åˆ°AåŸŸã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæœ‰æ­£åä¸¤ä¸ªè¿‡ç¨‹(ForwardBackward)ï¼Œæ­£å‘è¿‡ç¨‹é¦–å…ˆå°†å›¾ç‰‡ä»AåŸŸè½¬åŒ–ä¸ºBåŸŸï¼Œç„¶ååœ¨ç”¨å¦ä¸€ä¸ªç½‘ç»œå°†ç”Ÿæˆçš„å‡BåŸŸçš„å›¾ç‰‡å†è½¬åŒ–æˆAåŸŸçš„å›¾ç‰‡ï¼Œç„¶åç”¨ç”Ÿæˆå›å»çš„å›¾åƒå’ŒåŸæ¥çš„è¾“å…¥å›¾åƒä½œå·®ï¼Œä¹Ÿå°±æ˜¯cycleconsistencylossï¼Œæˆ‘ä»¬å¸Œæœ›è¿™ä¸ªlosså°½å¯èƒ½å°ï¼Œä¹Ÿå°±æ˜¯ç»è¿‡ä¸¤æ¬¡è½¬åŒ–ä¹‹åçš„å›¾åƒèƒ½å¤Ÿå’ŒåŸæ¥çš„å›¾åƒå°½å¯èƒ½ç›¸åƒã€‚åŒæ ·çš„ï¼Œåœ¨åå‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»Båˆ°Aï¼Œå†Aåˆ°Bï¼Œå†åšä¸€æ¬¡cycleconsistency lossã€‚æ•°å­¦è¡¨ç¤ºå°±æ˜¯ <span class="math display">\[\begin{align}\text{forward: }&amp;x\rightarrow G(x)\rightarrow F(Gx)\approx x \\\text{backward: }&amp;y\rightarrow F(y)\rightarrow G(F(y))\approx y\end{align}\]</span></p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå¦‚æœè¯´æˆ‘ä»¬ä¸é‡‡ç”¨æ­£åä¸¤ä¸ªè¿‡ç¨‹å’Œcycle consistencylossï¼Œæˆ‘ä»¬å°±ç”¨ä¸€ä¸ªGANç½‘ç»œä»Aç”Ÿæˆåˆ°Bï¼Œé‚£ä¹ˆå¯èƒ½ä¼šé€ æˆç”Ÿæˆçš„å›¾ç‰‡è™½ç„¶çœ‹ç€ç¡®å®æ˜¯BåŸŸçš„å›¾ç‰‡ï¼Œä½†æ˜¯å®ƒå®é™…ä¸Šå’Œè¾“å…¥çš„å›¾ç‰‡å·²ç»æ²¡æœ‰å…³ç³»äº†ï¼Œç”šè‡³å¯èƒ½ä»»ä½•AåŸŸä¸­çš„å›¾ç‰‡è¾“å…¥åˆ°ç½‘ç»œä¸­å¾—åˆ°çš„BåŸŸå›¾ç‰‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±é€ æˆäº†æ¨¡å¼å´©æºƒé—®é¢˜(Mode collapse)ã€‚è€Œä½¿ç”¨cycle consistencylosså¯ä»¥ä¿è¯ç”Ÿæˆçš„å›¾ç‰‡çš„å†…å®¹å’ŒåŸæ¥çš„å›¾ç‰‡æ˜¯ç›¸ç¬¦çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20221204215142.png"></p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><ul><li><a href="https://openaccess.thecvf.com/content_iccv_2017/html/Zhu_Unpaired_Image-To-Image_Translation_ICCV_2017_paper.html">CycleGANè®ºæ–‡åŸæ–‡</a></li><li><a href="https://junyanz.github.io/CycleGAN/">CycleGAN Project Page(junyanz.github.io)</a></li><li><a href="https://www.bilibili.com/video/BV1Ya411a78P/?spm_id_from=333.788&amp;vd_source=4363d4cc2554c5f82c74408e68eb7dc0">ç²¾è¯»CycleGANè®ºæ–‡-æ‹æ¡ˆå«ç»çš„éé…å¯¹å›¾åƒé£æ ¼è¿ç§»-åŒæµå­è±ªå…„</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> ComputerVision </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UE5æ’ä»¶CommonUIä½¿ç”¨åŠåŸç†å‰–æ(Input)</title>
      <link href="/2023/06/10/gamegraphics/ue5-cha-jian-commonui-shi-yong-ji-yuan-li-pou-xi-input/"/>
      <url>/2023/06/10/gamegraphics/ue5-cha-jian-commonui-shi-yong-ji-yuan-li-pou-xi-input/</url>
      
        <content type="html"><![CDATA[<p>CommonUIæ˜¯UE5æ–°æ¨å‡ºçš„ä¸€æ¬¾UIæ’ä»¶ï¼ŒåŸæœ¬æ˜¯å ¡å’ä¹‹å¤œé‡Œä½¿ç”¨çš„æ’ä»¶ï¼ŒEpicå°±å°†å…¶ä½œä¸ºæ’ä»¶å¼•å…¥åˆ°äº†UE5ä¸­ã€‚ä»–ä¸»è¦çš„åŠŸèƒ½åœ¨äºä¸¤ç‚¹ï¼šä¸€æ˜¯å¯¹äºå¤æ‚çš„UIä½¿ç”¨LayerStackçš„æ€æƒ³ï¼Œå¯¹äºä¸åŒå±‚çº§çš„UIè¿›è¡Œç›¸åº”çš„ç®¡ç†ï¼Œå¹¶ä½¿ç”¨æ ˆçš„æ–¹å¼è§£å†³UIå±‚çº§çš„å“åº”é—®é¢˜ï¼›äºŒæ˜¯ä½¿ç”¨InputRoutingå®ç°å¯¹ä¸åŒè¾“å…¥çš„ç»Ÿä¸€é€‚é…ï¼Œå¯¹äºå¼€å‘å¤šå¹³å°æ¸¸æˆæ¥è¯´æ¯”è¾ƒæ–¹ä¾¿ï¼Œé€šè¿‡é…ç½®é…ç½®è¡¨å³å¯å®ç°å¤šå¹³å°çš„UIå’Œè¾“å…¥é€‚é…ã€‚æœ¬ç¯‡ä¸»è¦ç€é‡åœ¨Inputéƒ¨åˆ†è¿›è¡Œä½¿ç”¨çš„è¯¦è§£å’Œæºç çš„ç®€è¦å‰–æã€‚</p><span id="more"></span><h3><span id="commonui-inputçš„ä½¿ç”¨">CommonUI Inputçš„ä½¿ç”¨</span></h3><p>CommonUIçš„ä½¿ç”¨å‚è€ƒ<a href="https://docs.unrealengine.com/5.0/zh-CN/common-ui-quickstart-guide-for-unreal-engine/">è™šå¹»å¼•æ“CommonUIå¿«é€ŸæŒ‡å— | è™šå¹»å¼•æ“5.0æ–‡æ¡£</a>ï¼Œä¸»è¦åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š 1.è®¾ç½®Viewportä¸ºCommonUIClientViewportã€‚åœ¨Project Settings -&gt; GeneralSettings -&gt; GameViewportClientClass ä¿®æ”¹ä¸ºCommonGameViewportClient 2.åˆ›å»º<strong>InputActionDataTable</strong>è¿›è¡Œæ§åˆ¶å™¨æ“ä½œæ˜ å°„çš„é…ç½®ã€‚ <img src="https://s2.loli.net/2023/08/14/ZWoLkTa5DqVKAfm.png"></p><ol start="3" type="1"><li><p>è®¾ç½® <strong>Default NavigationActions</strong>ï¼Œæ”¯æŒå…¨å±€çš„ç‚¹å‡»å’Œè¿”å›æŒ‰é’®åŠŸèƒ½ã€‚åˆ›å»ºä¸€ä¸ªCommonUIInputDataçš„è“å›¾ç±»ï¼Œè®¾ç½®ClickActionå’ŒBackActionçš„InputActionæ˜ å°„ï¼Œå…¶ä¸­BackActionHandlerå¯ä»¥åœ¨CommonUIçš„Widgetä¸­Overrideï¼ˆè®¾ç½®ä¸€ä¸ªå¸ƒå°”å€¼IsBackHandlerï¼‰<img src="https://s2.loli.net/2023/08/14/XucEgY4PHMtx2ZV.png"></p></li><li><p>åˆ›å»º <strong>Controller Data Assets</strong>å¹¶ä¸”å°†å…¶åˆ†é…åˆ°ç‰¹å®šå¹³å°ä¸Šçš„ç‰¹å®šæ§åˆ¶å™¨ç±»å‹ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªButtonæ·»åŠ ç‰¹å®šçš„Brushï¼Œé€šè¿‡è¿™ä¸ªè®¾ç½®å°±å¯ä»¥ç”¨CommonActionWidgetæ¥æ˜¾ç¤ºå¯¹åº”çš„Actionçš„Iconäº†ã€‚<img src="https://s2.loli.net/2023/08/14/rlxmqL5RTfbaCw6.png">é€šè¿‡ä»¥ä¸Šå››ä¸ªæ­¥éª¤å¯ä»¥å®ç°CommonUIInputçš„åŸºæœ¬è®¾ç½®ã€‚è¦è®©ä¸€äº›åŠŸèƒ½ç”Ÿæ•ˆï¼Œæœ€å¥½è¿˜æ˜¯è¦ä½¿ç”¨CommonUIæä¾›çš„Widgetï¼Œæ¯”å¦‚CommonActivatableWidgetã€CommonButtonBaseç­‰ç­‰ã€‚è¯¦ç»†å¯ä»¥å‚è€ƒ<a href="https://www.youtube.com/watch?v=TTB5y-03SnE&amp;t=4740s">InsideUnrealçš„æ•™ç¨‹</a>ï¼Œæˆ–è€…é˜…è¯»CommonUIçš„æºç è¿›è¡Œç†è§£ã€‚### CommonUI Inputæºç æµç¨‹æ¢³ç†é€šè¿‡é˜…è¯»æºç å‘ç°ï¼Œå…¶å®CommonUIæä¾›çš„ä¸æ˜¯ä¸€ä¸ªå®Œæ•´çš„è§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä¸ªäººè§‰å¾—æ›´å¤šçš„æ˜¯ä¸€ç§æ€è·¯ã€‚å¯¹äºInputActionDataTableçš„ä½¿ç”¨ï¼Œä¸»è¦æ˜¯åœ¨<code>UCommonUserWidget</code>ä¸­çš„<code>RegisterUIActionBinding()</code>å‡½æ•°ä¸­ã€‚åœ¨è¿™ä¸ªå‡½æ•°ä¸­è¿›è¡ŒInputActionçš„æ³¨å†Œç»‘å®šï¼Œé€šè¿‡æŸ¥æ‰¾å‘ç°ä¸»è¦æ˜¯ä¸‰ç§æ“ä½œ:<code>CommonActivatableWidget</code>çš„Backæ“ä½œï¼Œ<code>CommonButtonBase</code>çš„Triggeræ“ä½œï¼Œä»¥åŠ<code>CommonTabListWidgetBase</code>çš„Tabæ“ä½œã€‚åœ¨è¿™äº›Widgetä¸­å¯ä»¥è‡ªå®šä¹‰æ˜¯å¦Handleå¯¹åº”çš„æ“ä½œã€‚æ‰€ä»¥å•å•ä¸€ä¸ªCommonUIå¯¹äºInputçš„å¤„ç†è¿˜æ˜¯æ¯”è¾ƒå±€é™çš„ã€‚</p></li></ol><p><img src="https://s2.loli.net/2023/08/15/tAXBTyI17VY8PHm.png"></p><p>è°ƒç”¨çš„æµç¨‹æ˜¯ä»<code>UCommonGameViewportClient</code>å¼€å§‹ã€‚åœ¨è¿™ä¸ªç±»ä¸­<code>UCommonGameViewportClient::InputKey</code>è¿™ä¸ªå‡½æ•°é¦–å…ˆå¤„ç†KeyInputï¼Œç„¶ååœ¨<code>UCommonGameViewportClient::HandleRerouteInput</code>ä¸­åœ¨ActionRouteré‡Œå¤„ç†Input<img src="https://s2.loli.net/2023/08/15/G6OHbLnVPuvQTSj.png"></p><p>åœ¨ActionRouterä¸­ï¼Œä¼šå°†Inputä¼ é€’ç»™CommonUIWidgetä¸­å½“å‰çš„ActiveRootNodeè¿›è¡Œå¤„ç†ã€‚CommonUIä¼šå°†æ‰€æœ‰çš„ActivatableWidgetæŒ‰ç…§å±‚çº§è¿›è¡Œå»ºæ ‘ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¼šè¢«æŠ½è±¡æˆä¸º<code>FActivatableRootNode</code>ã€‚ç„¶åä»æ ¹èŠ‚ç‚¹å¼€å§‹éå†ï¼Œå¯¹äºæ¯ä¸ªChildæ‰§è¡Œ<code>ProcessNormalInput</code>ï¼Œç›´åˆ°Inputè¢«Consumeã€‚</p><blockquote><p>Activatable Widgets are abstracted as nodes in a tree using<code>FActivatableRootNode</code>. Nodes are arranged in a hierarchybased on the hierarchy of Activatable Widgets in the UI's widget tree.Parent nodes act as <strong>root nodes</strong>, while their childrenare considered <strong>child</strong> or <strong>leafnodes</strong>.</p></blockquote><p><img src="https://s2.loli.net/2023/08/15/SxfgBUuKONc9rDh.jpg"></p><p>ProcessInputNormaå‡½æ•°å¦‚ä¸‹ <img src="https://s2.loli.net/2023/08/15/M2ygsvznqeFulh9.png"></p><p>è¿™é‡Œå°±æ˜¯é€šè¿‡æŸ¥æ‰¾ç»‘å®šçš„ActionBindingsåˆ¶å®šç»‘å®šçš„ç›¸åº”çš„æ“ä½œã€‚åœ¨IDEä¸­æŸ¥æ‰¾åå‘ç°ï¼Œè¿½æ ¹æº¯æºï¼ŒActionBindingsçš„ç»‘å®šå°±æ˜¯åœ¨ä¸Šé¢æ‰€è¯´<code>UCommonUserWidget</code>ä¸­çš„<code>RegisterUIActionBinding()</code>å‡½æ•°ä¸­è¿›è¡Œçš„ã€‚Click(ç¡®è®¤) å’Œ Back(å–æ¶ˆ)ä¸¤ç§æ“ä½œä¸Šã€‚ä½†æ˜¯ä»–æä¾›äº†ä¸€ç§é€šç”¨Inputçš„å¤„ç†æ–¹æ³•ï¼Œåœ¨LyraStarterGameä¸­ï¼Œå°±é€šè¿‡è¿™ç§æ–¹æ³•åˆè‡ªå®šä¹‰äº†ä¸€äº›é€šç”¨çš„ActionBindingsã€‚### å‚è€ƒèµ„æ–™ <a href="https://docs.unrealengine.com/5.0/zh-CN/common-ui-quickstart-guide-for-unreal-engine/">è™šå¹»å¼•æ“CommonUIå¿«é€ŸæŒ‡å— | è™šå¹»å¼•æ“5.0æ–‡æ¡£</a> <a href="https://www.youtube.com/watch?v=TTB5y-03SnE&amp;t=4740s">InsideUnrealCommonUI Tutorial</a> <a href="https://zhuanlan.zhihu.com/p/553170706">æ¸¸æˆå¼•æ“åº”ç”¨â€”â€”UnrealEngineçš„CommonUIæ’ä»¶åˆ†æ - çŸ¥ä¹</a></p>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unreal Engine </tag>
            
            <tag> UI </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾å½¢å­¦å…¥é—¨ç¬”è®°4: å®æ—¶é˜´å½±</title>
      <link href="/2023/06/04/gamegraphics/tu-xing-xue-ru-men-bi-ji-4-shi-shi-yin-ying/"/>
      <url>/2023/06/04/gamegraphics/tu-xing-xue-ru-men-bi-ji-4-shi-shi-yin-ying/</url>
      
        <content type="html"><![CDATA[<h3><span id="shadow-map">Shadow Map</span></h3><p>ShadowMapçš„æ€æƒ³éå¸¸ç®€å•ï¼Œå°±æ˜¯é€šè¿‡ä¸¤ä¸ªPasså°†é˜´å½±æ¸²æŸ“å‡ºæ¥ã€‚åœ¨ç¬¬ä¸€ä¸ªPassä¸­ï¼Œä»å…‰æºçš„è§†è§’å»æ¸²æŸ“åœºæ™¯ï¼Œè®°å½•ç‰‡å…ƒçš„æ·±åº¦ï¼Œå¾—åˆ°ä¸€å¼ æ·±åº¦å›¾ã€‚ç„¶åè¿›è¡Œç¬¬äºŒä¸ªPassï¼Œä»æ‘„åƒæœºçš„è§†è§’å»æ¸²æŸ“åœºæ™¯ï¼Œå¯¹äºæ¸²æŸ“çš„æ¯ä¸€ä¸ªç‰‡å…ƒï¼Œå°†å…¶åæ ‡è½¬åŒ–ä¸ºä»¥å…‰æºä¸ºå‚ç…§çš„åæ ‡ï¼Œå¯ä»¥å¾—åˆ°å½“å‰çš„æ·±åº¦ï¼Œå°†è¿™ä¸ªæ·±åº¦å€¼å’Œå­˜å‚¨åœ¨æ·±åº¦å›¾ä¸­çš„æ·±åº¦å€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè¯´å½“å‰æ·±åº¦å¤§äºæ·±åº¦å›¾ä¸­çš„æ·±åº¦ï¼Œè¯´æ˜è¿™ä¸ªä½ç½®çš„å…‰æºè¢«ç‰©ä½“é®æŒ¡äº†ï¼Œæ˜¯ä¸€ä¸ªé˜´å½±ã€‚</p><p>ä½†æ˜¯ï¼ŒShadowMapä¼šé€ æˆæ‘©å°”çº¹çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚è¿™æ˜¯ç”±äºé‡‡æ ·ç‡ä¸è¶³ï¼Œå¤šä¸ªä¸åŒä½ç½®ä½†ä¸´è¿‘çš„ç‰‡å…ƒæœ‰å¯èƒ½æ˜ å°„åˆ°åŒä¸€ä¸ªShadowMapçš„åƒç´ ä¸Šï¼Œå¦‚ç¬¬äºŒå¼ å›¾æ‰€ç¤ºï¼Œè¿™å°±ä¼šå¯¼è‡´æœ‰äº›åƒç´ ä¼šè¢«è¯¯è®¤ä¸ºæ˜¯é˜´å½±ï¼ˆäº§ç”Ÿäº†é”™è¯¯çš„è‡ªé®æŒ¡ï¼‰ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ªéå¸¸å°çš„biasï¼Œå°±å¥½åƒè®©åœ°é¢ç¨å¾®æ‚¬ç©ºä¸€ç‚¹ï¼Œè®©é‚£äº›è‡ªé®æŒ¡çš„éƒ¨åˆ†ä¸è¢«è¯¯åˆ¤ä¸ºé˜´å½±ï¼Œè¿™æ ·å­å°±å¯ä»¥è§£å†³æ‘©å°”çº¹çš„é—®é¢˜äº†ã€‚ä½†åŒæ—¶ï¼Œè¿™æ ·å­åšåˆä¼šå¼•å‡ºæ–°çš„é—®é¢˜ï¼Œå°±æ˜¯ç‰©ä½“çœ‹èµ·æ¥åƒæ˜¯å’Œåœ°é¢æ‚¬ç©ºäº†ä¸€æ ·ã€‚å®é™…ä¸Šæœ‰å¾ˆå¤šä¸åŒè®¾ç½®biaså¤§å°çš„åŠæ³•ã€‚</p><figure><img src="https://s2.loli.net/2023/07/16/lm5TDGQndikEFe8.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p><img src="https://s2.loli.net/2023/07/16/oa3bpAV8tGkEcdZ.png" alt="img">æ¯”è¾ƒç®€å•çš„ä¸€ç§è‡ªé€‚åº”biasæ–¹æ³•æ˜¯é€šè¿‡æ³•çº¿å’Œå…¥å°„å…‰çš„å¤¹è§’æ¥ç¡®å®šã€‚å½“å…¥å°„å…‰éå¸¸å€¾æ–œçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦çš„biasæ˜¯æ¯”è¾ƒå¤§çš„ï¼Œåä¹‹ä¼šæ¯”è¾ƒå°ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾å®šä¸€ä¸ªbiasçš„æœ€å¤§å€¼å’Œæœ€å°å€¼ï¼Œç„¶åé€šè¿‡æ³•çº¿å’Œå…¥å°„å…‰çš„å¤¹è§’ä½¿biaså–ä¸€ä¸ªåˆé€‚çš„å€¼ã€‚</p><figure><img src="https://s2.loli.net/2023/07/16/aE9FG1uUdBkwXme.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>æ›´å…·ä½“çš„ï¼Œè¿˜å¯ä»¥é‡‡ç”¨æ›´åŠ ç»†è‡´çš„æ•°å­¦è®¡ç®—ï¼Œå¯ä»¥å‚è€ƒ<a href="https://zhuanlan.zhihu.com/p/370951892">è‡ªé€‚åº”Shadow Biasç®—æ³• -çŸ¥ä¹</a>ä¸­ç»™å‡ºçš„å…¬å¼ã€‚æ³¨æ„ä»¥ä¸Šä¸¤ç§æ–¹æ³•ä¸­ï¼Œè¦è€ƒè™‘æ³•çº¿æ–¹å‘å’Œå…‰çº¿æ–¹å‘åœ¨ä¸åŒä¾§ï¼Œä¼šæœ‰è´Ÿå€¼ï¼Œæ‰€ä»¥éœ€è¦åŠ ä¸€ä¸ªabsï¼ˆæ¯”å¦‚è¯´å°å¥³å­©çš„èƒŒé¢ï¼‰ã€‚</p><h3><span id="pcf">PCF</span></h3><p>PCFå…¨ç§°æ˜¯Percentage CloserFilteringï¼Œæ˜¯ä¸ºäº†è§£å†³é”¯é½¿é—®é¢˜çš„ä¸€ç§æœ€ç®€å•çš„å¤„ç†æ–¹æ³•ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ç§æ–¹æ³•æ˜¯é‡‡ç”¨äº†filteringçš„æ–¹æ³•ï¼Œå½“è®¡ç®—æŸä¸ªåƒç´ æ˜¯å¦è¢«é®æŒ¡æ—¶ï¼Œé¦–å…ˆå…ˆé‡‡æ ·ä»¥è¯¥åƒç´ ä¸ºä¸­å¿ƒå‘¨å›´ä¸€äº›ç‚¹çš„é®æŒ¡æƒ…å†µï¼Œæœ€åçš„Visibilityå€¼ä¸ºè¢«é®æŒ¡çš„é‡‡æ ·ç‚¹çš„æ¯”ç‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºæ¯ä¸€ä¸ªshadingpointï¼Œæˆ‘ä»¬éƒ½è¦åœ¨shadowmapä¸Šè¿™ä¸ªç‚¹å‘¨å›´ä¸€ä¸ªèŒƒå›´å†…é‡‡æ ·æ·±åº¦ï¼Œå¹¶ä¸”åˆ¤æ–­å’Œæ¸²æŸ“è§†è§’æ·±åº¦çš„å…³ç³»</p><p>Note</p><p>æ³¨æ„è¿™é‡Œçš„filteringæ“ä½œæ˜¯åœ¨è®¡ç®—å¯è§åº¦çš„æ—¶å€™è¿›è¡Œçš„æ“ä½œï¼Œå¹¶éæ˜¯ç›´æ¥åœ¨æ·±åº¦å›¾ä¸Šè¿›è¡Œçš„æ“ä½œï¼ˆç›´æ¥åœ¨æ·±åº¦å›¾ä¸Šè¿›è¡Œå·ç§¯æœ€ç»ˆè®¡ç®—çš„ç»“æœè¿˜æ˜¯ç¡¬é˜´å½±ï¼Œæ²¡æœ‰æ„ä¹‰ï¼‰ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="title function_">PCF</span><span class="params">(sampler2D shadowMap, vec4 coords, <span class="type">float</span> biasC, <span class="type">float</span> filterRadiusUV)</span> &#123;</span><br><span class="line">  <span class="comment">//uniformDiskSamples(coords.xy);</span></span><br><span class="line">  poissonDiskSamples(coords.xy); <span class="comment">//ä½¿ç”¨xyåæ ‡ä½œä¸ºéšæœºç§å­ç”Ÿæˆ</span></span><br><span class="line">  <span class="type">float</span> visibility = <span class="number">0.0</span>;</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_SAMPLES; i++)&#123;</span><br><span class="line">    vec2 offset = poissonDisk[i] * filterRadiusUV;</span><br><span class="line">    <span class="type">float</span> shadowDepth = useShadowMap(shadowMap, coords + vec4(offset, <span class="number">0.</span>, <span class="number">0.</span>), biasC, filterRadiusUV);</span><br><span class="line">    <span class="keyword">if</span>(coords.z &gt; shadowDepth + EPS)&#123;</span><br><span class="line">      visibility++;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1.0</span> - visibility / <span class="type">float</span>(NUM_SAMPLES);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="pcss">PCSS</span></h3><p>åœ¨PCFä¸­ï¼Œfilteringçš„èŒƒå›´å¤§å°æ˜¯é¢„å…ˆç¡®å®šçš„ï¼Œç„¶è€Œåœ¨å®é™…æƒ…å†µä¸­ï¼Œè·ç¦»æ›´è¿‘çš„é˜´å½±æ›´å½±ï¼Œè¿œå¤„åˆ™æ›´è¿œï¼Œå¦‚ä¸‹å›¾<img src="https://i.sstatic.net/75AbS.jpg" alt="img"></p><p>åœ¨PCFçš„åŸºç¡€ä¸Šï¼ŒPCSSä¼šæ ¹æ®é˜´å½±è·ç¦»ç‰©ä½“çš„è¿œè¿‘è°ƒæ•´filteringçš„å¤§å°ã€‚PCSSåˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol type="1"><li>Blocker Searchï¼Œåœ¨æŸä¸ªç‰¹å®šèŒƒå›´å†…å¾—å‡ºå¹³å‡é®æŒ¡ç‰©çš„æ·±åº¦ï¼›</li><li>ä¼°è®¡åŠå½± (Penumbra)åŒºåŸŸçš„å¤§å°ï¼Œæ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢å¾—å‡ºï¼›</li><li>ä½¿ç”¨è®¡ç®—å¾—åˆ°çš„åŠå½±å¤§å°ä½œä¸ºFilterRadiusè¿›è¡ŒPCF</li></ol><figure><img src="https://s2.loli.net/2023/07/15/eFwgaTP76LSBcvu.png" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>é‚£ä¹ˆåœ¨ç¬¬ä¸€æ­¥ä¸­ï¼Œåœ¨å“ªä¸€å—åŒºåŸŸä¸­è®¡ç®—é‚£é®æŒ¡ç‰©çš„å¹³å‡æ·±åº¦å‘¢ï¼Ÿè¿™å—åŒºåŸŸå–å†³äºå…‰æºçš„å¤§å°å’Œé˜´å½±æ¥æ”¶å¹³é¢è·ç¦»å…‰æºçš„è·ç¦»ã€‚åŒæ ·ç±»ä¼¼çš„ï¼Œæ ¹æ®ç›¸ä¼¼ä¸‰è§’å½¢ï¼Œåœ¨shadowmapä¸Šå¯ä»¥å¾—åˆ°å¯¹åº”çš„åŒºåŸŸï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p><figure><img src="https://s2.loli.net/2024/12/30/iYXOmlW24Q7tvS9.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å¯¹åº”çš„ä»£ç å®ç°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float</span> <span class="title function_">findBlocker</span><span class="params">(sampler2D shadowMap, vec2 uv, <span class="type">float</span> zReceiver)</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> blockerNum = <span class="number">0</span>;</span><br><span class="line">  <span class="type">float</span> blockDepth = <span class="number">0.</span>;</span><br><span class="line">  <span class="type">float</span> posZFromLight = vPositionFromLight.z;</span><br><span class="line">  <span class="comment">// blocker searchçš„å¤§å°</span></span><br><span class="line">  <span class="comment">// NEAR_PLANEæ˜¯è¿‘å¹³é¢ï¼Œå³shadow mapæ‰€åœ¨çš„å¹³é¢</span></span><br><span class="line">  <span class="type">float</span> searchRadius = LIGHT_SIZE_UV * (posZFromLight - NEAR_PLANE) / posZFromLight;</span><br><span class="line"></span><br><span class="line">  poissonDiskSamples(uv);</span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; NUM_SAMPLES; i++)&#123;</span><br><span class="line">    <span class="type">float</span> shadowDepth = unpack(texture2D(shadowMap, uv + poissonDisk[i] * searchRadius));</span><br><span class="line">    <span class="keyword">if</span>(zReceiver &gt; shadowDepth)&#123;</span><br><span class="line">      blockerNum++;</span><br><span class="line">      blockDepth += shadowDepth;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(blockerNum == <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1.</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> blockDepth / <span class="type">float</span>(blockerNum);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">float</span> <span class="title function_">PCSS</span><span class="params">(sampler2D shadowMap, vec4 coords, <span class="type">float</span> biasC)</span>&#123;</span><br><span class="line">  <span class="type">float</span> zReceiver = coords.z;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// STEP 1: avgblocker depth</span></span><br><span class="line">  <span class="type">float</span> avgBlockerDepth = findBlocker(shadowMap, coords.xy, zReceiver);</span><br><span class="line">  <span class="keyword">if</span>(avgBlockerDepth &lt; -EPS)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// STEP 2: penumbra size</span></span><br><span class="line">  <span class="type">float</span> penumbra = (zReceiver - avgBlockerDepth) * LIGHT_SIZE_UV / avgBlockerDepth;</span><br><span class="line">  <span class="type">float</span> filterRadiusUV = penumbra;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// STEP 3: filtering</span></span><br><span class="line">  <span class="keyword">return</span> PCF(shadowMap, coords, biasC, filterRadiusUV);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="variance-soft-shadow-mappingvssm">Variance Soft Shadow Mapping(VSSM)</span></h3><p>VSSMåœ¨PCFå’ŒPCSSçš„åŸºç¡€ä¸Šé€šè¿‡ç»Ÿè®¡å­¦æ–¹æ³•è¿›è¡Œäº†æ”¹è¿›ã€‚</p><h4><span id="step-3">Step 3</span></h4><p>åœ¨PCSSä¸­ç¬¬ä¸‰æ­¥å³PCFä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä»»æ„ä¸€ä¸ªshadingpointé€šè¿‡å·ç§¯è®¡ç®—å…¶visibilityã€‚è¿™ä¸€æ­¥é€šå¸¸æ¯”è¾ƒè€—æ—¶ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶è½¬åŒ–ä¸ºä¸€ä¸ªæ¦‚ç‡ï¼Œå…¶ä¸­å¯ä»¥ä»£è¡¨shadowmapçš„é‡‡æ ·å€¼ï¼Œå¯ä»¥è¡¨ç¤ºshadingpointçš„æ·±åº¦ã€‚æˆ‘ä»¬å¯ä»¥å°†æ·±åº¦çš„æ¦‚ç‡åˆ†å¸ƒç²—ç•¥çš„ä¼°è®¡ä¸ºä¸€ä¸ªGaussiandistributionï¼Œæ›´è¿›ä¸€æ­¥çš„ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥ç›´æ¥é‡‡ç”¨Chebyshevä¸ç­‰å¼è¿›è¡Œä¼°è®¡</p><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¦‚ä½•è®¡ç®—å‡å€¼å’Œæ–¹å·®ï¼Œå¯¹äºæ–¹å·®æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å…¬å¼ï¼Œè¿™æ ·å°±åªéœ€è¦çŸ¥é“å‡å€¼ä»¥åŠå¹³æ–¹çš„å‡å€¼å°±å¯ä»¥è®¡ç®—æ–¹å·®</p><h4><span id="step-1">Step 1</span></h4><p>åœ¨PCSSç¬¬ä¸€æ­¥Blocker searchä¸­ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å¯¹shadowmapè¿›è¡Œé‡‡æ ·æ¥è®¡ç®—é®æŒ¡ç‰©çš„å¹³å‡æ·±åº¦ï¼ŒåŒæ ·ä¹Ÿæ˜¯éå¸¸è€—æ—¶çš„æ­¥éª¤ã€‚è¿™é‡ŒåŒæ ·å¯ä»¥ç”¨æ¦‚ç‡è¿›è¡Œä¼°è®¡ä»¥æé«˜æ•ˆç‡ã€‚é¦–å…ˆå®šä¹‰ä»¥ä¸‹ç›¸å…³å˜é‡</p><ul><li><p>é®æŒ¡ç‰© ()çš„å¹³å‡æ·±åº¦</p></li><li><p>éé®æŒ¡ç‰© ()çš„å¹³å‡æ·±åº¦</p></li><li><p>æ€»æ ·æœ¬æ•°é‡</p></li><li><p>é®æŒ¡ç‰©çš„æ ·æœ¬æ•°é‡</p></li><li><p>éé®æŒ¡ç‰©çš„æ ·æœ¬æ•°é‡</p></li><li><p>åŒºåŸŸå¹³å‡æ·±åº¦</p><p>å› æ­¤æˆ‘ä»¬æœ‰ä»¥ä¸‹å…¬å¼</p><p>ä½¿ç”¨æ¦‚ç‡ä½œä»¥ä¸‹ä¼°è®¡å’Œå‡è®¾</p></li><li></li><li></li><li><p>ç„¶åå°±å¯ä»¥ç”¨Chebyshevä¸ç­‰å¼è§£å†³ã€‚å¦å¤–è¿™é‡Œä½¿ç”¨çš„å‡è®¾ç›´æ¥å‡å®šéé®æŒ¡ç‰©éƒ½å’Œshadingpointåœ¨åŒä¸€å¹³é¢ä¸Šï¼Œå¯ä»¥ç†è§£ä¸ºå› ä¸ºç»å¤§éƒ¨åˆ†é˜´å½±æ¥æ”¶è€…éƒ½æ˜¯ä¸€ä¸ªå¹³é¢ï¼Œæ‰€ä»¥è¿™æ ·çš„å‡è®¾ä¹Ÿå…·æœ‰ä¸€å®šçš„åˆç†æ€§ã€‚</p></li></ul><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œç”¨ç»Ÿè®¡å­¦æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³PCSSä¸­ä¸¤æ­¥é‡‡æ ·è¾ƒä¸ºè€—æ—¶çš„é—®é¢˜ã€‚</p><h4><span id="mipmap-andsummed-area-variance-shadow-maps">MIPMAP andSummed-Area Variance Shadow Maps</span></h4><p>åœ¨å…·ä½“å®ç°ç®—æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®—shadowmapä¸­ä¸€å—åŒºåŸŸçš„æ–¹å·®å’Œå‡å€¼ï¼Œå¯ä»¥é€šè¿‡Mipmapæˆ–è€…SAT(Summed AreaTable)å®ç°ã€‚</p><ul><li>Mipmapå¯ä»¥å¿«é€Ÿçš„å¯¹Textureè¿›è¡ŒèŒƒå›´æŸ¥è¯¢ï¼Œåœ¨æŸ¥è¯¢æŸå—æ–¹å½¢èŒƒå›´æ—¶ï¼Œéœ€è¦æ ¹æ®æ–¹å½¢å¤§å°é€‰æ‹©å¯¹åº”çš„Levelï¼Œæ ¹æ®æ–¹å½¢ä¸­å¿ƒä½ç½®é€‰æ‹©å‘¨å›´å››ä¸ªåƒç´ è¿›è¡Œæ’å€¼ï¼Œä»¥åŠä¸Šä¸‹Levelä¹‹é—´ä½œä¸‰çº¿æ€§æ’å€¼(Trillinearinterpolation)ã€‚ç”±äºå¤šæ¬¡æ’å€¼ï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœæ˜¯ä¸å‡†ç¡®çš„ã€‚å¦å¤–ï¼ŒMipmapä¸é€‚åˆåšéæ–¹å½¢åŒºåŸŸçš„èŒƒå›´æŸ¥è¯¢ã€‚</li></ul><figure><img src="https://s2.loli.net/2024/12/30/LenHG8ImYyxZDok.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><ul><li>SATä½¿ç”¨äº†ç±»ä¼¼å‰ç¼€å’Œçš„æ€æƒ³ï¼Œç»´æŠ¤ä¸€ä¸ªtableï¼Œæ¯ä¸ªä½ç½®ä¸Šå­˜å‚¨ä»åŸç‚¹åˆ°å½“å‰ä½ç½®çš„çŸ©å½¢åŒºåŸŸçš„å’Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¾—åˆ°æŸä¸€å—åŒºåŸŸçš„èŒƒå›´ä¹‹å’Œã€‚é¢„è®¡ç®—å’Œå­˜å‚¨æ‰€éœ€è¦çš„é¢å¤–å¤æ‚åº¦éƒ½æ˜¯(é€è¡Œé€åˆ—ç´¯åŠ )ï¼Œå¯ä»¥é‡‡ç”¨å¹¶è¡Œè®¡ç®—è¿›è¡ŒåŠ é€Ÿã€‚SATå¾—åˆ°çš„ç»“æœå¯¹æ¯”Mipmapæ˜¯å‡†ç¡®çš„ï¼Œä½†ç¼ºç‚¹å°±æ˜¯é¢„å¤„ç†æ¯”è¾ƒè€—æ—¶ã€‚</li></ul><figure><img src="https://s2.loli.net/2024/12/09/ZHKiDFk2qsy1VxA.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h4><span id="é—®é¢˜">é—®é¢˜</span></h4><p>ç”±äºVSSMä¸­ä½¿ç”¨äº†å¤§é‡çš„å‡è®¾ï¼Œåœ¨è¿™äº›ä¼°è®¡ä¸å‡†ç¡®çš„æ—¶å€™ï¼Œä¼šé€ æˆæ¸²æŸ“çš„ç»“æœå­˜åœ¨æ˜æ˜¾çš„artifactã€‚æ¯”å¦‚ç”±äºæˆ‘ä»¬å‡è®¾äº†åœ¨filteringçš„èŒƒå›´å†…çš„æ·±åº¦æ˜¯ä¸€ä¸ªæ­£æ€åˆ†å¸ƒï¼Œä½†å¦‚æœåœ¨å¹¶ä¸æ˜¯çš„æƒ…å†µä¸‹ï¼Œå°±ä¼šé€ æˆä¼°è®¡çš„ç»“æœä¸å‡†ç¡®ã€‚é€šå¸¸æœ‰ä¸¤ç§æƒ…å†µï¼Œè¿‡å¤§æˆ–è€…è¿‡å°ã€‚è¿‡å°ä¼šå¯¼è‡´ç”»é¢åé»‘ï¼Œè€Œè¿‡å¤§ä¼šå¯¼è‡´æ¼å…‰çš„ç°è±¡ï¼Œæ¯”å¦‚ä¸‹é¢ä¸€ä¸ªä¾‹å­</p><figure><img src="https://s2.loli.net/2024/12/31/YxyJIZXDBzg8Uoi.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>å‡è®¾å³å›¾ä¸­ä¸‰å—æ¿ä»ä¸Šåˆ°ä¸‹Aã€Bã€Cçš„æ·±åº¦åˆ†åˆ«ä¸ºaã€bã€cï¼Œé‚£ä¹ˆåœ¨Filterregionä¸­æˆ‘ä»¬è®¡ç®—å¾—åˆ°æ·±åº¦çš„å‡å€¼å’Œæ–¹å·®</p><p>å› æ­¤ï¼Œæ ¹æ®Chebyshevä¸ç­‰å¼ï¼ŒBæ¿çš„Visibilityå°±æ˜¯</p><p>Cæ¿çš„Visibilityæ˜¯</p><p>å¯ä»¥çœ‹å‡ºå½“å¾ˆå°æ—¶ï¼Œä¹Ÿå°±æ˜¯å¤šä¸ªé®æŒ¡ç‰©ä½“ä¹‹é—´çš„æ·±åº¦å˜åŒ–å¾ˆå¤§çš„æ—¶å€™ï¼Œæœ¬æ¥åº”è¯¥å¾ˆå°çš„Visibilityåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ä¼šæ¥è¿‘0.5ï¼Œå°±ä¼šé€ æˆæ¼å…‰é—®é¢˜ã€‚</p><p>é™¤äº†è¿™ä¸ªé—®é¢˜ä»¥å¤–ï¼Œå¦ä¸€ä¸ªå‡è®¾ï¼Œä¹Ÿå°±æ˜¯å‡è®¾æœªé€ æˆé®æŒ¡çš„ç‰©ä½“å’Œé˜´å½±æ¥æ”¶å¹³é¢å¤„äºåŒä¸€ä¸ªå¹³é¢ä¸Šï¼Œåœ¨ä¸€äº›å¹¶ä¸ç¬¦åˆçš„æƒ…å†µä¸‹å°±ä¼šé€ æˆæ¼å…‰çš„é—®é¢˜ï¼Œå¦‚ä¸‹å›¾ã€‚</p><figure><img src="https://s2.loli.net/2024/12/31/qWf3zmNd5kHQxiV.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h3><span id="moment-shadow-map">Moment Shadow Map</span></h3><p>ä¸ºäº†è§£å†³VSSMä¸­å­˜åœ¨çš„é—®é¢˜ï¼ŒMoment Shadowmapä½¿ç”¨äº†æ›´é«˜é˜¶çš„çŸ©(Moment)å»æ‹Ÿåˆä¸€ä¸ªåˆ†å¸ƒçš„CDFã€‚Moment shadowmappingä½¿ç”¨çŸ©çš„æœ€ç®€å•çš„å½¢å¼ VSSMåœ¨æœ¬è´¨ä¸Šå°±æ˜¯ä½¿ç”¨äº†ä¸¤é˜¶çš„Moment,</p><figure><img src="https://s2.loli.net/2024/12/31/mERcCMS71IoKL6V.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé€šå¸¸æƒ…å†µä¸‹å››é˜¶momentå·²ç»å¯ä»¥å¾ˆå¥½çš„æ‹Ÿåˆä¸€ä¸ªCDFäº†ã€‚ä½†æ˜¯è™½ç„¶Moment Shadow Mapping æ•ˆæœç›¸å½“ä¸é”™ï¼Œå¾ˆå¥½çš„è§£å†³äº† VSSMç»å¤§éƒ¨åˆ†ç¼ºé™·ï¼Œä½†æ˜¯å®ƒä»éœ€è¦ç›¸å½“çš„é¢å¤–ç©ºé—´å¼€é”€å’Œé‡å»ºçŸ©çš„é¢å¤–æ€§èƒ½å¼€é”€ã€‚</p><figure><img src="https://s2.loli.net/2024/12/31/FsWZ8ErpS5dAeio.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><h3><span id="distance-field-soft-shadow">Distance Field Soft Shadow</span></h3><p>Distance Field Shadow Mapé‡‡ç”¨äº†Signed Distance Function(SDF)è¿›è¡Œé˜´å½±çš„è®¡ç®—ã€‚ä½¿ç”¨SDFå¯ä»¥æœ‰æ•ˆè§£å†³Shadowmapå­˜åœ¨çš„è¯¸å¤šé—®é¢˜ï¼Œæ¯”å¦‚æ‘©å°”çº¹ï¼Œpeter panningï¼Œé”¯é½¿ç­‰ç­‰é—®é¢˜ã€‚</p><p>SDFç”¨ä¸€ä¸ªVolumeTextureå­˜å‚¨æ¯ä¸ªç‚¹åˆ°æœ€è¿‘çš„meshè¡¨é¢çš„è·ç¦»ï¼Œå¦‚æœåœ¨meshå¤–åˆ™ä¸ºæ­£ï¼Œåœ¨meshå†…éƒ¨åˆ™ä¸ºè´Ÿã€‚</p><p>SDFçš„æ€§è´¨å¯ä»¥ç”¨äºè¿›è¡Œraytracingã€‚ä»èµ·ç‚¹å‡ºå‘ï¼Œæ¯ä¸€æ¬¡traceæ­¥è¿›å½“å‰ç‚¹æŸ¥è¯¢åˆ°çš„æœ€è¿‘è·ç¦»ï¼Œè¿™æ ·å­å¯ä»¥ç¡®ä¿æ¯ä¸€æ¬¡æ­¥è¿›éƒ½ä¸ä¼šç©¿è¿‡ç‰©ä½“ã€‚ä¸‹å›¾å±•ç¤ºäº†ä»èµ·ç‚¹ä¸æ–­traceå…‰çº¿ç›´åˆ°æ‰¾åˆ°äº†å…‰çº¿å’Œæ ‘çš„äº¤ç‚¹çš„è¿‡ç¨‹ã€‚</p><figure><img src="https://s2.loli.net/2024/12/31/WVRJ76l3rdBKYcX.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>ä½¿ç”¨è¿™ä¸ªæ€§è´¨ï¼Œå¯ä»¥é€šè¿‡raymarchingçš„æ–¹å¼å¯ä»¥å¤§è‡´ä¼°ç®—å‡ºvisibilityã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€ä¸ªé¢å…‰æºï¼Œä»shadingpointå‡ºå‘ï¼Œtraceä¸€æ ¹å…‰çº¿ï¼Œä½¿ç”¨SDFå¯ä»¥è®¡ç®—å‡ºè¿™æ ¹å…‰çº¿åœ¨å¤šå¤§è§’åº¦çš„èŒƒå›´å†…æ²¡æœ‰è¢«é®æŒ¡ï¼Œè¶Šå°çš„è§’åº¦ä»£è¡¨è¶Šå°çš„visibilityã€‚å…·ä½“åšæ³•æ˜¯ï¼Œä»èµ·ç‚¹å‡ºå‘ï¼ŒæŒ‰ç…§ä¸Šé¢çš„åŠæ³•ä¸æ–­çš„traceå…‰çº¿ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è®¡ç®—è§’åº¦ï¼Œä¹Ÿå°±æ˜¯</p><figure><img src="https://s2.loli.net/2024/12/31/hYkRr5JtuGAvyUi.png" alt="image.png"><figcaption aria-hidden="true">image.png</figcaption></figure><p>ä½†åœ¨å®é™…æƒ…å†µä¸‹ï¼Œç”±äºè®¡ç®—æ¯”è¾ƒè€—æ—¶ï¼Œå¯ä»¥ç²—ç•¥çš„é€šè¿‡ç®€å•çš„çº¿æ€§å…³ç³»è¡¨ç¤ºé®æŒ¡ç¨‹åº¦ï¼Œè€Œå¹¶éä¸¥æ ¼çš„è®¡ç®—æœªé®æŒ¡è§’åº¦å’Œå…‰æºæœ€å¤§è§’åº¦çš„æ¯”å€¼</p><p>å…¶ä¸­ç”¨æ¥æ§åˆ¶é˜´å½±çš„è½¯ç¡¬ç¨‹åº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º <img src="https://s2.loli.net/2024/12/31/Kwvc1HPAW6q7o4E.png" alt="image.png"></p><p>shaderä»£ç å®ç°å¦‚ä¸‹ï¼Œæ¥æº<a href="https://iquilezles.org/articles/rmshadows/">Inigo Quilez ::computer graphics, mathematics, shaders, fractals, demoscene andmore</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">float softshadow( in vec3 ro, in vec3 rd, float mint, float maxt, float k )</span><br><span class="line">&#123;</span><br><span class="line">    float res = 1.0;</span><br><span class="line">    float t = mint;</span><br><span class="line">    for( int i=0; i&lt;256 &amp;&amp; t&lt;maxt; i++ )</span><br><span class="line">    &#123;</span><br><span class="line">        float h = map(ro + rd*t);</span><br><span class="line">        if( h&lt;0.001 )</span><br><span class="line">            return 0.0;</span><br><span class="line">        res = min( res, k*h/t );</span><br><span class="line">        t += h;</span><br><span class="line">    &#125;</span><br><span class="line">    return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><ol type="1"><li><a href="https://zhuanlan.zhihu.com/p/595039591">GAMES202-ä½œä¸š1ï¼šå®æ—¶é˜´å½± -çŸ¥ä¹</a></li><li><a href="https://blog.csdn.net/qq_36242312/article/details/117562881">GAMES202 - ä½œä¸š 1: å®æ—¶é˜´å½±_games202ä½œä¸š1_CCCCCCros____çš„åšå®¢-CSDNåšå®¢</a></li><li><a href="https://zhuanlan.zhihu.com/p/370951892">è‡ªé€‚åº”ShadowBiasç®—æ³• - çŸ¥ä¹</a></li><li><a href="https://developer.nvidia.com/gpugems/gpugems3/part-ii-light-and-shadows/chapter-8-summed-area-variance-shadow-maps">Chapter8. Summed-Area Variance Shadow Maps | NVIDIA Developer</a></li><li><a href="https://www.cnblogs.com/KillerAery/p/15201310.html">å®æ—¶é˜´å½±æŠ€æœ¯ï¼ˆ1ï¼‰ShadowMapping - KillerAery - åšå®¢å›­</a></li><li><a href="https://dev.epicgames.com/documentation/en-us/unreal-engine/mesh-distance-fields-in-unreal-engine">MeshDistance Fields in Unreal Engine | Unreal Engine 5.5 Documentation |Epic Developer Community</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cpp </tag>
            
            <tag> å›¾å½¢å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>C++åå°„æœºåˆ¶è¯¦è§£ï¼ˆä¸€ï¼‰ åŠ¨æ€åå°„</title>
      <link href="/2023/01/06/cpp/c-fan-she-ji-zhi-dong-tai-fan-she/"/>
      <url>/2023/01/06/cpp/c-fan-she-ji-zhi-dong-tai-fan-she/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™éœ€è¦è¿›è¡Œä¸€äº›æ“ä½œæ¯”å¦‚è¯´åºåˆ—åŒ–ã€‚è€Œå¦‚æœæˆ‘ä»¬å¯¹æ‰€æœ‰çš„å†…å®¹éƒ½è¿›è¡Œhardcodeï¼Œæ˜¾ç„¶è¿™æ ·çš„å·¥ä½œæ¯”è¾ƒç¹çã€‚å› æ­¤ï¼Œä½¿ç”¨åå°„å¯ä»¥è®©æˆ‘ä»¬åœ¨è¿è¡Œæ—¶è·å¾—ç±»å‹ä¿¡æ¯ï¼Œä»è€Œæ›´æ–¹ä¾¿çš„è¿›è¡Œå¼€å‘ã€‚åœ¨C++ä¸­åŸç”Ÿä¸èƒ½æä¾›åå°„æœºåˆ¶ï¼Œå› æ­¤ï¼Œé€šå¸¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»å®ç°ã€‚</p><p>åœ¨C++ä¸­ï¼Œå¸¸è§çš„åå°„å®ç°é€šå¸¸åˆ†ä¸ºåŠ¨æ€åå°„å’Œé™æ€åå°„ã€‚é™æ€åå°„å°†ç±»å‹ä¿¡æ¯åœ¨ç¼–è¯‘æ—¶è¿›è¡Œå¯¼å‡ºï¼Œé€šå¸¸æƒ…å†µä¸‹ä½¿ç”¨parseråœ¨ç¼–è¯‘æ—¶æœŸç”Ÿæˆä¸€äº›è¾…åŠ©ä»£ç ï¼Œé€šè¿‡å¯¹ç±»å‹ã€å­—æ®µå’Œå‡½æ•°çš„æ ‡è®°ï¼Œç”Ÿæˆç›¸åº”çš„åå°„ç±»å‹ä¿¡æ¯ï¼Œå¦‚UnrealEngineã€Qtç­‰éƒ½æ˜¯é€šè¿‡é™æ€åå°„å»å®ç°åå°„çš„åŠŸèƒ½ã€‚åŠ¨æ€åå°„æ˜¯åœ¨è¿è¡Œæ—¶å°†ç±»å‹ä¿¡æ¯è®°å½•ä¸‹æ¥ï¼Œé€šå¸¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»registeræ‰€éœ€è¦çš„åå°„ä¿¡æ¯ã€‚</p><h2><span id="ä¸€ç§ç®€å•çš„åå°„å®ç°">ä¸€ç§ç®€å•çš„åå°„å®ç°</span></h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥ä»ç®€å•å¼€å§‹ï¼Œè€ƒè™‘ä¸€ä¸ªæœ€åŸºæœ¬çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ä¸€ä¸ªç±»åçš„å­—ç¬¦ä¸²åˆ›å»ºå‡ºå¯¹åº”çš„ç±»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªClasså·¥å‚ç±»ï¼Œå­˜å‚¨æˆ‘ä»¬æ³¨å†Œçš„ç±»åå’Œç±»çš„æ„é€ ä¿¡æ¯ã€‚åœ¨åˆ›å»ºç±»çš„åŒæ—¶ï¼Œæˆ‘ä»¬å®ç°ä¸€ä¸ªç±»çš„å›è°ƒæ„é€ å‡½æ•°ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨å·¥å‚ç±»ä¸­ä¿å­˜çš„ç±»çš„æ„é€ ä¿¡æ¯ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç±»åå­—ç¬¦ä¸²åˆ›å»ºå¯¹åº”çš„ç±»äº†ã€‚ä»£ç å¦‚ä¸‹(æºè‡ª <a href="https://blog.csdn.net/K346K346/article/details/51698184">æˆ‘æ‰€ç†è§£çš„C++åå°„æœºåˆ¶</a> )</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span>* (*PTRCreateObject)(<span class="type">void</span>);  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ClassFactory</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:  </span><br><span class="line">    map&lt;string, PTRCreateObject&gt; m_classMap ;  </span><br><span class="line"><span class="built_in">ClassFactory</span>()&#123;&#125;; <span class="comment">//æ„é€ å‡½æ•°ç§æœ‰åŒ–</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:   </span><br><span class="line">    <span class="function"><span class="type">void</span>* <span class="title">getClassByName</span><span class="params">(string className)</span></span>;  </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">registClass</span><span class="params">(string name, PTRCreateObject method)</span> </span>;  </span><br><span class="line">    <span class="function"><span class="type">static</span> ClassFactory&amp; <span class="title">getInstance</span><span class="params">()</span> </span>;  </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span>* <span class="title">ClassFactory::getClassByName</span><span class="params">(string className)</span></span>&#123;  </span><br><span class="line">    map&lt;string, PTRCreateObject&gt;::const_iterator iter;  </span><br><span class="line">    iter = m_classMap.<span class="built_in">find</span>(className) ;  </span><br><span class="line">    <span class="keyword">if</span> ( iter == m_classMap.<span class="built_in">end</span>() )  </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span> ;  </span><br><span class="line">    <span class="keyword">else</span>  </span><br><span class="line">        <span class="keyword">return</span> iter-&gt;<span class="built_in">second</span>() ;  </span><br><span class="line">&#125;  </span><br><span class="line">   </span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ClassFactory::registClass</span><span class="params">(string name, PTRCreateObject method)</span></span>&#123;  </span><br><span class="line">    m_classMap.<span class="built_in">insert</span>(<span class="built_in">pair</span>&lt;string, PTRCreateObject&gt;(name, method)) ;  </span><br><span class="line">&#125;  </span><br><span class="line">   </span><br><span class="line"><span class="function">ClassFactory&amp; <span class="title">ClassFactory::getInstance</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="type">static</span> ClassFactory sLo_factory;  </span><br><span class="line">    <span class="keyword">return</span> sLo_factory ;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RegisterAction</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">RegisterAction</span>(string className,PTRCreateObject ptrCreateFn)&#123;</span><br><span class="line">ClassFactory::<span class="built_in">getInstance</span>().<span class="built_in">registClass</span>(className,ptrCreateFn);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> REGISTER(className)                                             \</span></span><br><span class="line"><span class="meta">    className* objectCreator##className()&#123;                              \</span></span><br><span class="line"><span class="meta">        return new className;                                           \</span></span><br><span class="line"><span class="meta">    &#125;                                                                   \</span></span><br><span class="line"><span class="meta">    RegisterAction g_creatorRegister##className(                        \</span></span><br><span class="line"><span class="meta">        #className,(PTRCreateObject)objectCreator##className)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// test class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TestClass</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">m_print</span><span class="params">()</span></span>&#123;</span><br><span class="line">cout&lt;&lt;<span class="string">&quot;hello TestClass&quot;</span>&lt;&lt;endl;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">REGISTER</span>(TestClass);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc,<span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line">TestClass* ptrObj=(TestClass*)ClassFactory::<span class="built_in">getInstance</span>().<span class="built_in">getClassByName</span>(<span class="string">&quot;TestClass&quot;</span>);</span><br><span class="line">ptrObj-&gt;<span class="built_in">m_print</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="taichi-åå°„åº“">Taichi åå°„åº“</span></h2><p>Taichi Trainingç±»ä¼¼äºRTTRå®ç°äº†ä¸€å¥—åŠ¨æ€åå°„åº“ä½œä¸ºæ•™ç¨‹ï¼Œæ•™ç¨‹é“¾æ¥<a href="https://www.bilibili.com/video/BV1MY4y1c7hU?vd_source=3ba69f5a040f08d144671fe461ae8b68">40åˆ†é’Ÿæ“ä¸€ä¸ª C++åå°„åº“ã€åŸç†ã€ç”¨æ³•ã€å®ç°éƒ½åœ¨è¿™é‡Œäº†ï¼ã€‘_å“”å“©å“”å“©_bilibili</a></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€æ®µæµ‹è¯•ä»£ç </p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Foo</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">PassByValue</span><span class="params">(std::string s)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Foo::PassByValue(`&quot;</span> &lt;&lt; s &lt;&lt; <span class="string">&quot;`)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">PassByConstRef</span><span class="params">(<span class="type">const</span> std::string &amp;s)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Foo::PassByConstRef(const `&quot;</span> &lt;&lt; s &lt;&lt; <span class="string">&quot;` &amp;)&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">std::string <span class="title">Concat</span><span class="params">(<span class="type">const</span> std::string &amp;head, <span class="type">const</span> std::string &amp;tail)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> res = head + tail;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// std::unique_ptr will result in compile-time error</span></span><br><span class="line">  <span class="function">std::shared_ptr&lt;<span class="type">float</span>&gt; <span class="title">MakeFloatPtr</span><span class="params">(<span class="type">float</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_shared</span>&lt;<span class="type">float</span>&gt;(i);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">MakeReflectable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    reflect::<span class="built_in">AddClass</span>&lt;Foo&gt;(<span class="string">&quot;Foo&quot;</span>)</span><br><span class="line">        .<span class="built_in">AddMemberVar</span>(<span class="string">&quot;name&quot;</span>, &amp;Foo::name)</span><br><span class="line">        .<span class="built_in">AddMemberVar</span>(<span class="string">&quot;x_&quot;</span>, &amp;Foo::x_)</span><br><span class="line">        .<span class="built_in">AddMemberFunc</span>(<span class="string">&quot;PassByValue&quot;</span>, &amp;Foo::PassByValue)</span><br><span class="line">        .<span class="built_in">AddMemberFunc</span>(<span class="string">&quot;PassByConstRef&quot;</span>, &amp;Foo::PassByConstRef)</span><br><span class="line">        .<span class="built_in">AddMemberFunc</span>(<span class="string">&quot;Concat&quot;</span>, &amp;Foo::Concat)</span><br><span class="line">        .<span class="built_in">AddMemberFunc</span>(<span class="string">&quot;MakeFloatPtr&quot;</span>, &amp;Foo::MakeFloatPtr);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">int</span> <span class="title">x</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> x_; &#125;</span><br><span class="line"></span><br><span class="line">  std::string name;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="type">int</span> x_&#123;<span class="number">0</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨å†Œç±»å‹ä¿¡æ¯çš„ä»£ç å°±åœ¨<code>MakeReflectable</code>ä¸­ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œé‡‡ç”¨äº†ä¸€ä¸ªå»ºé€ è€…æ¨¡å¼ï¼Œå¯ä»¥é“¾å¼çš„å¯¹æˆå‘˜å‡½æ•°å’Œæˆå‘˜å˜é‡è¿›è¡Œregisterã€‚é¦–å…ˆï¼Œåœ¨<code>AddClass</code>ä¸­ä¼šåˆ›å»ºå‡ºè¿™æ ·çš„ä¸€ä¸ªBuilder</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">details::TypeDescriptorBuilder&lt;T&gt; <span class="title">AddClass</span><span class="params">(<span class="type">const</span> std::string &amp;name)</span> </span>&#123;</span><br><span class="line">  details::TypeDescriptorBuilder&lt;T&gt; b&#123;name&#125;;</span><br><span class="line">  <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„Builderæœ€ç»ˆæƒ³è¦åˆ›å»ºçš„å°±æ˜¯ä¸€ä¸ª<code>TypeDescriptor</code>ï¼Œ</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TypeDescriptor</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="type">const</span> std::string &amp;<span class="title">name</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">const</span> std::vector&lt;MemberVariable&gt; &amp;<span class="title">member_vars</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> member_vars_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">const</span> std::vector&lt;MemberFunction&gt; &amp;<span class="title">member_funcs</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> member_funcs_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">MemberVariable <span class="title">GetMemberVar</span><span class="params">(<span class="type">const</span> std::string &amp;name)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;mv : member_vars_) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mv.<span class="built_in">name</span>() == name) &#123;</span><br><span class="line">        <span class="keyword">return</span> mv;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> MemberVariable&#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function">MemberFunction <span class="title">GetMemberFunc</span><span class="params">(<span class="type">const</span> std::string &amp;name)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;mf : member_funcs_) &#123;</span><br><span class="line">      <span class="keyword">if</span> (mf.<span class="built_in">name</span>() == name) &#123;</span><br><span class="line">        <span class="keyword">return</span> mf;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> MemberFunction&#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">RawTypeDescriptorBuilder</span>;</span><br><span class="line"></span><br><span class="line">  std::string name_;</span><br><span class="line">  std::vector&lt;MemberVariable&gt; member_vars_;</span><br><span class="line">  std::vector&lt;MemberFunction&gt; member_funcs_;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3><span id="æˆå‘˜å˜é‡">æˆå‘˜å˜é‡</span></h3><p>åœ¨<code>MemberVariable</code>çš„å®ç°ä¸­ï¼Œä½¿ç”¨äº†C++ä¸­çš„ä¸€ç§TypeEraserçš„æ–¹æ³•ï¼Œè¿™æ ·åœ¨ç¼–è¯‘æ—¶æˆ‘ä»¬ä¸éœ€è¦ç±»å‹ä¿¡æ¯ï¼Œå°†ç±»å‹ä¿¡æ¯çš„å¤„ç†æ”¾åœ¨äº†è¿è¡Œæ—¶è¿›è¡Œï¼Œä¹Ÿå°±æ˜¯å°†ç±»å‹çš„å¤„ç†äº¤ç»™äº†ä½¿ç”¨è€…ã€‚ä¹Ÿå°±æ˜¯è¯´è¿™é‡ŒMemberVariableæœ¬èº«ä¸åŒ…å«ä»»ä½•æ¨¡æ¿ï¼Œç±»å‹çš„ä¼ é€’åœ¨æ„é€ å‡½æ•°ä»¥åŠgetterå’Œsetterä¸­ä½¿ç”¨æ¨¡æ¿è¿›è¡Œæ¨å¯¼ã€‚<code>getter_</code>å’Œ<code>setter_</code>çš„å‚æ•°å’Œè¿”å›å€¼éƒ½ä½¿ç”¨<code>std::any</code>ï¼Œä¹Ÿå°±æ˜¯ä»»æ„ç±»å‹ï¼Œåœ¨æ›´å¤è€çš„ç‰ˆæœ¬ä¸­å¯ä»¥ç”¨<code>void*</code>ã€‚åœ¨<code>getter_</code>å’Œ<code>setter_</code>çš„å…·ä½“å®ç°ä¸­ï¼Œä½¿ç”¨<code>std::any_cast</code>å¯¹ç±»å‹è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬åŒ–ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MemberVariable</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MemberVariable</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="built_in">MemberVariable</span>(T C::*var) &#123;</span><br><span class="line">    getter_ = [var](std::any obj) -&gt; std::any &#123;</span><br><span class="line">      <span class="keyword">return</span> std::<span class="built_in">any_cast</span>&lt;<span class="type">const</span> C *&gt;(obj)-&gt;*var;</span><br><span class="line">    &#125;;</span><br><span class="line">    setter_ = [var](std::any obj, std::any val) &#123;</span><br><span class="line">      <span class="comment">// Syntax: https://stackoverflow.com/a/670744/12003165</span></span><br><span class="line">      <span class="comment">// `obj.*member_var`</span></span><br><span class="line">      <span class="keyword">auto</span> *self = std::<span class="built_in">any_cast</span>&lt;C *&gt;(obj);</span><br><span class="line">      self-&gt;*var = std::<span class="built_in">any_cast</span>&lt;T&gt;(val);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">const</span> std::string &amp;<span class="title">name</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">typename</span> C&gt;</span><br><span class="line">  <span class="function">T <span class="title">GetValue</span><span class="params">(<span class="type">const</span> C &amp;c)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">any_cast</span>&lt;T&gt;(<span class="built_in">getter_</span>(&amp;c));</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> T&gt;</span><br><span class="line">  <span class="function"><span class="type">void</span> <span class="title">SetValue</span><span class="params">(C &amp;c, T val)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">setter_</span>(&amp;c, val);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">RawTypeDescriptorBuilder</span>;</span><br><span class="line"></span><br><span class="line">  std::string name_;</span><br><span class="line">  std::function&lt;std::any(std::any)&gt; getter_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">  std::function&lt;<span class="type">void</span>(std::any, std::any)&gt; setter_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3><span id="æˆå‘˜å‡½æ•°">æˆå‘˜å‡½æ•°</span></h3><p>æˆå‘˜å‡½æ•°ä¸­ï¼Œç±»ä¼¼çš„ï¼Œä¹Ÿé‡‡ç”¨äº†TypeEraserçš„ç­–ç•¥ã€‚è¿™é‡Œçš„æ„é€ å‡½æ•°ä»ä¸€ä¸ªå˜æˆäº†å››ä¸ªï¼Œåˆ†åˆ«å¯¹åº” -<code>void func(params...)</code> -<code>return_type func(params...)</code> -<code>void func(params...) const</code> -<code>return_type func(params...) const</code>å››ç§æƒ…å†µã€‚å…·ä½“çš„å®ç°ä¸­ï¼Œ<code>C::*func</code>ä¸­<code>C</code>æ—¶ç±»çš„ç±»å‹ï¼Œ<code>func</code>æ—¶æˆå‘˜å‡½æ•°ï¼Œ<code>Args...</code>æ—¶å‚æ•°åˆ—è¡¨ã€‚ç»‘å®šå‡½æ•°åˆ°<code>fn_</code>ä¸Šè°ƒç”¨æ—¶ï¼Œé¦–å…ˆä¼šå°†ç±»<code>C</code>å’Œå‚æ•°åˆ—è¡¨<code>Args...</code>è½¬åŒ–æˆä¸€ä¸ª<code>tuple</code>çš„æŒ‡é’ˆï¼Œç„¶åè°ƒç”¨<code>std::apply</code>å‡½æ•°æ‰§è¡Œå‡½æ•°è¿”å›ç»“æœã€‚</p><p>å¦å¤–ï¼Œåœ¨è°ƒç”¨çš„æ—¶å€™ï¼Œä½¿ç”¨<code>std::reference_wrapper</code>å¯¹ç±»å‹è¿›è¡Œäº†å¼•ç”¨å°è£…ï¼Œç”¨äºç¡®ä¿è¯¥å¯¹è±¡æ˜¯ä½œä¸ºä¸€ä¸ªå¼•ç”¨ä¿å­˜åœ¨<code>tuple</code>ä¸­è€Œä¸æ˜¯å€¼ã€‚</p><blockquote><p><a href="https://en.cppreference.com/w/cpp/utility/tuple/make_tuple">std::make_tuple</a>Creates a tuple object, deducing the target type from the types ofarguments. For eachÂ <code>Ti</code>Â inÂ <code>Types...</code>, thecorresponding typeÂ <code>Vi</code>Â inÂ <code>VTypes...</code>Â isÂ <a href="http://en.cppreference.com/w/cpp/types/decay">std::decay</a>&lt;Ti&gt;::typeÂ unlessapplication ofÂ <a href="https://en.cppreference.com/w/cpp/types/decay" title="cpp/types/decay">std::decay</a>Â results inÂ <a href="http://en.cppreference.com/w/cpp/utility/functional/reference_wrapper">std::reference_wrapper</a>&lt;X&gt;Â forsome typeÂ <code>X</code>, in which case the deduced typeisÂ <code>X&amp;</code>.</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MemberFunction</span> &#123;</span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="built_in">MemberFunction</span>() = <span class="keyword">default</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> R, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MemberFunction</span><span class="params">(R (C::*func)(Args...))</span> </span>&#123;</span><br><span class="line">    fn_ = [<span class="keyword">this</span>, func](std::any obj_args) -&gt; std::any &#123;</span><br><span class="line">      <span class="keyword">using</span> <span class="type">tuple_t</span> = std::tuple&lt;C &amp;, Args...&gt;;</span><br><span class="line">      <span class="comment">// How to debug compile-time types...</span></span><br><span class="line">      <span class="comment">// static_assert(std::is_same&lt;tuple_t, void&gt;::value, &quot;Hoi!&quot;);</span></span><br><span class="line">      <span class="keyword">auto</span> *tp_ptr = std::<span class="built_in">any_cast</span>&lt;<span class="type">tuple_t</span> *&gt;(obj_args);</span><br><span class="line">      <span class="keyword">return</span> std::<span class="built_in">apply</span>(func, *tp_ptr);</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MemberFunction</span><span class="params">(<span class="type">void</span> (C::*func)(Args...))</span> </span>&#123;</span><br><span class="line">    fn_ = [<span class="keyword">this</span>, func](std::any obj_args) -&gt; std::any &#123;</span><br><span class="line">      <span class="keyword">using</span> <span class="type">tuple_t</span> = std::tuple&lt;C &amp;, Args...&gt;;</span><br><span class="line">      <span class="keyword">auto</span> *tp_ptr = std::<span class="built_in">any_cast</span>&lt;<span class="type">tuple_t</span> *&gt;(obj_args);</span><br><span class="line">      std::<span class="built_in">apply</span>(func, *tp_ptr);</span><br><span class="line">      <span class="keyword">return</span> std::any&#123;&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span> R, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MemberFunction</span><span class="params">(R (C::*func)(Args...) <span class="type">const</span>)</span> </span>&#123;</span><br><span class="line">    fn_ = [<span class="keyword">this</span>, func](std::any obj_args) -&gt; std::any &#123;</span><br><span class="line">      <span class="keyword">using</span> <span class="type">tuple_t</span> = std::tuple&lt;<span class="type">const</span> C &amp;, Args...&gt;;</span><br><span class="line">      <span class="comment">// How to debug compile-time types...</span></span><br><span class="line">      <span class="comment">// static_assert(std::is_same&lt;tuple_t, void&gt;::value, &quot;Hoi!&quot;);</span></span><br><span class="line">      <span class="keyword">auto</span> *tp_ptr = std::<span class="built_in">any_cast</span>&lt;<span class="type">tuple_t</span> *&gt;(obj_args);</span><br><span class="line">      <span class="keyword">return</span> std::<span class="built_in">apply</span>(func, *tp_ptr);</span><br><span class="line">    &#125;;</span><br><span class="line">    is_const_ = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line">  <span class="function"><span class="keyword">explicit</span> <span class="title">MemberFunction</span><span class="params">(<span class="type">void</span> (C::*func)(Args...) <span class="type">const</span>)</span> </span>&#123;</span><br><span class="line">    fn_ = [<span class="keyword">this</span>, func](std::any obj_args) -&gt; std::any &#123;</span><br><span class="line">      <span class="keyword">using</span> <span class="type">tuple_t</span> = std::tuple&lt;<span class="type">const</span> C &amp;, Args...&gt;;</span><br><span class="line">      <span class="keyword">auto</span> *tp_ptr = std::<span class="built_in">any_cast</span>&lt;<span class="type">tuple_t</span> *&gt;(obj_args);</span><br><span class="line">      std::<span class="built_in">apply</span>(func, *tp_ptr);</span><br><span class="line">      <span class="keyword">return</span> std::any&#123;&#125;;</span><br><span class="line">    &#125;;</span><br><span class="line">    is_const_ = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">const</span> std::string &amp;<span class="title">name</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> name_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="type">bool</span> <span class="title">is_const</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> is_const_;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">template</span> &lt;<span class="keyword">typename</span> C, <span class="keyword">typename</span>... Args&gt;</span><br><span class="line">  <span class="function">std::any <span class="title">Invoke</span><span class="params">(C &amp;c, Args &amp;&amp;... args)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (is_const_) &#123;</span><br><span class="line">      <span class="keyword">auto</span> tp = std::<span class="built_in">make_tuple</span>(std::<span class="built_in">reference_wrapper</span>&lt;<span class="type">const</span> C&gt;(c), args...);</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">fn_</span>(&amp;tp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">auto</span> tp = std::<span class="built_in">make_tuple</span>(std::<span class="built_in">reference_wrapper</span>&lt;C&gt;(c), args...);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">fn_</span>(&amp;tp);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">private</span>:</span><br><span class="line">  <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">RawTypeDescriptorBuilder</span>;</span><br><span class="line"></span><br><span class="line">  std::string name_;</span><br><span class="line">  <span class="type">bool</span> is_const_&#123;<span class="literal">false</span>&#125;;</span><br><span class="line">  std::function&lt;std::any(std::any)&gt; fn_&#123;<span class="literal">nullptr</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h3><span id="æœ€ç»ˆçš„æµ‹è¯•å’Œä½¿ç”¨">æœ€ç»ˆçš„æµ‹è¯•å’Œä½¿ç”¨</span></h3><p>æµ‹è¯•ä»£ç å¦‚ä¸‹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå¯¹äºconstreferenceå’Œreferenceçš„å‚æ•°ä¼ é€’ï¼Œéœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸€ä¸ª<code>std::ref</code>å’Œ<code>std::cref</code>çš„åŒ…è£…ï¼Œå¦åˆ™ä¼šcrashã€‚è¿™æ˜¯å› ä¸ºå¦åˆ™å­˜åœ¨tupleä¸­çš„ç±»å‹ä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œè¿™å’Œæˆ‘ä»¬å¸Œæœ›çš„æ˜¯å†²çªçš„ï¼Œæ‰€ä»¥ä¼šäº§ç”Ÿé—®é¢˜ã€‚</p><p>è¿™é‡Œè¿˜æœ‰å¦ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œä½œè€…é€šè¿‡ä¸€å±‚ä¸­é—´å±‚<code>ArgWrap</code>å¯¹å½¢å‚åˆ°å®å‚çš„è½¬åŒ–ä½œäº†å¤„ç†ï¼Œç»†èŠ‚å‚è€ƒä»£ç å’Œè§†é¢‘</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">TestFoo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;&gt;&gt;&gt; TestFoo\n&quot;</span> &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  Foo::<span class="built_in">MakeReflectable</span>();</span><br><span class="line">  <span class="keyword">auto</span> <span class="type">foo_t</span> = reflect::<span class="built_in">GetByName</span>(<span class="string">&quot;Foo&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;mv : <span class="type">foo_t</span>.<span class="built_in">member_vars</span>()) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;member var: &quot;</span> &lt;&lt; mv.<span class="built_in">name</span>() &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span> &amp;mf : <span class="type">foo_t</span>.<span class="built_in">member_funcs</span>()) &#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;member func: &quot;</span> &lt;&lt; mf.<span class="built_in">name</span>() &lt;&lt; <span class="string">&quot;, is_const=&quot;</span> &lt;&lt; mf.<span class="built_in">is_const</span>()</span><br><span class="line">              &lt;&lt; std::endl;</span><br><span class="line">  &#125;</span><br><span class="line">  std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  Foo f;</span><br><span class="line">  <span class="comment">// Test member variables</span></span><br><span class="line">  <span class="keyword">auto</span> name_var = <span class="type">foo_t</span>.<span class="built_in">GetMemberVar</span>(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">  name_var.<span class="built_in">SetValue</span>(f, std::string&#123;<span class="string">&quot;taichi&quot;</span>&#125;);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;f.name=&quot;</span> &lt;&lt; f.name &lt;&lt; std::endl;</span><br><span class="line">  <span class="keyword">auto</span> x_var = <span class="type">foo_t</span>.<span class="built_in">GetMemberVar</span>(<span class="string">&quot;x_&quot;</span>);</span><br><span class="line">  x_var.<span class="built_in">SetValue</span>(f, <span class="number">42</span>);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;f.x=&quot;</span> &lt;&lt; f.<span class="built_in">x</span>() &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Test member functions</span></span><br><span class="line">  <span class="keyword">auto</span> foo_make_float_ptr = <span class="type">foo_t</span>.<span class="built_in">GetMemberFunc</span>(<span class="string">&quot;MakeFloatPtr&quot;</span>);</span><br><span class="line">  <span class="keyword">auto</span> res = foo_make_float_ptr.<span class="built_in">Invoke</span>(f, <span class="number">123.4f</span>);</span><br><span class="line">  <span class="keyword">auto</span> float_sptr = std::any_cast&lt;std::shared_ptr&lt;<span class="type">float</span>&gt;&gt;(res);</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;MakeFloatPtr res: &quot;</span> &lt;&lt; *float_sptr &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  std::string hello_s&#123;<span class="string">&quot;hello&quot;</span>&#125;;</span><br><span class="line">  std::string world_s&#123;<span class="string">&quot; world&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> foo_pass_by_val = <span class="type">foo_t</span>.<span class="built_in">GetMemberFunc</span>(<span class="string">&quot;PassByValue&quot;</span>);</span><br><span class="line">  foo_pass_by_val.<span class="built_in">Invoke</span>(f, hello_s);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> foo_pass_by_cref = <span class="type">foo_t</span>.<span class="built_in">GetMemberFunc</span>(<span class="string">&quot;PassByConstRef&quot;</span>);</span><br><span class="line">  <span class="comment">// foo_pass_by_cref.Invoke(f, hello_s);  // Crash, value</span></span><br><span class="line">  <span class="comment">// foo_pass_by_cref.Invoke(f, std::ref(hello_s));  // Crash, non-const ref</span></span><br><span class="line">  foo_pass_by_cref.<span class="built_in">Invoke</span>(f, std::<span class="built_in">cref</span>(hello_s));  <span class="comment">// OK: const ref</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">auto</span> foo_concat = <span class="type">foo_t</span>.<span class="built_in">GetMemberFunc</span>(<span class="string">&quot;Concat&quot;</span>);</span><br><span class="line">  <span class="comment">// foo_concat.Invoke(f, hello_s, world_s);</span></span><br><span class="line">  res = foo_concat.<span class="built_in">Invoke</span>(f, std::<span class="built_in">cref</span>(hello_s), std::<span class="built_in">cref</span>(world_s));</span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;Concat got: &quot;</span> &lt;&lt; std::<span class="built_in">any_cast</span>&lt;std::string&gt;(res) &lt;&lt; std::endl;</span><br><span class="line">  std::cout &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">  std::cout &lt;&lt; <span class="string">&quot;&lt;&lt;&lt; TestFoo OK\n&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><ul><li><a href="https://blog.csdn.net/K346K346/article/details/51698184">æˆ‘æ‰€ç†è§£çš„C++ åå°„æœºåˆ¶_æ‹å–µå¤§é²¤é±¼çš„åšå®¢-CSDNåšå®¢_c++ åå°„</a></li><li><a href="https://www.bilibili.com/video/BV1MY4y1c7hU?vd_source=3ba69f5a040f08d144671fe461ae8b68">40åˆ†é’Ÿæ“ä¸€ä¸ª C++åå°„åº“ã€åŸç†ã€ç”¨æ³•ã€å®ç°éƒ½åœ¨è¿™é‡Œäº†ï¼ã€‘_å“”å“©å“”å“©_bilibili</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Cpp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cpp </tag>
            
            <tag> GameEngine </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾å½¢å­¦å…¥é—¨ç¬”è®°3: Path Tracing</title>
      <link href="/2022/10/05/gamegraphics/tu-xing-xue-ru-men-bi-ji-3-path-tracing/"/>
      <url>/2022/10/05/gamegraphics/tu-xing-xue-ru-men-bi-ji-3-path-tracing/</url>
      
        <content type="html"><![CDATA[<p>Path tracingç¬”è®°ä»¥åŠGames101ä½œä¸š7ä»£ç ç›¸å…³è§£è¯»ä»¥åŠå®ç°ã€‚ç¬”è®°åŒ…æ‹¬</p><ol type="1"><li>è¾å°„åº¦é‡å­¦ç›¸å…³æ¦‚å¿µ</li><li>æ¸²æŸ“æ–¹ç¨‹</li><li>è’™ç‰¹å¡æ´›ç§¯åˆ†</li><li>Path Tracingé€»è¾‘ã€‚</li></ol><p><span id="more"></span></p><h3><span id="è¾å°„åº¦é‡å­¦-radiometry">è¾å°„åº¦é‡å­¦ (Radiometry)</span></h3><ul><li><p>è¾å°„é€šé‡ (Radiant flux (power)) <span class="math inline">\(\Phi=\frac{\mathrm{d}Q}{\mathrm{d}t}\)</span>Energy per unit timeï¼Œè¡¨ç¤ºå•ä½æ—¶é—´å†…å…‰ç©¿è¿‡ä¸€ä¸ªæˆªé¢çš„å…‰èƒ½ã€‚</p></li><li><p>è¾å°„å¼ºåº¦ (Radiant intensity)ï¼Œ<span class="math inline">\(I(\omega)=\frac{\mathrm{d}\Phi}{\mathrm{d}\omega}\)</span>Power per unit solid angleï¼Œè¡¨ç¤ºå•ä½ç«‹ä½“è§’ä¸Šçš„è¾å°„é€šé‡ã€‚</p></li><li><p>è¾å°„ç‡ (Radiance)ï¼Œ<span class="math inline">\(L(\mathrmp,\omega)=\frac{\mathrm d^2\Phi(p,\omega)}{\mathrm d \omega\cdot\mathrmdA\cos\theta}\)</span> Power emitted, reflected, transmitted or receivedby a surface, per unit solid angle, per projected unitareaï¼Œè¡¨ç¤ºå•ä½ç«‹ä½“è§’ï¼Œå•ä½æŠ•å½±é¢ç§¯ä¸Šçš„è¾å°„é€šé‡ã€‚è¿™é‡Œå¤šå‡ºæ¥ä¸€ä¸ª<span class="math inline">\(\cos \theta\)</span>æ˜¯å› ä¸ºLamber's CosineLawï¼Œå³é˜³å…‰åœ¨æ–œç…§çš„æ—¶å€™å¼ºåº¦ä¼šç”±äºå€¾è§’å˜æˆåŸæ¥çš„<span class="math inline">\(\cos \theta\)</span>å€ã€‚</p></li><li><p>è¾ç…§åº¦ (Irradiance)ï¼Œ<span class="math inline">\(E(\mathrm{x})=\frac{\mathrm d\Phi(\mathrmx)}{\mathrm d A}\)</span> Power per unit area incident on a surfacepointï¼Œè¡¨ç¤ºå•ä½é¢ç§¯ä¸Šçš„è¾å°„é€šé‡ã€‚è¿™é‡Œæœ‰ä¸€ç§è®°å¿†æ–¹æ³•ï¼Œåœ¨Games104ä¸Šå­¦åˆ°çš„ï¼Œå°†Irradianceæ‹†åˆ†æˆIr(In)å’ŒRadianceè®°ä¸ºè¿›å…¥åˆ°è¡¨é¢çš„å…‰ç…§å¼ºåº¦ã€‚</p></li><li><p>ç«‹ä½“è§’ (Solid Angles)</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20221005201356513.png"></p></li></ul><h3><span id="bidirectionalreflectance-distribution-function-brdf">BidirectionalReflectance Distribution Function (BRDF)</span></h3><ul><li>æ¸²æŸ“æ–¹ç¨‹ (Rendering Equation) <span class="math display">\[L_o(p,\omega_0)=L_e(p,\omega_0)+\int_{\Omega+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_0)(n\cdot\omega_i)\mathrmd\omega_i\]</span>å…¶ä¸­ç¬¬ä¸€é¡¹è¡¨ç¤ºç‰©ä½“æœ¬èº«çš„å‘å‡ºçš„å…‰ç…§å¼ºåº¦ï¼Œç¬¬äºŒé¡¹çš„ç§¯åˆ†æ‰€åŒ…æ‹¬çš„å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„åå°„å‡½æ•°(Reflection Function)ï¼Œå³ <span class="math display">\[L_r(\mathrm p,\omega_r)=\int_{\Omega+}L_i(p,\omega_i)f_r(p,\omega_i,\omega_0)\cos\theta_i\mathrmd\omega_i\]</span>å…¶ä¸­ç¬¬ä¸€é¡¹ä¸ºå…¥å°„æ–¹å‘çš„Radianceï¼Œä»£è¡¨ä»å•ä½ç«‹ä½“è§’æ–¹å‘å…¥å°„åˆ°å•ä½é¢ç§¯ä¸Šçš„å…‰ç…§å¼ºåº¦ï¼Œç¬¬äºŒé¡¹å°±æ˜¯åŒå‘åå°„åˆ†å¸ƒå‡½æ•°ï¼Œä»–è¡¨ç¤ºä»¥ä¸‹æ¯”å€¼<span class="math display">\[f_r(\omega_i\rightarrow\omega_r)=\frac{\mathrm dL_r(\omega_r)}{\mathrmdE_i(\omega_i)}=\frac{\mathrmdL_r(\omega_r)}{L_i(\omega_i)\cos\theta_i\mathrmd\omega_i}~~[\frac{1}{\text{sr}}]\]</span>ä¹Ÿå°±æ˜¯å‡ºå°„å…‰Radianceä¸å…¥å°„å…‰Irradianceçš„æ¯”å€¼ï¼Œä¹Ÿå°±æ˜¯ä»£è¡¨äº†åœ¨å„ä¸ªæ–¹å‘ä¸Šå¤šå°‘å…‰ç…§ä¼šè¢«åå°„å‡ºå»ã€‚è¿™é‡Œçš„ç§¯åˆ†æ˜¯å¯¹å…¥å°„å…‰çš„Radianceè¿›è¡Œç§¯åˆ†ï¼Œå¾—åˆ°çš„å°±æ˜¯å…¥å°„å…‰åœ¨åŠçƒé¢ä¸Šçš„Irradianceï¼Œç„¶åå’ŒBRDFç›¸ä¹˜å¾—åˆ°çš„å°±æ˜¯åå°„å‡ºçš„åœ¨å•ä½ç«‹ä½“è§’ä¸Šçš„Radianceã€‚</li></ul><h3><span id="è’™ç‰¹å¡æ´›ç§¯åˆ†-monte-carlointegration">è’™ç‰¹å¡æ´›ç§¯åˆ† (Monte CarloIntegration)</span></h3><ul><li>Monte Carlo estimator <span class="math inline">\(F_N=\frac{1}{N}\sum^N_{i=1}\frac{f(X_i)}{p(X_i)}\)</span>,Example, Basic (Uniform) Monte Carlo estimator <span class="math inline">\(F_N=\frac{b-a}{N}\sum_{i=1}^Nf(X_i)\)</span></li><li>Monte Carlo Integration <span class="math inline">\(\int f(x)\mathrmdx=\frac{1}{N}\sum_{i=1}^N\frac{f(X_i)}{p(X_i)}\)</span> The moresamples, the less variance.</li></ul><h3><span id="è·¯å¾„è¿½è¸ª-path-tracing">è·¯å¾„è¿½è¸ª (Path Tracing)</span></h3><p>Whitted-styleå…‰çº¿è¿½è¸ªå§‹ç»ˆé‡‡ç”¨é•œé¢åå°„ï¼Œåœ¨å…‰çº¿ä¸diffuseè¡¨é¢ç›¸äº¤æ—¶åœæ­¢åå°„ï¼Œè¿™ä¸€å‡è®¾ä¼šé€ æˆä¸€äº›é—®é¢˜ã€‚é¦–å…ˆï¼Œæ¯”å¦‚è¯´è¯¸å¦‚Glossy(æ„Ÿè§‰ç±»ä¼¼ç£¨ç ‚)çš„æ•ˆæœå°±æ— æ³•è¡¨ç°å‡ºæ¥ã€‚å…¶æ¬¡ï¼Œç”±äºä¸åœ¨diffuseè¡¨é¢è¿›è¡Œåå°„ï¼Œç‰©ä½“ä¹‹é—´ç”±äºå…‰çº¿åå°„å½¢æˆçš„ç°è±¡æ¯”å¦‚è¯´åº·å¥ˆå°”Boxä¸­çš„å¢™é¢ä¼šæ˜ å°„å‡ºå·¦å³ä¸¤é¢å¢™çš„çº¢ç»¿ä¸¤ç§é¢œè‰²(å¦‚ä¸‹å›¾)å°±æ— æ³•è¡¨ç°å‡ºæ¥ã€‚</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20221005213331204.png"></p><p>Path tracingä½¿ç”¨Rendering Equationè¿›è¡Œå…‰ç…§çš„è®¡ç®—ã€‚åœ¨è®¡ç®—RenderingEquationä¸­çš„ç§¯åˆ†éƒ¨åˆ†æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Monte CarloIntegrationè®¡ç®—ã€‚ä¸€ä¸ªç®€å•çš„Monte Carloçš„æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤º (DirectIllumination)ï¼Œå…¶ä¸­çš„pdfæœ€ç›´è§‚çš„åŠæ³•æˆ‘ä»¬å¯ä»¥è§†ä¸ºuniformçš„ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(\mathrm{pdf}=\frac{1}{2\pi}\)</span>ã€‚</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20221005214101763.png"></p><p>ä»¥ä¸Šæ˜¯æœ€ç®€å•çš„ç›´æ¥å…‰ç…§çš„è’™ç‰¹å¡æ´›ç§¯åˆ†ï¼Œç„¶åæˆ‘ä»¬å†åŠ ä¸Šé€’å½’çš„é—´æ¥å…‰ç…§ä»¥åŠæ§åˆ¶é€’å½’æ·±åº¦å°±å®Œæˆäº†æœ€ç»ˆçš„PathTracingã€‚ä¸ºäº†æ§åˆ¶æ·±åº¦ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ç§å«åšä¿„ç½—æ–¯è½®ç›˜èµŒ (RussianRoulette)çš„æ–¹æ³•ã€‚éå¸¸ç®€å•ï¼Œè¿™ç§æ–¹æ³•å°±æ˜¯åœ¨æ¯æ¬¡å…‰çº¿è¿›è¡Œåå°„çš„æ—¶å€™è¿›è¡Œä¸€æ¬¡éšæœºé€‰æ‹©ï¼Œpçš„æ¦‚ç‡ç»§ç»­é€’å½’ï¼Œ(1-p)çš„æ¦‚ç‡åœæ­¢ï¼Œå¦‚æœç»§ç»­åå°„ï¼Œåˆ™æˆ‘ä»¬è®¡ç®—åå°„çš„å…‰ç…§å¼ºåº¦ä¸º<span class="math inline">\(\frac{L_r(p,\omega_r)}{p}\)</span>ï¼Œè¿™æ ·æˆ‘ä»¬æœ€åæ ¹æ®æ•°å­¦æœŸæœ›å¾—åˆ°çš„å…‰ç…§å¼ºåº¦ä»ç„¶æ˜¯<span class="math inline">\(L_r(p,\omega_r)\)</span>ã€‚ä½¿ç”¨åRRçš„PathTracingä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20221005225016368.png"></p><p>æœ€åè¿˜æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼Œä½¿ç”¨ä»¥ä¸Šæ–¹æ³•è¿›è¡Œé‡‡æ ·çš„æ•ˆç‡å®é™…ä¸Šæ˜¯ä¸é«˜çš„ï¼Œå› ä¸ºå¾ˆå¤šå…‰çº¿å®é™…ä¸Šæ˜¯åå°„ä¸åˆ°å…‰æºä¸Šçš„ï¼Œé‚£æ ·å°±ä¼šé€ æˆå¾ˆå¤šæµªè´¹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦å¤–ä¸€ç§é‡‡æ ·æ–¹å¼ï¼ŒSamplingtheLightï¼Œä»å…‰æºå¤„é‡‡æ ·ã€‚ä¸ºäº†å®ç°å…‰æºé‡‡æ ·ï¼Œæˆ‘ä»¬å¯ä»¥é‡å†™åå°„æ–¹ç¨‹ï¼Œå°†å¯¹å…¥å°„è§’åº¦<span class="math inline">\(\omega\)</span>çš„ç§¯åˆ†è½¬åŒ–ä¸ºå¯¹å…‰æºé¢ç§¯<span class="math inline">\(A\)</span>çš„ç§¯åˆ†ï¼Œç”±äº<span class="math inline">\(\mathrm d\omega=\frac{\mathrmdA\cos\theta&#39;}{\Vert x&#39;-x\Vert^2}\)</span>(ç”±ç«‹ä½“è§’çš„å®šä¹‰å¾—å‡º)ï¼Œå› æ­¤ <span class="math display">\[\begin{align}L_r(\mathrmp,\omega_r)&amp;=\int_{\Omega+}L_i(x,\omega_i)f_r(x,\omega_i,\omega_0)\cos\theta_i\mathrmd\omega_i \\    &amp;=\int_{A}L_i(x,\omega_i)f_r(p,\omega_i,\omega_0)\frac{\cos\theta_i\cos\theta&#39;_i}{\Vertx&#39;-x\Vert^2}\mathrm d\omega_i\end{align}\]</span> <img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20221005230600428.png"></p><p>æœ€ç»ˆç‰ˆçš„Path Tracingä¼ªä»£ç å¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20221005230708399.png"></p><h3><span id="ä½œä¸š7">ä½œä¸š7</span></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸Šä¸€æ¬¡ä½œä¸šçš„å‡ ä¸ªå‡½æ•°çš„å®ç°å¤åˆ¶ç²˜è´´åˆ°è¿™é‡Œæ¥ï¼ŒåŒ…æ‹¬<code>Triangle::getIntersection()</code>inTriangle.hppï¼Œ<code>IntersectP(const Ray&amp; ray, const Vector3f&amp; invDir, const std::array&lt;int, 3&gt;&amp; dirIsNeg)</code>inBounds3.hppä»¥åŠ<code>getIntersection(BVHBuildNode* node, const Ray ray)</code>in BVH.cppã€‚ä»£ç å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Triangle.hpp</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> Intersection <span class="title">Triangle::getIntersection</span><span class="params">(Ray ray)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Intersection inter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dotProduct</span>(ray.direction, normal) &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    <span class="type">double</span> u, v, t_tmp = <span class="number">0</span>;</span><br><span class="line">    Vector3f pvec = <span class="built_in">crossProduct</span>(ray.direction, e2);</span><br><span class="line">    <span class="type">double</span> det = <span class="built_in">dotProduct</span>(e1, pvec);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(det) &lt; EPSILON)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> det_inv = <span class="number">1.</span> / det;</span><br><span class="line">    Vector3f tvec = ray.origin - v0;</span><br><span class="line">    u = <span class="built_in">dotProduct</span>(tvec, pvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (u &lt; <span class="number">0</span> || u &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    Vector3f qvec = <span class="built_in">crossProduct</span>(tvec, e1);</span><br><span class="line">    v = <span class="built_in">dotProduct</span>(ray.direction, qvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (v &lt; <span class="number">0</span> || u + v &gt; <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    t_tmp = <span class="built_in">dotProduct</span>(e2, qvec) * det_inv;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// find ray triangle intersection</span></span><br><span class="line">    <span class="keyword">if</span> (t_tmp &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    inter.happened = <span class="literal">true</span>;</span><br><span class="line">    inter.distance = t_tmp;</span><br><span class="line">    inter.coords = <span class="built_in">ray</span>(t_tmp);</span><br><span class="line">    inter.normal = normal;</span><br><span class="line">    inter.obj = <span class="keyword">this</span>;</span><br><span class="line">    inter.m = m;</span><br><span class="line">    <span class="keyword">return</span> inter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bounds3.hpp</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bounds3::IntersectP</span><span class="params">(<span class="type">const</span> Ray&amp; ray, <span class="type">const</span> Vector3f&amp; invDir,</span></span></span><br><span class="line"><span class="params"><span class="function">                                <span class="type">const</span> std::array&lt;<span class="type">int</span>, <span class="number">3</span>&gt;&amp; dirIsNeg)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// invDir: ray direction(x,y,z), invDir=(1.0/x,1.0/y,1.0/z), use this because Multiply is faster that Division</span></span><br><span class="line">    <span class="comment">// dirIsNeg: ray direction(x,y,z), dirIsNeg=[int(x&gt;0),int(y&gt;0),int(z&gt;0)], use this to simplify your logic</span></span><br><span class="line">    <span class="comment">// test if ray bound intersects</span></span><br><span class="line">    Vector3f t_min = (<span class="keyword">this</span>-&gt;pMin - ray.origin) * invDir;</span><br><span class="line">    Vector3f t_max = (<span class="keyword">this</span>-&gt;pMax - ray.origin) * invDir;</span><br><span class="line">    <span class="keyword">if</span> (!dirIsNeg[<span class="number">0</span>]) std::<span class="built_in">swap</span>(t_min.x, t_max.x);</span><br><span class="line">    <span class="keyword">if</span> (!dirIsNeg[<span class="number">1</span>]) std::<span class="built_in">swap</span>(t_min.y, t_max.y);</span><br><span class="line">    <span class="keyword">if</span> (!dirIsNeg[<span class="number">2</span>]) std::<span class="built_in">swap</span>(t_min.z, t_max.z);</span><br><span class="line">    <span class="type">float</span> t_enter = <span class="built_in">fmax</span>(t_min.x, <span class="built_in">fmax</span>(t_min.y, t_min.z));</span><br><span class="line">    <span class="type">float</span> t_exit = <span class="built_in">fmin</span>(t_max.x, <span class="built_in">fmin</span>(t_max.y, t_max.z));</span><br><span class="line">    <span class="keyword">return</span> t_enter &lt;= t_exit &amp;&amp; t_exit &gt;= <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//BVH.cpp</span></span><br><span class="line"><span class="function">Intersection <span class="title">BVHAccel::getIntersection</span><span class="params">(BVHBuildNode* node, <span class="type">const</span> Ray&amp; ray)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Intersection inter;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">nullptr</span>)</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    std::array&lt;<span class="type">int</span>, 3&gt; dirIsNeg = &#123;<span class="built_in">int</span>(ray.direction.x &gt; <span class="number">0</span>), <span class="built_in">int</span>(ray.direction.y &gt; <span class="number">0</span>), <span class="built_in">int</span>(ray.direction.z &gt; <span class="number">0</span>)&#125;;</span><br><span class="line">    <span class="keyword">if</span> (!node-&gt;bounds.<span class="built_in">IntersectP</span>(ray, ray.direction_inv, dirIsNeg))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> inter; <span class="comment">// No intersection in the current node</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node-&gt;left == <span class="literal">nullptr</span> &amp;&amp; node-&gt;right == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;object == <span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;NULL Object Error&quot;</span>);</span><br><span class="line">        inter = node-&gt;object-&gt;<span class="built_in">getIntersection</span>(ray);</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    &#125;</span><br><span class="line">    Intersection left_inter = <span class="built_in">getIntersection</span>(node-&gt;left, ray);</span><br><span class="line">    Intersection right_inter = <span class="built_in">getIntersection</span>(node-&gt;right, ray);</span><br><span class="line">    <span class="keyword">return</span> left_inter.distance &lt; right_inter.distance ? left_inter : right_inter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæˆåç¡®ä¿ç¼–è¯‘è¿è¡Œéƒ½æ²¡æœ‰é—®é¢˜åï¼Œæˆ‘ä»¬å†æ­£å¼å¼€å§‹è¿™æ¬¡ä½œä¸šçš„å®ç°ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹<code>castRay(const Ray ray, int depth)</code>in Scene.cppè¿›è¡Œå®ç°ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤º</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Vector3f <span class="title">Scene::castRay</span><span class="params">(<span class="type">const</span> Ray &amp;ray, <span class="type">int</span> depth)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector3f L_dir = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;, L_indir = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    Intersection intersection = Scene::<span class="built_in">intersect</span>(ray);</span><br><span class="line">    <span class="keyword">if</span> (!intersection.happened)</span><br><span class="line">        <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">    <span class="keyword">if</span> (intersection.m-&gt;<span class="built_in">hasEmission</span>())</span><br><span class="line">        <span class="keyword">return</span> intersection.m-&gt;<span class="built_in">getEmission</span>();</span><br><span class="line"></span><br><span class="line">    Intersection light_pos;</span><br><span class="line">    <span class="type">float</span> light_pdf = <span class="number">0.0f</span>;</span><br><span class="line">    <span class="built_in">sampleLight</span>(light_pos, light_pdf);</span><br><span class="line">    Vector3f collision_light = light_pos.coords - intersection.coords;</span><br><span class="line">    <span class="type">float</span> dis = <span class="built_in">dotProduct</span>(collision_light, collision_light);</span><br><span class="line">    Vector3f collision_light_dir = collision_light.<span class="built_in">normalized</span>();</span><br><span class="line">    <span class="function">Ray <span class="title">light_to_object_ray</span><span class="params">(intersection.coords, collision_light_dir)</span></span>;</span><br><span class="line">    Intersection light_ray_inter = Scene::<span class="built_in">intersect</span>(light_to_object_ray);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> f_r = intersection.m -&gt; <span class="built_in">eval</span>(ray.direction, collision_light_dir, intersection.normal);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// Pay attention to the precision here</span></span><br><span class="line">    <span class="keyword">if</span> (light_ray_inter.distance - collision_light.<span class="built_in">norm</span>() &gt; <span class="number">-0.005</span>)&#123;</span><br><span class="line">        L_dir = light_pos.emit * f_r * <span class="built_in">dotProduct</span>(collision_light_dir, intersection.normal)</span><br><span class="line">                * <span class="built_in">dotProduct</span>(-collision_light_dir, light_pos.normal) / dis / light_pdf;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">get_random_float</span>() &gt; RussianRoulette)</span><br><span class="line">        <span class="keyword">return</span> L_dir;</span><br><span class="line"></span><br><span class="line">    Vector3f w0 = intersection.m -&gt; <span class="built_in">sample</span>(ray.direction, intersection.normal).<span class="built_in">normalized</span>();</span><br><span class="line">    <span class="function">Ray <span class="title">object_to_object_ray</span><span class="params">(intersection.coords, w0)</span></span>;</span><br><span class="line">    Intersection islight = Scene::<span class="built_in">intersect</span>(object_to_object_ray);</span><br><span class="line">    <span class="keyword">if</span> (islight.happened &amp;&amp; !islight.m-&gt;<span class="built_in">hasEmission</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">float</span> pdf = intersection.m-&gt;<span class="built_in">pdf</span>(ray.direction, w0, intersection.normal);</span><br><span class="line">        f_r = intersection.m-&gt;<span class="built_in">eval</span>(ray.direction, w0, intersection.normal);</span><br><span class="line">        L_indir = <span class="built_in">castRay</span>(object_to_object_ray, depth + <span class="number">1</span>) * f_r * <span class="built_in">dotProduct</span>(w0, intersection.normal) / pdf / RussianRoulette;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> L_dir + L_indir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€ç»ˆç”Ÿæˆçš„å›¾ç‰‡ï¼Œè¿™é‡Œä¸ºäº†æ•ˆæœå¥½ä¸€ç‚¹æˆ‘è·‘äº†128çš„SPPï¼Œå¤§æ¦‚éœ€è¦è·‘å‡ ä¸ªå°æ—¶ï¼Œå¦‚ä¸‹å›¾</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/output-128.jpg"></p><h3><span id="å¤šçº¿ç¨‹éƒ¨åˆ†">å¤šçº¿ç¨‹éƒ¨åˆ†</span></h3><p>å¤šçº¿ç¨‹éƒ¨åˆ†åªéœ€è¦æŠŠ<code>render()</code>å‡½æ•°ä¸­éƒ¨åˆ†æ¸²æŸ“ç›¸å…³ä»£ç ä¿®æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œå¯¹å¤šè¡Œåƒç´ è¿›è¡ŒåŒæ—¶æ¸²æŸ“ã€‚C++å¤šçº¿ç¨‹æ•™ç¨‹å¯ä»¥å‚è€ƒ<a href="https://blog.csdn.net/sjc_0910/article/details/118861539">C++11å¤šçº¿ç¨‹ï¼ˆstd::threadï¼‰è¯¦è§£_std::threadæŸ¥çº¿ç¨‹åç§°_sjc_0910çš„åšå®¢-CSDNåšå®¢</a>ã€‚ä½¿ç”¨å¤šçº¿ç¨‹çš„é€Ÿåº¦å¯ä»¥çœ‹åˆ°æ˜¾è‘—æå‡<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> spp = <span class="number">64</span>;  </span><br><span class="line">std::cout &lt;&lt; <span class="string">&quot;SPP: &quot;</span> &lt;&lt; spp &lt;&lt; <span class="string">&quot;\n&quot;</span>;  </span><br><span class="line"><span class="type">const</span> <span class="type">int</span> thread_num = <span class="number">16</span>;  </span><br><span class="line">std::thread th[thread_num];  </span><br><span class="line">std::atomic_int process = <span class="number">0</span>;  </span><br><span class="line"><span class="type">int</span> times = scene.height / thread_num;  </span><br><span class="line"><span class="keyword">auto</span> func = [&amp;](<span class="type">uint32_t</span> y_min, <span class="type">uint32_t</span> y_max) &#123;  </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> j = y_min; j &lt; y_max; ++j) &#123;  </span><br><span class="line">        <span class="type">int</span> m = j * scene.width;  </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; scene.width; ++i) &#123;  </span><br><span class="line">            <span class="comment">// generate primary ray direction  </span></span><br><span class="line">            <span class="keyword">auto</span> x = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;((<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">double</span>) scene.width - <span class="number">1</span>) * imageAspectRatio * scale);  </span><br><span class="line">            <span class="keyword">auto</span> y = <span class="built_in">static_cast</span>&lt;<span class="type">float</span>&gt;((<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">double</span>) scene.height) * scale);  </span><br><span class="line">  </span><br><span class="line">            Vector3f dir = <span class="built_in">normalize</span>(<span class="built_in">Vector3f</span>(-x, y, <span class="number">1</span>));  </span><br><span class="line">  </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; spp; k++) &#123;  </span><br><span class="line">                framebuffer[m] += scene.<span class="built_in">castRay</span>(<span class="built_in">Ray</span>(eye_pos, dir), <span class="number">0</span>) / spp;  </span><br><span class="line">            &#125;  </span><br><span class="line">            m++;  </span><br><span class="line">        &#125;  </span><br><span class="line">        mtx.<span class="built_in">lock</span>();  </span><br><span class="line">        process++;  </span><br><span class="line">        <span class="built_in">UpdateProgress</span>((<span class="type">float</span>) process / (<span class="type">float</span>) scene.height);  </span><br><span class="line">        mtx.<span class="built_in">unlock</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;;  </span><br><span class="line"><span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; thread_num; ++i) &#123;  </span><br><span class="line">    th[i] = std::<span class="built_in">thread</span>(func, i * times, (i + <span class="number">1</span>) * times);  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; thread_num; ++i) &#123;  </span><br><span class="line">    th[i].<span class="built_in">join</span>();  </span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Join thread &quot;</span> &lt;&lt; i &lt;&lt; std::endl;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="built_in">UpdateProgress</span>(<span class="number">1.f</span>);</span><br></pre></td></tr></table></figure></p><h3><span id="å¾®è¡¨é¢æ¨¡å‹">å¾®è¡¨é¢æ¨¡å‹</span></h3><p>å¦å¤–ï¼Œé™¤äº†å¤šçº¿ç¨‹è¿˜æœ‰ä¸€ä¸ªæé«˜éƒ¨åˆ†æ˜¯å¾®è¡¨é¢æ¨¡å‹ï¼Œè¿™ä¸ªæ¨¡å‹åº”è¯¥åªéœ€è¦å»æ”¹ä¸€ä¸‹Materialç›¸å…³çš„éƒ¨åˆ†ï¼Œåªä¸è¿‡è¿™éƒ¨åˆ†ç›®å‰è¿˜æ˜¯æœ‰ç‚¹ä¸å¤ªç†Ÿæ‚‰ï¼Œæ‰“ç®—ç­‰åˆ°Games202ä¹‹åæ‰å›è¿‡å¤´æ¥åšå®Œã€‚</p><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><p><a href="https://blog.csdn.net/qq_41765657/article/details/121942469">GAMES101:ä½œä¸š7_å—é…’çŒ«çš„åšå®¢-CSDNåšå®¢_games101ä½œä¸š7</a><a href="https://blog.csdn.net/sjc_0910/article/details/118861539">C++11å¤šçº¿ç¨‹ï¼ˆstd::threadï¼‰è¯¦è§£_std::threadæŸ¥çº¿ç¨‹åç§°_sjc_0910çš„åšå®¢-CSDNåšå®¢</a></p>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cpp </tag>
            
            <tag> å›¾å½¢å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Latexçš„ä½¿ç”¨è¯¦è§£ç¬”è®°(å¸¸ç”¨æ•°å­¦ç¬¦å·ã€å›¾ç‰‡è¡¨æ ¼ç­‰)æŒç»­æ›´æ–°</title>
      <link href="/2022/09/30/other/late-yu-fa-bi-ji/"/>
      <url>/2022/09/30/other/late-yu-fa-bi-ji/</url>
      
        <content type="html"><![CDATA[<p>æœ¬ç¯‡ç¬”è®°ç”¨æ¥è®°å½•åœ¨ä½¿ç”¨LaTeXè¿‡ç¨‹ä¸­ç»å¸¸ç¢°åˆ°çš„LaTeXæ•°å­¦ç¬¦å·ä»¥åŠä¸€äº›åŸºç¡€çš„å¸¸ç”¨çš„æ“ä½œæ¯”å¦‚æ·»åŠ å›¾ç‰‡ï¼Œæ·»åŠ ä»£ç ï¼Œå¦‚æœæœ‰çš„è¯è¿˜ä¼šæ”¶è—ä¸€äº›æ¯”è¾ƒå®ç”¨çš„æ¨¡æ¿æ¯”å¦‚CVæ¨¡æ¿ï¼Œä½œä¸šæ¨¡æ¿è®ºæ–‡æ¨¡æ¿ç­‰ç­‰ã€‚æŒç»­æ›´æ–°â€¦â€¦</p><p><span id="more"></span></p><h1><span id="latexæ•°å­¦"><span class="math inline">\(\LaTeX\)</span>æ•°å­¦</span></h1><p>ä¸ºäº†ä½¿ç”¨ AMS-LaTeX æä¾›çš„æ•°å­¦åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å¯¼è¨€åŒºåŠ è½½<code>amsmath</code> å®åŒ…ï¼š</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;amsmath&#125;</span><br></pre></td></tr></table></figure><p>LaTeX çš„æ•°å­¦æ¨¡å¼æœ‰ä¸¤ç§ï¼šè¡Œå†…æ¨¡å¼ (inline) å’Œè¡Œé—´æ¨¡å¼(display)ã€‚å‰è€…åœ¨æ­£æ–‡çš„è¡Œæ–‡ä¸­ï¼Œæ’å…¥æ•°å­¦å…¬å¼ï¼›åè€…ç‹¬ç«‹æ’åˆ—å•ç‹¬æˆè¡Œï¼Œå¹¶è‡ªåŠ¨å±…ä¸­ã€‚</p><p>åœ¨è¡Œæ–‡ä¸­ï¼Œä½¿ç”¨<strong><code>$ ... $</code>å¯ä»¥æ’å…¥è¡Œå†…å…¬å¼</strong>ï¼Œä½¿ç”¨ <code>\[ ... \]</code>å¯ä»¥æ’å…¥è¡Œé—´å…¬å¼ï¼Œå¦‚æœéœ€è¦å¯¹è¡Œé—´å…¬å¼è¿›è¡Œç¼–å·ï¼Œåˆ™å¯ä»¥ä½¿ç”¨<code>equation</code> ç¯å¢ƒï¼š</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line">...</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br></pre></td></tr></table></figure><h2><span id="ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ç‰¹æ®Šç¬¦å·æ•´ç†">ä¸€äº›æ¯”è¾ƒå¸¸ç”¨çš„ç‰¹æ®Šç¬¦å·æ•´ç†</span></h2><ul><li><p>å„ç±»å¸Œè…Šå­—æ¯ç¼–è¾‘è¡¨</p><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>Î±</td><td>Î²</td><td>Ï‰</td><td><span class="math inline">\(\Theta\)</span></td><td><span class="math inline">\(\Gamma\)</span></td><td><span class="math inline">\(\Omega\)</span></td></tr></tbody></table></li><li><p>ä¸Šä¸‹æ ‡</p><p>â€‹ ä¸Šæ ‡ï¼š ^ å¦‚ <span class="math inline">\(x^2\)</span> â€‹ ä¸‹æ ‡ï¼š _ å¦‚<span class="math inline">\(x_2\)</span> â€‹ä¸Šä¸‹æ ‡å¦‚æœå¤šäºä¸€ä¸ªå­—æ¯æˆ–ç¬¦å·,éœ€è¦ç”¨ä¸€å¯¹ {} æ‹¬èµ·æ¥ã€‚</p></li><li><p>æ ¹å·ï¼š å¦‚<code>$sqrt[n]&#123;5&#125;</code>ä¸º<span class="math inline">\(\sqrt[n]5\)</span></p></li><li><p>çœç•¥å·ï¼š<code>$\dots \cdots$</code>åˆ†åˆ«ä¸º<span class="math inline">\(\dots \cdots\)</span></p></li><li><p>è¿ç®—ç¬¦ å°çš„è¿ç®—ç¬¦(operator)ä¾‹å¦‚ + - */ç­‰å¯ä»¥ç›´æ¥è¾“å…¥ï¼Œå…¶ä»–ç‰¹æ®Šçš„æœ‰</p><table><colgroup><col style="width: 7%"><col style="width: 11%"><col style="width: 7%"><col style="width: 9%"><col style="width: 7%"><col style="width: 7%"><col style="width: 7%"><col style="width: 7%"><col style="width: 7%"><col style="width: 13%"><col style="width: 11%"></colgroup><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>Â±</td><td>Ã—</td><td>Ã·</td><td>â‹…</td><td>âˆ©</td><td>âˆª</td><td>â‰¥</td><td>â‰¤</td><td>â‰ </td><td>â‰ˆ</td><td>â‰¡</td></tr></tbody></table><p>æ±‚å’Œï¼š<code>\sum_1^n</code>: <span class="math inline">\(\sum_1^n\)</span> ç§¯åˆ†ï¼š<code>\int_1^n</code>:<span class="math inline">\(\int_1^n\)</span>æé™ï¼š<code>lim_&#123;x \to \infty&#125;</code>: <span class="math inline">\(lim_{x \to \infty}\)</span>åˆ†æ•°çš„è¡¨ç¤ºï¼š<code>\frac&#123;&#125;&#123;&#125;</code>å¦‚ <span class="math inline">\(\frac{3}{8}\)</span></p></li><li><p>å­—æ¯çš„ç‰¹æ®Šæ ‡è®°</p><p>å¹³å‡æ•°: <code>\overline&#123;mean&#125;</code> or <code>\bar x</code>: <span class="math inline">\(\overline{mean} \text{ or } \bar m\)</span></p><p>Hat: <code>\hat&#123;\theta&#125;</code>: <span class="math inline">\(\hat{\theta}\)</span></p></li><li><p>çŸ©é˜µä¸è¡Œåˆ—å¼<code>$$\begin&#123;matrix&#125;â€¦\end&#123;matrix&#125;$$</code>ï¼Œä½¿ç”¨&amp;åˆ†éš”åŒè¡Œå…ƒç´ ï¼Œã€‚å¦‚ï¼š</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;matrix&#125;</span><br><span class="line">    1 <span class="built_in">&amp;</span> x <span class="built_in">&amp;</span> x<span class="built_in">^</span>2 <span class="keyword">\\</span></span><br><span class="line">    1 <span class="built_in">&amp;</span> y <span class="built_in">&amp;</span> y<span class="built_in">^</span>2 <span class="keyword">\\</span></span><br><span class="line">    1 <span class="built_in">&amp;</span> z <span class="built_in">&amp;</span> z<span class="built_in">^</span>2 <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\end</span>&#123;matrix&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p><span class="math display">\[\begin{matrix}    1 &amp; x &amp; x^2 \\\\    1 &amp; y &amp; y^2 \\\\    1 &amp; z &amp; z^2 \\\\\end{matrix}\]</span> è¡Œåˆ—å¼</p><p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line">X=<span class="keyword">\left</span>|</span><br><span class="line">    <span class="keyword">\begin</span>&#123;matrix&#125;</span><br><span class="line">        x<span class="built_in">_</span>&#123;11&#125; <span class="built_in">&amp;</span> x<span class="built_in">_</span>&#123;12&#125; <span class="built_in">&amp;</span> <span class="keyword">\cdots</span> <span class="built_in">&amp;</span> x<span class="built_in">_</span>&#123;1d&#125;<span class="keyword">\\</span></span><br><span class="line">        x<span class="built_in">_</span>&#123;21&#125; <span class="built_in">&amp;</span> x<span class="built_in">_</span>&#123;22&#125; <span class="built_in">&amp;</span> <span class="keyword">\cdots</span> <span class="built_in">&amp;</span> x<span class="built_in">_</span>&#123;2d&#125;<span class="keyword">\\</span></span><br><span class="line">        <span class="keyword">\vdots</span> <span class="built_in">&amp;</span> <span class="keyword">\vdots</span> <span class="built_in">&amp;</span> <span class="keyword">\ddots</span> <span class="built_in">&amp;</span> <span class="keyword">\vdots</span><span class="keyword">\\</span></span><br><span class="line">        x<span class="built_in">_</span>&#123;m1&#125; <span class="built_in">&amp;</span> x<span class="built_in">_</span>&#123;m2&#125; <span class="built_in">&amp;</span> <span class="keyword">\cdots</span> <span class="built_in">&amp;</span> x<span class="built_in">_</span>&#123;md&#125;<span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\end</span>&#123;matrix&#125;</span><br><span class="line"><span class="keyword">\right</span>|</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure></p><p><span class="math display">\[X=\left|\begin{matrix}x_{11} &amp; x_{12} &amp; \cdots &amp; x_{1d}\\\\x_{21} &amp; x_{22} &amp; \cdots &amp; x_{2d}\\\\\vdots &amp; \vdots &amp; \ddots &amp; \vdots\\\\x_{m1} &amp; x_{m2} &amp; \cdots &amp; x_{md}\\\\\end{matrix}\right|\]</span></p></li><li><p>åˆ†éš”ç¬¦ å„ç§æ‹¬å·ç”¨ <code>() [] &#123;&#125;</code> <code>\langle</code><code>\rangle</code> (<span class="math inline">\(\langle\rangle\)</span>)ç­‰å‘½ä»¤è¡¨ç¤º,æ³¨æ„èŠ±æ‹¬å·é€šå¸¸ç”¨æ¥è¾“å…¥å‘½ä»¤å’Œç¯å¢ƒçš„å‚æ•°,æ‰€ä»¥åœ¨æ•°å­¦å…¬å¼ä¸­å®ƒä»¬å‰é¢è¦åŠ \ã€‚å¯ä»¥åœ¨ä¸Šè¿°åˆ†éš”ç¬¦å‰é¢åŠ  \big \Big \bigg \Biggç­‰å‘½ä»¤æ¥è°ƒæ•´å¤§å°ã€‚</p></li><li><p>æ–¹ç¨‹</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;equation&#125;</span><br><span class="line">E=mc<span class="built_in">^</span>2</span><br><span class="line"><span class="keyword">\end</span>&#123;equation&#125;</span><br></pre></td></tr></table></figure><p><span class="math display">\[\begin{equation}E=mc^2\end{equation}\]</span></p></li><li><p>åˆ†æ®µå‡½æ•°</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">f(n) =</span><br><span class="line"><span class="keyword">\begin</span>&#123;cases&#125;</span><br><span class="line">n/2,  <span class="built_in">&amp;</span> <span class="keyword">\text</span>&#123;if <span class="built_in">$</span>n<span class="built_in">$</span> is even&#125; <span class="keyword">\\</span></span><br><span class="line">3n+1, <span class="built_in">&amp;</span> <span class="keyword">\text</span>&#123;if <span class="built_in">$</span>n<span class="built_in">$</span> is odd&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;cases&#125;</span><br></pre></td></tr></table></figure><p><span class="math display">\[f(n) =\begin{cases}n/2,  &amp; \text{if $n$ is even} \\\\3n+1, &amp; \text{if $n$ is odd}\end{cases}\]</span></p></li><li><p>æ–¹ç¨‹ç»„</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\left</span><span class="keyword">\&#123;</span> </span><br><span class="line"><span class="keyword">\begin</span>&#123;array&#125;&#123;c&#125;</span><br><span class="line">    a<span class="built_in">_</span>1x+b<span class="built_in">_</span>1y+c<span class="built_in">_</span>1z=d<span class="built_in">_</span>1 <span class="keyword">\\</span> </span><br><span class="line">    a<span class="built_in">_</span>2x+b<span class="built_in">_</span>2y+c<span class="built_in">_</span>2z=d<span class="built_in">_</span>2 <span class="keyword">\\</span> </span><br><span class="line">    a<span class="built_in">_</span>3x+b<span class="built_in">_</span>3y+c<span class="built_in">_</span>3z=d<span class="built_in">_</span>3</span><br><span class="line"><span class="keyword">\end</span>&#123;array&#125;</span><br><span class="line"><span class="keyword">\right</span></span><br></pre></td></tr></table></figure><p><span class="math display">\[\left\{\begin{array}{c}     a_1x+b_1y+c_1z=d_1 \\\\     a_2x+b_2y+c_2z=d_2 \\\\     a_3x+b_3y+c_3z=d_3\end{array}\right.\]</span></p></li></ul><h2><span id="å¸¸ç”¨å…¬å¼">å¸¸ç”¨å…¬å¼</span></h2><ul><li><p>çº¿æ€§æ¨¡å‹</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">h(<span class="keyword">\theta</span>) = <span class="keyword">\sum</span><span class="built_in">_</span>&#123;j = 0&#125; <span class="built_in">^</span>n <span class="keyword">\theta</span><span class="built_in">_</span>j x<span class="built_in">_</span>j</span><br></pre></td></tr></table></figure><p><span class="math display">\[h(\theta) = \sum_{j = 0} ^n \theta_j x_j\]</span></p></li><li><p>å‡æ–¹è¯¯å·®</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line">J(<span class="keyword">\theta</span>) = <span class="keyword">\frac</span>&#123;1&#125;&#123;2m&#125;<span class="keyword">\sum</span><span class="built_in">_</span>&#123;i = 0&#125; <span class="built_in">^</span>m(y<span class="built_in">^</span>i - h<span class="built_in">_</span><span class="keyword">\theta</span> (x<span class="built_in">^</span>i))<span class="built_in">^</span>2</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p><span class="math display">\[J(\theta) = \frac{1}{2m}\sum_{i = 0} ^m(y^i - h_\theta (x^i))^2\]</span></p></li><li><p>æ‰¹é‡æ¢¯åº¦ä¸‹é™</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\frac</span>&#123;<span class="keyword">\partial</span> J(<span class="keyword">\theta</span>)&#125;&#123;<span class="keyword">\partial</span><span class="keyword">\theta</span><span class="built_in">_</span>j&#125;=<span class="keyword">\frac</span>1m<span class="keyword">\sum</span><span class="built_in">_</span>&#123;i=0&#125;<span class="built_in">^</span>m(y<span class="built_in">^</span>i-h<span class="built_in">_</span><span class="keyword">\theta</span>(x<span class="built_in">^</span>i))x<span class="built_in">^</span>i<span class="built_in">_</span>j</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p><span class="math display">\[\frac{\partialJ(\theta)}{\partial\theta_j}=-\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i))x^i_j\]</span></p></li><li><p>æ¨å¯¼è¿‡ç¨‹ï¼š</p><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;align&#125;</span><br><span class="line"><span class="keyword">\frac</span>&#123;<span class="keyword">\partial</span> J(<span class="keyword">\theta</span>)&#125;&#123;<span class="keyword">\partial</span><span class="keyword">\theta</span><span class="built_in">_</span>j&#125;</span><br><span class="line"><span class="built_in">&amp;</span> = -<span class="keyword">\frac</span>1m<span class="keyword">\sum</span><span class="built_in">_</span>&#123;i=0&#125;<span class="built_in">^</span>m(y<span class="built_in">^</span>i-h<span class="built_in">_</span><span class="keyword">\theta</span>(x<span class="built_in">^</span>i)) <span class="keyword">\frac</span>&#123;<span class="keyword">\partial</span>&#125;&#123;<span class="keyword">\partial</span><span class="keyword">\theta</span><span class="built_in">_</span>j&#125;(y<span class="built_in">^</span>i-h<span class="built_in">_</span><span class="keyword">\theta</span>(x<span class="built_in">^</span>i)) <span class="keyword">\\</span></span><br><span class="line"><span class="built_in">&amp;</span> = -<span class="keyword">\frac</span>1m<span class="keyword">\sum</span><span class="built_in">_</span>&#123;i=0&#125;<span class="built_in">^</span>m(y<span class="built_in">^</span>i-h<span class="built_in">_</span><span class="keyword">\theta</span>(x<span class="built_in">^</span>i)) <span class="keyword">\frac</span>&#123;<span class="keyword">\partial</span>&#125;&#123;<span class="keyword">\partial</span><span class="keyword">\theta</span><span class="built_in">_</span>j&#125;(<span class="keyword">\sum</span><span class="built_in">_</span>&#123;j=0&#125;<span class="built_in">^</span>n<span class="keyword">\theta</span><span class="built_in">_</span>jx<span class="built_in">_</span>j<span class="built_in">^</span>i-y<span class="built_in">^</span>i) <span class="keyword">\\</span></span><br><span class="line"><span class="built_in">&amp;</span> = -<span class="keyword">\frac</span>1m<span class="keyword">\sum</span><span class="built_in">_</span>&#123;i=0&#125;<span class="built_in">^</span>m(y<span class="built_in">^</span>i-h<span class="built_in">_</span><span class="keyword">\theta</span>(x<span class="built_in">^</span>i))x<span class="built_in">^</span>i<span class="built_in">_</span>j</span><br><span class="line"><span class="keyword">\end</span>&#123;align&#125;</span><br><span class="line"><span class="built_in">$</span><span class="built_in">$</span></span><br></pre></td></tr></table></figure><p><span class="math display">\[\begin{align}\frac{\partial J(\theta)}{\partial\theta_j}&amp; = -\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i))\frac{\partial}{\partial\theta_j}(y^i-h_\theta(x^i)) \\\\&amp; = -\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i))\frac{\partial}{\partial\theta_j}(\sum_{j=0}^n\theta_jx_j^i-y^i) \\\\&amp; = -\frac1m\sum_{i=0}^m(y^i-h_\theta(x^i))x^i_j\end{align}\]</span></p></li><li><p>ç»„åˆæ•°ï¼š<span class="math inline">\(\tbinom{n}{m}\)</span><code>$\tbinom&#123;n&#125;&#123;m&#125;$</code>æˆ–è€… <span class="math inline">\(C^m_n\)</span></p></li><li><p>çº¿æ€§å›å½’çš„è§£æè§£ <span class="math display">\[\begin{align}\theta_1 &amp;=\frac{\sum_{i=1}^m{(x^{(i)}-\bar{x})(y^{(i)}-\bar{y})}}{\sum^m_{i=1}{(x^{(i)}-\bar{x})^2}}\\\theta_0 &amp;= \bar{y}-\theta_1\bar{x}\end{align}\]</span></p><p><span class="math display">\[\hat{\Theta}=\Theta^*=(\mathbf{X}^T\mathbf{X})^{-1}X^TY\]</span></p></li></ul><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><ol type="1"><li><p><a href="https://liam.page/2014/09/08/latex-introduction/">ä¸€ä»½å…¶å®å¾ˆçŸ­çš„LaTeX å…¥é—¨æ–‡æ¡£</a></p></li><li><p><a href="https://blog.csdn.net/baidu_38060633/article/details/79183905">è¯•è¯•LaTeXæ’å…¥æ•°å­¦å…¬å¼</a></p></li><li><p><a href="https://www.cnblogs.com/Sinte-Beuve/p/6160905.html">åœ¨åšå®¢ä¸­ä½¿ç”¨LaTeXæ’å…¥æ•°å­¦å…¬å¼</a></p></li><li><p><a href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">MathJaxbasic tutorial and quick reference</a></p></li></ol><h1><span id="åœ¨latexä¸­æ’å…¥å›¾ç‰‡">åœ¨<span class="math inline">\(\LaTeX\)</span>ä¸­æ’å…¥å›¾ç‰‡</span></h1><h2><span id="å•å¼ å›¾ç‰‡æ’å…¥">å•å¼ å›¾ç‰‡æ’å…¥</span></h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[H]</span><br><span class="line">    <span class="keyword">\centering</span><span class="comment">% è®¾ç½®å±…ä¸­</span></span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=10cm]&#123;fig/Figure<span class="built_in">_</span>2.png&#125;<span class="comment">% å›¾ç‰‡è·¯å¾„å’Œå¤§å°è®¾ç½®</span></span><br><span class="line">    <span class="keyword">\caption</span>&#123;PDF derived from CHNS&#x27;s data &#125;<span class="comment">% å›¾ç‰‡ä¸‹æ–‡å­—(caption)</span></span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/06/taCXRdc7gUiYHb6.png"></p><p>[æ³¨]ï¼š</p><ol type="1"><li><p>æ‰€éœ€è¦çš„å®åŒ…ï¼š<code>\usepackage&#123;graphicx&#125;</code></p></li><li><p>[htbp] ä¸ºè°ƒæ•´å›¾ç‰‡æ’ç‰ˆä½ç½®é€‰é¡¹ï¼Œè¯´æ˜å¦‚ä¸‹ï¼š</p><p>[h]å½“å‰ä½ç½®ã€‚å°†å›¾å½¢æ”¾ç½®åœ¨æ­£æ–‡æ–‡æœ¬ä¸­ç»™å‡ºè¯¥å›¾å½¢ç¯å¢ƒçš„åœ°æ–¹ã€‚å¦‚æœæœ¬é¡µæ‰€å‰©çš„é¡µé¢ä¸å¤Ÿï¼Œè¿™ä¸€å‚æ•°å°†ä¸èµ·ä½œç”¨ã€‚[t]é¡¶éƒ¨ã€‚å°†å›¾å½¢æ”¾ç½®åœ¨é¡µé¢çš„é¡¶éƒ¨ã€‚ [b]åº•éƒ¨ã€‚å°†å›¾å½¢æ”¾ç½®åœ¨é¡µé¢çš„åº•éƒ¨ã€‚[p]æµ®åŠ¨é¡µã€‚å°†å›¾å½¢æ”¾ç½®åœ¨ä¸€åªå…è®¸æœ‰æµ®åŠ¨å¯¹è±¡çš„é¡µé¢ä¸Šã€‚</p></li><li><p>[htbp]é€‰é¡¹æ˜¯<span class="math inline">\(\LaTeX\)</span>è‡ªåŠ¨æ’ç‰ˆçš„ï¼Œä¼šå¯¼è‡´åæ¥å†™çš„æ–‡æœ¬è‡ªåŠ¨ç´§æ¥ç€å‰é¢çš„æ–‡æœ¬ã€‚å¦‚æœéœ€è¦æŒ‡å®šå›¾ç‰‡åœ¨å½“å‰ä½ç½®ï¼Œå°±éœ€è¦</p><ol type="1"><li>å¼•å…¥å®åŒ…<code>\usepackage&#123;float&#125;</code></li><li><code>\begin&#123;figure&#125;[H]</code></li></ol></li></ol><h2><span id="æ’ç‰ˆä¸¤å¼ å›¾ç‰‡åœ¨åŒä¸€è¡Œ">æ’ç‰ˆä¸¤å¼ å›¾ç‰‡åœ¨åŒä¸€è¡Œ</span></h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[H]</span><br><span class="line">    <span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\begin</span>&#123;minipage&#125;[t]&#123;0.48<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">    <span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=6cm]&#123;fig/Figure3-Female-Height.png&#125;</span><br><span class="line">    <span class="keyword">\label</span>&#123;fig<span class="built_in">_</span>22&#125;</span><br><span class="line">    <span class="keyword">\caption</span>&#123;Female Height&#125;</span><br><span class="line">    <span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line">    <span class="keyword">\begin</span>&#123;minipage&#125;[t]&#123;0.48<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">    <span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=6cm]&#123;fig/Figure2-Male-Height.png&#125;</span><br><span class="line">    <span class="keyword">\caption</span>&#123;Male Height&#125;</span><br><span class="line">    <span class="keyword">\label</span>&#123;fig<span class="built_in">_</span>23&#125;</span><br><span class="line">    <span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/06/Wk1q9j3bBhGlT2Y.png"></p><p>åŸºæœ¬ç”¨æ³•å’Œæ’å…¥å•å¼ å›¾ç‰‡éå¸¸ç›¸ä¼¼ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯å¤šäº†<code>minipage</code>çš„ä½¿ç”¨ã€‚</p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><p><a href="https://blog.csdn.net/qq_38526623/article/details/103737589">Latexå¦‚ä½•æ’å…¥å›¾ç‰‡</a></p><p><a href="https://blog.csdn.net/weixin_42141390/article/details/103773143">Latexå¹¶æ’æ’å…¥ä¸¤å¼ å›¾ç‰‡</a></p><p><a href="https://blog.csdn.net/weixin_39278265/article/details/108781140">[LaTeX]ç”¨minipageæ¥æ’ç‰ˆå¤šå¼ å›¾ç‰‡ï¼ˆå­å›¾ç‰‡ï¼‰ï¼ï¼ˆä»¥åŠç”¨subfigureè€Œä¸æ˜¯subfloatæ¥æ’ç‰ˆä»£ç å‹å›¾ç‰‡ï¼‰</a></p><h1><span id="latexå®šç†-å¼•ç†-è¯æ˜"><span class="math inline">\(\LaTeX\)</span>å®šç†ã€å¼•ç†ã€è¯æ˜</span></h1><h2><span id="å®šç†">å®šç†</span></h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\newtheorem</span>&#123;thm&#125;&#123;<span class="keyword">\bf</span> Theorem&#125;[section]</span><br><span class="line"><span class="keyword">\begin</span>&#123;thm&#125;<span class="keyword">\label</span>&#123;thm1&#125;</span><br><span class="line">    Let <span class="built_in">$</span>f<span class="built_in">_</span>1<span class="built_in">$</span> and <span class="built_in">$</span>f<span class="built_in">_</span>2<span class="built_in">$</span> be normal densities with respective means <span class="built_in">$</span><span class="keyword">\mu</span><span class="built_in">_</span>1<span class="built_in">$</span> and <span class="built_in">$</span><span class="keyword">\mu</span><span class="built_in">_</span>2<span class="built_in">$</span> and common variance <span class="built_in">$</span><span class="keyword">\sigma</span><span class="built_in">^</span>2<span class="built_in">$</span>, and let <span class="built_in">$</span>f<span class="built_in">$</span> be the </span><br><span class="line">    mixture density <span class="built_in">$</span>0.5 f<span class="built_in">_</span>1+0.5 f<span class="built_in">_</span>2<span class="built_in">$</span>. Then <span class="built_in">$</span>f<span class="built_in">$</span> is unimodal if and only if <span class="built_in">$</span>|<span class="keyword">\mu</span><span class="built_in">_</span>2-<span class="keyword">\mu</span><span class="built_in">_</span>1 | <span class="keyword">\leq</span>  2<span class="keyword">\sigma</span><span class="built_in">$</span>. [4]</span><br><span class="line"><span class="keyword">\end</span>&#123;thm&#125; </span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/06/jko9lMg8feHp4zA.png"></p><h2><span id="è¯æ˜">è¯æ˜</span></h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;proof&#125;</span><br><span class="line">    A normal density is concave down between its inflection points <span class="built_in">$</span><span class="keyword">\mu</span> <span class="keyword">\pm</span> <span class="keyword">\sigma</span><span class="built_in">$</span> and concave up elsewhere. Note that <span class="built_in">$</span>f<span class="built_in">$</span> is symmetric </span><br><span class="line">    around <span class="built_in">$</span>m=(<span class="keyword">\mu</span><span class="built_in">_</span>1+<span class="keyword">\mu</span><span class="built_in">_</span>2)/2<span class="built_in">$</span> . Now if <span class="built_in">$</span>|<span class="keyword">\mu</span><span class="built_in">_</span>2-<span class="keyword">\mu</span><span class="built_in">_</span>1 |&gt;2<span class="keyword">\sigma</span><span class="built_in">$</span>, then both <span class="built_in">$</span>f<span class="built_in">_</span>1<span class="built_in">$</span> and <span class="built_in">$</span>f<span class="built_in">_</span>2<span class="built_in">$</span> are concave up at <span class="built_in">$</span>m<span class="built_in">$</span>, hence so is <span class="built_in">$</span>f<span class="built_in">$</span>. Therefore f has a </span><br><span class="line">    local minimum at <span class="built_in">$</span>m<span class="built_in">$</span>, which implies that <span class="built_in">$</span>f<span class="built_in">$</span> is bimodal. Conversely, if <span class="built_in">$</span>|<span class="keyword">\mu</span><span class="built_in">_</span>2-<span class="keyword">\mu</span><span class="built_in">_</span>1 |&lt;2<span class="keyword">\sigma</span><span class="built_in">$</span>, then both <span class="built_in">$</span>f<span class="built_in">_</span>1<span class="built_in">$</span> and <span class="built_in">$</span>f<span class="built_in">_</span>2<span class="built_in">$</span> are concave down </span><br><span class="line">    at <span class="built_in">$</span>m<span class="built_in">$</span>, hence so is <span class="built_in">$</span>f<span class="built_in">$</span>. Thus, <span class="built_in">$</span>f<span class="built_in">$</span> has a local maximum at <span class="built_in">$</span>m<span class="built_in">$</span> and is therefore unimodal. In the borderline case <span class="built_in">$</span>|<span class="keyword">\mu</span><span class="built_in">_</span>2-<span class="keyword">\mu</span><span class="built_in">_</span>1 |=2<span class="keyword">\sigma</span><span class="built_in">$</span> the </span><br><span class="line">    second derivative of <span class="built_in">$</span>f<span class="built_in">$</span> vanishes, but the fourth derivative can be used to show that <span class="built_in">$</span>f<span class="built_in">$</span> has a maximum at <span class="built_in">$</span>m<span class="built_in">$</span> and thus is unimodal. [2]</span><br><span class="line">    <span class="keyword">\begin</span>&#123;figure&#125;[H]</span><br><span class="line">        <span class="keyword">\centering</span></span><br><span class="line">        <span class="keyword">\includegraphics</span>[width=14cm]&#123;fig/proof.png&#125;</span><br><span class="line">        <span class="keyword">\caption</span>&#123;Two cases in the theorem &#123;[2]&#125;&#125;</span><br><span class="line">    <span class="keyword">\end</span>&#123;figure&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;proof&#125;</span><br></pre></td></tr></table></figure><p><img src="https://i.loli.net/2021/05/06/QHlbVTNd6vcpeK9.png"></p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><p><a href="https://blog.csdn.net/miracle_fans/article/details/78255650">Latexä¸­å®šç†ã€å¼•ç†ã€è¯æ˜ã€å‡è®¾</a></p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> Latex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•ï¼šæœ€å°ç”Ÿæˆæ ‘(Minimum Spanning Tree)</title>
      <link href="/2022/09/28/algorithms/suan-fa-minimum-spanning-tree/"/>
      <url>/2022/09/28/algorithms/suan-fa-minimum-spanning-tree/</url>
      
        <content type="html"><![CDATA[<p>ç”Ÿæˆæ ‘æŒ‡çš„æ˜¯ä¸€ä¸ªè¿é€šå›¾Gçš„è¦†ç›–æ‰€æœ‰é¡¶ç‚¹çš„æ— ç¯å­å›¾ï¼Œæœ€å°ç”Ÿæˆæ ‘æŒ‡çš„æ˜¯æ‰€æœ‰ç”Ÿæˆæ ‘ä¸­åŠ æƒå’Œæœ€å°çš„ç”Ÿæˆæ ‘ã€‚</p><blockquote><p>æœ€å°ç”Ÿæˆæ ‘çš„åº”ç”¨ï¼šèšç±»åˆ†æã€ç½‘ç»œæ¶æ„è®¾è®¡ã€VLSIå¸ƒçº¿è®¾è®¡ç­‰è¯¸å¤šå®é™…åº”ç”¨é—®é¢˜ï¼Œéƒ½å¯è½¬åŒ–å¹¶æè¿°ä¸ºæœ€å°æ”¯æ’‘æ ‘çš„æ„é€ é—®é¢˜ã€‚åœ¨è¿™äº›åº”ç”¨ä¸­ï¼Œè¾¹çš„æƒé‡å¤§å¤šå¯¹åº”äºæŸç§å¯é‡åŒ–çš„æˆæœ¬ï¼Œå› æ­¤ä½œä¸ºå¯¹åº”ä¼˜åŒ–é—®é¢˜çš„åŸºæœ¬æ¨¡å‹ï¼Œæœ€å°æ”¯æ’‘æ ‘çš„ä»·å€¼ä¸è¨€è€Œå–»ã€‚â€”â€”ã€Šæ•°æ®ç»“æ„C++ç‰ˆã€‹</p></blockquote><p>æ±‚æœ€å°æ”¯æ’‘æ ‘çš„ç®—æ³•ä¸»è¦é‡‡ç”¨è´ªå¿ƒç®—æ³•ï¼Œæœ€è‘—åçš„ä¸¤ä¸ªç®—æ³•åˆ†åˆ«æ˜¯Primç®—æ³•å’ŒKruskalç®—æ³•ã€‚</p><p>æœ¬ç¯‡ä¸»è¦å‚è€ƒ<a href="https://www.geeksforgeeks.org/kruskals-minimum-spanning-tree-algorithm-greedy-algo-2/">Kruskalâ€™sMinimum Spanning Tree Algorithm | Greedy Algo-2 -GeeksforGeeks</a>ä»¥åŠä»¥åŠ<a href="https://www.geeksforgeeks.org/prims-minimum-spanning-tree-mst-greedy-algo-5/?ref=lbp">Primâ€™sMinimum Spanning Tree (MST) | Greedy Algo-5 -GeeksforGeeks</a>ï¼ŒGeeksforGeeksä¸Šçš„æ•°æ®ç»“æ„ä»Šå¤©åˆšå¥½æœåˆ°äº†ï¼Œç¡®å®è®²çš„ä¸é”™ï¼Œè½¬è½½æ”¶è—ä¸€ä¸‹ä½œä¸ºç¬”è®°ã€‚</p><p><span id="more"></span></p><h3><span id="primç®—æ³•">Primç®—æ³•</span></h3><p>ä½¿ç”¨Primç®—æ³•ä¹‹å‰ï¼Œéœ€è¦äº†è§£å›¾è®ºä¸­çš„ä¸€ä¸ªæ¦‚å¿µã€‚å‰²(Cut or Cross edges)æŒ‡çš„æ˜¯è¿æ¥ä¸¤ä¸ªå­å›¾çš„è¾¹ã€‚Primç®—æ³•ä»å›¾ä¸­çš„ä»»æ„ä¸€ä¸ªç‚¹å‡ºå‘ï¼Œé€‰å‡ºæ‰€æœ‰å‰²ä¸­çš„æœ€å°è¾¹åŠ å…¥åˆ°MSTä¸­ï¼Œç›´åˆ°æ‰€æœ‰çš„é¡¶ç‚¹éƒ½åœ¨MSTä¸­ã€‚ç®—æ³•çš„æ€æƒ³å¾ˆç®€å•ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A C++ program for Prim&#x27;s Minimum</span></span><br><span class="line"><span class="comment">// Spanning Tree (MST) algorithm. The program is</span></span><br><span class="line"><span class="comment">// for adjacency matrix representation of the graph</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Number of vertices in the graph</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> V 5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// A utility function to find the vertex with</span></span><br><span class="line"><span class="comment">// minimum key value, from the set of vertices</span></span><br><span class="line"><span class="comment">// not yet included in MST</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">minKey</span><span class="params">(<span class="type">int</span> key[], <span class="type">bool</span> mstSet[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Initialize min value</span></span><br><span class="line">    <span class="type">int</span> min = INT_MAX, min_index;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; V; v++)</span><br><span class="line">        <span class="keyword">if</span> (mstSet[v] == <span class="literal">false</span> &amp;&amp; key[v] &lt; min)</span><br><span class="line">            min = key[v], min_index = v;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> min_index;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// A utility function to print the</span></span><br><span class="line"><span class="comment">// constructed MST stored in parent[]</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printMST</span><span class="params">(<span class="type">int</span> parent[], <span class="type">int</span> graph[V][V])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Edge \tWeight\n&quot;</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; V; i++)</span><br><span class="line">        cout &lt;&lt; parent[i] &lt;&lt; <span class="string">&quot; - &quot;</span> &lt;&lt; i &lt;&lt; <span class="string">&quot; \t&quot;</span></span><br><span class="line">             &lt;&lt; graph[i][parent[i]] &lt;&lt; <span class="string">&quot; \n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Function to construct and print MST for</span></span><br><span class="line"><span class="comment">// a graph represented using adjacency</span></span><br><span class="line"><span class="comment">// matrix representation</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">primMST</span><span class="params">(<span class="type">int</span> graph[V][V])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Array to store constructed MST</span></span><br><span class="line">    <span class="type">int</span> parent[V];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Key values used to pick minimum weight edge in cut</span></span><br><span class="line">    <span class="type">int</span> key[V];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// To represent set of vertices included in MST</span></span><br><span class="line">    <span class="type">bool</span> mstSet[V];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Initialize all keys as INFINITE</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; V; i++)</span><br><span class="line">        key[i] = INT_MAX, mstSet[i] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Always include first 1st vertex in MST.</span></span><br><span class="line">    <span class="comment">// Make key 0 so that this vertex is picked as first</span></span><br><span class="line">    <span class="comment">// vertex.</span></span><br><span class="line">    key[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    parent[<span class="number">0</span>] = <span class="number">-1</span>; <span class="comment">// First node is always root of MST</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// The MST will have V vertices</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> count = <span class="number">0</span>; count &lt; V - <span class="number">1</span>; count++) &#123;</span><br><span class="line">        <span class="comment">// Pick the minimum key vertex from the</span></span><br><span class="line">        <span class="comment">// set of vertices not yet included in MST</span></span><br><span class="line">        <span class="type">int</span> u = <span class="built_in">minKey</span>(key, mstSet);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Add the picked vertex to the MST Set</span></span><br><span class="line">        mstSet[u] = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Update key value and parent index of</span></span><br><span class="line">        <span class="comment">// the adjacent vertices of the picked vertex.</span></span><br><span class="line">        <span class="comment">// Consider only those vertices which are not</span></span><br><span class="line">        <span class="comment">// yet included in MST</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> v = <span class="number">0</span>; v &lt; V; v++)</span><br><span class="line"></span><br><span class="line">            <span class="comment">// graph[u][v] is non zero only for adjacent</span></span><br><span class="line">            <span class="comment">// vertices of m mstSet[v] is false for vertices</span></span><br><span class="line">            <span class="comment">// not yet included in MST Update the key only</span></span><br><span class="line">            <span class="comment">// if graph[u][v] is smaller than key[v]</span></span><br><span class="line">            <span class="keyword">if</span> (graph[u][v] &amp;&amp; mstSet[v] == <span class="literal">false</span></span><br><span class="line">                &amp;&amp; graph[u][v] &lt; key[v])</span><br><span class="line">                parent[v] = u, key[v] = graph[u][v];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// print the constructed MST</span></span><br><span class="line">    <span class="built_in">printMST</span>(parent, graph);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Driver&#x27;s code</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* Let us create the following graph</span></span><br><span class="line"><span class="comment">        2 3</span></span><br><span class="line"><span class="comment">    (0)--(1)--(2)</span></span><br><span class="line"><span class="comment">    | / \ |</span></span><br><span class="line"><span class="comment">    6| 8/ \5 |7</span></span><br><span class="line"><span class="comment">    | / \ |</span></span><br><span class="line"><span class="comment">    (3)-------(4)</span></span><br><span class="line"><span class="comment">            9 */</span></span><br><span class="line">    <span class="type">int</span> graph[V][V] = &#123; &#123; <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">0</span> &#125;,</span><br><span class="line">                        &#123; <span class="number">2</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">5</span> &#125;,</span><br><span class="line">                        &#123; <span class="number">0</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">7</span> &#125;,</span><br><span class="line">                        &#123; <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">9</span> &#125;,</span><br><span class="line">                        &#123; <span class="number">0</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">0</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Print the solution</span></span><br><span class="line">    <span class="built_in">primMST</span>(graph);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// This code is contributed by rathbhupendra</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„ä»£ç ä¸»è¦ä½¿ç”¨çš„æ˜¯å›¾çš„é‚»æ¥çŸ©é˜µè¡¨ç¤ºï¼Œé‡‡ç”¨çš„æ€æƒ³æ˜¯ç»´æŠ¤ä¸€ä¸ªä¸å‰©ä½™çš„å­å›¾ç›¸è¿çš„å‰²çš„æ•°ç»„ï¼Œåœ¨æ·»åŠ è¾¹çš„æ—¶å€™æ›´æ–°è¿™ä¸ªæ•°ç»„ï¼Œæ¯æ¬¡æ·»åŠ çš„æ—¶å€™å°±å¯ä»¥ä»è¿™ä¸ªæ•°ç»„ä¸­å¯»æ‰¾æœ€å°çš„å‰²ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(V^2)ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§é‚»æ¥è¡¨çš„è¡¨ç¤ºæ–¹æ³•ï¼Œä½¿ç”¨é‚»æ¥è¡¨å’Œä¼˜å…ˆé˜Ÿåˆ—å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™ä¸ºO(Elog V)ï¼Œæ›´åŠ å¤æ‚ä¸€äº›ï¼Œå‚è€ƒ<a href="https://www.geeksforgeeks.org/prims-mst-for-adjacency-list-representation-greedy-algo-6/">Primâ€™sMST for Adjacency List Representation | Greedy Algo-6 -GeeksforGeeks</a>ã€‚</p><h3><span id="kruskalç®—æ³•">Kruskalç®—æ³•</span></h3><p>é¦–å…ˆï¼Œå°†Gä¸­çš„æ‰€æœ‰è¾¹EæŒ‰ç…§æƒé‡ä»å°åˆ°å¤§è¿›è¡Œæ’åºï¼Œç„¶åä¾æ¬¡éå†ï¼Œå¦‚æœå°†å½“å‰çš„è¾¹åŠ å…¥å½“å‰çš„å­å›¾ä¸­ä¸ä¼šäº§ç”Ÿç¯ï¼Œé‚£ä¹ˆå°±åŠ å…¥å½“å‰çš„è¾¹ï¼Œå¦åˆ™ç»§ç»­éå†ä¸‹ä¸€ä¸ªæœ€å°è¾¹ï¼Œç›´åˆ°æ‰€æœ‰çš„è¾¹éƒ½è¢«éå†ã€‚è¿™é‡Œäº§ç”Ÿçš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•åˆ¤æ–­æ˜¯å¦æ˜¯æœ‰ç¯å›¾ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥æ˜¯ç”¨å‹ç¼©è·¯å¾„çš„å¹¶æŸ¥é›†ç®—æ³•ï¼Œå‚è€ƒ<a href="https://www.geeksforgeeks.org/union-find-algorithm-set-2-union-by-rank/">Union-FindAlgorithm | Set 2 (Union By Rank and Path Compression) -GeeksforGeeks</a>ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">node</span> &#123;</span><br><span class="line">    <span class="type">int</span> rank;</span><br><span class="line">    <span class="type">int</span> parent;</span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Union</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    node *nodes;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Union</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">        nodes = <span class="keyword">new</span> node[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            nodes[i].rank = <span class="number">1</span>;</span><br><span class="line">            nodes[i].parent = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Union</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> nodes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">find</span><span class="params">(<span class="type">int</span> i)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nodes[i].parent != i)</span><br><span class="line">            nodes[i].parent = <span class="built_in">find</span>(nodes[i].parent);</span><br><span class="line">        <span class="keyword">return</span> nodes[i].parent;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">merge</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> i_root = <span class="built_in">find</span>(i);</span><br><span class="line">        <span class="type">int</span> j_root = <span class="built_in">find</span>(j);</span><br><span class="line">        <span class="keyword">if</span> (nodes[i_root].rank &lt; nodes[j_root].rank) &#123;</span><br><span class="line">            nodes[i_root].parent = nodes[j_root].parent;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nodes[i_root].rank &gt; nodes[j_root].rank) &#123;</span><br><span class="line">            nodes[j_root].parent = nodes[i_root].parent;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nodes[i_root].parent != nodes[j_root].parent) &#123;</span><br><span class="line">            nodes[j_root].parent = nodes[i_root].parent;</span><br><span class="line">            nodes[i_root].rank += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Graph</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; edgelist;</span><br><span class="line">    <span class="type">int</span> V;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">Graph</span><span class="params">(<span class="type">int</span> v)</span> </span>&#123; <span class="keyword">this</span>-&gt;V = v; &#125;</span><br><span class="line"></span><br><span class="line">    vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; <span class="built_in">get_edgelist</span>() <span class="type">const</span> &#123; <span class="keyword">return</span> edgelist; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> V; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(<span class="type">int</span> source, <span class="type">int</span> destination, <span class="type">int</span> weight)</span> </span>&#123; edgelist.<span class="built_in">push_back</span>(&#123;weight, source, destination&#125;); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add_edge</span><span class="params">(vector&lt;<span class="type">int</span>&gt; edge)</span> </span>&#123; edgelist.<span class="built_in">push_back</span>(edge); &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_total_weights</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="type">int</span> sum = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; edge : edgelist) &#123;</span><br><span class="line">           sum += edge[<span class="number">0</span>];</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> Graph <span class="title">kruskals_mst</span><span class="params">(<span class="type">const</span> Graph&amp; graph)</span> </span>&#123;</span><br><span class="line">        vector&lt;vector&lt;<span class="type">int</span>&gt;&gt; edgelist = graph.<span class="built_in">get_edgelist</span>();</span><br><span class="line">        <span class="built_in">sort</span>(edgelist.<span class="built_in">begin</span>(), edgelist.<span class="built_in">end</span>());</span><br><span class="line">        <span class="function">Union <span class="title">s</span><span class="params">(graph.get_size())</span></span>;</span><br><span class="line">        Graph mst = <span class="built_in">Graph</span>(graph.<span class="built_in">get_size</span>());</span><br><span class="line">        <span class="keyword">for</span> (vector&lt;<span class="type">int</span>&gt; edge: edgelist) &#123;</span><br><span class="line">            <span class="comment">// determine whether put the edge into mst will cause a cycle</span></span><br><span class="line">            <span class="comment">// if the two vertices do not belong to the same root</span></span><br><span class="line">            <span class="comment">// they will introduce a cycle</span></span><br><span class="line">            <span class="keyword">if</span> (s.<span class="built_in">find</span>(edge[<span class="number">1</span>]) != s.<span class="built_in">find</span>(edge[<span class="number">2</span>])) &#123;</span><br><span class="line">                <span class="comment">// merge the two subsets together</span></span><br><span class="line">                s.<span class="built_in">merge</span>(edge[<span class="number">1</span>], edge[<span class="number">2</span>]);</span><br><span class="line">                mst.<span class="built_in">add_edge</span>(edge);</span><br><span class="line">                cout &lt;&lt; edge[<span class="number">1</span>] &lt;&lt; <span class="string">&quot; -- &quot;</span> &lt;&lt; edge[<span class="number">2</span>] &lt;&lt; <span class="string">&quot; == &quot;</span> &lt;&lt; edge[<span class="number">0</span>] &lt;&lt; endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mst;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* Let us create following weighted graph</span></span><br><span class="line"><span class="comment">                   10</span></span><br><span class="line"><span class="comment">              0--------1</span></span><br><span class="line"><span class="comment">              |  \     |</span></span><br><span class="line"><span class="comment">             6|   5\   |15</span></span><br><span class="line"><span class="comment">              |      \ |</span></span><br><span class="line"><span class="comment">              2--------3</span></span><br><span class="line"><span class="comment">                  4       */</span></span><br><span class="line">    <span class="function">Graph <span class="title">g</span><span class="params">(<span class="number">4</span>)</span></span>;</span><br><span class="line">    g.<span class="built_in">add_edge</span>(<span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    g.<span class="built_in">add_edge</span>(<span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>);</span><br><span class="line">    g.<span class="built_in">add_edge</span>(<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">    g.<span class="built_in">add_edge</span>(<span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>);</span><br><span class="line">    g.<span class="built_in">add_edge</span>(<span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Function call</span></span><br><span class="line">    Graph::<span class="built_in">kruskals_mst</span>(g);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><ol type="1"><li>ã€Šæ•°æ®ç»“æ„C++ç‰ˆ-é‚“ä¿Šè¾‰ã€‹6.11 æœ€å°æ”¯æ’‘æ ‘</li><li><a href="https://www.geeksforgeeks.org/kruskals-minimum-spanning-tree-algorithm-greedy-algo-2/">Kruskalâ€™sMinimum Spanning Tree Algorithm | Greedy Algo-2 - GeeksforGeeks</a></li><li><a href="https://www.geeksforgeeks.org/prims-minimum-spanning-tree-mst-greedy-algo-5/?ref=lbp">Primâ€™sMinimum Spanning Tree (MST) | Greedy Algo-5 - GeeksforGeeks</a></li><li><a href="https://www.geeksforgeeks.org/union-find-algorithm-set-2-union-by-rank/">Union-FindAlgorithm | Set 2 (Union By Rank and Path Compression) -GeeksforGeeks</a></li><li><a href="https://www.geeksforgeeks.org/prims-mst-for-adjacency-list-representation-greedy-algo-6/">Primâ€™sMST for Adjacency List Representation | Greedy Algo-6 -GeeksforGeeks</a></li><li><a href="https://zhuanlan.zhihu.com/p/93647900">ç®—æ³•å­¦ä¹ ç¬”è®°(1) :å¹¶æŸ¥é›† - çŸ¥ä¹ (zhihu.com)</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> C++ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PyTorch Inplace Operation Notes</title>
      <link href="/2022/09/25/bug/pytorch-inplace-operation-notes/"/>
      <url>/2022/09/25/bug/pytorch-inplace-operation-notes/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨è·‘å®éªŒçš„æ—¶å€™é‡åˆ°äº†è¿™æ ·ä¸€ä¸ªBugèŠ±äº†å¾ˆä¹…æ‰è§£å†³ï¼Œè®°å½•ä¸€ä¸‹å­¦ä¹ ä¸€æ³¢ä»¥å…ä»¥åå†é‡åˆ°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RuntimeError: one of the variables needed for gradient computation has been modified by an inplace operation: [torch.cuda.FloatTensor [3</span><br><span class="line">, 64, 7, 7]] is at version 2; expected version 1 instead. Hint: enable anomaly detection to find the operation that failed to compute it</span><br><span class="line">s gradient, with torch.autograd.set_detect_anomaly(True).</span><br></pre></td></tr></table></figure><p><span id="more"></span></p><h3><span id="å…³äºinplace-operation">å…³äºInplace Operation</span></h3><p>é¦–å…ˆï¼Œè¿™ä¸ªé—®é¢˜ä»æŠ¥é”™ä¸­å¯ä»¥çœ‹åˆ°æ˜¯ç”±äºinplaceoperationå¯¼è‡´çš„ã€‚ç»è¿‡æŸ¥æ‰¾ï¼ŒinplaceoperationæŒ‡çš„å°±æ˜¯PyTorchåœ¨è®¡ç®—ä¸€ä¸ªå€¼çš„æ—¶å€™ä¸åˆ›å»ºæ–°çš„å˜é‡è¿›è¡Œå¤åˆ¶ï¼Œè€Œæ˜¯ç›´æ¥æ”¹å˜åŸæ¥çš„å˜é‡çš„å€¼ã€‚æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼Œç¬¬ä¸€ä¸ªå°±ä¸æ˜¯inplaceoperationè€Œåä¸¤ä¸ªå°±æ˜¯inplace operationã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = torch.rand(<span class="number">2</span>)</span><br><span class="line">y = torch.rand(<span class="number">2</span>)</span><br><span class="line"><span class="comment"># non-inplace operation</span></span><br><span class="line">z = x + y</span><br><span class="line"><span class="comment"># inplace operation</span></span><br><span class="line">x.add_(y)</span><br><span class="line">x += y</span><br></pre></td></tr></table></figure><h3><span id="è§£å†³è¿‡ç¨‹">è§£å†³è¿‡ç¨‹</span></h3><p>é¦–å…ˆåœ¨ç½‘ä¸Šæœåˆ°çš„èµ„æ–™éƒ½æ˜¯è¯´å°½é‡ç§»é™¤æ‰æ‰€æœ‰çš„inplaceoperationï¼ŒåŒ…æ‹¬æŠŠActivationLayerçš„<code>inplace=True</code>å»æ‰ç­‰ç­‰ï¼Œä½†æ˜¯éƒ½æ— æ³•è§£å†³ã€‚ç„¶åå°±æ ¹æ®æŠ¥é”™ä¸­çš„æç¤ºï¼Œä½¿ç”¨<code>torch.autograd.set_detect_anomaly(True)</code>æŸ¥æ‰¾åœ¨å“ªé‡Œå‘ç”Ÿäº†inplaceoperation (å‚è€ƒ<a href="https://github.com/pytorch/pytorch/issues/15803">Debugging featurefor "modified by an inplace operation" errors Â· Issue #15803 Â·pytorch/pytorch Â· GitHub</a>)ï¼Œæœ€åæç¤ºå¦‚ä¸‹æŠ¥é”™</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[W python_anomaly_mode.cpp:104] Warning: Error detected in CudnnConvolutionBackward. Traceback of forward call that caused the error:</span><br><span class="line">  File &quot;./train.py&quot;, line 44, in &lt;module&gt;</span><br><span class="line">    model.optimize_parameters()</span><br><span class="line">  File &quot;xxxx.py&quot;, line 374, in optimize_parameters</span><br><span class="line">    self.backward_all_net()</span><br><span class="line">  File &quot;xxxx.py&quot;, line 273, in backward_all_net</span><br><span class="line">    _, _, _, fake_B_x6_processed = self.pixelnet(fake_B_x6)</span><br><span class="line">  File &quot;/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py&quot;, line 1051, in _call_impl</span><br><span class="line">    return forward_call(*input, **kwargs)</span><br><span class="line">  File &quot;xxxx.py&quot;, line 282, in forward</span><br><span class="line">    output = self.model_3(feature_256)</span><br><span class="line">  File &quot;/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py&quot;, line 1051, in _call_impl</span><br><span class="line">    return forward_call(*input, **kwargs)</span><br><span class="line">  File &quot;/usr/local/lib/python3.6/dist-packages/torch/nn/modules/container.py&quot;, line 139, in forward</span><br><span class="line">    input = module(input)</span><br><span class="line">  File &quot;/usr/local/lib/python3.6/dist-packages/torch/nn/modules/module.py&quot;, line 1051, in _call_impl</span><br><span class="line">    return forward_call(*input, **kwargs)</span><br><span class="line">  File &quot;/usr/local/lib/python3.6/dist-packages/torch/nn/modules/conv.py&quot;, line 443, in forward</span><br><span class="line">    return self._conv_forward(input, self.weight, self.bias)</span><br><span class="line">  File &quot;/usr/local/lib/python3.6/dist-packages/torch/nn/modules/conv.py&quot;, line 440, in _conv_forward</span><br><span class="line">    self.padding, self.dilation, self.groups)</span><br><span class="line"> (function _print_stack)</span><br><span class="line">RuntimeError: one of the variables needed for gradient computation has been modified by an inplace operation: [torch.cuda.FloatTensor [3</span><br><span class="line">, 64, 7, 7]] is at version 2; expected version 1 instead. Hint: the backtrace further above shows the operation that failed to compute i</span><br><span class="line">ts gradient. The variable in question was changed in there or anywhere later. Good luck!</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç„¶åå‘ç°è²Œä¼¼æ˜¯åœ¨convå±‚å‘ç”Ÿäº†inplaceoperationï¼Œä½†æ˜¯å®åœ¨æ²¡æœ‰å¤´ç»ªï¼Œæœ€ååˆæ‰¾åˆ°ä¸€ç¯‡åšæ–‡ä¸æˆ‘çš„æƒ…å†µéå¸¸ç±»ä¼¼(<a href="https://www.cnblogs.com/js2hou/p/13923089.html">RuntimeError: oneof the variables needed for gradient computation has been modified by aninplace operation - Js2Hou - åšå®¢å›­(cnblogs.com)</a>)ï¼Œæœ€åå‘ç°æ˜¯ä»£ç æ‰§è¡Œçš„é¡ºåºé—®é¢˜ï¼ŒåŸæœ¬çš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">optimize_parameters</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.backward_all_net()        </span><br><span class="line">    </span><br><span class="line">    <span class="variable language_">self</span>.optimizer_gridnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.loss_gridnet.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_gridnet.step()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_pixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.loss_pixelnet.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_pixelnet.step()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_depixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.loss_depixelnet.backward()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_depixelnet.step()<span class="comment"># å‡ºé”™å¤„</span></span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_gridnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.backward_D_gridnet()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_gridnet.step()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_pixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.backward_D_pixelnet()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_pixelnet.step()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_depixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.backward_D_depixelnet()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_depixelnet.step()</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹åçš„ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">optimize_parameters</span>(<span class="params">self</span>):</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_gridnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_pixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_depixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_gridnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_pixelnet.zero_grad()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_depixelnet.zero_grad()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.backward_all_net()        </span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.loss_gridnet.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">    <span class="variable language_">self</span>.loss_pixelnet.backward(retain_graph=<span class="literal">True</span>)</span><br><span class="line">    <span class="variable language_">self</span>.loss_depixelnet.backward()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_gridnet.step()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_pixelnet.step()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_depixelnet.step()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.backward_D_gridnet()</span><br><span class="line">    <span class="variable language_">self</span>.backward_D_pixelnet()</span><br><span class="line">    <span class="variable language_">self</span>.backward_D_depixelnet()</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_gridnet.step()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_pixelnet.step()</span><br><span class="line">    <span class="variable language_">self</span>.optimizer_D_depixelnet.step()</span><br></pre></td></tr></table></figure><p>ç»ˆäºé¡ºåˆ©è§£å†³ï¼ï¼ï¼</p><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><ol type="1"><li><p><a href="https://zhuanlan.zhihu.com/p/38475183">å…³äº pytorchinplace operation, éœ€è¦çŸ¥é“çš„å‡ ä»¶äº‹ - çŸ¥ä¹ (zhihu.com)</a></p></li><li><p><a href="https://blog.csdn.net/york1996/article/details/81835873">åœ¨PyTorchä¸­in-placeoperationçš„å«ä¹‰_York1996çš„åšå®¢-CSDNåšå®¢_inplace operation</a></p></li><li><p><a href="https://github.com/pytorch/pytorch/issues/15803">Debugging featurefor "modified by an inplace operation" errors Â· Issue #15803 Â·pytorch/pytorch Â· GitHub</a></p></li><li><p><a href="https://www.cnblogs.com/js2hou/p/13923089.html">RuntimeError: oneof the variables needed for gradient computation has been modified by aninplace operation - Js2Hou - åšå®¢å›­ (cnblogs.com)</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bug </tag>
            
            <tag> CV </tag>
            
            <tag> PyTorch </tag>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾åƒåƒç´ ç”»ç”Ÿæˆæ–¹æ³•æ€»ç»“ï¼ˆå›¾åƒä¸‹é‡‡æ ·ï¼‰</title>
      <link href="/2022/07/10/computervision/tu-pian-xia-cai-yang-duo-chong-fang-fa-zong-jie/"/>
      <url>/2022/07/10/computervision/tu-pian-xia-cai-yang-duo-chong-fang-fa-zong-jie/</url>
      
        <content type="html"><![CDATA[<p>å›¾ç‰‡çš„ä¸Šé‡‡æ ·å’Œä¸‹é‡‡æ ·åˆ†åˆ«å¯¹åº”å›¾ç‰‡çš„æ”¾å¤§å’Œç¼©å°ï¼Œåœ¨å¯¹å›¾åƒè¿›è¡Œé‡‡æ ·çš„è¿‡ç¨‹ä¸­ä¼šé€ æˆä¸åŒç¨‹åº¦çš„æ¨¡ç³Šã€‚å›¾åƒçš„åƒç´ ç”»ç”Ÿæˆé‡‡ç”¨çš„æ–¹æ³•å°±æ˜¯å›¾ç‰‡ä¸‹é‡‡ç”¨çš„æ–¹æ³•ã€‚æœ¬æ–‡ä¼šå¯¹å›¾åƒåƒç´ åŒ–çš„æ–¹æ³•è¿›è¡Œæ€»ç»“ã€‚</p><span id="more"></span><h1><span id="ä¼ ç»Ÿçš„æ’å€¼æ–¹æ³•">ä¼ ç»Ÿçš„æ’å€¼æ–¹æ³•</span></h1><p>é¦–å…ˆï¼Œä»<code>OpenCV</code>ä¸­çš„<code>cv2.resize()</code>ä¸­æ‰€é‡‡ç”¨çš„æ–¹æ³•æ¥çœ‹ï¼Œä¼ ç»Ÿçš„å›¾ç‰‡é‡‡æ ·æ–¹æ³•ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ç§(æ‹¬å·ä¸­ä¸ºåœ¨<code>OpenCV</code>ä¸­çš„æ’å€¼Flag)ï¼š 1. Nearest Neighbor(INTER_NEAREST) 2. Linear Interpolation (INTER_LINEAR) 3. BicubicInterpolation (INTER_CUBIC) 4. Area Interpolation (INTER_AREA) 5.Lanczos interpolation (INTER_LANCZOS4)</p><p>æˆ‘ä»¬å®šä¹‰ä¸€å¼ å›¾ç‰‡ä¸ºä¸€ä¸ª<code>ndarray</code>ï¼Œimage width <span class="math inline">\(= W\)</span>, image height <span class="math inline">\(= H\)</span>,æ‰€ä»¥<code>image.shape = (W, H, 3)</code>, ç›®æ ‡å›¾ç‰‡çš„image width <span class="math inline">\(= TW\)</span>, image height <span class="math inline">\(= TH\)</span>,<code>output.shape = (TW, TH, 3)</code>ã€‚å¾—å‡ºé•¿å’Œå®½çš„ç¼©æ”¾æ¯”åˆ†åˆ«ä¸º<span class="math inline">\(TW/W, TH/H\)</span>ã€‚ ## æœ€è¿‘æ’å€¼ (NearestNeighbor)æœ€ç®€å•ç›´è§‚çš„ä¸€ç§æ’å€¼æ–¹æ³•ã€‚åªéœ€è¦ä»ç›®æ ‡å›¾åƒçš„åæ ‡æ˜ å°„åˆ°åŸå›¾åƒåï¼Œæ‰¾åˆ°ä¸´è¿‘çš„åæ ‡å³å¯ã€‚æ¯”å¦‚å¯¹äºtargetimageçš„<span class="math inline">\((i,j)\)</span>åƒç´ ï¼Œæ˜ å°„åˆ°åŸå›¾åƒä¸Šå°±æ˜¯<span class="math inline">\((i\times\frac{W}{TW},j\times\frac{H}{TH})\)</span>ï¼Œç„¶åå››èˆäº”å…¥å°±æ˜¯å¯¹åº”çš„åŸå›¾åƒçš„åƒç´ åæ ‡ã€‚</p><h2><span id="çº¿æ€§æ’å€¼-linearinterpolation">çº¿æ€§æ’å€¼ (LinearInterpolation)</span></h2><p>æ¯”è¾ƒå¸¸è§çš„æ’å€¼ç®—æ³•ã€‚å¾—åˆ°åŸå›¾åƒä¸Šå¯¹åº”çš„åæ ‡åï¼Œä½¿ç”¨åŒçº¿æ€§æ’å€¼ï¼Œå¾—åˆ°å¯¹åº”çš„åƒç´ å€¼ã€‚ä¸‹å›¾ä¸ºåŒçº¿æ€§æ’å€¼çš„ç¤ºæ„å›¾ã€‚<img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20220710205724.png">## åŒä¸‰æ¬¡æ’å€¼ (Bicubic Interpolation)åŒä¸‰æ¬¡æ’å€¼å°±æ›´åŠ å¤æ‚ä¸€äº›ã€‚æ¯”èµ·çº¿æ€§æ’å€¼çš„æ ¹æ®å‘¨å›´å››ä¸ªç‚¹è¿›è¡Œæ’å€¼ï¼ŒåŒä¸‰æ¬¡æ’å€¼éœ€è¦ç”¨åˆ°å‘¨å›´çš„16ä¸ªç‚¹è¿›è¡ŒåŠ æƒã€‚ä½¿ç”¨çš„æ’å€¼å…¬å¼ä¹Ÿä¸æ˜¯çº¿æ€§çš„ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸‰æ¬¡æ–¹ç¨‹ã€‚## åŒºåŸŸæ’å€¼æ³• (Area Interpolation) AreaInterpolationå¯¹æˆ‘ä¸ªäººæ¥è¯´å®é™…ä¸Šæ›´åŠ ç¬¦åˆç›´è§‰ï¼Œä¹Ÿå°±æ˜¯æ ¹æ®å›¾ç‰‡çš„ç¼©æ”¾æ¯”ï¼Œæ‰¾åˆ°ç”Ÿæˆçš„ç›®æ ‡çš„å›¾åƒæ‰€å¯¹åº”çš„ä¸€å—åŒºåŸŸï¼Œå¯¹è¯¥åŒºåŸŸè¿›è¡ŒåŠ æƒå¹³å‡ï¼Œäº‹å®ä¸Šè¿™ç§æ–¹æ³•åœ¨ç¼©æ”¾æ™®é€šå›¾åƒçš„æ—¶å€™æ„Ÿè§‰èƒ½å¤Ÿè¾ƒå¥½çš„ä¿ç•™åŸæœ¬å›¾åƒçš„ç‰¹å¾ï¼Œç¼ºç‚¹å°±æ˜¯è¾¹ç¼˜ä¼šæ˜¾å¾—éå¸¸æ¨¡ç³Šï¼Œæ‰€ä»¥ä¸æ˜¯å¾ˆåˆ©äºå¯¹å›¾åƒè¿›è¡Œåƒç´ åŒ–ã€‚## Lanczosé‡é‡‡æ ·Lanczosåœ¨å½¢å¼ä¸Šå’ŒåŒä¸‰æ¬¡æ’å€¼æœ‰ç€ç›¸ä¼¼ä¹‹å¤„ï¼Œé€šè¿‡ä¸€ä¸ªå†…æ ¸å‡½æ•°è®¡ç®—æ¯ä¸ªåƒç´ å¯¹åº”çš„æƒé‡ã€‚<a href="https://en.wikipedia.org/wiki/Lanczos_resampling">Lanczosresampling-ç»´åŸºç™¾ç§‘</a>ã€‚</p><h1><span id="å…¶ä»–è¿›è¡Œåƒç´ ç”»çš„æ–¹æ³•">å…¶ä»–è¿›è¡Œåƒç´ ç”»çš„æ–¹æ³•</span></h1><p>é™¤äº†ä¼ ç»Ÿçš„æ’å€¼æ–¹æ³•ï¼Œè¿˜æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•è¿›è¡Œå›¾ç‰‡ä¸‹é‡‡æ ·ç”Ÿæˆåƒç´ ç”»ã€‚ 1.Content-Adaptive <a href="https://johanneskopf.de/publications/downscaling"><sup>2</sup></a>2. Perceptual based downscaling <a href="https://dl.acm.org/doi/10.1145/2766891"><sup>3</sup></a> 3. ImageAbstraction Method <a href="https://gfx.cs.princeton.edu/pubs/Gerstner_2012_PIA/index.php"><sup>4</sup></a>4. Deep Unsupervised Downscaling <a href="https://www.cse.cuhk.edu.hk/~ttwong/papers/pixel/pixel.html"><sup>5</sup></a>ï¼Œä½¿ç”¨æ·±åº¦å­¦ä¹ GANçš„æ–¹å¼è¿›è¡Œå›¾ç‰‡ç”Ÿæˆï¼Œå¯ä»¥è¾ƒå¥½çš„ä¿ç•™å›¾ç‰‡çš„è¾¹ç¼˜ï¼Œå‡å°‘ç”±äºè¾¹ç•Œæ‰€é€ æˆçš„æ¨¡ç³Šæ•ˆæœã€‚</p><h1><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h1><ol type="1"><li><a href="https://docs.opencv.org/4.5.1/da/d54/group__imgproc__transform.html#ga5bb5a1fea74ea38e1a5445ca803ff121">OpenCV-GeometricImage Transformations</a></li><li><a href="https://johanneskopf.de/publications/downscaling/">Content-AdaptiveImage Downscaling</a></li><li><a href="https://dl.acm.org/doi/10.1145/2766891">Perceptually baseddownscaling of images</a></li><li><a href="https://gfx.cs.princeton.edu/pubs/Gerstner_2012_PIA/index.php">PixelatedImage Abstraction</a></li><li><a href="https://www.cse.cuhk.edu.hk/~ttwong/papers/pixel/pixel.html">DeepUnsupervised Pixelization</a></li><li><a href="https://blog.csdn.net/u010468553/article/details/79359488">Lanczosé‡é‡‡æ · - CSDN</a></li><li><a href="https://zh.m.wikipedia.org/zh-hans/%E5%8F%8C%E4%B8%89%E6%AC%A1%E6%8F%92%E5%80%BC">åŒä¸‰æ¬¡æ’å€¼-ç»´åŸºç™¾ç§‘</a></li><li><a href="https://www.youtube.com/watch?v=poY_nGzEEWM">ä¸€ä¸ªBicubicè®²çš„å¾ˆæ¸…æ¥šçš„youtube-BicubicInterpolation - Computerphile</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> ComputerVision </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CV </tag>
            
            <tag> python </tag>
            
            <tag> å›¾åƒå¤„ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Riderå’ŒEmmyluaè¿›è¡ŒUnLuaé…ç½®</title>
      <link href="/2022/06/27/gamegraphics/shi-yong-rider-he-emmylua-jin-xing-unlua-pei-zhi/"/>
      <url>/2022/06/27/gamegraphics/shi-yong-rider-he-emmylua-jin-xing-unlua-pei-zhi/</url>
      
        <content type="html"><![CDATA[<p>åœ¨Riderä¸­é…ç½®UnLuaç¯å¢ƒå°±å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªIDEåŒæ—¶è¿›è¡Œc++å’ŒLuaçš„å¼€å‘ï¼Œä¸ç”¨åˆ‡æ¢vscodeå’ŒVisualStudioï¼Œå¹¶ä¸”Rideræ›´åŠ ç¾è§‚ï¼Œæ“ä½œé€»è¾‘å’Œä»£ç æç¤ºä¹Ÿæ¯”VisualStudioåŠ ç•ªèŒ„æ’ä»¶æ›´åŠ å¥½ç”¨ã€‚æ‰€ä»¥è¿˜æ˜¯éå¸¸æ¨èä½¿ç”¨Riderè¿›è¡ŒUEçš„å¼€å‘çš„ã€‚</p><span id="more"></span><h3><span id="emmyluaé…ç½®intellisence">Emmyluaé…ç½®IntelliSence</span></h3><p>é¦–å…ˆåœ¨Riderä¸­ä¸‹è½½æ’ä»¶EmmyLuaï¼ŒEmmyLuaæä¾›äº†ä»£ç æç¤ºè¯­æ³•æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚ç„¶åæ‰“å¼€é¡¹ç›®ï¼Œå¦‚æœæŒ‰ç…§UnLuaä»“åº“ä¸­çš„æŒ‡ç¤ºæ­£ç¡®å®‰è£…æ’ä»¶åï¼ŒUEçš„ç•Œé¢å°±ä¼šå‡ºç°ä¸‹å›¾ä¸­çš„å›¾æ ‡ï¼Œç‚¹å‡»GenerateIntelliSenseï¼ŒUnLuaå°±ä¼šç”Ÿæˆå‡ºä»£ç æ™ºèƒ½æç¤ºæ–‡ä»¶å¤¹ã€‚</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20220627232545.png"></p><p>ç„¶åï¼Œåœ¨Riderä¸­ç‚¹å‡»Solutioné¢æ¿ä¸­çš„Show AllFilesæŒ‰é’®å³å¯æ˜¾ç¤ºæ‰€æœ‰æ–‡ä»¶ï¼Œ</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20220627232907.png"></p><p>æ‰¾åˆ°é¡¹ç›®çš„Luaæ–‡ä»¶å¤¹(Content/Scipts)ä»¥åŠIntelliSenseæ–‡ä»¶å¤¹(Plugins/Unlua/Intermediate/IntelliSense)ï¼Œåˆ†åˆ«å³é”®ï¼ŒTools-&gt;AttachtoSolutionå°±å¯ä»¥æ·»åŠ åˆ°Solutionä¸­è¿›è¡ŒIndexï¼Œè¿™æ ·å­ä»£ç è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½å°±é…ç½®å®Œæˆäº†ã€‚ä¹‹åå–æ¶ˆShowAll Fileså°±å¯ä»¥å†æ¬¡éšè—ä¸éœ€è¦çš„æ–‡ä»¶ä½†æ˜¯Scriptsæ–‡ä»¶å¤¹è¿˜æ˜¯åœ¨çš„ã€‚</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/20220627233258.png"></p><h3><span id="ä½¿ç”¨emmyluaè¿›è¡Œdebug">ä½¿ç”¨EmmyLuaè¿›è¡ŒDebug</span></h3><p>ç›®å‰è¿˜æ²¡æœ‰æˆåŠŸç”¨EmmyLuaè¿›è¡ŒDebugè¿‡orzï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆå°±æ˜¯æ²¡æ³•Debugï¼Œæœ€åè¿˜æ˜¯æ”¾å¼ƒäº†ï¼Œæ¢å›äº†VSCode+LuaHelperï¼Œä½¿ç”¨LuaPandaè¿›è¡ŒDebugï¼Œæ²¡æœ‰é‚£ä¹ˆéº»çƒ¦ã€‚ä¼¼ä¹LuaHelperçš„æ³¨è§£åŠŸèƒ½å¥½åƒæœ‰å¢å¼ºï¼Œç”¨ä¸‹æ¥è¿˜æ˜¯ä¸é”™çš„ï¼Œä¸è¿‡åœ¨ä¸€ä¸ªIDEé‡Œå†™ä»£ç çš„æƒ³æ³•ç ´ç­äº†lolã€‚</p><p>ï¼ˆ2022.7.10æ›´æ–°ï¼‰æœ€åå‘ç°Luahelperçš„ä»£ç æç¤ºæ—¶ä¸æ—¶ä¼šæŠ½æï¼Œä¼šæ˜¾ç¤ºé”™è¯¯æˆ–è€…æ˜¾ç¤ºä¸å‡ºæ¥ï¼Œvscodeå°±åªç”¨æ¥debugç”¨äº†ï¼Œå®é™…å¼€å‘å†™ä»£ç çš„æ—¶å€™è¿˜æ˜¯é€‰æ‹©ä½¿ç”¨Rideråœ¨ä¸€ä¸ªIDEä¸­å†™ä»£ç è¿˜æ˜¯æ›´çˆ½ï¼</p>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Unreal Engine </tag>
            
            <tag> IDE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾å½¢å­¦å…¥é—¨ç¬”è®°2: Ray Tracing</title>
      <link href="/2022/02/28/gamegraphics/tu-xing-xue-ru-men-bi-ji-2-ray-tracing/"/>
      <url>/2022/02/28/gamegraphics/tu-xing-xue-ru-men-bi-ji-2-ray-tracing/</url>
      
        <content type="html"><![CDATA[<p>Games101ä½œä¸š5å®ç°ç¬”è®°ä»¥åŠWitted Style Ray Tracingå’ŒMoller TrumboreAlgorithmç¬”è®°</p><h2><span id="witted-style-å…‰çº¿è¿½è¸ª">Witted Style å…‰çº¿è¿½è¸ª</span></h2><p>æœ€åŸºç¡€æœ€åŸå§‹çš„å…‰çº¿è¿½è¸ªç®—æ³•ã€‚æ ¹æ®å…‰è·¯çš„å¯é€†æ€§ï¼Œæˆ‘ä»¬ä»çœ¼ç›å¤„æœç€åƒç´ ç‚¹å‘å°„ä¸€é“å…‰çº¿ï¼Œè¿™é“å…‰çº¿ä¸åœºæ™¯ä¸­çš„ç‰©ä½“ç›¸äº¤ä¼šå‘ç”Ÿåå°„å’ŒæŠ˜å°„ï¼Œè¿™é‡Œæˆ‘ä»¬é»˜è®¤åå°„æ˜¯é•œé¢åå°„ï¼Œäº§ç”Ÿçš„ä¸¤é“å…‰çº¿ä¼šç»§ç»­å’Œåœºæ™¯ä¸­çš„ç‰©ä½“ç›¸äº¤äº§ç”Ÿæ–°çš„æŠ˜å°„å…‰çº¿å’Œåå°„å…‰çº¿ï¼Œè¿™å°±æ˜¯å…‰çº¿è¿½è¸ªçš„åŸºæœ¬åŸç†ã€‚å¦‚æœä¸åŠ ä»¥é™åˆ¶ï¼Œå…‰è·¯çš„åå°„å’ŒæŠ˜å°„ä¼šä¸æ–­è¿›è¡Œä¸‹å»ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªåå°„æ·±åº¦é™åˆ¶ã€‚</p><span id="more"></span><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20220912001300536.png"></p><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•ä¸åœºæ™¯ä¸­çš„ç‰©ä½“æ±‚äº¤çš„é—®é¢˜äº†ï¼Œå…‰çº¿çš„æ–¹ç¨‹ä¸º<span class="math inline">\(\mathbf{r}(t)=\mathbf{o}+t\mathbf{d}\)</span>ï¼Œ<span class="math inline">\(\mathbf{o}\)</span>è¡¨ç¤ºå‘å°„å‡ºå…‰çº¿çš„ç‚¹ï¼Œ<span class="math inline">\(\mathbf{d}\)</span>è¡¨ç¤ºå…‰çº¿å‘å°„çš„æ–¹å‘å•ä½å‘é‡ï¼Œ<span class="math inline">\(t(t&gt;0)\)</span>å¯ä»¥ç†è§£ä¸ºâ€œæ—¶é—´â€ï¼Œä»£è¡¨ä»å‘å°„å…‰çº¿çš„ç‚¹åˆ°äº¤ç‚¹çš„è·ç¦»ã€‚å¦‚æœæ˜¯å’Œè§„åˆ™çš„å¯ä»¥ç”¨æ–¹ç¨‹è¡¨ç¤ºå‡ºæ¥çš„ç‰©ä½“æ¯”å¦‚è¯´çƒå‹ç­‰è¿›è¡Œæ±‚äº¤ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥è”ç«‹å…‰çº¿å’Œç‰©ä½“è¡¨é¢çš„æ–¹ç¨‹ç®—å‡ºè§£å³å¯ã€‚ä½†æ˜¯å®é™…æƒ…å†µä¸­å¤§éƒ¨åˆ†çš„ç‰©ä½“éƒ½æ˜¯é‡‡ç”¨Meshçš„æ–¹å¼ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å…‰çº¿å°±éœ€è¦å’Œåœºæ™¯ä¸­çš„ä¸€ä¸ªä¸ªä¸‰è§’å½¢è¡¨é¢è¿›è¡Œæ±‚äº¤ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç”¨åˆ°MollerTrumbore Algorithmã€‚ $$ <span class="math display">\[\begin{align}\vec{\mathbf{O}}+t\vec{\mathbf{D}}&amp;=(1-b_1-b_2)\vec{\mathbf{P_0}}+b_1\vec{\mathbf{P_1}}+b_2\vec{\mathbf{P_2}}\\\left[      \begin{matrix}        t \\        b_1 \\        b_2    \end{matrix}\right] &amp;=\frac{1}{\mathbf{\vec{S_1}\cdot\vec{E_1}}}\left[    \begin{matrix}        \mathbf{\vec{S_2}\cdot\vec{E_2}} \\        \mathbf{\vec{S_1}\cdot\vec{S}} \\        \mathbf{\vec{S_2}\cdot\vec{D}} \\    \end{matrix}\right], \\\text{where } \vec{\mathbf{E_1}} &amp;=\mathbf{\vec{P_1}-\vec{P_0}}, \\\vec{\mathbf{E_2}} &amp;= \vec{\mathbf{P_2}}-\vec{\mathbf{P_0}},\\\vec{\mathbf{S}} &amp;= \vec{\mathbf{O}}-\vec{\mathbf{P_0}},\\\vec{\mathbf{S_1}} &amp;= \vec{\mathbf{D}}-\vec{\mathbf{E_2}},\\\vec{\mathbf{S_2}} &amp;= \vec{\mathbf{S}}-\vec{\mathbf{E_1}},\\\end{align}\]</span> $$</p><p>å…¶ä¸­<span class="math inline">\(P_0, P_1,P_2\)</span>æ˜¯ä¸‰è§’å½¢çš„ä¸‰ä¸ªé¡¶ç‚¹ï¼Œè¿™é‡Œä½¿ç”¨äº†é‡å¿ƒåæ ‡æ¥è¡¨ç¤ºä¸‰è§’å½¢å†…çš„ä»»æ„ä¸€ç‚¹ã€‚åˆ©ç”¨è¿™ä¸ªç­‰å¼è§£å‡ºæ­£æ•°<span class="math inline">\(t\)</span>ï¼Œå°±å¯ä»¥å¾—åˆ°äº¤ç‚¹åæ ‡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä½œä¸š5ä¸­æˆ‘ä»¬éœ€è¦å®ç°çš„ç®—æ³•ã€‚</p><h2><span id="ä½œä¸š5ç›¸å…³ä»£ç å®ç°">ä½œä¸š5ç›¸å…³ä»£ç å®ç°</span></h2><p>æœ¬æ¬¡ä½œä¸šä¸»è¦å®ç°ä¸¤ä¸ªå‡½æ•°</p><ol type="1"><li><p><code>Triangle.hpp</code>çš„<code>rayTriangleIntersect()</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ç”¨æ¥è®¡ç®—å…‰çº¿å’Œä¸‰è§’å½¢æ±‚äº¤çš„ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">bool</span> <span class="title">rayTriangleIntersect</span><span class="params">(<span class="type">const</span> Vector3f&amp; v0, <span class="type">const</span> Vector3f&amp; v1, <span class="type">const</span> Vector3f&amp; v2, <span class="type">const</span> Vector3f&amp; orig,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> Vector3f&amp; dir, <span class="type">float</span>&amp; tnear, <span class="type">float</span>&amp; u, <span class="type">float</span>&amp; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Implement this function that tests whether the triangle</span></span><br><span class="line">    <span class="comment">// that&#x27;s specified bt v0, v1 and v2 intersects with the ray (whose</span></span><br><span class="line">    <span class="comment">// origin is *orig* and direction is *dir*)</span></span><br><span class="line">    <span class="comment">// Also don&#x27;t forget to update tnear, u and v.</span></span><br><span class="line">    <span class="keyword">auto</span> S = orig - v0;</span><br><span class="line">    <span class="keyword">auto</span> E_1 = v1 - v0;</span><br><span class="line">    <span class="keyword">auto</span> E_2 = v2 - v0;</span><br><span class="line">    <span class="keyword">auto</span> S_1 = <span class="built_in">crossProduct</span>(dir, E_2);</span><br><span class="line">    <span class="keyword">auto</span> S_2 = <span class="built_in">crossProduct</span>(S, E_1);</span><br><span class="line">    <span class="keyword">auto</span> S<span class="number">1E1</span>  = <span class="built_in">dotProduct</span>(S_1, E_1);</span><br><span class="line">    <span class="type">float</span> t = <span class="built_in">dotProduct</span>(S_2, E_2) / S<span class="number">1E1</span>;</span><br><span class="line">    <span class="type">float</span> b_1 = <span class="built_in">dotProduct</span>(S_1, S) / S<span class="number">1E1</span>;</span><br><span class="line">    <span class="type">float</span> b_2 = <span class="built_in">dotProduct</span>(S_2, dir) / S<span class="number">1E1</span>;</span><br><span class="line">    <span class="keyword">if</span> (t &gt;= <span class="number">0.0f</span> &amp;&amp; b_1 &gt;= <span class="number">0.0f</span> &amp;&amp; b_2 &gt;= <span class="number">0.0f</span> &amp;&amp; (<span class="number">1</span> - b_1 - b_2) &gt;= <span class="number">0.0f</span>) &#123;</span><br><span class="line">        tnear = t;</span><br><span class="line">        u = b_1;</span><br><span class="line">        v = b_2;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ç¬¬äºŒä¸ªå‡½æ•°æ˜¯<code>Renderer.cpp</code>ä¸­çš„<code>Render()</code>ï¼Œä¸»è¦æ˜¯è€ƒå¯Ÿå±å¹•ç©ºé—´å’Œä¸–ç•Œç©ºé—´ä¹‹é—´çš„è½¬åŒ–é—®é¢˜ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// [comment]</span></span><br><span class="line"><span class="comment">// The main render function. This where we iterate over all pixels in the image, generate</span></span><br><span class="line"><span class="comment">// primary rays and cast these rays into the scene. The content of the framebuffer is</span></span><br><span class="line"><span class="comment">// saved to a file.</span></span><br><span class="line"><span class="comment">// [/comment]</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::Render</span><span class="params">(<span class="type">const</span> Scene&amp; scene)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="function">std::vector&lt;Vector3f&gt; <span class="title">framebuffer</span><span class="params">(scene.width * scene.height)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> scale = std::<span class="built_in">tan</span>(<span class="built_in">deg2rad</span>(scene.fov * <span class="number">0.5f</span>));</span><br><span class="line">    <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Use this variable as the eye position to start your rays.</span></span><br><span class="line">    <span class="function">Vector3f <span class="title">eye_pos</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// generate primary ray direction</span></span><br><span class="line">            <span class="comment">// Find the x and y positions of the current pixel to get the direction</span></span><br><span class="line">            <span class="comment">// vector that passes through it.</span></span><br><span class="line">            <span class="comment">// Also, don&#x27;t forget to multiply both of them with the variable *scale*, and</span></span><br><span class="line">            <span class="comment">// x (horizontal) variable with the *imageAspectRatio*</span></span><br><span class="line">            <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5f</span>) / (<span class="type">float</span>)(scene.width<span class="number">-1</span>) - <span class="number">1.0f</span>) * imageAspectRatio * scale;</span><br><span class="line">            <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5f</span>) / (<span class="type">float</span>)(scene.height<span class="number">-1</span>)) * scale;</span><br><span class="line"></span><br><span class="line">            Vector3f dir = <span class="built_in">normalize</span>(<span class="built_in">Vector3f</span>(x, y, <span class="number">-1</span>)); <span class="comment">// Don&#x27;t forget to normalize this direction!</span></span><br><span class="line">            framebuffer[m++] = <span class="built_in">castRay</span>(eye_pos, dir, scene, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">UpdateProgress</span>(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save framebuffer to file</span></span><br><span class="line">    FILE* fp = <span class="built_in">fopen</span>(<span class="string">&quot;binary-test.ppm&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i) &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">        color[<span class="number">0</span>] = (<span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x));</span><br><span class="line">        color[<span class="number">1</span>] = (<span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y));</span><br><span class="line">        color[<span class="number">2</span>] = (<span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z));</span><br><span class="line">        <span class="built_in">fwrite</span>(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(fp);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>æœ€ç»ˆç”Ÿæˆçš„ç»“æœå¦‚ä¸‹</p><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/output.jpg"></p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><p><a href="https://zhuanlan.zhihu.com/p/431092843">Games101-ä½œä¸š5 -çŸ¥ä¹ (zhihu.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cpp </tag>
            
            <tag> å›¾å½¢å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vscodeç¼–è¯‘.cppæ–‡ä»¶å‡ºç°ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ</title>
      <link href="/2022/02/25/bug/g-bian-yi.cpp-wen-jian-chu-xian-zhong-wen-luan-ma-jie-jue-fang-an/"/>
      <url>/2022/02/25/bug/g-bian-yi.cpp-wen-jian-chu-xian-zhong-wen-luan-ma-jie-jue-fang-an/</url>
      
        <content type="html"><![CDATA[<h1><span id="vscodeç¼–è¯‘cppæ–‡ä»¶å‡ºç°ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ">vscodeç¼–è¯‘.cppæ–‡ä»¶å‡ºç°ä¸­æ–‡ä¹±ç è§£å†³æ–¹æ¡ˆ</span></h1><p>åœ¨vscodeä¸­ç¼–è¯‘.cppæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨vscodeä¸­çš„æ’ä»¶coderunnerç‚¹å‡»æŒ‰é’®è¿è¡Œï¼Œå¦‚æœç†Ÿæ‚‰å¦‚ä½•ä½¿ç”¨g++çš„å‘½ä»¤ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤è¡Œè¯­å¥ç¼–è¯‘è¿è¡Œã€‚ä½†æ˜¯å¦‚æœæ–‡ä»¶ä¸­å‡ºç°äº†ä¸­æ–‡å­—ç¬¦ï¼Œå°±ä¼šå‡ºç°ç¼–è¯‘ä¹‹åç”Ÿæˆä¹±ç çš„é—®é¢˜ã€‚æ¯”å¦‚è¿™ä¸€æ®µä»£ç ï¼ˆæ¥æºäº<a href="https://www.runoob.com/cplusplus/cpp-data-types.html">èœé¸Ÿæ•™ç¨‹</a>ï¼‰</p><span id="more"></span><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;limits&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span>  </span></span><br><span class="line"><span class="function"></span>&#123;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;type: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;************size**************&quot;</span>&lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;bool: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">bool</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">bool</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\t\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">bool</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;char: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">char</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">char</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\t\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">char</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;signed char: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">signed</span> <span class="type">char</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">signed</span> <span class="type">char</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\t\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">signed</span> <span class="type">char</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;unsigned char: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">char</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\t\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">unsigned</span> <span class="type">char</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;wchar_t: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">wchar_t</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">wchar_t</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\t\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">wchar_t</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;short: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">short</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">short</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\t\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">short</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;int: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">int</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">int</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">int</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;unsigned: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">unsigned</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">unsigned</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">unsigned</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;long: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">long</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">long</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">long</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;unsigned long: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">unsigned</span> <span class="type">long</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">unsigned</span> <span class="type">long</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">unsigned</span> <span class="type">long</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;double: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">double</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">double</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">double</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;long double: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">long</span> <span class="type">double</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">long</span> <span class="type">double</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">long</span> <span class="type">double</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;float: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">float</span>); </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">float</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">float</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;size_t: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(<span class="type">size_t</span>);  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å¤§å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">size_t</span>&gt;::max)();  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\tæœ€å°å€¼ï¼š&quot;</span> &lt;&lt; (numeric_limits&lt;<span class="type">size_t</span>&gt;::min)() &lt;&lt; endl;  </span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;string: \t&quot;</span> &lt;&lt; <span class="string">&quot;æ‰€å å­—èŠ‚æ•°ï¼š&quot;</span> &lt;&lt; <span class="built_in">sizeof</span>(string) &lt;&lt; endl;  </span><br><span class="line">    <span class="comment">// &lt;&lt; &quot;\tæœ€å¤§å€¼ï¼š&quot; &lt;&lt; (numeric_limits&lt;string&gt;::max)() &lt;&lt; &quot;\tæœ€å°å€¼ï¼š&quot; &lt;&lt; (numeric_limits&lt;string&gt;::min)() &lt;&lt; endl;  </span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;type: \t\t&quot;</span> &lt;&lt; <span class="string">&quot;************size**************&quot;</span>&lt;&lt; endl;  </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç›´æ¥è¿è¡Œçš„è¯ç»“æœæ˜¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">type:           ************size**************</span><br><span class="line">bool:           éµâ‚¬é—çŠ²ç“§é‘ºå‚›æšŸé”›?</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œåˆ°ä¹±ç çš„éƒ¨åˆ†å°±ç›´æ¥ç»“æŸäº†ï¼Œè¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ³•è§£å†³ã€‚</p><h3><span id="1-æ›´æ”¹æ–‡ä»¶ç¼–ç ç±»å‹">1. æ›´æ”¹æ–‡ä»¶ç¼–ç ç±»å‹</span></h3><p>åœ¨vscodeå·¦ä¸‹è§’æœ‰ä¸€ä¸ªé€‰æ‹©ç¼–ç çš„æŒ‰é’®ï¼Œé»˜è®¤æ˜¯<code>utf-8</code>ç¼–ç ï¼Œç‚¹å‡»ä¹‹åå†ç‚¹å‡»é€šè¿‡ç¼–ç é‡æ–°æ‰“å¼€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ç¬¬ä¸€ä¸ªé€‰é¡¹åé¢ä¼šæœ‰'é€šè¿‡æ–‡ä»¶å†…å®¹çŒœæµ‹'ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå¯ä»¥æœç´¢GBKï¼Œå°†ç¼–ç è®¾ç½®ä¸ºGBKï¼ˆæ±‰å­—ç¼–ç ï¼‰ï¼Œæ³¨æ„ï¼šè¿™ä¸ªæ—¶å€™å¦‚æœå†æ›´æ”¹å›utf-8ï¼Œæ‰€æœ‰çš„ä¸­æ–‡åœ¨ç¼–è¾‘å™¨ä¸­æ˜¾ç¤ºéƒ½ä¼šæ˜¯ä¹±ç ï¼Œä½†æ˜¯ç¼–è¯‘è¿˜æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚è¿˜æœ‰ä¸€ç§æ”¹å˜ç¼–ç çš„æ–¹å¼ï¼Œå°±æ˜¯ç”¨è®°äº‹æœ¬æ‰“å¼€ï¼Œç„¶åå¦å­˜ä¸ºï¼Œåœ¨ç¼–ç ä¸€æ é‡Œé€‰æ‹©ANSIï¼Œç„¶åç¼–è¯‘è¿è¡Œå°±å¯ä»¥äº†ã€‚ï¼ˆè¿™ä¸ªæ—¶å€™åœ¨vscodeä¸­çš„ä»£ç è¿˜æ˜¯ä¼šä¹±ç çš„ï¼Œæ‰€ä»¥è¿˜æ˜¯å»ºè®®ä½¿ç”¨ä¸Šä¸€ç§æ–¹æ³•ï¼‰</p><h3><span id="2-å‘½ä»¤è¡Œæ“ä½œ">2. å‘½ä»¤è¡Œæ“ä½œ</span></h3><p>å¦‚æœä¸æ”¹å˜ä»£ç çš„ç¼–ç ç±»å‹ï¼Œå¯ä»¥åœ¨ç¼–è¯‘çš„æ—¶å€™è®¾ç½®ç¼–è¯‘çš„ç¼–ç ç±»å‹ã€‚åœ¨è¿è¡Œæ—¶ä½¿ç”¨ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ -fexec-charset=GBK test.cpp -o test</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨GBKç¼–ç ç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test.exe</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œæ–‡ä»¶</p><p>å¾—åˆ°ç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">type:         ************size**************</span><br><span class="line">bool:         æ‰€å å­—èŠ‚æ•°ï¼š1    æœ€å¤§å€¼ï¼š1        æœ€å°å€¼ï¼š0</span><br><span class="line">char:         æ‰€å å­—èŠ‚æ•°ï¼š1    æœ€å¤§å€¼ï¼š        æœ€å°å€¼ï¼š?</span><br><span class="line">signed char:     æ‰€å å­—èŠ‚æ•°ï¼š1    æœ€å¤§å€¼ï¼š        æœ€å°å€¼ï¼š?</span><br><span class="line">unsigned char:     æ‰€å å­—èŠ‚æ•°ï¼š1    æœ€å¤§å€¼ï¼š?        æœ€å°å€¼ï¼š</span><br><span class="line">wchar_t:     æ‰€å å­—èŠ‚æ•°ï¼š4    æœ€å¤§å€¼ï¼š2147483647        æœ€å°å€¼ï¼š-2147483648</span><br><span class="line">short:         æ‰€å å­—èŠ‚æ•°ï¼š2    æœ€å¤§å€¼ï¼š32767        æœ€å°å€¼ï¼š-32768</span><br><span class="line">int:         æ‰€å å­—èŠ‚æ•°ï¼š4    æœ€å¤§å€¼ï¼š2147483647    æœ€å°å€¼ï¼š-2147483648</span><br><span class="line">unsigned:     æ‰€å å­—èŠ‚æ•°ï¼š4    æœ€å¤§å€¼ï¼š4294967295    æœ€å°å€¼ï¼š0</span><br><span class="line">long:         æ‰€å å­—èŠ‚æ•°ï¼š8    æœ€å¤§å€¼ï¼š9223372036854775807    æœ€å°å€¼ï¼š-9223372036854775808</span><br><span class="line">unsigned long:     æ‰€å å­—èŠ‚æ•°ï¼š8    æœ€å¤§å€¼ï¼š18446744073709551615    æœ€å°å€¼ï¼š0</span><br><span class="line">double:     æ‰€å å­—èŠ‚æ•°ï¼š8    æœ€å¤§å€¼ï¼š1.79769e+308    æœ€å°å€¼ï¼š2.22507e-308</span><br><span class="line">long double:     æ‰€å å­—èŠ‚æ•°ï¼š16    æœ€å¤§å€¼ï¼š1.18973e+4932    æœ€å°å€¼ï¼š3.3621e-4932</span><br><span class="line">float:         æ‰€å å­—èŠ‚æ•°ï¼š4    æœ€å¤§å€¼ï¼š3.40282e+38    æœ€å°å€¼ï¼š1.17549e-38</span><br><span class="line">size_t:     æ‰€å å­—èŠ‚æ•°ï¼š8    æœ€å¤§å€¼ï¼š18446744073709551615    æœ€å°å€¼ï¼š0</span><br><span class="line">string:     æ‰€å å­—èŠ‚æ•°ï¼š24</span><br><span class="line">type:         ************size**************</span><br></pre></td></tr></table></figure><p>å‚è€ƒåšå®¢ï¼š<a href="https://blog.csdn.net/weixin_33720452/article/details/85970159">g++ç¼–è¯‘åä¸­æ–‡æ˜¾ç¤ºä¹±ç è§£å†³æ–¹æ¡ˆ(c++)</a></p>]]></content>
      
      
      <categories>
          
          <category> Bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C++ </tag>
            
            <tag> Bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Three.jsä½¿ç”¨è´å¡å°”æ›²çº¿ç»˜åˆ¶å¿ƒå½¢</title>
      <link href="/2022/02/10/gamegraphics/three-js-shi-yong-bei-sai-er-qu-xian-hui-zhi-xin-xing/"/>
      <url>/2022/02/10/gamegraphics/three-js-shi-yong-bei-sai-er-qu-xian-hui-zhi-xin-xing/</url>
      
        <content type="html"><![CDATA[<p>è´å¡å°”æ›²çº¿æ˜¯å›¾å½¢å­¦ä¸­éå¸¸é‡è¦çš„çŸ¥è¯†ï¼Œæ˜¯ç»˜åˆ¶æ›²çº¿ä»¥åŠæ›²é¢çš„åŸºç¡€ï¼Œåœ¨å¾ˆå¤šåœ°æ–¹éƒ½æœ‰ç€éå¸¸å¹¿æ³›çš„åº”ç”¨ï¼Œæ¯”å¦‚Photoshopé‡Œçš„é’¢ç¬”å·¥å…·ï¼Œå­—ä½“è®¾è®¡ï¼Œå„ç§è¿‡æ¸¡åŠ¨ç”»ç­‰ç­‰ã€‚æœ¬æ–‡å°†è®°å½•è´å¡å°”æ›²çº¿çš„åŸç†å…¬å¼ï¼Œä»¥åŠä½¿ç”¨Three.jsä¸­çš„è´å¡å°”æ›²çº¿APIè¿›è¡Œç®€å•çš„å¿ƒå½¢ç»˜åˆ¶ã€‚</p><span id="more"></span><h3><span id="è´å¡å°”æ›²çº¿è¯¦è§£">è´å¡å°”æ›²çº¿è¯¦è§£</span></h3><p>è´å¡å°”æ›²çº¿å°±æ˜¯åœ¨èµ·å§‹ç‚¹å’Œç»ˆæ­¢ç‚¹ä¹‹é—´ï¼Œè®¾ç½®æ§åˆ¶ç‚¹ï¼Œé€šè¿‡æ§åˆ¶ç‚¹çš„ç§»åŠ¨æ¥æ§åˆ¶æ›²çº¿çš„å½¢çŠ¶ã€‚æ ¹æ®æ§åˆ¶ç‚¹æ•°é‡çš„ä¸åŒï¼Œå¯ä»¥å°†è´å¡å°”æ›²çº¿åˆ†ä¸ºä¸€é˜¶æ›²çº¿ã€äºŒé˜¶æ›²çº¿ã€ä¸‰é˜¶æ›²çº¿â€¦â€¦ç­‰ç­‰ã€‚</p><h4><span id="ä¸€é˜¶æ›²çº¿">ä¸€é˜¶æ›²çº¿</span></h4><p>ä¸€é˜¶æ›²çº¿éå¸¸ç®€å•ï¼Œå› ä¸ºæ²¡æœ‰æ§åˆ¶ç‚¹ï¼Œæ‰€ä»¥å°±æ˜¯ä¸€æ¡ä»èµ·å§‹ç‚¹åˆ°ç»ˆæ­¢ç‚¹çš„çº¿æ®µã€‚</p><h4><span id="äºŒé˜¶æ›²çº¿">äºŒé˜¶æ›²çº¿</span></h4><figure><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20220210111040096.png" alt="image-20220210111040096"><figcaption aria-hidden="true">image-20220210111040096</figcaption></figure><p>äºŒé˜¶æ›²çº¿ç”±èµ·å§‹ç‚¹ã€ç»ˆæ­¢ç‚¹å’Œä¸€ä¸ªæ§åˆ¶ç‚¹ç»„æˆã€‚è´å¡å°”æ›²çº¿ç”±ä»¥ä¸‹è§„åˆ™å½¢æˆï¼šå¯¹äº[0,1]å†…ä»»ä½•tï¼Œåœ¨<span class="math inline">\(b_0b_1\)</span>ä¸Šå–ä¸€ä¸ªç‚¹<span class="math inline">\(b_0^1\)</span>ï¼Œæ»¡è¶³<span class="math inline">\(b_0b_0^1\)</span>å’Œ<span class="math inline">\(b_0^1b_1\)</span>çš„å…³ç³»ä¸º<span class="math inline">\(t : 1-t\)</span>ï¼ŒåŒæ ·çš„ï¼Œåœ¨åœ¨<span class="math inline">\(b_1b_2\)</span>ä¸Šå–ä¸€ä¸ªç‚¹<span class="math inline">\(b_1^1\)</span>ï¼Œæ»¡è¶³<span class="math inline">\(b_1b_1^1\)</span>å’Œ<span class="math inline">\(b_1^1b_2\)</span>çš„å…³ç³»ä¸º<span class="math inline">\(t : 1-t\)</span>ã€‚æœ€åå°†<span class="math inline">\(b_0^1b_1^1\)</span>ç›¸è¿ï¼Œåœ¨<span class="math inline">\(b_0^1b_1^1\)</span>ä¸Šç»§ç»­å–ä¸€ç‚¹æ»¡è¶³<span class="math inline">\(b_0^1b_0^2:b_0^2b_1^1=t:1-t\)</span>ã€‚æ‰€æœ‰çš„tæ‰€å½¢æˆçš„<span class="math inline">\(b_0^2\)</span>å½¢æˆä¸€é“æ›²çº¿ï¼Œè¿™é“æ›²çº¿å°±æ˜¯è´å¡å°”æ›²çº¿ã€‚å¯¹åº”çš„ç‚¹çš„åæ ‡åœ¨å‘é‡è¡¨ç¤ºä¸‹å¾ˆå®¹æ˜“è¡¨ç¤ºå‡ºæ¥ï¼š<span class="math display">\[\vec{b^1_0}(t)=(1-t)\vec{b_0}+t\vec b_1 \\\vec{b^1_1}(t)=(1-t)\vec{b_1}+t\vec b_2 \\\vec{b^2_0}(t)=(1-t)\vec{b_0^1}+t\vec b_1^1 \\\Rightarrow \vec{b_0^2}(t)=(1-t)^2\vec b_0 + 2t(1-t)\vec{b_1}+t^2\vecb_2\]</span></p><h4><span id="ä¸‰é˜¶ä»¥åŠå¤šé˜¶æ›²çº¿">ä¸‰é˜¶ä»¥åŠå¤šé˜¶æ›²çº¿</span></h4><p>ç±»ä¼¼äºäºŒé˜¶æ›²çº¿ï¼Œä¸‰é˜¶ä»¥åŠå¤šé˜¶è´å¡å°”æ›²çº¿ä¹Ÿæ˜¯é‡‡ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¸æ–­è¿›è¡Œè¿­ä»£ï¼Œæ¯ä¸€ä¸ªtç¡®å®šä¸€ä¸ªç‚¹ï¼Œæœ€åå½¢æˆä¸€æ¡æ›²çº¿ã€‚</p><figure><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20220210112920807.png" alt="image-20220210112920807"><figcaption aria-hidden="true">image-20220210112920807</figcaption></figure><p>è®¡ç®—è´å¡å°”æ›²çº¿æœ‰ä¸€ä¸ªå¯¹äºä»»æ„é˜¶é€šç”¨çš„å…¬å¼ï¼š<strong>å¾·å¡æ–¯ç‰¹é‡Œå¥¥ç®—æ³•</strong>(De Casteljau's algorithm)ï¼Œæ˜¯ä¸€ç§é€’å½’çš„è®¡ç®—è´å¡å°”æ›²çº¿çš„æ–¹æ³•ï¼š <span class="math display">\[\vec b^n(t)=\vec b_0^n(t)=\sum_{j=0}^n\vec b_jB_j^n(t)\text{, where}\vec b_j \text{ is the Bernstein polynomial} \\\text{Bernstein polynomial: }B^n_t(t)=\tbinom{n}{t}t^i(1-t)^{n-i}\]</span></p><h3><span id="ä½¿ç”¨threejsä¸­çš„è´å¡å°”æ›²çº¿ç»˜åˆ¶å¿ƒå½¢">ä½¿ç”¨Three.jsä¸­çš„è´å¡å°”æ›²çº¿ç»˜åˆ¶å¿ƒå½¢</span></h3><h4><span id="ç»˜åˆ¶åœ†å½¢">ç»˜åˆ¶åœ†å½¢</span></h4><p>æˆ‘ä»¬é¦–å…ˆå¯ä»¥é€šè¿‡è´å¡å°”æ›²çº¿ç»˜åˆ¶å‡ºä¸€ä¸ªåœ†å½¢ï¼Œå¿ƒå½¢å¯ä»¥åœ¨åœ†å½¢çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€å®šçš„æ§åˆ¶ç‚¹çš„è°ƒæ•´å°±å¯ä»¥ç»˜åˆ¶è€Œæˆã€‚</p><figure><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/aEsuA.png" alt="aEsuA"><figcaption aria-hidden="true">aEsuA</figcaption></figure><p>ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œä¸€ä¸ªåœ†å½¢å¯ä»¥è¢«åˆ†æˆå››ä¸ªå¼§çº¿ï¼Œæ¯æ¡å¼§çº¿å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸‰é˜¶è´å¡å°”æ›²çº¿ç»˜åˆ¶è€Œæˆï¼ˆä¸¤ä¸ªæ§åˆ¶ç‚¹ï¼‰ï¼Œæ§åˆ¶ç‚¹çš„ä½ç½®åœ¨<a href="https://stackoverflow.com/questions/1734745/how-to-create-circle-with-bÃ©zier-curves">geometry- How to create circle with BÃ©zier curves? - StackOverflow</a>å·²ç»æœ‰äººè®¡ç®—å¥½äº†ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼ˆè¿™é‡Œçš„è®¡ç®—ä¹Ÿå¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ï¼Œç®€å•çš„æ•°å­¦çŸ¥è¯†å°±å¯ä»¥è®¡ç®—å‡ºæ¥ï¼‰ã€‚ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è´å¡å°”æ›²çº¿åˆ›å»ºå‡ºä¸€ä¸ªåœ†çš„å½¢çŠ¶ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> radius = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">const</span> c = <span class="number">0.551915024494</span> * radius;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> heartShape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">    .<span class="title function_">moveTo</span>(x, y+radius)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x+c,y+radius, x+radius, y+c, x+radius, y)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x+radius,y-c, x+c, y-radius, x, y-radius)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x-c,y-radius, x-radius, y-c, x-radius, y)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x-radius,y+c, x-c, y+radius, x, y+radius)</span><br></pre></td></tr></table></figure><p><code>bezierCurveTo()</code>æ˜¯Three.jsä¸­çš„è´å¡å°”æ›²çº¿çš„APIï¼Œå®ƒæ¥å—å…­ä¸ªå‚æ•°ï¼Œå‰å››ä¸ªåˆ†åˆ«æ˜¯ä¸¤ä¸ªæ§åˆ¶ç‚¹çš„x,yåæ ‡ï¼Œæœ€åä¸¤ä¸ªæ˜¯ç»ˆæ­¢ç‚¹çš„x,yåæ ‡ã€‚è¿™é‡Œåªéœ€è¦è®¾å®šå¥½å‚æ•°ï¼Œä½¿ç”¨å››æ®µè´å¡å°”æ›²çº¿ä¸€ä¸€ç»˜åˆ¶å‡ºæ¥å°±å¯ä»¥äº†ã€‚</p><h4><span id="ç»˜åˆ¶å¿ƒå½¢">ç»˜åˆ¶å¿ƒå½¢</span></h4><p>å¿ƒå½¢å…¶å®å°±æ˜¯åœ¨åœ†å½¢çš„åŸºç¡€ä¸Šç§»åŠ¨äº†ä¸‰ä¸ªæ§åˆ¶ç‚¹çš„ä½ç½®ï¼Œå°†yè½´ä¸Šä¸Šæ–¹çš„èµ·å§‹ç‚¹ç¨å‘ä¸‹ç§»åŠ¨ï¼Œä»¥åŠä¸‹æ–¹å·¦å³ä¸¤ä¸ªæ§åˆ¶ç‚¹å‘ä¸Šç§»åŠ¨ï¼Œå°±å¯ä»¥ç»˜åˆ¶å‡ºä¸€ä¸ªå¿ƒå½¢ï¼Œä»£ç ä»¥åŠæ•ˆæœå›¾å¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> x = <span class="number">0</span>, y = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">const</span> radius = <span class="number">30</span>;</span><br><span class="line"><span class="keyword">const</span> c = <span class="number">0.551915024494</span> * radius;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> heartShape = <span class="keyword">new</span> <span class="variable constant_">THREE</span>.<span class="title class_">Shape</span>()</span><br><span class="line">    .<span class="title function_">moveTo</span>(x, y+radius/<span class="number">3</span>)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x+c,y+radius, x+radius, y+c, x+radius, y)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x+radius,y-c, x+c, y-radius/<span class="number">2</span>, x, y-radius)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x-c,y-radius/<span class="number">2</span>, x-radius, y-c, x-radius, y)</span><br><span class="line">    .<span class="title function_">bezierCurveTo</span>(x-radius,y+c, x-c, y+radius, x, y+radius/<span class="number">3</span>)</span><br></pre></td></tr></table></figure><figure><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/heart.gif" alt="heart"><figcaption aria-hidden="true">heart</figcaption></figure><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><p><a href="https://www.bilibili.com/video/BV1X7411F744?p=11">GAMES101-ç°ä»£è®¡ç®—æœºå›¾å½¢å­¦å…¥é—¨-é—«ä»¤çª_å“”å“©å“”å“©_bilibili</a></p><p><a href="https://zh.wikipedia.org/wiki/å¾·å¡æ–¯ç‰¹é‡Œå¥¥ç®—æ³•">å¾·å¡æ–¯ç‰¹é‡Œå¥¥ç®—æ³• -ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org)</a></p><p><a href="https://threejs.org/docs/#api/en/extras/core/Path.bezierCurveTo">Path#bezierCurveToâ€“ three.js docs (threejs.org)</a></p><p><a href="https://github.com/GcsSloop/AndroidNote/blob/master/CustomView/Advance/%5B06%5DPath_Bezier.md">AndroidNote_Path_BezierGcsSloop/AndroidNote(github.com)</a></p><p><a href="https://stackoverflow.com/questions/1734745/how-to-create-circle-with-bÃ©zier-curves">geometry- How to create circle with BÃ©zier curves? - Stack Overflow</a></p>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›¾å½¢å­¦ </tag>
            
            <tag> å‰ç«¯ </tag>
            
            <tag> Three.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BugMysql:Access Denied for user &#39;root&#39;@&#39;localhost&#39;</title>
      <link href="/2021/11/21/bug/bugmysql-access-denied-for-user-root-localhost/"/>
      <url>/2021/11/21/bug/bugmysql-access-denied-for-user-root-localhost/</url>
      
        <content type="html"><![CDATA[<p>ç»ˆäºå°†å›°æ‰°äº†å¾ˆé•¿æ—¶é—´çš„mysqlçš„Bugè§£å†³äº†ã€‚æœ‹å‹åœ¨macOSä¸Šçš„mysqlæ¯æ¬¡è¿›å…¥çš„æ—¶å€™éƒ½ä¼šå¼¹å‡º<code>Access denied......</code>çš„é”™è¯¯æç¤ºï¼Œç»è¿‡é•¿æ—¶é—´çš„ä¸Šç½‘æœç´¢æœªæœï¼Œä»Šå¤©ç»ˆäºæœ‰æœºä¼šå°†å…¶è§£å†³ã€‚</p><p><span id="more"></span></p><p>æˆ‘åœ¨Ubuntuä¸Šéƒ¨ç½²mysqlçš„æ—¶å€™å‘ç°ï¼Œå¦‚æœæ²¡æœ‰sudoæƒé™çš„è¯ï¼Œç›´æ¥è¾“å…¥<code>mysql -u root -p</code>è¿›å…¥mysqlçš„è¯ï¼Œå³ä½¿å¯†ç æ­£ç¡®ä¹Ÿæ˜¯ä¼š<code>access denied</code>ï¼Œåªè¦åˆsudoæƒé™å°±èƒ½è¿›å…¥ï¼Œæ‰€ä»¥mysqlçš„rootä¹Ÿæ˜¯éœ€è¦osçš„rootæƒé™çš„ã€‚ç”±äºæˆ‘æƒ³è¿œç¨‹ä»æœ¬åœ°çš„å¯è§†åŒ–databasenavigatorè¿œç¨‹å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå¦‚æœæƒ³è¦è¿æ¥åˆ°rootï¼Œå°±ä¼šæç¤º<code>access denied</code>ï¼Œç©¶å…¶åŸå› è¿˜æ˜¯å› ä¸ºsshè¿æ¥åˆ°è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„æ—¶å€™ä¸ä¼šç»™sudoæƒé™ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±åªèƒ½å¤Ÿæ–°åˆ›å»ºä¸€ä¸ªuserï¼Œç»™è¿™ä¸ªuserè¿‘ä¼¼rootçš„æƒé™ï¼Œæ¥è¾¾åˆ°å…¨ç¨‹æ“ä½œçš„æ•ˆæœã€‚</p><p>é¦–å…ˆï¼Œæ‰“å¼€mysqlè·¯å¾„ä¸‹çš„my.cnfï¼Œæ‰¾åˆ°bind-addressè¿™ä¸€è¡Œï¼Œæ”¹ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bind-address=0.0.0.0</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥<code>sudo mysql -u root -p</code>è¿›å…¥mysqlï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &#x27;myuser&#x27;@&#x27;localhost&#x27; IDENTIFIED BY &#x27;mypass&#x27;;</span><br><span class="line">CREATE USER &#x27;myuser&#x27;@&#x27;%&#x27; IDENTIFIED BY &#x27;mypass&#x27;;</span><br><span class="line">GRANT ALL ON *.* TO &#x27;myuser&#x27;@&#x27;localhost&#x27;;</span><br><span class="line">GRANT ALL ON *.* TO &#x27;myuser&#x27;@&#x27;%&#x27;;</span><br><span class="line">flush privileges;</span><br><span class="line">// myuserå°±æ˜¯ä½ çš„username</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ç”¨æ–°åˆ›å»ºçš„è¿™ä¸ªuserè¿›è¡Œè¿œç¨‹è®¿é—®æ•°æ®åº“äº†</p><p>å‚è€ƒèµ„æ–™</p><p><a href="https://stackoverflow.com/questions/16287559/mysql-adding-user-for-remote-access">Mysqladding user for remote access</a></p>]]></content>
      
      
      <categories>
          
          <category> Bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bug </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•ï¼šæ•°ç»„ä¸­çš„é€†åºå¯¹</title>
      <link href="/2021/11/06/algorithms/suan-fa-shu-zu-zhong-de-ni-xu-dui/"/>
      <url>/2021/11/06/algorithms/suan-fa-shu-zu-zhong-de-ni-xu-dui/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>é¢˜ç›®æ¥æºï¼š<a href="https://leetcode-cn.com/problems/shu-zu-zhong-de-ni-xu-dui-lcof/">å‰‘æŒ‡Offer 51. æ•°ç»„ä¸­çš„é€†åºå¯¹ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)</a></p><p>æ•°ç»„ä¸­çš„é€†åºå¯¹æ˜¯æ•°æ®ç»“æ„å’Œç®—æ³•ä¸­çš„ä¸€é“ç»å…¸é¢˜ç›®ã€‚å¦‚æœ<code>A[i]&gt;A[j]</code>å¹¶ä¸”<code>i&lt;j</code>ï¼Œé‚£ä¹ˆè¿™å°±ç®—æ˜¯ä¸€ç»„é€†åºå¯¹ã€‚é¢˜ç›®è¦æ±‚ç»™å®šä¸€ä¸ªæ•°ç»„ï¼Œæ±‚å‡ºæ•°ç»„ä¸­é€†åºå¯¹çš„ä¸ªæ•°</p><blockquote><p>è¾“å…¥ï¼š[7,5,6,4]</p><p>è¾“å‡ºï¼š5</p></blockquote><span id="more"></span><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>æœ¬é¢˜å¯ä»¥ä½¿ç”¨æ’åºçš„æ€æƒ³ï¼Œå› ä¸ºåœ¨æ’åºä¸­æˆ‘ä»¬å‘ç°çš„ä¸ç¬¦åˆæ’åˆ—é¡ºåºçš„æ•°ç»„å¯¹éƒ½æ˜¯ä¸€ç»„é€†åºå¯¹ï¼Œæˆ‘ä»¬åªéœ€è¦è®¡ç®—å‡ºåœ¨æ’åºçš„è¿‡ç¨‹ä¸­äº¤æ¢çš„æ¬¡æ•°å³å¯ã€‚æœ¬é¢˜ä¸­å¯ä»¥é‡‡ç”¨æ—¶é—´å¤æ‚åº¦ä¸ºO(logn)çš„å½’å¹¶æ’åºã€‚ä»£ç å¦‚ä¸‹ï¼š</p><p>åŸºæœ¬æ€è·¯å’Œå½’å¹¶æ’åºæ˜¯ä¸€æ ·çš„ï¼Œå¦‚æœå¯¹å½’å¹¶æ’åºçš„ä»£ç ä¸ç†è§£çš„å¯ä»¥å…ˆçœ‹ä¸€çœ‹<a href="https://lucas-hao.github.io/2021/07/26/suan-fa-pai-xu-suan-fa/">æ’åºç®—æ³•</a>ã€‚</p><p>å”¯ä¸€éœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯å½’å¹¶çš„æ—¶å€™çš„é€†åºå¯¹è®¡ç®—ï¼Œå½“æˆ‘ä»¬å‘ç°rightå°äºleftçš„æ—¶å€™ï¼ŒrightåŒæ—¶ä¹Ÿå°äºleftåé¢çš„æ‰€æœ‰å…ƒç´ ï¼Œæˆ‘ä»¬å¢åŠ çš„ä¸ªæ•°å°±æ˜¯mid-left+1ï¼ˆmergeå‡½æ•°ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span>[] aux; <span class="comment">// copy of the origin array</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">reversePairs</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        aux = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="keyword">return</span> subReversePairs(nums, <span class="number">0</span>, nums.length - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">subReversePairs</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lo &gt;= hi) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        count += subReversePairs(nums, lo, mid);</span><br><span class="line">        count += subReversePairs(nums, mid+<span class="number">1</span>, hi);</span><br><span class="line">        <span class="comment">// ä¼˜åŒ–ï¼šå¦‚æœå·¦ä¾§æœ€å¤§å°äºå³ä¾§æœ€å°ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦è¿›è¡Œå½’å¹¶äº†</span></span><br><span class="line">        <span class="keyword">if</span> (nums[mid] &lt;= nums[mid+<span class="number">1</span>]) <span class="keyword">return</span> count;</span><br><span class="line">        count += merge(nums, lo, mid, hi);</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lo, <span class="type">int</span> mid, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo; i &lt;= hi; i++) aux[i] = nums[i];</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> lo, right  = mid+<span class="number">1</span>, index = lo;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= mid &amp;&amp; right &lt;= hi) &#123;</span><br><span class="line">            <span class="keyword">if</span> (aux[left] &lt;= aux[right]) nums[index++] = aux[left++];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (aux[left] &gt; aux[right]) &#123;</span><br><span class="line">                nums[index++] = aux[right++];</span><br><span class="line">                count += mid - left + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (left &lt;= mid) nums[index++] = aux[left++];</span><br><span class="line">        <span class="keyword">while</span> (right &lt;= hi) nums[index++] = aux[right++];</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> LeetCode </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å›¾å½¢å­¦å…¥é—¨ç¬”è®°1: å›¾å½¢å­¦ä¸­çš„æ•°å­¦</title>
      <link href="/2021/10/30/gamegraphics/tu-xing-xue-ru-men-bi-ji-1-tu-xing-xue-zhong-de-shu-xue/"/>
      <url>/2021/10/30/gamegraphics/tu-xing-xue-ru-men-bi-ji-1-tu-xing-xue-zhong-de-shu-xue/</url>
      
        <content type="html"><![CDATA[<p>æ•°å­¦åœ¨å›¾å½¢å­¦ä¸­æ˜¯éå¸¸é‡è¦çš„åŸºç¡€ï¼Œæœ¬ç¯‡ç®€è¦è®°å½•ä¸€ä¸‹å›¾å½¢å­¦ä¹‹ä¸­çš„ä¸€äº›æ•°å­¦åŸºç¡€å’ŒæŠ€å·§</p><span id="more"></span><h2><span id="çº¿æ€§ä»£æ•°åŸºç¡€">çº¿æ€§ä»£æ•°åŸºç¡€</span></h2><p>çº¿ä»£åœ¨å›¾å½¢å­¦ä¸­æ˜¯éå¸¸é‡è¦çš„æ•°å­¦ã€‚åœ¨å›¾å½¢å­¦ä¸­ï¼Œä¸€äº›åŸºç¡€çš„çº¿æ€§ä»£æ•°çŸ¥è¯†æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼Œæ¯”å¦‚å‘é‡ä¸çŸ©é˜µçš„ç›¸å…³è¿ç®—</p><ul><li>Vector Addition, Scalar Multiplication, Scalar Product,Normalization, Cross Product</li><li>Vector Cross Product: <span class="math inline">\(V_1\timesV_2=u|V_1||V_2|\sin\theta=\left|\begin{matrix}u_x &amp; u_y &amp; u_z \\v_{1x} &amp; v_{1y} &amp; v_{1z} \\ v_{2x} &amp; v_{2y} &amp; v_{2z}\end{matrix}\right|\)</span></li><li>Vector Cross product properties: 1. <span class="math inline">\(V_1\times V_2 = -(V_2 \times V_1)\)</span> (ä¸ç¬¦åˆäº¤æ¢å¾‹) 2. <span class="math inline">\(V_1 \times (V_2 \times V_3) \neq (V_1 \times V_2)\times V_3\)</span> (ä¸ç¬¦åˆäº¤æ¢å¾‹) 3. <span class="math inline">\(V_1\times (V_2 + V_3)=V_1 \times V_2 + V_1 \times V_3\)</span>(ç¬¦åˆç»“åˆå¾‹)</li><li>Matrix-matrix multiplicationï¼Œ Matrix-vector multiplication</li></ul><h2><span id="äºŒç»´ä¸‰ç»´å˜æ¢ä¸é½æ¬¡åæ ‡ç³»">äºŒç»´ä¸‰ç»´å˜æ¢ä¸é½æ¬¡åæ ‡ç³»</span></h2><p>åˆ©ç”¨çº¿æ€§ä»£æ•°ä¸­çš„å‘é‡å’ŒçŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥è¡¨ç¤ºå‡ºåœ¨äºŒç»´å¹³é¢å’Œä¸‰ç»´ç©ºé—´ä¸­ç‚¹çº¿é¢çš„ä½ç½®ä¸ç›¸åº”çš„å…³ç³»ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥é½æ¬¡åæ ‡çš„æ¦‚å¿µï¼Œä¸ºäº†ç®€ä¾¿ï¼Œä»¥ä¸‹éƒ½ä»¥ä¸‰ç»´ç©ºé—´ä¸­çš„é½æ¬¡åæ ‡ä¸ºä¾‹ã€‚æ™®é€šçš„ä¸‰ç»´åæ ‡è¡¨ç¤ºä¸º<span class="math inline">\((x,y,z)\)</span>ï¼Œä½†æ˜¯åœ¨é½æ¬¡åæ ‡ç³»ä¸­ï¼Œæˆ‘ä»¬æ·»åŠ ä¸€ä¸ªç»´åº¦<span class="math inline">\(w\)</span>ç”¨æ¥æ ‡æ˜è¯¥åæ ‡ä¸ºå‘é‡è¿˜æ˜¯åæ ‡ï¼Œå¦‚æœæ˜¯ç©ºé—´ä¸­çš„ç‚¹å°±æ˜¯1ï¼Œå¦‚æœæ˜¯å‘é‡å°±æ˜¯0ï¼Œå¹¶ä¸”é½æ¬¡åæ ‡æ»¡è¶³ä»¥ä¸‹è§„åˆ™ï¼Œ<span class="math inline">\((x,y,z,w)=(x/w,y/w,z/w,1)\)</span>ï¼Œå³åŸåæ ‡ä¸æ¯ä¸ªç»´åº¦ä¹˜ä»¥ç›¸åŒçš„æ•°ä¹‹åå¾—åˆ°çš„åæ ‡æ˜¯ç­‰ä»·çš„ã€‚é€šè¿‡é½æ¬¡åæ ‡ç³»ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°å¸¸è§çš„åŸºæœ¬å˜æ¢çš„çŸ©é˜µè¡¨ç¤ºã€‚</p><ol type="1"><li><p>å¹³ç§» (Translation) <span class="math display">\[\text{Translation: }\left(\begin{matrix}1 &amp; 0 &amp; 0 &amp; T_x \\0 &amp; 1 &amp; 0 &amp; T_y \\0 &amp; 0 &amp; 1 &amp; T_z \\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right)\text{, Inverse: }\left(\begin{matrix}1 &amp; 0 &amp; 0 &amp; -T_x \\0 &amp; 1 &amp; 0 &amp; -T_y \\0 &amp; 0 &amp; 1 &amp; -T_z \\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right)\]</span></p></li><li><p>ç¼©æ”¾ (Scaling) <span class="math display">\[\text{Scaling:}\left(\begin{matrix}S_x &amp; 0 &amp; 0 &amp; 0 \\0 &amp; S_y &amp; 0 &amp; 0 \\0 &amp; 0 &amp; S_z &amp; 0 \\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right)\]</span></p></li><li><p>æ—‹è½¬ (Rotation) é€†æ—¶é’ˆ <span class="math display">\[R_x(\alpha)=\left(\begin{matrix}1 &amp; 0 &amp; 0 &amp; 0 \\0 &amp; \cos{\alpha} &amp; -\sin{\alpha} &amp; 0 \\0 &amp; \sin{\alpha} &amp; \cos{\alpha} &amp; 0 \\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right),R_y(\alpha)=\left(\begin{matrix}\cos{\alpha} &amp; 0 &amp; \sin{\alpha} &amp; 0 \\0 &amp; 1 &amp; 0 &amp; 0 \\-\sin{\alpha} &amp; 0 &amp; \cos{\alpha} &amp; 0 \\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right),R_z(\alpha)=\left(\begin{matrix}\cos{\alpha} &amp; -\sin{\alpha} &amp; 0 &amp; 0 \\\sin{\alpha} &amp; \cos{\alpha} &amp; 0 &amp; 0 \\0 &amp; 0 &amp; 1 &amp; 0 \\0 &amp; 0 &amp; 0 &amp; 1\end{matrix}\right),\]</span> ç»•ç€è½´<span class="math inline">\(n\)</span>æ—‹è½¬è§’åº¦<span class="math inline">\(\alpha\)</span> (Rodrigues' Rotation Formula)<span class="math display">\[R(n,\alpha)=\cos(\alpha)\mathbf{I}+(1-\cos(\alpha))\mathbf{nn^T}+\sin(\alpha)\underbrace{\left(\begin{matrix}0 &amp; -n_z &amp; n_y \\n_z &amp; 0 &amp; -n_x \\-n_y &amp; n_x &amp; 0\end{matrix}\right)}\]</span> æ¬§æ‹‰è§’ï¼š<span class="math inline">\(R_{xyz}(\alpha,\beta,\gamma)=R_x(\alpha)R_y(\beta)R_z(\gamma)\)</span>:</p><p>æ¡¶æ»š (roll), åèˆª (yaw), ä¿¯ä»° (pitch)</p><p><img src="https://i.loli.net/2021/10/31/8Mug69ZUWynx2eC.png" height="200" alt="å›¾ç‰‡åç§°" align="center"></p><blockquote><p><strong>è¡¥å……:</strong>æ—‹è½¬é™¤äº†ä½¿ç”¨åæ ‡è¿›è¡Œè®¡ç®—ä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å››å…ƒæ•°è¿›è¡Œè®¡ç®—ï¼Œå››å…ƒæ•°è¿™é‡Œæ¨èä¸¤ä¸ªYouTubeè§†é¢‘</p><ul><li><a href="https://www.youtube.com/watch?v=3BR8tK-LuB0">FantasticQuaternions - Numberphile - YouTube</a></li><li><a href="https://www.youtube.com/watch?v=d4EgbgTm0Bg">Visualizingquaternions (4d numbers) with stereographic projection -YouTube</a></li></ul></blockquote></li></ol><h2><span id="äºŒç»´ä¸ä¸‰ç»´å‡ ä½•çš„åŸºç¡€çŸ¥è¯†">äºŒç»´ä¸ä¸‰ç»´å‡ ä½•çš„åŸºç¡€çŸ¥è¯†</span></h2><h3><span id="äºŒç»´å‡ ä½•çŸ¥è¯†">äºŒç»´å‡ ä½•çŸ¥è¯†</span></h3><ol type="1"><li><p>è®¡ç®—ç‚¹åˆ°ç›´çº¿è·ç¦» [<span class="math inline">\(A(x_1,y_1),B(x_2,y_2),P(x,y)\)</span>]</p><ul><li>ç›´çº¿æ–¹å‘å‘é‡ï¼š<span class="math inline">\(\vec{v}=(x_2-x_1,y_2-y_1)=(d_x,d_y)\)</span></li><li>ç›´çº¿çš„æ³•çº¿å‘é‡ (å‚ç›´äºç›´çº¿)ï¼š<span class="math inline">\(\vec{n}=(-d_y,d_x)=(y_1-y_2,x_2-x_1)\)</span></li><li><span class="math inline">\(\vec{n},\vec{v}\)</span>è½¬åŒ–ä¸ºå•ä½å‘é‡(Normalization)</li><li>å‘é‡ç‚¹ä¹˜æ‰¾åˆ°è·ç¦»: <span class="math inline">\(h=|(P-A)\cdot\hat{n}|\)</span></li></ul></li><li><p>ä¸¤æ¡ç›´çº¿ç›¸äº¤ï¼ˆéå¸¸ç®€å•ï¼‰ï¼Œè”ç«‹æ–¹ç¨‹è§£å‡ºäº¤ç‚¹å³å¯</p></li><li><p>ç»™å®šä¸€ä¸ªç‚¹<span class="math inline">\(P\)</span>å’Œä¸€æ¡ç›´çº¿<span class="math inline">\(AB\)</span>ï¼Œåˆ¤æ–­ç‚¹åœ¨ç›´çº¿çš„å“ªä¸€ä¾§</p><p>ä½¿ç”¨ä¸‰è§’å½¢çš„æœ‰å‘é¢ç§¯ (Signed area) <span class="math inline">\(\gamma=\frac{1}{2}Det\left|\begin{matrix}x_a &amp;x_b &amp; x \\ y_a &amp; y_b &amp; y \\ 1 &amp; 1 &amp;1\end{matrix}\right|,\begin{cases}\gamma&gt;0,left\\\gamma&lt;0,right\\\gamma=0,on\spaceline\end{cases}\)</span></p></li></ol><p><img src="https://i.loli.net/2021/10/31/iqGdoEm9ukIJfjM.png" height="200" alt="å›¾ç‰‡åç§°" align="center"></p><p>â€‹ å¤šè¾¹å½¢çš„æœ‰å‘é¢ç§¯ï¼š<span class="math inline">\(polygon\spacearea=\frac{1}{2}\sum{Det\left|\begin{matrix}x_i &amp; x_{i+1} \\ y_i&amp; y_{i+1}\end{matrix}\right|}\)</span> (Note:ä¸èƒ½å¿˜è®°æœ€åä¸€ä¸ªç‚¹å’Œç¬¬ä¸€ä¸ªç‚¹)</p><ol type="1"><li><p>åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢å†…éƒ¨1</p><ol type="1"><li><p>æ³•ä¸€ï¼šä½¿ç”¨(3)çš„æ–¹æ³•åˆ¤æ–­ç‚¹åœ¨å¤šè¾¹å½¢çš„æ¯ä¸€æ¡è¾¹çš„å“ªä¸€ä¾§ï¼Œè¿›è€Œåˆ¤æ–­ç‚¹æ˜¯å¦åœ¨å¤šè¾¹å½¢çš„å†…éƒ¨</p></li><li><p>æ³•äºŒï¼šå¦‚æœä¸€ä¸ªç‚¹åœ¨å¤šè¾¹å½¢å†…éƒ¨ï¼Œè¿‡è¿™ä¸ªç‚¹ä»»æ„åšä¸€æ¡ç›´çº¿ï¼Œä¸å¤šè¾¹å½¢çš„è¾¹çš„äº¤ç‚¹ä¸ªæ•°ä¸ºå¥‡æ•°ï¼Œå¦‚æœä¸ºå¶æ•°ï¼Œè¯´æ˜è¿™ä¸ªç‚¹åœ¨å¤šè¾¹å½¢çš„å¤–éƒ¨ï¼ˆæ³¨æ„ï¼šè¿˜æœ‰ä¸€äº›ç‰¹æ®Šæƒ…å†µéœ€è¦è€ƒè™‘ï¼‰</p><p><img src="https://i.loli.net/2021/10/31/sfeOKyQblIcTU7L.png" height="200" alt="å›¾ç‰‡åç§°" align="center"></p></li></ol></li></ol><h3><span id="ä¸‰ç»´å‡ ä½•çŸ¥è¯†">ä¸‰ç»´å‡ ä½•çŸ¥è¯†</span></h3><ol type="1"><li><p>çº¿æ€§å·®å€¼ (Linear Interpolation) [Lerp]: <span class="math inline">\(V=V_0+t(V_1-V_0)\)</span> (ç‚¹<span class="math inline">\(V\)</span>åœ¨<span class="math inline">\(V_0\)</span>å’Œ<span class="math inline">\(V_1\)</span>çš„ç›´çº¿ä¸Šç§»åŠ¨ )</p></li><li><p>è´¨å¿ƒåæ ‡ (Barycentric coordinate)</p><p><span class="math inline">\(P=\alpha P_0+\beta P_1 + \gamma P_2\text{ where } \alpha+\beta+\gamma=1,A_0=\alpha A, A_1=\betaA,A_2=\gamma A\)</span></p></li><li><p>çƒé¢çº¿æ€§å·®å€¼ (Spherical Linear Interpolation) [Slerp]</p><p><span class="math inline">\(\vec{V(t)}=\vec{V_0}\frac{\sin((1-t)\theta)}{\sin\theta}+\vec{V_1}\frac{\sin(t\theta)}{\sin\theta}\)</span>(<span class="math inline">\(V\)</span>åœ¨<span class="math inline">\(V_0\)</span>å’Œ<span class="math inline">\(V_1\)</span>ä¹‹é—´çš„å¼§çº¿ä¸Šç§»åŠ¨ )</p></li><li><p>ä¸‰è§’å½¢çš„æ³•çº¿ï¼Œå‡è®¾ä¸‰è§’å½¢ä¸‰ä¸ªé¡¶ç‚¹<span class="math inline">\(V_0,V_1,V_2\)</span>ï¼Œå°†ä¸¤æ¡è¾¹æŒ‰ç…§é€†æ—¶é’ˆæ–¹å‘è¿›è¡Œå‰ä¹˜ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ä¸‰è§’å½¢çš„æ³•çº¿<span class="math display">\[\vec{n}=(V_1-V_0)\times(V_2-V_0) \text{ OR } (V_1-V_1) \cdots\]</span></p></li><li><p>é¡¶ç‚¹çš„æ³•çº¿: å–å‘¨å›´å¤šä¸ªé¢çš„æ³•çº¿çš„å¹³å‡å€¼</p></li></ol><blockquote><p>æœ¬ç¯‡ç¬”è®°åŸºäºä¸Šè¯¾çš„è¯¾ä»¶ä»¥åŠGames101è¿›è¡Œæ•´ç†</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> GameGraphics </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> å›¾å½¢å­¦ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•ï¼šæ•°ç»„ä¸­ç¬¬kå¤§çš„æ•°</title>
      <link href="/2021/10/21/algorithms/suan-fa-shu-zu-zhong-di-k-da-de-shu/"/>
      <url>/2021/10/21/algorithms/suan-fa-shu-zu-zhong-di-k-da-de-shu/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>æ•°ç»„ä¸­ç¬¬kå¤§çš„æ•°æ˜¯ä¸€é“ååˆ†ç»å…¸çš„é¢˜ç›®ï¼Œé¢˜ç›®è¡¨è¿°å¯ä»¥å¦‚ä¸‹</p><blockquote><p>You are given a set S of n integers in an array and also an integer kâˆˆ [1, n]. Design an algorithm to find the k-th largest integer of S.</p><p>ç»™å®š ä¸€ä¸ªæ•°ç»„ï¼Œè¿”å›æ•°ç»„ä¸­ç¬¬kå¤§çš„å…ƒç´ </p></blockquote><p><a href="https://leetcode-cn.com/problems/kth-largest-element-in-an-array/">215.æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´  - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)</a></p><p><a href="https://leetcode-cn.com/problems/xx4gT2/">å‰‘æŒ‡ Offer II 076.æ•°ç»„ä¸­çš„ç¬¬ k å¤§çš„æ•°å­— - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)</a></p><span id="more"></span><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><h3><span id="åˆ†æ²»ç®—æ³•å¿«é€Ÿæ’åº">åˆ†æ²»ç®—æ³•ï¼ˆå¿«é€Ÿæ’åºï¼‰</span></h3><p>é¦–å…ˆï¼Œä¸€ä¸ªéå¸¸ç®€å•çš„æ€è·¯ï¼Œæˆ‘ä»¬ç›´æ¥å…ˆå°†æ•´ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼Œç„¶åå°±å¯ä»¥ç›´æ¥æ‰¾åˆ°ç¬¬kå¤§çš„æ•°å­—äº†ï¼Œè¿™æ ·çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(nlogn)ã€‚ä½†æ˜¯å®é™…ä¸Šï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å°†æ•´ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼Œæˆ‘ä»¬åœ¨æ’åºçš„è¿‡ç¨‹ä¸­å·²ç»å¯ä»¥æ‰¾åˆ°ç¬¬kå¤§çš„å…ƒç´ ã€‚ä¸‹é¢è¿™ä¸ªç®—æ³•å°±æ˜¯åŸºäºå¿«é€Ÿæ’åºç®—æ³•æ‰¾å‡ºäº†ç¬¬kå¤§çš„æ•°å­—(å‚è€ƒã€Šç®—æ³•å¯¼è®ºã€‹ä»¥åŠè¯¾ä¸Šçš„è¯¾ä»¶)ã€‚</p><p>ç®—æ³•æ€è·¯ï¼šé¦–å…ˆåœ¨æ•°ç»„ä¸­éšæœºé€‰å–ä¸€ä¸ªä¸‹æ ‡å½“åšpivotï¼Œç„¶åè¿›è¡Œpartitionï¼Œå°†æ¯”pivotçš„å€¼å¤§çš„æ”¾åœ¨å·¦ä¾§ï¼Œæ¯”pivotçš„å€¼å°çš„æ”¾åœ¨å³ä¾§ï¼Œæ¥ä¸‹æ¥åˆ†ä¸‰ç§æƒ…å†µï¼š</p><blockquote><ol type="1"><li>pivot==k-1, æˆ‘ä»¬å°±å·²ç»æ‰¾åˆ°äº†ç¬¬kå¤§çš„å…ƒç´ </li><li>pivot&lt;k-1,æˆ‘ä»¬éœ€è¦åœ¨pivotä¹‹åçš„æ•°å­—ä¸­æ‰¾åˆ°ç¬¬k-pivot-1å¤§çš„å…ƒç´ </li><li>pivot&gt;k-1, æˆ‘ä»¬éœ€è¦åœ¨pivotä¹‹å‰çš„æ•°å­—ä¸­æ‰¾åˆ°ç¬¬kå¤§çš„å…ƒç´ </li></ol><p>ï¼ˆæ³¨ï¼šè¿™é‡Œæ˜¯k-1æ˜¯å› ä¸ºpivotæ˜¯ä¸‹æ ‡ä»0å¼€å§‹ï¼Œkä»1å¼€å§‹ï¼‰</p></blockquote><p>æˆ‘ä»¬è¿˜å¯ä»¥å¯¹è¿™ä¸ªç®—æ³•è¿›è¡Œä¸€å®šçš„ä¼˜åŒ–ï¼Œå¦‚æœè¯´æˆ‘ä»¬éšæœºé€‰å–çš„pivotçš„ä½ç½®éå¸¸é å·¦æˆ–è€…é å³ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨é€’å½’ä¹‹å‰å¯èƒ½åªèƒ½æ’é™¤æ‰éå¸¸å°‘çš„éƒ¨åˆ†å…ƒç´ ï¼Œæˆ‘ä»¬å¯ä»¥å¸Œæœ›pivotè½åœ¨æ•°ç»„èŒƒå›´çš„ä¸­é—´1/3éƒ¨åˆ†ï¼Œå¦‚æœä¸åœ¨çš„è¯ï¼Œæˆ‘ä»¬é‡æ–°é€‰æ‹©ä¸€ä¸ªpivot(å®é™…ä¸Šæ„Ÿè§‰è¿™æ ·å­æå‡çš„æ•ˆæœä¹Ÿä¸æ˜¯å¾ˆå¥½ï¼Ÿ)ä¸‹é¢æ˜¯ä»£ç éƒ¨åˆ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KSelection</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Comparable <span class="title function_">kSelectionSort</span><span class="params">(Comparable[] arr, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (k &gt; arr.length || k &lt;= <span class="number">0</span>) <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> quickKSelection(arr, <span class="number">0</span>, arr.length - <span class="number">1</span>, k - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Comparable <span class="title function_">quickKSelection</span><span class="params">(Comparable[] arr, <span class="type">int</span> lo, <span class="type">int</span> hi, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lo == hi) <span class="keyword">return</span> arr[hi];</span><br><span class="line">        <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> partition(arr, lo, hi);</span><br><span class="line">        <span class="keyword">if</span> (pivot &gt; k) <span class="keyword">return</span> quickKSelection(arr, lo, pivot - <span class="number">1</span>, k);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (pivot &lt; k) <span class="keyword">return</span> quickKSelection(arr, pivot + <span class="number">1</span>, hi, k);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> arr[pivot];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(Comparable[] arr, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="type">int</span> pivot= random.nextInt(hi-lo+<span class="number">1</span>)+lo;</span><br><span class="line">        swap(arr, pivot, lo);</span><br><span class="line">        pivot = lo;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo, j = hi + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (arr[++i].compareTo(arr[pivot]) &gt; <span class="number">0</span>) <span class="keyword">if</span> (i == hi) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">while</span> (arr[pivot].compareTo(arr[--j]) &gt; <span class="number">0</span> ) <span class="keyword">if</span> (j == lo) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">if</span> (i &gt;= j) <span class="keyword">break</span>;</span><br><span class="line">            swap(arr, i, j);</span><br><span class="line">        &#125;</span><br><span class="line">        swap(arr, pivot, j);</span><br><span class="line">        pivot = j;</span><br><span class="line">        <span class="keyword">if</span> (pivot &gt;= lo + (hi - lo) / <span class="number">3</span> &amp;&amp; pivot &lt;= hi - (hi - lo) / <span class="number">3</span>)</span><br><span class="line">            <span class="keyword">return</span> pivot;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">return</span> partition(arr, lo, hi);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(Comparable[] arr, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">Comparable</span> <span class="variable">temp</span> <span class="operator">=</span> arr[i];</span><br><span class="line">        arr[i] = arr[j];</span><br><span class="line">        arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ—¶é—´å¤æ‚åº¦ï¼š<span class="math inline">\(f(n)\leO(n)+f(\lceil2n/3\rceil)\)</span>,æ ¹æ®Master's theorem,æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚ç©ºé—´å¤æ‚åº¦ï¼šå‡½æ•°é€’å½’å ç”¨æ ˆç©ºé—´O(logn)ã€‚</p><h3><span id="æœ€å¤§å †">æœ€å¤§å †</span></h3><p>å¦ä¸€ä¸ªæ€è·¯ä¹Ÿéå¸¸å®¹æ˜“ï¼Œå°±æ˜¯ç»´æŠ¤ä¸€ä¸ªå¤§æ ¹å †ï¼Œç„¶åä¾æ¬¡å°†æ¯ä¸ªå…ƒç´ å‹å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åæœ€åå°†æœ€ä¸Šé¢k-1ä¸ªå…ƒç´ ä¾æ¬¡å¼¹å‡ºï¼Œç°åœ¨å †é¡¶çš„å…ƒç´ å°±æ˜¯æ•°ç»„ä¸­ç¬¬kå¤§çš„å…ƒç´ ã€‚æ—¶é—´å¤æ‚åº¦O(nlogn)ã€‚ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findKthLargest</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        PriorityQueue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(Collections.reverseOrder());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> num : nums) queue.add(num);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k - <span class="number">1</span>; i++) queue.poll();</span><br><span class="line">        <span class="keyword">return</span> queue.poll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> LeetCode </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1109. èˆªç­é¢„è®¢ç»Ÿè®¡</title>
      <link href="/2021/09/24/leetcode/1109-hang-ban-yu-ding-tong-ji/"/>
      <url>/2021/09/24/leetcode/1109-hang-ban-yu-ding-tong-ji/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>è¿™é‡Œæœ‰ n ä¸ªèˆªç­ï¼Œå®ƒä»¬åˆ†åˆ«ä» 1 åˆ° n è¿›è¡Œç¼–å·ã€‚</p><p>æœ‰ä¸€ä»½èˆªç­é¢„è®¢è¡¨ bookings ï¼Œè¡¨ä¸­ç¬¬ i æ¡é¢„è®¢è®°å½• bookings[i] =[firsti, lasti, seatsi] æ„å‘³ç€åœ¨ä» firsti åˆ° lasti ï¼ˆåŒ…å« firsti å’Œlasti ï¼‰çš„ æ¯ä¸ªèˆªç­ ä¸Šé¢„è®¢äº† seatsi ä¸ªåº§ä½ã€‚</p><p>è¯·ä½ è¿”å›ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„answerï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯æ¯ä¸ªèˆªç­é¢„å®šçš„åº§ä½æ€»æ•°ã€‚</p><p><span id="more"></span></p><blockquote><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šbookings = [[1,2,10],[2,3,20],[2,5,25]], n = 5è¾“å‡ºï¼š[10,55,45,25,25] è§£é‡Šï¼š èˆªç­ç¼–å· 1 2 3 4 5 é¢„è®¢è®°å½• 1 ï¼š 10 10é¢„è®¢è®°å½• 2 ï¼š 20 20 é¢„è®¢è®°å½• 3 ï¼š 25 25 25 25 æ€»åº§ä½æ•°ï¼š 10 55 45 25 25å› æ­¤ï¼Œanswer = [10,55,45,25,25] ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šbookings = [[1,2,10],[2,2,15]], n = 2 è¾“å‡ºï¼š[10,25] è§£é‡Šï¼šèˆªç­ç¼–å· 1 2 é¢„è®¢è®°å½• 1 ï¼š 10 10 é¢„è®¢è®°å½• 2 ï¼š 15 æ€»åº§ä½æ•°ï¼š 10 25å› æ­¤ï¼Œanswer = [10,25]</p></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>ä½¿ç”¨æ–¹æ³•ï¼šå·®åˆ†ï¼Œä¹Ÿå°±æ˜¯é€†å‘å‰ç¼€å’Œï¼Œæ—¶é—´å¤æ‚åº¦O(N)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] corpFlightBookings(<span class="type">int</span>[][] bookings, <span class="type">int</span> n) &#123;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] booking : bookings) &#123;</span><br><span class="line">            ans[booking[<span class="number">0</span>]-<span class="number">1</span>] += booking[<span class="number">2</span>];</span><br><span class="line">            <span class="keyword">if</span> (booking[<span class="number">1</span>] != n) ans[booking[<span class="number">1</span>]] -= booking[<span class="number">2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">            ans[i] += ans[i-<span class="number">1</span>]; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> Java </tag>
            
            <tag> å·®åˆ† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¼‚å¸¸java.util.ConcurrentModificationExceptionè¯¦è§£ï¼ˆè½¬è½½ï¼‰</title>
      <link href="/2021/08/02/java/java-yi-chang-java-util-concurrentmodificationexception-xiang-jie/"/>
      <url>/2021/08/02/java/java-yi-chang-java-util-concurrentmodificationexception-xiang-jie/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨Androidå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨WorkerManagerçš„æ—¶å€™äº§ç”Ÿäº†æŠ¥é”™java.util.ConcurrentModificationExceptionï¼Œäºæ˜¯å°±åˆ°ç½‘ä¸Šè¿›è¡ŒæŸ¥è¯¢ï¼Œæ„Ÿè§‰è¿™ç¯‡æ–‡ç« è®²è¿°çš„æ¯”è¾ƒè¯¦å°½ï¼Œè®°å½•å­¦ä¹ ä¸€ä¸‹ã€‚</p><p>åŸæ–‡åŸè½½äº<a href="https://www.cnblogs.com/snowater/p/8024776.html">java.util.ConcurrentModificationExceptionå¼‚å¸¸é—®é¢˜è¯¦è§£</a></p><p><span id="more"></span></p><p>åœ¨Javaå¼€å‘è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨iteratoréå†é›†åˆçš„åŒæ—¶å¯¹é›†åˆè¿›è¡Œä¿®æ”¹å°±ä¼šå‡ºç°java.util.ConcurrentModificationExceptionå¼‚å¸¸ï¼Œæœ¬æ–‡å°±ä»¥ArrayListä¸ºä¾‹å»ç†è§£å’Œè§£å†³è¿™ç§å¼‚å¸¸ã€‚</p><h2><span id="ä¸€-å•çº¿ç¨‹æƒ…å†µä¸‹é—®é¢˜åˆ†æåŠè§£å†³æ–¹æ¡ˆ">ä¸€ã€å•çº¿ç¨‹æƒ…å†µä¸‹é—®é¢˜åˆ†æåŠè§£å†³æ–¹æ¡ˆ</span></h2><h3><span id="11-é—®é¢˜å¤ç°">1.1 é—®é¢˜å¤ç°</span></h3><p>å…ˆä¸Šä¸€æ®µæŠ›å¼‚å¸¸çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span>  &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">        arrayList.add(Integer.valueOf(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤ç°æ–¹æ³•ä¸€</span></span><br><span class="line">    Iterator&lt;Integer&gt; iterator = arrayList.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">        <span class="keyword">if</span> (integer.intValue() == <span class="number">5</span>) &#123;</span><br><span class="line">            arrayList.remove(integer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤ç°æ–¹æ³•äºŒ</span></span><br><span class="line">    iterator = arrayList.iterator();</span><br><span class="line">    <span class="keyword">for</span> (Integer value : arrayList) &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">        <span class="keyword">if</span> (integer.intValue() == <span class="number">5</span>) &#123;</span><br><span class="line">            arrayList.remove(integer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä»£ç ä¸­å±•ç¤ºäº†ä¸¤ç§èƒ½æŠ›å¼‚å¸¸çš„å®ç°æ–¹å¼ã€‚</p><h3><span id="12-é—®é¢˜åŸå› åˆ†æ">1.2ã€é—®é¢˜åŸå› åˆ†æ</span></h3><p>å…ˆæ¥çœ‹å®ç°æ–¹æ³•ä¸€ï¼Œæ–¹æ³•ä¸€ä¸­ä½¿ç”¨Iteratoréå†ArrayListï¼ŒæŠ›å‡ºå¼‚å¸¸çš„æ˜¯iterator.next()ã€‚çœ‹ä¸‹Iterator nextæ–¹æ³•å®ç°æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">    checkForComodification();</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> cursor;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= size)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">    Object[] elementData = ArrayList.<span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="keyword">if</span> (i &gt;= elementData.length)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    cursor = i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> (E) elementData[lastRet = i];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨nextæ–¹æ³•ä¸­é¦–å…ˆè°ƒç”¨äº†checkForComodificationæ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåˆ¤æ–­modCountæ˜¯å¦ç­‰äºexpectedModCountï¼Œä¸ç­‰äºå°±ä¼šæŠ›å‡ºjava.util.ConcurrentModificationExcepitonå¼‚å¸¸ã€‚</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥è·Ÿè¸ªçœ‹ä¸€ä¸‹modCountå’ŒexpectedModCountçš„èµ‹å€¼å’Œä¿®æ”¹ã€‚</p><p>modCountæ˜¯ArrayListçš„ä¸€ä¸ªå±æ€§ï¼Œç»§æ‰¿è‡ªæŠ½è±¡ç±»AbstractListï¼Œç”¨äºè¡¨ç¤ºArrayListå¯¹è±¡è¢«ä¿®æ”¹æ¬¡æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="keyword">protected</span> <span class="keyword">transient</span> <span class="type">int</span> <span class="variable">modCount</span> <span class="operator">=</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>æ•´ä¸ªArrayListä¸­ä¿®æ”¹modCountçš„æ–¹æ³•æ¯”è¾ƒå¤šï¼Œæœ‰addã€removeã€clearã€ensureCapacityInternalç­‰ï¼Œå‡¡æ˜¯è®¾è®¡åˆ°ArrayListå¯¹è±¡ä¿®æ”¹çš„éƒ½ä¼šè‡ªå¢modCountå±æ€§ã€‚</p><p>åœ¨åˆ›å»ºIteratorçš„æ—¶å€™ä¼šå°†modCountèµ‹å€¼ç»™expectedModCountï¼Œåœ¨éå†ArrayListè¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰å…¶ä»–åœ°æ–¹å¯ä»¥è®¾ç½®expectedModCountäº†ï¼Œå› æ­¤éå†è¿‡ç¨‹ä¸­expectedModCountä¼šä¸€ç›´ä¿æŒåˆå§‹å€¼20ï¼ˆè°ƒç”¨addæ–¹æ³•æ·»åŠ äº†20ä¸ªå…ƒç´ ï¼Œä¿®æ”¹äº†20æ¬¡ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span> <span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount; <span class="comment">// åˆ›å»ºå¯¹è±¡æ—¶åˆå§‹åŒ–</span></span><br></pre></td></tr></table></figure><p>éå†çš„æ—¶å€™æ˜¯ä¸ä¼šè§¦å‘modCountè‡ªå¢çš„ï¼Œä½†æ˜¯éå†åˆ°integer.intValue() ==5çš„æ—¶å€™ï¼Œæ‰§è¡Œäº†ä¸€æ¬¡arrayList.remove(integer)ï¼Œè¿™è¡Œä»£ç æ‰§è¡ŒåmodCount++å˜ä¸ºäº†21ï¼Œä½†æ­¤æ—¶çš„expectedModCountä»ç„¶ä¸º20ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">checkForComodification</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œnextæ–¹æ³•æ—¶ï¼Œé‡åˆ°modCount !=expectedModCountæ–¹æ³•ï¼Œå¯¼è‡´æŠ›å‡ºå¼‚å¸¸java.util.ConcurrentModificationExceptionã€‚</p><p>æ˜ç™½äº†æŠ›å‡ºå¼‚å¸¸çš„è¿‡ç¨‹ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå¾ˆæ˜æ˜¾è¿™ä¹ˆåšæ˜¯ä¸ºäº†é˜»æ­¢ç¨‹åºå‘˜åœ¨ä¸å…è®¸ä¿®æ”¹çš„æ—¶å€™ä¿®æ”¹å¯¹è±¡ï¼Œèµ·åˆ°ä¿æŠ¤ä½œç”¨ï¼Œé¿å…å‡ºç°æœªçŸ¥å¼‚å¸¸ã€‚å¼•ç”¨ç½‘ä¸Šçš„ä¸€æ®µè§£é‡Šï¼Œ<a href="http://lz12366.iteye.com/blog/675016">ç‚¹å‡»æŸ¥çœ‹è§£é‡Šæ¥æº</a></p><blockquote><p>Iterator æ˜¯å·¥ä½œåœ¨ä¸€ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”æ‹¥æœ‰ä¸€ä¸ª mutex é”ã€‚ Iteratorè¢«åˆ›å»ºä¹‹åä¼šå»ºç«‹ä¸€ä¸ªæŒ‡å‘åŸæ¥å¯¹è±¡çš„å•é“¾ç´¢å¼•è¡¨ï¼Œå½“åŸæ¥çš„å¯¹è±¡æ•°é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿™ä¸ªç´¢å¼•è¡¨çš„å†…å®¹ä¸ä¼šåŒæ­¥æ”¹å˜ã€‚å½“ç´¢å¼•æŒ‡é’ˆå¾€åç§»åŠ¨çš„æ—¶å€™å°±æ‰¾ä¸åˆ°è¦è¿­ä»£çš„å¯¹è±¡ï¼Œæ‰€ä»¥æŒ‰ç…§ fail-fast åŸåˆ™Iterator ä¼šé©¬ä¸ŠæŠ›å‡º java.util.ConcurrentModificationException å¼‚å¸¸ã€‚æ‰€ä»¥ Iterator åœ¨å·¥ä½œçš„æ—¶å€™æ˜¯ä¸å…è®¸è¢«è¿­ä»£çš„å¯¹è±¡è¢«æ”¹å˜çš„ã€‚ä½†ä½ å¯ä»¥ä½¿ç”¨Iterator æœ¬èº«çš„æ–¹æ³• remove() æ¥åˆ é™¤å¯¹è±¡ï¼Œ Iterator.remove()æ–¹æ³•ä¼šåœ¨åˆ é™¤å½“å‰è¿­ä»£å¯¹è±¡çš„åŒæ—¶ç»´æŠ¤ç´¢å¼•çš„ä¸€è‡´æ€§ã€‚</p></blockquote><p>å†æ¥åˆ†æä¸‹ç¬¬äºŒç§forå¾ªç¯æŠ›å¼‚å¸¸çš„åŸå› ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line">    Objects.requireNonNull(action);</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">expectedModCount</span> <span class="operator">=</span> modCount;</span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="keyword">final</span> E[] elementData = (E[]) <span class="built_in">this</span>.elementData;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="built_in">this</span>.size;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; modCount == expectedModCount &amp;&amp; i &lt; size; i++) &#123;</span><br><span class="line">        action.accept(elementData[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (modCount != expectedModCount) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨forå¾ªç¯ä¸­ä¸€å¼€å§‹ä¹Ÿæ˜¯å¯¹expectedModCounté‡‡ç”¨modCountè¿›è¡Œèµ‹å€¼ã€‚åœ¨è¿›è¡Œforå¾ªç¯æ—¶æ¯æ¬¡éƒ½ä¼šæœ‰åˆ¤å®šæ¡ä»¶modCount==expectedModCountï¼Œå½“æ‰§è¡Œå®ŒarrayList.remove(integer)ä¹‹åï¼Œè¯¥åˆ¤å®šæ¡ä»¶è¿”å›falseé€€å‡ºå¾ªç¯ï¼Œç„¶åæ‰§è¡Œifè¯­å¥ï¼Œç»“æœåŒæ ·æŠ›å‡ºjava.util.ConcurrentModificationExceptionå¼‚å¸¸ã€‚</p><p>è¿™ä¸¤ç§å¤ç°æ–¹æ³•å®é™…ä¸Šéƒ½æ˜¯åŒä¸€ä¸ªåŸå› å¯¼è‡´çš„ã€‚</p><h3><span id="13-é—®é¢˜è§£å†³æ–¹æ¡ˆ">1.3 é—®é¢˜è§£å†³æ–¹æ¡ˆ</span></h3><p>ä¸Šè¿°çš„ä¸¤ç§å¤ç°æ–¹æ³•éƒ½æ˜¯åœ¨å•çº¿ç¨‹è¿è¡Œçš„ï¼Œå…ˆæ¥è¯´æ˜å•çº¿ç¨‹ä¸­çš„è§£å†³æ–¹æ¡ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">    ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">        arrayList.add(Integer.valueOf(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Iterator&lt;Integer&gt; iterator = arrayList.iterator();</span><br><span class="line">    <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">        <span class="keyword">if</span> (integer.intValue() == <span class="number">5</span>) &#123;</span><br><span class="line">            iterator.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§è§£å†³æ–¹æ¡ˆæœ€æ ¸å¿ƒçš„å°±æ˜¯è°ƒç”¨iterator.remove()æ–¹æ³•ã€‚æˆ‘ä»¬çœ‹çœ‹è¯¥æ–¹æ³•æºç ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ³•èƒ½é¿å…æŠ›å‡ºå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">    checkForComodification();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ArrayList.<span class="built_in">this</span>.remove(lastRet);</span><br><span class="line">        cursor = lastRet;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨iterator.remove()æ–¹æ³•ä¸­ï¼ŒåŒæ ·è°ƒç”¨äº†ArrayListè‡ªèº«çš„removeæ–¹æ³•ï¼Œä½†æ˜¯è°ƒç”¨å®Œä¹‹åå¹¶éå°±returnäº†ï¼Œè€Œæ˜¯expectedModCount= modCounté‡ç½®äº†expectedModCountå€¼ï¼Œä½¿äºŒè€…çš„å€¼ç»§ç»­ä¿æŒç›¸ç­‰ã€‚</p><p>é’ˆå¯¹forEachå¾ªç¯å¹¶æ²¡æœ‰ä¿®å¤æ–¹æ¡ˆï¼Œå› æ­¤åœ¨éå†è¿‡ç¨‹ä¸­åŒæ—¶éœ€è¦ä¿®æ”¹ArrayListå¯¹è±¡ï¼Œåˆ™éœ€è¦é‡‡ç”¨iteratoréå†ã€‚</p><p>ä¸Šé¢æå‡ºçš„è§£å†³æ–¹æ¡ˆè°ƒç”¨çš„æ˜¯iterator.remove()æ–¹æ³•ï¼Œå¦‚æœä¸ä»…ä»…æ˜¯æƒ³è°ƒç”¨removeæ–¹æ³•ç§»é™¤å…ƒç´ ï¼Œè¿˜æƒ³å¢åŠ å…ƒç´ ï¼Œæˆ–è€…æ›¿æ¢å…ƒç´ ï¼Œæ˜¯å¦å¯ä»¥å‘¢ï¼Ÿæµè§ˆIteratoræºç å¯ä»¥å‘ç°è¿™æ˜¯ä¸è¡Œçš„ï¼ŒIteratoråªæä¾›äº†removeæ–¹æ³•ã€‚</p><p>ä½†æ˜¯ArrayListå®ç°äº†ListIteratoræ¥å£ï¼ŒListIteratorç±»ç»§æ‰¿äº†Iterï¼Œè¿™äº›æ“ä½œéƒ½æ˜¯å¯ä»¥å®ç°çš„ï¼Œä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (lastRet &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>();</span><br><span class="line">    checkForComodification();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        ArrayList.<span class="built_in">this</span>.remove(lastRet);</span><br><span class="line">        cursor = lastRet;</span><br><span class="line">        lastRet = -<span class="number">1</span>;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IndexOutOfBoundsException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ConcurrentModificationException</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="äºŒ-å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„é—®é¢˜åˆ†æåŠè§£å†³æ–¹æ¡ˆ">äºŒã€å¤šçº¿ç¨‹æƒ…å†µä¸‹çš„é—®é¢˜åˆ†æåŠè§£å†³æ–¹æ¡ˆ</span></h2><p>å•çº¿ç¨‹é—®é¢˜è§£å†³äº†ï¼Œå†æ¥çœ‹çœ‹å¤šçº¿ç¨‹æƒ…å†µã€‚</p><h3><span id="21-é—®é¢˜å¤ç°">2.1 é—®é¢˜å¤ç°</span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test4</span><span class="params">()</span> &#123;</span><br><span class="line">ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">arrayList.add(Integer.valueOf(i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            ListIterator&lt;Integer&gt; iterator = arrayList.listIterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;thread1 &quot;</span> + iterator.next().intValue());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            ListIterator&lt;Integer&gt; iterator = arrayList.listIterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;thread2 &quot;</span> + iterator.next().intValue());</span><br><span class="line">                iterator.remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread1.start();</span><br><span class="line">    thread2.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸ªæµ‹è¯•ä»£ç ä¸­ï¼Œå¼€å¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªçº¿ç¨‹éå†ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹éå†åŠ ä¿®æ”¹ã€‚ç¨‹åºè¾“å‡ºç»“æœå¦‚ä¸‹</p><blockquote><p>thread1 0 thread2 0 thread2 1 thread2 2 thread2 3 thread2 4 thread2 5thread2 6 thread2 7 thread2 8 thread2 9 thread2 10 thread2 11 thread2 12thread2 13 thread2 14 thread2 15 thread2 16 thread2 17 thread2 18thread2 19 Exception in thread "Thread-0"java.util.ConcurrentModificationException at java.util.ArrayList<span class="math inline">\(Itr.checkForComodification(ArrayList.java:901)  at java.util.ArrayList\)</span>Itr.next(ArrayList.java:851) atcom.snow.ExceptionTest$1.run(ExceptionTest.java:74) atjava.lang.Thread.run(Thread.java:745)</p><p>Process finished with exit code 0</p></blockquote><h3><span id="22-é—®é¢˜åˆ†æ">2.2 é—®é¢˜åˆ†æ</span></h3><p>ä»ä¸Šé¢ä»£ç æ‰§è¡Œç»“æœå¯ä»¥çœ‹å‡ºthread2 éå†ç»“æŸåï¼Œthread1sleepå®Œ1000mså‡†å¤‡éå†ç¬¬äºŒä¸ªå…ƒç´ ï¼Œnextçš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸äº†ã€‚æˆ‘ä»¬ä»æ—¶é—´ç‚¹åˆ†æä¸€ä¸‹æŠ›å¼‚å¸¸çš„åŸå› </p><table><colgroup><col style="width: 25%"><col style="width: 16%"><col style="width: 29%"><col style="width: 29%"></colgroup><thead><tr><th>æ—¶é—´ç‚¹</th><th>arrayList.modCount</th><th>thread1 iterator.expectedModCount</th><th>thread2 iterator.expectedModCount</th></tr></thead><tbody><tr><td>thread startï¼Œåˆå§‹åŒ–iterator</td><td>20</td><td>20</td><td>20</td></tr><tr><td>thread2.remove()è°ƒç”¨ä¹‹å</td><td>21</td><td>20</td><td>21</td></tr></tbody></table><p>ä¸¤ä¸ªthreadéƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªarrayListï¼Œthread2ä¿®æ”¹å®ŒåmodCount =21ï¼Œæ­¤æ—¶thread2çš„expectedModCount = 21å¯ä»¥ä¸€ç›´éå†åˆ°ç»“æŸï¼›thread1çš„expectedModCountä»ç„¶ä¸º20ï¼Œå› ä¸ºthread1çš„expectedModCountåªæ˜¯åœ¨åˆå§‹åŒ–çš„æ—¶å€™èµ‹å€¼ï¼Œå…¶åå¹¶æœªè¢«ä¿®æ”¹è¿‡ã€‚å› æ­¤å½“arrayListçš„modCountè¢«thread2ä¿®æ”¹ä¸º21ä¹‹åï¼Œthread1æƒ³ç»§ç»­éå†å¿…å®šä¼šæŠ›å‡ºå¼‚å¸¸äº†ã€‚</p><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä»£ç é‡Œé¢ï¼Œä¸¤ä¸ªthreadï¼Œæ¯ä¸ªthreadéƒ½æœ‰è‡ªå·±çš„iteratorï¼Œå½“thread2é€šè¿‡iteratoræ–¹æ³•ä¿®æ”¹expectedModCountå¿…å®šä¸ä¼šè¢«thread1æ„ŸçŸ¥åˆ°ã€‚è¿™ä¸ªè·ŸArrayListéçº¿ç¨‹å®‰å…¨æ˜¯æ— å…³çš„ï¼Œå³ä½¿è¿™é‡Œé¢çš„ArrayListæ¢æˆVectorä¹Ÿæ˜¯ä¸€æ ·çš„ç»“æœï¼Œä¸ä¿¡ä¸Šæµ‹è¯•ä»£ç ï¼š</p><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> &#123;</span><br><span class="line">    Vector&lt;Integer&gt; vector = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">        vector.add(Integer.valueOf(i));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            ListIterator&lt;Integer&gt; iterator = vector.listIterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;thread1 &quot;</span> + iterator.next().intValue());</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            ListIterator&lt;Integer&gt; iterator = vector.listIterator();</span><br><span class="line">            <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                System.out.println(<span class="string">&quot;thread2 &quot;</span> + integer.intValue());</span><br><span class="line">                <span class="keyword">if</span> (integer.intValue() == <span class="number">5</span>) &#123;</span><br><span class="line">                    iterator.remove();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    thread1.start();</span><br><span class="line">    thread2.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œåè¾“å‡ºç»“æœä¸ºï¼š</p><blockquote><p>thread1 0 thread2 0 thread2 1 thread2 2 thread2 3 thread2 4 thread2 5thread2 6 thread2 7 thread2 8 thread2 9 thread2 10 thread2 11 thread2 12thread2 13 thread2 14 thread2 15 thread2 16 thread2 17 thread2 18thread2 19 Exception in thread "Thread-0"java.util.ConcurrentModificationException at java.util.Vector<span class="math inline">\(Itr.checkForComodification(Vector.java:1184)  at java.util.Vector\)</span>Itr.next(Vector.java:1137) atcom.snow.ExceptionTest$3.run(ExceptionTest.java:112) atjava.lang.Thread.run(Thread.java:745)</p><p>Process finished with exit code 0</p></blockquote><p>test5()æ–¹æ³•æ‰§è¡Œç»“æœå’Œtest4()æ˜¯ç›¸åŒçš„ï¼Œé‚£å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><h3><span id="23-å¤šçº¿ç¨‹ä¸‹çš„è§£å†³æ–¹æ¡ˆ">2.3 å¤šçº¿ç¨‹ä¸‹çš„è§£å†³æ–¹æ¡ˆ</span></h3><h4><span id="231æ–¹æ¡ˆä¸€iteratoréå†è¿‡ç¨‹åŠ åŒæ­¥é”é”ä½æ•´ä¸ªarraylist">2.3.1æ–¹æ¡ˆä¸€ï¼šiteratoréå†è¿‡ç¨‹åŠ åŒæ­¥é”ï¼Œé”ä½æ•´ä¸ªarrayList</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test5</span><span class="params">()</span> &#123;</span><br><span class="line">ArrayList&lt;Integer&gt; arrayList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">arrayList.add(Integer.valueOf(i));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">             <span class="keyword">synchronized</span> (arrayList) &#123;</span><br><span class="line">                ListIterator&lt;Integer&gt; iterator = arrayList.listIterator();</span><br><span class="line">              <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;thread1 &quot;</span> + iterator.next().intValue());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                   &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (arrayList) &#123;</span><br><span class="line">                ListIterator&lt;Integer&gt; iterator = arrayList.listIterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">                    System.out.println(<span class="string">&quot;thread2 &quot;</span> + integer.intValue());</span><br><span class="line">                    <span class="keyword">if</span> (integer.intValue() == <span class="number">5</span>) &#123;</span><br><span class="line">                        iterator.remove();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">   &#125;);</span><br><span class="line">   thread1.start();</span><br><span class="line">    thread2.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>è¿™ç§æ–¹æ¡ˆæœ¬è´¨ä¸Šæ˜¯å°†å¤šçº¿ç¨‹é€šè¿‡åŠ é”æ¥è½¬å˜ä¸ºå•çº¿ç¨‹æ“ä½œï¼Œç¡®ä¿åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹å»ä½¿ç”¨iteratoréå†arrayListï¼Œå…¶å®ƒçº¿ç¨‹ç­‰å¾…ï¼Œæ•ˆç‡æ˜¾ç„¶æ˜¯åªæœ‰å•çº¿ç¨‹çš„æ•ˆç‡ã€‚</p><h4><span id="232æ–¹æ¡ˆäºŒä½¿ç”¨copyonwritearraylistæœ‰å‘è¦æ˜ç™½åŸç†å†ç”¨å¦åˆ™ä½ å°±å‘†å‘é‡Œå§">2.3.2æ–¹æ¡ˆäºŒï¼šä½¿ç”¨CopyOnWriteArrayListï¼Œæœ‰å‘ï¼è¦æ˜ç™½åŸç†å†ç”¨ï¼Œå¦åˆ™ä½ å°±å‘†å‘é‡Œå§ã€‚</span></h4><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä»£ç ï¼Œå¾ˆæœ‰æ„æ€å’¯</p><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test6</span><span class="params">()</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            list.add(Integer.valueOf(i));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                ListIterator&lt;Integer&gt; iterator = list.listIterator();</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;thread1 &quot;</span> + iterator.next().intValue());</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                        e.printStackTrace();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Integer integer : list) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;thread2 &quot;</span> + integer.intValue());</span><br><span class="line">                    <span class="keyword">if</span> (integer.intValue() == <span class="number">5</span>) &#123;</span><br><span class="line">                        list.remove(integer);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span> (Integer integer : list) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;thread2 again &quot;</span> + integer.intValue());</span><br><span class="line">                &#125;</span><br><span class="line"><span class="comment">//                ListIterator&lt;Integer&gt; iterator = list.listIterator();</span></span><br><span class="line"><span class="comment">//                while (iterator.hasNext()) &#123;</span></span><br><span class="line"><span class="comment">//                    Integer integer = iterator.next();</span></span><br><span class="line"><span class="comment">//                    System.out.println(&quot;thread2 &quot; + integer.intValue());</span></span><br><span class="line"><span class="comment">//                    if (integer.intValue() == 5) &#123;</span></span><br><span class="line"><span class="comment">//                        iterator.remove();</span></span><br><span class="line"><span class="comment">//                    &#125;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><a href="javascript:void(0);"><img src="https://common.cnblogs.com/images/copycode.gif" alt="å¤åˆ¶ä»£ç "></a></p><p>å…ˆä¸åˆ†æï¼Œçœ‹æ‰§è¡Œç»“æœï¼Œè¿™ä¸ªæ‰§è¡Œç»“æœé‡ç‚¹å…³æ³¨å­—ä½“åŠ ç²—éƒ¨åˆ†ã€‚</p><blockquote><p>thread1 0 thread2 0 thread2 1 thread2 2 thread2 3 <strong>thread24</strong> <strong>thread2 5</strong> <strong>thread2 6</strong> thread27 thread2 8 thread2 9 thread2 10 thread2 11 thread2 12 thread2 13thread2 14 thread2 15 thread2 16 thread2 17 thread2 18 thread2 19thread2 again 0 thread2 again 1 thread2 again 2 thread2 again 3<strong>thread2 again 4</strong> <strong>thread2 again 6</strong>thread2 again 7 thread2 again 8 thread2 again 9 thread2 again 10 thread2again 11 thread2 again 12 thread2 again 13 thread2 again 14 thread2again 15 thread2 again 16 thread2 again 17 thread2 again 18 thread2again 19 thread1 1 thread1 2 thread1 3 thread1 4 thread1 5 thread1 6thread1 7 thread1 8 thread1 9 thread1 10 thread1 11 thread1 12 thread113 thread1 14 thread1 15 thread1 16 thread1 17 thread1 18 thread1 19</p><p>Process finished with exit code 0</p></blockquote><p>æˆ‘ä»¬å…ˆåˆ†æthread2çš„è¾“å‡ºç»“æœï¼Œç¬¬ä¸€æ¬¡éå†å°†4 56éƒ½è¾“å‡ºï¼Œæƒ…ç†ä¹‹ä¸­ï¼›ç¬¬ä¸€æ¬¡éå†ååˆ é™¤æ‰äº†ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒæ¬¡éå†è¾“å‡º46ï¼Œç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p><p>å†æ¥çœ‹ä¸‹thread1çš„è¾“å‡ºç»“æœï¼Œæœ‰æ„æ€çš„äº‹æƒ…æ¥äº†ï¼Œthread1 ä»ç„¶è¾“å‡ºäº†4 56ï¼Œä»€ä¹ˆé¬¼ï¼Ÿthread1å’Œthread2éƒ½æ˜¯éå†listï¼Œliståœ¨thread1éå†ç¬¬äºŒä¸ªå…ƒç´ çš„æ—¶å€™å°±å·²ç»åˆ é™¤äº†ä¸€ä¸ªå…ƒç´ äº†ï¼Œä¸ºå•¥è¿˜èƒ½è¾“å‡º5ï¼Ÿ</p><p>ä¸ºäº†äº†è§£è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦äº†è§£CopyOnWriteArrayListæ˜¯å¦‚ä½•åšåˆ°ä¸€è¾¹éå†çš„åŒæ—¶è¿˜èƒ½ä¸€è¾¹ä¿®æ”¹å¹¶ä¸”è¿˜ä¸æŠ›å¼‚å¸¸çš„ã€‚</p><p>åœ¨è¿™é‡Œä¸æƒ³å†æ·±å…¥åˆ†æCopyOnWriteArrayListä»£ç ï¼Œåç»­ä¼šä¸“é—¨å‡ºä¸€ç¯‡åšå®¢æ¥è§£é‡Šè¿™ä¸ªç±»çš„æºç çš„ã€‚</p><p>è¿™é‡Œè¯´ä¸€ä¸‹CopyOnWriteArrayListçš„è§£å†³æ€è·¯ï¼Œå…¶å®å¾ˆç®€å•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Object[] array;</span><br></pre></td></tr></table></figure><p>CopyOnWriteArrayListæœ¬è´¨ä¸Šæ˜¯å¯¹arrayæ•°ç»„çš„ä¸€ä¸ªå°è£…ï¼Œä¸€æ—¦CopyOnWriteArrayListå¯¹è±¡å‘ç”Ÿä»»ä½•çš„ä¿®æ”¹éƒ½ä¼šnewä¸€ä¸ªæ–°çš„Object[]æ•°ç»„newElementï¼Œåœ¨newElementæ•°ç»„ä¸Šæ‰§è¡Œä¿®æ”¹æ“ä½œï¼Œä¿®æ”¹å®Œæˆåå°†newElementèµ‹å€¼ç»™arrayæ•°ç»„ï¼ˆarray=newElementï¼‰ã€‚</p><p>å› ä¸ºarrayæ˜¯volatileçš„ï¼Œå› æ­¤å®ƒçš„ä¿®æ”¹å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½å¯è§ã€‚</p><p>äº†è§£äº†CopyOnWriteArrayListçš„å®ç°æ€è·¯ä¹‹åï¼Œæˆ‘ä»¬å†æ¥åˆ†æä¸Šé¢ä»£ç test6ä¸ºä»€ä¹ˆä¼šå‡ºç°é‚£æ ·çš„è¾“å‡ºç»“æœã€‚å…ˆæ¥çœ‹ä¸‹thread1å’Œthread2ä¸­ç”¨åˆ°çš„ä¸¤ç§éå†æ–¹å¼çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">forEach</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> E&gt; action)</span> &#123;</span><br><span class="line"><span class="keyword">if</span> (action == <span class="literal">null</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line"><span class="comment">// åœ¨éå†å¼€å§‹å‰è·å–å½“å‰æ•°ç»„</span></span><br><span class="line">Object[] elements = getArray();</span><br><span class="line"><span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> <span class="type">E</span> <span class="variable">e</span> <span class="operator">=</span> (E) elements[i];</span><br><span class="line">action.accept(e);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> ListIterator&lt;E&gt; <span class="title function_">listIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">COWIterator</span>&lt;E&gt;(getArray(), <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">COWIterator</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">ListIterator</span>&lt;E&gt; &#123;</span><br><span class="line">        <span class="comment">/** Snapshot of the array */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Object[] snapshot;</span><br><span class="line">        <span class="comment">/** Index of element to be returned by subsequent call to next.  */</span></span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> cursor;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="title function_">COWIterator</span><span class="params">(Object[] elements, <span class="type">int</span> initialCursor)</span> &#123;</span><br><span class="line">            cursor = initialCursor;</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–ä¸ºå½“å‰æ•°ç»„</span></span><br><span class="line">            snapshot = elements;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// å·²ç»ä¸æ”¯æŒIterator removeæ“ä½œäº†ï¼ï¼</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> cursor &lt; snapshot.length;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (! hasNext())</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NoSuchElementException</span>();</span><br><span class="line">            <span class="keyword">return</span> (E) snapshot[cursor++];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ­¤å¤„çœç•¥å…¶ä»–æ— å…³ä»£ç </span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤ç§éå†æ–¹å¼æœ‰ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼šéƒ½åœ¨åˆå§‹åŒ–çš„æ—¶å€™å°†å½“å‰æ•°ç»„ä¿å­˜ä¸‹æ¥äº†ï¼Œä¹‹åçš„éå†éƒ½å°†ä¼šéå†è¿™ä¸ªæ•°ç»„ï¼Œè€Œä¸ç®¡arrayå¦‚ä½•å˜åŒ–ã€‚</p><table><colgroup><col style="width: 14%"><col style="width: 15%"><col style="width: 20%"><col style="width: 24%"><col style="width: 24%"></colgroup><thead><tr><th>æ—¶é—´ç‚¹</th><th>CopyOnWriteArrayListçš„array</th><th>thread1 iterator åˆå§‹åŒ–çš„Objectæ•°ç»„</th><th>thread2 ç¬¬ä¸€æ¬¡éå†forEachåˆå§‹åŒ–çš„Objectæ•°ç»„</th><th>thread2 ç¬¬äºŒæ¬¡éå†forEachåˆå§‹åŒ–çš„Objectæ•°ç»„</th></tr></thead><tbody><tr><td>thread start</td><td>å‡è®¾ä¸ºA</td><td>A</td><td>A</td><td>/</td></tr><tr><td>thread2 è°ƒç”¨removeæ–¹æ³•ä¹‹å</td><td>å‡è®¾ä¸ºB</td><td>A</td><td>A</td><td>B</td></tr></tbody></table><p>æœ‰äº†è¿™ä¸ªæ—¶é—´èŠ‚ç‚¹è¡¨å°±å¾ˆæ¸…æ¥šäº†ï¼Œthread1å’Œthread2startçš„æ—¶å€™éƒ½ä¼šå°†Aæ•°ç»„åˆå§‹åŒ–ç»™è‡ªå·±çš„ä¸´æ—¶å˜é‡ï¼Œä¹‹åéå†çš„ä¹Ÿéƒ½æ˜¯è¿™ä¸ªAæ•°ç»„ï¼Œè€Œä¸ç®¡CopyOnWriteArrayListä¸­çš„arrayå‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ã€‚å› æ­¤ä¹Ÿå°±è§£é‡Šäº†thread1åœ¨thread2removeæ‰ä¸€ä¸ªå…ƒç´ ä¹‹åä¸ºä»€ä¹ˆè¿˜ä¼šè¾“å‡º5äº†ã€‚åœ¨thread2ä¸­ï¼Œç¬¬äºŒæ¬¡éå†åˆå§‹åŒ–æ•°ç»„å˜æˆäº†å½“å‰çš„arrayï¼Œä¹Ÿå°±æ˜¯ä¿®æ”¹åçš„Bï¼Œå› æ­¤ä¸ä¼šæœ‰Integer.valueOf(5)è¿™ä¸ªå…ƒç´ äº†ã€‚</p><p>ä»test6æ‰§è¡Œç»“æœæ¥çœ‹ï¼ŒCopyOnWriteArrayListç¡®å®èƒ½è§£å†³ä¸€è¾¹éå†ä¸€è¾¹ä¿®æ”¹å¹¶ä¸”è¿˜ä¸ä¼šæŠ›å¼‚å¸¸ï¼Œä½†æ˜¯è¿™ä¹Ÿæ˜¯æœ‰<strong>ä»£ä»·</strong>çš„ï¼š</p><ol type="1"><li><p>thread2å¯¹arrayæ•°ç»„çš„ä¿®æ”¹thread1å¹¶ä¸èƒ½è¢«åŠ¨æ„ŸçŸ¥åˆ°ï¼Œåªèƒ½é€šè¿‡hashCode()æ–¹æ³•å»ä¸»åŠ¨æ„ŸçŸ¥ï¼Œå¦åˆ™å°±ä¼šä¸€ç›´ä½¿ç”¨ä¿®æ”¹å‰çš„æ•°æ®</p></li><li><p>æ¯æ¬¡ä¿®æ”¹éƒ½éœ€è¦é‡æ–°newä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä¸”å°†arrayæ•°ç»„æ•°æ®æ‹·è´åˆ°newå‡ºæ¥çš„æ•°ç»„ä¸­ï¼Œæ•ˆç‡ä¼šå¤§å¹…ä¸‹é™</p></li></ol><p>æ­¤å¤–CopyOnWriteArrayListä¸­çš„ListIteratorå®ç°æ˜¯ä¸æ”¯æŒremoveã€addå’Œsetæ“ä½œçš„ï¼Œä¸€æ—¦è°ƒç”¨å°±ä¼šæŠ›å‡ºUnsupportedOperationExceptionå¼‚å¸¸ï¼Œå› æ­¤test6æ³¨é‡Šä»£ç 34-41è¡Œä¸­å¦‚æœè¿è¡Œæ˜¯ä¼šæŠ›å¼‚å¸¸çš„ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¡ç‰¹å…°æ•°</title>
      <link href="/2021/07/27/algorithms/qia-te-lan-shu/"/>
      <url>/2021/07/27/algorithms/qia-te-lan-shu/</url>
      
        <content type="html"><![CDATA[<p>è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><blockquote><p>ç°åœ¨æˆ‘ä»¬æœ‰<span class="math inline">\(n+1\)</span>ä¸ªæ•°ï¼Œ<span class="math inline">\(x_0,x_1,x_2,\cdots,x_n\)</span>ï¼Œè€ƒè™‘å®ƒä»¬çš„ä¹˜ç§¯<span class="math inline">\(x_1\cdot x_2\cdotsx_n\)</span>ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨å…¶ä¸­æ’å…¥æ‹¬å·æ¥æ”¹å˜è®¡ç®—é¡ºåºã€‚é‚£ä¹ˆä¸€å…±æœ‰å¤šå°‘ç§æ’åˆ—çš„é¡ºåºå‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼Œç°åœ¨æœ‰ä¸‰ä¸ªæ•°<span class="math inline">\(x_0, x_1, x_2\)</span>ï¼Œå®ƒä»¬çš„è®¡ç®—é¡ºåºæœ‰<span class="math inline">\((x_0x_1)x_2\)</span>ä»¥åŠ<span class="math inline">\(x_0(x_1x_2)\)</span>ä¸¤ç§æ’åˆ—æ–¹å¼</p></blockquote><span id="more"></span><h3><span id="é—®é¢˜åˆ†æ">é—®é¢˜åˆ†æ</span></h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é€’å½’çš„æ€æƒ³æ¥è€ƒè™‘è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬æŠŠè¿™<span class="math inline">\(n+1\)</span>ä¸ªæ•°åˆ†ä¸ºä¸¤ç»„ï¼Œåœ¨ç¬¬<span class="math inline">\(k\)</span>ä¸ªæ•°å¤„åˆ†å¼€ï¼Œå°±å½¢æˆäº†ä¸‹é¢<span class="math inline">\(A, B\)</span>ä¸¤ç»„æ•°ã€‚</p><p><span class="math display">\[\underbrace{(x_0\space x_1\space x_2 \cdots x_k)}_{A},\underbrace{(\space x_{k+1}\cdots x_{n-1}\space x_{n})}_{B}\]</span></p><p>æˆ‘ä»¬è®°<span class="math inline">\(n+1\)</span>ä¸ªæ•°çš„æ’å…¥æ‹¬å·åçš„è®¡ç®—é¡ºåºä¸ªæ•°ä¸º<span class="math inline">\(C_n\)</span>ï¼Œé‚£ä¹ˆ<span class="math inline">\(A\)</span>çš„è®¡ç®—é¡ºåºä¸ªæ•°å°±æ˜¯<span class="math inline">\(C_k\)</span>ï¼Œ<span class="math inline">\(B\)</span>çš„å°±æ˜¯<span class="math inline">\(C_{n-k-1}\)</span>ã€‚æ‰€ä»¥è¯´ï¼Œå¦‚æœè¯´æˆ‘ä»¬æŠŠæœ€åä¸€ä¸ªæ‹¬å·æ”¾åœ¨ç¬¬<span class="math inline">\(k\)</span>ä¸ªæ•°çš„åœ°æ–¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€»çš„ä¸ªæ•°å°±æ˜¯<span class="math inline">\(C_kC_{n-k-1}\)</span>ã€‚è¿™é‡Œ<span class="math inline">\(k\)</span>å¯ä»¥ä»0åˆ°<span class="math inline">\(n-1\)</span>ï¼Œæ ¹æ®åŠ æ³•åŸåˆ™ï¼Œ</p><p><span class="math display">\[C_n=\sum^{n-1}_{k=0}C_kC_{n-k-1}, \space\space\space\space n\geqslant 1\]</span></p><p>å‰©ä¸‹çš„äº‹æƒ…å°±æ˜¯ç”¨æ•°å­¦æ–¹æ³•è®¡ç®—å‡ºè¿™ä¸ªæ•°åˆ—çš„é€šé¡¹å…¬å¼ã€‚</p><h3><span id="æ•°å­¦è§£æ³•">æ•°å­¦è§£æ³•</span></h3><p>é€šè¿‡ç”Ÿæˆå‡½æ•°æ³•(generatingfunction)å¯ä»¥è§£å‡ºç¬¦åˆæ–¹æ³•ä¸€ä¸­é€’æ¨å…¬å¼çš„æ•°åˆ—çš„é€šé¡¹å…¬å¼ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬å®šä¹‰å‡½æ•°</p><p><span class="math display">\[f(x)=\sum_{k\geqslant0}C_kx^k\]</span></p><p>ç„¶åæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„é€’æ¨å…¬å¼æ¨å¹¿åˆ°<span class="math inline">\(n\geqslant0\)</span>ï¼Œä¹Ÿå°±æ˜¯</p><p><span class="math display">\[C_n=\sum_{k\geqslant0}C_kC_{n-k-1}+\mathbb{I}_{\{n=0\}},\space\space\space\space \forall n\geqslant0\]</span></p><p>å…¶ä¸­<span class="math inline">\(\mathbb{I}_{\{n=0\}}\)</span>æ˜¯ç¤ºæ„å‡½æ•°(indicatorfunction)ï¼Œå½“<span class="math inline">\(n=0\)</span>æ—¶æ­¤å‡½æ•°å€¼ä¸º1ï¼Œå¦åˆ™å€¼ä¸º0ã€‚å¹¶ä¸”æˆ‘ä»¬å®šä¹‰å½“<span class="math inline">\(k&lt;0\)</span>æ—¶ï¼Œ<span class="math inline">\(C_k=0\)</span>ã€‚ç­‰å¼ä¸¤è¾¹åŒä¹˜æˆ‘ä»¬å¯ä»¥å¾—åˆ°</p><p><span class="math display">\[\begin{aligned}f(x)&amp; =\sum_{n\geqslant0}C_nx^n  =\sum_{n\geqslant0}C_kC_{n-k-1}x^n+\mathbb{I}_{\{n=0\}}x^n\\&amp; = \sum_{n\geqslant0}\sum_{k\geqslant0}C_kC_{n-k-1}x^kx^{n-k}+1 \\&amp; =\sum_{k\geqslant0}\Big[C_kx^k\sum_{n\geqslant0}C_{n-k-1}x^{n-k-1}\cdotx\Big]+1 \\\end{aligned}\]</span></p><p>æˆ‘ä»¬å¯¹<span class="math inline">\(n-k+1\)</span>è¿›è¡Œä¸€ä¸ªæ¢å…ƒä¹‹åï¼Œå¼å­ä¸­çš„<span class="math inline">\(\sum_{n\geqslant0}C_{n-k-1}x^{n-k-1}\)</span>å¯ä»¥å†™æˆ<span class="math inline">\(\sum_{j\geqslant0}Cjx^j\)</span>ï¼Œä¹Ÿå°±æ˜¯<span class="math inline">\(f(x)\)</span>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—åˆ°</p><p><span class="math display">\[\begin{aligned}f(x)&amp; =\sum_{k\geqslant0}C_kx^kf(x)x+1 \\&amp; =x\big(f(x)\big)^2+1 \\\Longrightarrow f(x)&amp; =\frac{1\pm\sqrt{1-4x}}{2x}\end{aligned}\]</span></p><p>é€šè¿‡è§‚å¯Ÿï¼Œç”±äº<span class="math inline">\(f(x)=C_0+C_1x+C_2x^2+\cdots\)</span>å¹¶ä¸”<span class="math inline">\(f(0)=C_0=1\)</span>ï¼Œå¯ä»¥æ¨æ–­å‡ºè¿™é‡Œæˆ‘ä»¬éœ€è¦å–å‡å·ã€‚æ¥ä¸‹æ¥è®¡ç®—<span class="math inline">\((1-4x)^{\frac{1}{2}}\)</span></p><p><span class="math display">\[\begin{aligned}(1-4x)^{\frac{1}{2}} &amp;=\sum_{k\geqslant0}\tbinom{\frac{1}{2}}{k}(-4x)^k\space\space\space\space |x|&lt;\frac{1}{4}\\ &amp; =1+\sum_{k\geqslant1}(-1)^k\tbinom{\frac{1}{2}}{k}4^kx^k\end{aligned}\]</span></p><p>é€šè¿‡å¹¿ä¹‰äºŒé¡¹å¼å®šç†ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥åŒ–ç®€</p><p><span class="math display">\[\begin{aligned}\tbinom{\frac{1}{2}}{k}&amp;=\frac{\frac{1}{2}(\frac{1}{2}-1)\cdots(\frac{1}{2}-k+1)}{k!} \\&amp; =\frac{1}{2k}\cdot\frac{(-\frac{1}{2})(-\frac{3}{2})\cdots(-\frac{1}{2}-(k-1)+1)}{(k-1)!}\\&amp; =\frac{1}{2k}\cdot(-\frac{1}{2})^{k-1}\cdot\frac{1\cdot3\cdots(2k-3)}{(k-1)!}\\&amp; =\frac{1}{2k}\cdot(-\frac{1}{2})^{k-1}\cdot\frac{1\cdot2\cdot3\cdot4\cdots(2k-3)\cdot(2k-2)}{2^{k-1}(k-1)!(k-1)!}\\&amp; =\frac{1}{2k}\cdot(-\frac{1}{4})^{k-1}\cdot\tbinom{2k-2}{k-1}\end{aligned}\]</span></p><p>ä»£å…¥ä¸Šè¿°å¼å­å¯å¾—</p><p><span class="math display">\[\begin{aligned}(1-4x)^{\frac{1}{2}}&amp;=1-\sum_{k\geqslant1}\frac{1}{2k}\tbinom{2k-2}{k-1}\cdot4\cdot x^k \\&amp; =1-2x\sum_{k\geqslant0}\frac{1}{k+1}\tbinom{2k}{k}x^k\end{aligned}\]</span></p><p>æœ€åæŠŠè¿™ä¸ªå¼å­ä»£å›åˆ°<span class="math inline">\(f(x)\)</span>çš„è¡¨è¾¾å¼ä¸­å»ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°</p><p><span class="math display">\[f(x)=\sum_{k\geqslant0}\frac{1}{k+1}\tbinom{2k}{k}x^k\]</span></p><p>ä¸<span class="math inline">\(f(x)=\sum_{k\geqslant0}C_kx^k\)</span>è¿›è¡Œå¯¹æ¯”æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®º</p><p><span class="math display">\[C_n=\frac{1}{n+1}\tbinom{2n}{n}\]</span></p><p>è¿™å°±æ˜¯å¡ç‰¹å…°æ•°(Catalan Number)</p><h3><span id="å¡ç‰¹å…°æ•°çš„å…¶ä»–ç­‰ä»·é—®é¢˜">å¡ç‰¹å…°æ•°çš„å…¶ä»–ç­‰ä»·é—®é¢˜</span></h3><ol type="1"><li><p>Dyck wordçš„ä¸ªæ•°. Dyck wordè¡¨ç¤ºä¸€ä¸ªæœ‰ç”±<span class="math inline">\(n\)</span>ä¸ªXå’Œ<span class="math inline">\(n\)</span>ä¸ªYç»„æˆçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”éœ€è¦æ»¡è¶³ï¼šåœ¨ä»»æ„ä¸€ä¸ªä½ç½®ï¼Œä¹‹å‰çš„Xä¸ªæ•°éƒ½å¿…é¡»å¤§äºç­‰äºYçš„ä¸ªæ•°ã€‚</p><p>è¿™é‡Œå¯ä»¥ç»™å‡ºä¸€ä¸ªå¡ç‰¹å…°æ•°ç®€å•çš„è®¡ç®—æ–¹æ³•</p><p>é¦–å…ˆä¸è€ƒè™‘é™åˆ¶æ¡ä»¶ï¼Œé‚£ä¹ˆæ€»å…±çš„æ’åˆ—æ–¹å¼æœ‰<span class="math inline">\(\tbinom{2n}{n}\)</span>ç§ï¼Œç„¶åè€ƒè™‘ä¸æ»¡è¶³é¢˜ç›®é™åˆ¶çš„ä¸ªæ•°ã€‚å‡è®¾åœ¨ç¬¬<span class="math inline">\(2m+1\)</span>å¤„æœ‰<span class="math inline">\(m+1\)</span>ä¸ªYå’Œ<span class="math inline">\(m\)</span>ä¸ªX(ä¸æ»¡è¶³é¢˜ç›®è¦æ±‚)ï¼Œé‚£ä¹ˆåé¢å°±æœ‰<span class="math inline">\(n-m\)</span>ä¸ªXå’Œ<span class="math inline">\(n-m-1\)</span>ä¸ªYï¼Œå°†è¿™é‡Œçš„Xå…¨éƒ¨æ›¿æ¢ä¸ºYï¼ŒYå…¨éƒ¨æ›¿æ¢ä¸ºXï¼Œé‚£ä¹ˆè¿™æ ·çš„å­—ç¬¦ä¸²å°±å˜æˆäº†ç”±<span class="math inline">\(n-1\)</span>ä¸ªXå’Œ<span class="math inline">\(n+1\)</span>ä¸ªYç»„æˆçš„å­—ç¬¦ä¸²ã€‚è¿™æ ·çš„å­—ç¬¦ä¸²æ€»æ•°æ˜¯<span class="math inline">\(\tbinom{2n}{n+1}\)</span>ï¼Œæ‰€ä»¥æ€»æ•°æ˜¯</p><p><span class="math display">\[\tbinom{2n}{n}-\tbinom{2n}{n+1}=\frac{1}{n+1}\tbinom{2n}{n}\]</span></p></li><li><p>åŒ…å«nç»„æ‹¬å·çš„åˆæ³•è¿ç®—å¼çš„ä¸ªæ•°ã€‚</p></li><li><p>ä¸ç›¸äº¤çš„å¼¦é—®é¢˜ï¼šåœ¨ä¸€ä¸ªåœ†å‘¨ä¸Šåˆ†å¸ƒç€<span class="math inline">\(2n\)</span>ä¸ªç‚¹ï¼Œè¦æ±‚åœ¨æ¯ä¸¤ä¸ªç‚¹ä¹‹é—´è¿æ¥ä¸€æ¡å¼¦ï¼Œå¹¶ä¸”å¼¦ä¸å¼¦ä¸èƒ½ç›¸äº¤ï¼Œæ±‚è¿™æ ·çš„è¿æ¥æ–¹å¼ä¸ªæ•°ã€‚</p></li><li><p>æ ¼è·¯é—®é¢˜ï¼šæ‰€æœ‰åœ¨<span class="math inline">\(n\timesn\)</span>æ ¼ç‚¹ä¸­ä¸è¶Šè¿‡å¯¹è§’çº¿çš„å•è°ƒè·¯å¾„çš„ä¸ªæ•°ã€‚å¯ä»¥ç­‰ä»·äºè®¡ç®—Dyckwordçš„ä¸ªæ•°(Xä»£è¡¨â€œå‘å³â€ï¼ŒYè¡¨ç¤ºå‘å³)</p></li></ol><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><p>ç»´åŸºç™¾ç§‘,https://zh.wikipedia.org/wiki/%E5%8D%A1%E5%A1%94%E5%85%B0%E6%95%B0</p><p>å¡ç‰¹å…°æ•°ï¼ˆCatalannumberï¼‰ï¼ˆä¸€ï¼‰,https://zhuanlan.zhihu.com/p/31317307</p>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå°†Listæ•°æ®æ‹†åˆ†è¿›è¡Œåˆ†æ‰¹å¤„ç†</title>
      <link href="/2021/07/26/java/java-jiang-list-shu-ju-chai-fen-jin-xing-fen-pi-chu-li/"/>
      <url>/2021/07/26/java/java-jiang-list-shu-ju-chai-fen-jin-xing-fen-pi-chu-li/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘ç¢°åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœå°†ä¸€ä¸ªæ•°æ®é‡æ¯”è¾ƒå¤§çš„Listæ•°æ®å‘é€åˆ°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·çš„æ‰¹é‡æ“ä½œå¯èƒ½ä¼šç”±ä¸€ä¸ªå°é”™è¯¯å¯¼è‡´æ•´ä¸ªè¯·æ±‚æ— æ³•å®ç°ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘å°†Listè¿›è¡Œæ‹†åˆ†ï¼Œåˆ†æ‰¹å¤„ç†ï¼Œé™ä½å¤±è¯¯ç‡ã€‚</p><span id="more"></span><p>è€ƒè™‘åˆ°Listä¸­å¹¶æ²¡æœ‰å®ç°<code>sublist</code>çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ª<code>sublist</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å°†listæ‹†åˆ†æˆæŒ‡å®šæ•°é‡çš„å°list</span></span><br><span class="line"><span class="comment">* æ³¨: ä½¿ç”¨çš„subListæ–¹å¼,è¿”å›çš„æ˜¯listçš„å†…éƒ¨ç±»,ä¸å¯åšå…ƒç´ çš„åˆ é™¤,ä¿®æ”¹,æ·»åŠ æ“ä½œ</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> length æ•°é‡</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> list å¤§list</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> List&lt;List&lt;T&gt;&gt; <span class="title function_">getSubList</span><span class="params">(<span class="type">int</span> length, List&lt;T&gt; list)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> list.size();</span><br><span class="line">    <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> size / length + <span class="number">1</span>;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> size % length == <span class="number">0</span>;</span><br><span class="line">    List&lt;List&lt;T&gt;&gt; subList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; temp; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i == temp - <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            subList.add(list.subList(length * i, size)) ;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            subList.add(list.subList(length * i, length * (i + <span class="number">1</span>))) ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> subList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://blog.csdn.net/weixin_43687353/article/details/104756939">Javaä¸­å°†å¤§listæ‹†åˆ†æˆå¤šä¸ªå°listï¼Œåˆ†æ‰¹æ“ä½œ</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•ï¼šæ’åºç®—æ³•</title>
      <link href="/2021/07/26/algorithms/suan-fa-pai-xu-suan-fa/"/>
      <url>/2021/07/26/algorithms/suan-fa-pai-xu-suan-fa/</url>
      
        <content type="html"><![CDATA[<h2><span id="é€‰æ‹©æ’åº-selection-sort">é€‰æ‹©æ’åº (Selection sort)</span></h2><p><code>Selection Sort</code>æ˜¯ä¸€ç§æœ€åŸºæœ¬çš„æ’åºæ–¹æ³•ã€‚è¿™ç§æ’åºæ–¹æ³•çš„åŸºæœ¬æƒ³æ³•å°±æ˜¯ï¼šç¬¬ä¸€æ¬¡æ‰¾åˆ°æœ€å°çš„æ•°ä¸ç¬¬ä¸€ä½è¿›è¡Œäº¤æ¢ï¼Œç¬¬äºŒæ¬¡æ‰¾åˆ°ç¬¬äºŒå°çš„æ•°ä¸ç¬¬äºŒä½è¿›è¡Œäº¤æ¢ï¼Œç¬¬ä¸‰æ¬¡æ‰¾åˆ°ç¬¬ä¸‰å°çš„æ•°ä¸ç¬¬ä¸‰ä½è¿›è¡Œäº¤æ¢â€¦â€¦ä»¥æ­¤ç±»æ¨ã€‚ç”±äºæ‰¾ç¬¬iå°çš„æ•°æ—¶ï¼Œå‰é¢i-1ä¸ªæ•°å·²ç»æ˜¯å‰i-1ä¸ªæœ€å°çš„æ•°äº†ï¼Œæ‰€ä»¥åªè¦åœ¨åN-i+1ä¸ªæ•°ä¸­æ‰¾åˆ°æœ€å°çš„æ•°å’Œç¬¬iä¸ªæ•°è¿›è¡Œäº¤æ¢å°±å¥½äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•éœ€è¦åµŒå¥—ä¸¤ä¸ª<code>for</code>å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦å¾ˆæ˜æ˜¾ä¹Ÿå°±æ˜¯<span class="math inline">\(O(N^2)\)</span>äº†ã€‚Java ä»£ç ï¼š</p><span id="more"></span><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SelectionSort</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">double</span>[] a)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> a.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; lengh; i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> i</span><br><span class="line">            <span class="title function_">for</span><span class="params">(<span class="type">int</span> j = i; j &lt; length; j++)</span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (a[j] &lt; a[min])&#123;</span><br><span class="line">                min = j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            a[min] = a[i] + a[min];</span><br><span class="line">            a[i] = a[min] - a[i];</span><br><span class="line">            a[min] = a[min] - a[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ’å…¥æ’åº-insertion-sort">æ’å…¥æ’åº (Insertion sort)</span></h2><p><code>Insertion Sort</code>æ˜¯å¦ä¸€ç§åŸºæœ¬çš„æ’åºæ–¹æ³•ï¼Œå®ƒä¼šæ¯”<code>Selection Sort</code>æ›´æœ‰æ•ˆç‡ä¸€äº›ï¼Œå› ä¸ºè¿™ç§æ’åºæ–¹æ³•çš„æ•ˆç‡å’ŒåŸæœ¬æ•°ç»„çš„æ··ä¹±åº¦æœ‰å…³ï¼Œå¦‚æœè¯´è¿™ä¸ªæ•°ç»„æœ¬èº«å°±å·²ç»æ’åºååˆ†æ•´é½çš„è¯ï¼Œè¿™ä¸ªæ—¶å€™è¿™ç§ç®—æ³•çš„æ•ˆç‡å°±ä¼šå¾ˆé«˜äº†ã€‚è¿™ç§ç®—æ³•çš„åŸºæœ¬æƒ³æ³•å°±å’Œæˆ‘ä»¬æ‰“æ‰‘å…‹çš„æ—¶å€™ç†ç‰Œçš„æ–¹æ³•æ˜¯ä¸€æ ·çš„ã€‚æˆ‘ä»¬æ‰“ç‰Œçš„æ—¶å€™ï¼Œä¼šå¯¹æˆ‘ä»¬æƒ³è¦è¿›è¡Œç§»åŠ¨çš„é‚£å¼ ç‰Œè¿›è¡Œå¤§å°åˆ¤æ–­ï¼Œå°†é‚£å¼ ç‰Œæ’å…¥åˆ°æˆ‘ä»¬å·²ç»æ•´ç†å¥½çš„ä¸€å †ç‰Œé‡Œçš„å¯¹åº”çš„ä½ç½®ã€‚è¿™ç§ç®—æ³•å°±æ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å‡è®¾æˆ‘ä»¬æƒ³è¦ç§»åŠ¨ç¬¬iä¸ªæ•°ï¼Œå¹¶ä¸”å‰i-1å¼ ç‰Œéƒ½å·²ç»è¿›è¡Œå¥½äº†æ’åºï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦å¯¹è¿™ä¸ªæ•°ä¸å‰ä¸€ä¸ªæ•°è¿›è¡Œå¤§å°çš„æ¯”è¾ƒï¼Œå¦‚æœè¿™ä¸ªæ•°æ›´å°ï¼Œé‚£ä¹ˆå°±è¿›è¡Œäº¤æ¢ï¼Œç›´åˆ°æˆ‘ä»¬æ‰¾åˆ°äº†å‰ä¸€ä¸ªä½ç½®çš„æ•°æ¯”è¿™ä¸ªç¬¬iä¸ªæ•°è¿˜è¦å°çš„æ—¶å€™ï¼Œå†å»ç§»åŠ¨ä¸‹ä¸€ä¸ªæ•°ã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ–¹æ³•ä»ç„¶éœ€è¦åµŒå¥—ä¸¤ä¸ª<code>for</code>å¾ªç¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¹Ÿæ˜¯<span class="math inline">\(O(N^2)\)</span>ã€‚Javaä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InsertionSort</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">double</span>[] a)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> a.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; length; i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i; j &gt;= <span class="number">0</span> &amp;&amp; a[j]&lt; a[j-<span class="number">1</span>]; j--)&#123;</span><br><span class="line">                a[j] = a[j] + a[j-<span class="number">1</span>];</span><br><span class="line">                a[j-<span class="number">1</span>] = a[j] - a[j-<span class="number">1</span>];</span><br><span class="line">                a[j] = a[j] - a[j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å½’å¹¶æ’åº-merge-sort">å½’å¹¶æ’åº (Merge sort)</span></h2><p>åœ¨ä¹‹å‰å¯»æ‰¾ä¸€ä¸ªæ•°ç»„ä¸­çš„æœ€å¤§å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒåˆ†æ³•çš„æ–¹æ³•å¯»æ‰¾æœ€å¤§å€¼ï¼Œå¯ä»¥å¤§å¤§æé«˜æ•ˆç‡ã€‚é‚£ä¹ˆåœ¨æ’åºçš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æƒ³æ³•ï¼Œåˆ©ç”¨åˆ†æ²»(divideand conquer)å¯ä»¥å°†æ—¶é—´å¤æ‚åº¦é™ä½è‡³<span class="math inline">\(O(lgN)\)</span>ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä¸€ä¸‹æƒ…å†µï¼Œæœ‰ä¸¤ç»„æ•°ï¼Œéƒ½æ˜¯å·²ç»æ’å¥½åºçš„ï¼Œå¦‚æœå°†è¿™ä¸¤ç»„æ•°æŒ‰ç…§é¡ºåºåˆå¹¶åœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ–°åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨æ–°çš„æœ‰é¡ºåºçš„æ•°ã€‚é¦–å…ˆï¼Œæ¯”è¾ƒä¸¤ç»„æ•°çš„ç¬¬ä¸€ä½æ•°ï¼Œå°†è¾ƒå°çš„æ•°æ”¾è¿›æ–°çš„æ•°ç»„ä¸­ï¼Œè¾ƒå°æ•°æ‰€åœ¨æ•°ç»„çš„ä¸‹ä¸€ä½ä¸è¾ƒå¤§æ•°æ‰€åœ¨æ•°ç»„åŸæ¥çš„æ•°ç»§ç»­è¿›è¡Œæ¯”è¾ƒï¼Œç›´åˆ°æœ‰ä¸€ç»„æ•°è¾¾åˆ°äº†å°½å¤´ï¼Œç„¶åæŠŠå¦ä¸€ç»„å‰©ä¸‹çš„æ•°æ”¾è¿›å»å¾—åˆ°çš„æ–°çš„æ•°ç»„å°±æ˜¯æ’å¥½åºçš„åˆå¹¶åçš„æ•°ç»„ã€‚Javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> mid, <span class="type">int</span> hi)</span>&#123;</span><br><span class="line">    <span class="comment">// æ•°ç»„aux[]ä¸ºåŸæ•°ç»„çš„å¤åˆ¶</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo, j = mid+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">inr</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= hi; i++)&#123;</span><br><span class="line">        aux[i] = a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> lo; k &lt;= hi; k++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i &gt; mid) a[k] = aux[j++]</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(j &gt; hi) a[k] = aux[i++];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(less(a[i], a[j])) a[k] = aux[i++];</span><br><span class="line">        <span class="keyword">else</span> a[k] = a[j++];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå°±å¯ä»¥ä½¿ç”¨åˆ†æ²»ç®—æ³•é€’å½’è¿›è¡Œè®¡ç®—ã€‚Javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeSort</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Comparable[] aux;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a)</span>&#123;</span><br><span class="line">        aux = <span class="keyword">new</span> <span class="title class_">Comaparable</span>[a.length]; </span><br><span class="line">        sort(a, <span class="number">0</span>, hi / <span class="number">2</span>, hi);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lo &gt; hi) <span class="keyword">return</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">        sort(a, lo, mid);</span><br><span class="line">        sort(a, mid+<span class="number">1</span>, hi);</span><br><span class="line">        merge(a, lo, mid, hi);</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> mid, <span class="type">int</span> hi)</span>&#123;</span><br><span class="line">        <span class="comment">// æ•°ç»„aux[]ä¸ºåŸæ•°ç»„çš„å¤åˆ¶</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo, j = mid+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> lo; k &lt;= hi; k++)&#123;</span><br><span class="line">            aux[k] = a[k];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> lo; k &lt;= hi; k++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i &gt; mid) a[k] = aux[j++]</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(j &gt; hi) a[k] = aux[i++];</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(less(a[i], a[j])) a[k] = aux[i++];</span><br><span class="line">            <span class="keyword">else</span> a[k] = a[j++];</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å¿«é€Ÿæ’åº-quick-sort">å¿«é€Ÿæ’åº (Quick sort)</span></h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QuickSort</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(Comparable[] a)</span> &#123;</span><br><span class="line">        quickSort(a, <span class="number">0</span>, a.length-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (lo &lt; hi) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">partitionIndex</span> <span class="operator">=</span> partition(a, lo, hi);</span><br><span class="line">            quickSort(a, lo, partitionIndex-<span class="number">1</span>);</span><br><span class="line">            quickSort(a, hi, partitionIndex+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(Comparable[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> a[i];</span><br><span class="line">        a[i] = a[j];</span><br><span class="line">        a[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸åŒç‰ˆæœ¬çš„partitionï¼šä¸»è¦æ€æƒ³éƒ½æ˜¯ä¸€è‡´çš„ï¼Œå°†æ¯”pivotå°çš„æ”¾åœ¨å·¦è¾¹ï¼Œæ¯”ä»–å¤§çš„æ”¾åœ¨pivotçš„å³è¾¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ç®—æ³•ç¬¬å››ç‰ˆ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(Comparable[] a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> lo, j = hi + <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> lo;</span><br><span class="line">    <span class="comment">// Scan right, scan left, check for scan complete, and exchange</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">while</span> (a[++i] &lt; a[pivot]) <span class="keyword">if</span> (i == hi) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">while</span> (a[pivot] &lt; a[--j]) <span class="keyword">if</span> (j == lo) <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">if</span> (i &gt;= j) <span class="keyword">break</span>;</span><br><span class="line">        swap(a, i, j);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(a, lo, j);</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* èœé¸Ÿæ•™ç¨‹ */</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(Comaparable[] a, <span class="type">int</span> lo, <span class="type">int</span> hi)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> lo;</span><br><span class="line">    <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> pivot + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt;= hi; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (arr[i] &lt; arr[pivot]) &#123;</span><br><span class="line">            swap(arr, i, index);</span><br><span class="line">            index++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    swap(arr, pivot, index - <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> index - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Java </tag>
            
            <tag> æ’åº </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>539. ç§»åŠ¨é›¶</title>
      <link href="/2021/07/26/leetcode/539-yi-dong-ling/"/>
      <url>/2021/07/26/leetcode/539-yi-dong-ling/</url>
      
        <content type="html"><![CDATA[<p>ç»™ä¸€ä¸ªæ•°ç»„ <em>nums</em> å†™ä¸€ä¸ªå‡½æ•°å°† <code>0</code>ç§»åŠ¨åˆ°æ•°ç»„çš„æœ€åé¢ï¼Œéé›¶å…ƒç´ ä¿æŒåŸæ•°ç»„çš„é¡ºåº</p><h3><span id="æ ·ä¾‹">æ ·ä¾‹</span></h3><p>ä¾‹1:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [0, 1, 0, 3, 12],</span><br><span class="line">è¾“å‡º: [1, 3, 12, 0, 0].</span><br></pre></td></tr></table></figure><span id="more"></span><p>ä¾‹2:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">è¾“å…¥: nums = [0, 0, 0, 3, 1],</span><br><span class="line">è¾“å‡º: [3, 1, 0, 0, 0].</span><br></pre></td></tr></table></figure><h3><span id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</span></h3><p>1.å¿…é¡»åœ¨åŸæ•°ç»„ä¸Šæ“ä½œ 2.æœ€å°åŒ–æ“ä½œæ•°</p><h3><span id="è§£æ³•">è§£æ³•</span></h3><p>ç®—æ³•ï¼šåŒæŒ‡é’ˆï¼Œç®€å•ç²—æš´ã€‚ç”¨ä¸¤ä¸ªæŒ‡é’ˆ <code>right</code>å’Œ<code>left</code>ï¼Œ<code>right</code>ç”¨æ¥å³ç§»æ•°ç»„ï¼Œç¢°åˆ°ä¸ä¸º0çš„å…ƒç´ å°±èµ‹å€¼åˆ° <code>left</code>æŒ‡é’ˆå¤„ã€‚æ—¶é—´å¤æ‚åº¦ï¼š<span class="math inline">\(O(N)\)</span></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// java solution</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">while</span> (right &lt; length)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[right] != <span class="number">0</span>)&#123;</span><br><span class="line">                nums[left] = nums[right];</span><br><span class="line">                left += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            right += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left; i &lt; length; i++) &#123;</span><br><span class="line">            nums[i] = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> Java </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç®—æ³•ï¼šå›æº¯æ³•å­¦ä¹ è®°å½•</title>
      <link href="/2021/07/26/algorithms/suan-fa-hui-su-fa-xue-xi-ji-lu/"/>
      <url>/2021/07/26/algorithms/suan-fa-hui-su-fa-xue-xi-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>å›æº¯æ³•æ˜¯ä¸€ç§éå¸¸å¸¸è§çš„ç®—æ³•ï¼Œå…«çš‡åé—®é¢˜å’Œè¿·å®«é—®é¢˜éƒ½å¯ä»¥ä½¿ç”¨å›æº¯æ³•è¿›è¡Œæ±‚è§£ã€‚ä»¥ä¸‹æ˜¯ç™¾åº¦ç™¾ç§‘ä¸­å¯¹äºå›æº¯æ³•çš„è§£é‡Š</p><blockquote><p>å›æº¯æ³•ï¼ˆæ¢ç´¢ä¸å›æº¯æ³•ï¼‰æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼Œåˆç§°ä¸ºè¯•æ¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©ï¼Œè¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯<a href="https://baike.baidu.com/item/æ¡ä»¶/1783021">æ¡ä»¶</a>çš„æŸä¸ª<a href="https://baike.baidu.com/item/çŠ¶æ€/33204">çŠ¶æ€</a>çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚â€”â€”ç™¾åº¦ç™¾ç§‘</p></blockquote><p>å›æº¯æ³•é‡‡ç”¨ä¸€ç§è¯•æ¢å›æº¯çš„æ€æƒ³ã€‚æˆ‘ä»¬ä»ä¸€ä¸ªä¸€ä¸ªåˆ†æ”¯é€æ­¥æ·±å…¥ï¼Œä¸€æ—¦å‘ç°å½“å‰åˆ†æ”¯ä¸æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„ï¼Œå°±æ’é™¤å½“å‰åˆ†æ”¯ï¼Œç„¶åå›åˆ°ä¸Šä¸€æ­¥è¯•æ¢å…¶ä»–åˆ†æ”¯ã€‚è¿·å®«é—®é¢˜å°±æ˜¯ä¸€ç§å¸¸è§çš„ä½¿ç”¨å›æº¯æ³•çš„ç®—æ³•é—®é¢˜ã€‚äº‹å®ä¸Šï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­èµ°è¿·å®«æˆ‘ä»¬ä¹Ÿç»å¸¸ä½¿ç”¨è¿™ç§è¯•æ¢çš„èµ°æ³•ã€‚</p><p>é™¤äº†è¿·å®«é—®é¢˜ï¼Œå…¨æ’åˆ—é—®é¢˜ï¼Œå…«çš‡åé—®é¢˜ä¹Ÿéƒ½æ˜¯å›æº¯æ³•çš„å…¸å‹é—®é¢˜</p><p><span id="more"></span></p><h3><span id="å…«çš‡åé—®é¢˜">å…«çš‡åé—®é¢˜</span></h3><blockquote><p>é—®é¢˜è¡¨è¿°ä¸ºï¼šåœ¨8Ã—8æ ¼çš„<a href="https://baike.baidu.com/item/å›½é™…è±¡æ£‹/80888">å›½é™…è±¡æ£‹</a>ä¸Šæ‘†æ”¾8ä¸ª<a href="https://baike.baidu.com/item/çš‡å/15860305">çš‡å</a>ï¼Œä½¿å…¶ä¸èƒ½äº’ç›¸æ”»å‡»ï¼Œå³ä»»æ„ä¸¤ä¸ªçš‡åéƒ½ä¸èƒ½å¤„äºåŒä¸€è¡Œã€åŒä¸€åˆ—æˆ–åŒä¸€æ–œçº¿ä¸Šï¼Œé—®æœ‰å¤šå°‘ç§æ‘†æ³•ã€‚</p></blockquote><p>å¯¹äºå…«çš‡åé—®é¢˜ï¼Œæˆ‘ä»¬é‡‡ç”¨é€è¡Œè¯•æ¢çš„æ–¹æ³•ã€‚å…ˆåœ¨å½“å‰è¡Œæ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ä½ç½®æ”¾ç½®çš‡åï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å›æº¯ä¸€è¡Œæ’é™¤å½“å‰ä½ç½®ç»§ç»­å¯»æ‰¾ï¼Œç›´åˆ°åœ¨æœ€åä¸€è¡Œæ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ä½ç½®ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè§£ã€‚</p><p>ä¸€ä¸‹æ˜¯å››çš‡åé—®é¢˜çš„ä¸€ä¸ªè§£çš„å¯»æ‰¾è¿‡ç¨‹ã€‚é¦–å…ˆåœ¨(0,0)å¤„æ”¾ç½®çš‡åï¼Œè½¬ç§»åˆ°è¡Œ1ï¼ŒæŸ¥æ‰¾åˆ°ç¬¬ä¸€ä¸ªåˆæ³•çš„ä½ç½®ä¸º(1,3)ã€‚</p><p><img src="https://i.loli.net/2021/07/26/W3ZKphw9uAESN8V.png"></p><p>æ¥ç€æœå¯»è¡Œ2ï¼Œå‘ç°æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„ä½ç½®ï¼Œäºæ˜¯å›æº¯åˆ°è¡Œ1ï¼Œç»§ç»­å¯»æ‰¾ä¸‹ä¸€ä¸ªåˆæ³•çš„ä½ç½®(1,4)ã€‚</p><p><img src="https://i.loli.net/2021/07/26/W3ZKphw9uAESN8V.png"></p><p>ç»§ç»­è¯•æ¢åˆ°è¡Œ2ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªåˆæ³•çš„ä½ç½®(2,1)ã€‚</p><p><img src="https://i.loli.net/2021/07/26/W3ZKphw9uAESN8V.png"></p><p>å‘ç°åœ¨è¿™ç§æƒ…å†µä¸‹è¡Œ3æ²¡æœ‰åˆæ³•çš„ä½ç½®ï¼Œå›æº¯åˆ°è¡Œ2ï¼Œå‘ç°è¡Œ2å‰©ä½™çš„ä½ç½®ä¹Ÿæ²¡æœ‰åˆæ³•çš„ï¼Œå›æº¯åˆ°è¡Œ1ï¼Œè¡Œ1å·²ç»æ²¡æœ‰å‰©ä½™ä½ç½®ï¼Œç›´æ¥å›æº¯åˆ°ç¬¬0è¡Œã€‚</p><p><img src="https://i.loli.net/2021/07/26/W3ZKphw9uAESN8V.png"></p><p>æ¥ç€è¯•æ¢ï¼Œèµ·å§‹ä½ç½®ä¸º(0,1)ã€‚ç¬¬1è¡Œè¯•æ¢ï¼Œçš‡åæ”¾åœ¨(1,3)</p><p><img src="https://i.loli.net/2021/07/26/W3ZKphw9uAESN8V.png"></p><p>ç¬¬2è¡Œï¼Œçš‡åæ”¾åœ¨(2,0)ã€‚ç¬¬3è¡Œï¼Œçš‡åæ”¾åœ¨(3,2)ã€‚å››çš‡åé—®é¢˜çš„ç¬¬ä¸€ä¸ªè§£æ‰¾åˆ°ã€‚</p><p><img src="https://i.loli.net/2021/07/26/W3ZKphw9uAESN8V.png"></p><p>ä»£ç å®ç°ä¸­ç‰¹åˆ«éœ€è¦å…³æ³¨çš„é—®é¢˜æ˜¯å¾ªç¯ä½•æ—¶ç»ˆæ­¢ï¼Œä»¥åŠå¯¹äºè¾¹ç•Œçš„å¤„ç†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> QUEENS 4</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> EMPTY 0</span></span><br><span class="line"><span class="meta"># <span class="keyword">define</span> FULL 1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> checkboard[QUEENS][QUEENS] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"><span class="type">int</span> boardrow[QUEENS] = &#123; <span class="number">0</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åªéœ€è¦åˆ¤æ–­å½“å‰è¡Œä¸ä¹‹å‰å‡ è¡Œæ˜¯å¦å†²çª</span></span><br><span class="line"><span class="comment">// assertï¼š 0&lt;=x&lt;QUEENS &amp;&amp; 0&lt;=y&lt;QUEENS</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">collide</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">    <span class="type">int</span> i = x - <span class="number">1</span>, j = y - <span class="number">1</span>, k = y + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; (j &gt;= <span class="number">0</span> || k &lt; QUEENS)) &#123;</span><br><span class="line">        <span class="keyword">if</span> (checkboard[i][y] == FULL)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (j &gt;= <span class="number">0</span> &amp;&amp; checkboard[i][j--] == FULL)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (k &lt; QUEENS &amp;&amp; checkboard[i][k++] == FULL)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        i--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">drawBoard</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;---------------\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; QUEENS; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; QUEENS; j++) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d | &quot;</span>, checkboard[i][j]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n---------------\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨æ„è¾¹ç•ŒçŠ¶æ€</span></span><br><span class="line"><span class="comment">// æ³¨æ„å¾ªç¯ç»“æŸåˆ¤æ–­</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">Queen</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> x = <span class="number">0</span>, y = <span class="number">0</span>; <span class="comment">// æ£‹ç›˜åæ ‡</span></span><br><span class="line">    <span class="type">int</span> numOfSol = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (x &gt;= <span class="number">0</span> || y &lt; QUEENS) &#123;</span><br><span class="line">        <span class="comment">/* ä½•æ—¶å›æº¯</span></span><br><span class="line"><span class="comment">         * 1. å½“å‰è¡Œæ•°è¾¾åˆ°æœ€å¤§ï¼ˆå¾—åˆ°ä¸€ä¸ªè§£ï¼‰</span></span><br><span class="line"><span class="comment">         * 2. åˆ—æ•°è¾¾åˆ°æœ€å¤§ï¼ˆå½“å‰æƒ…å†µè§£å·²ç»åˆ—ä¸¾å®Œæ¯•ï¼‰</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">if</span> (x &gt;= QUEENS) &#123;</span><br><span class="line">            numOfSol++;</span><br><span class="line">            x--;</span><br><span class="line">            drawBoard();</span><br><span class="line">            y = boardrow[x];</span><br><span class="line">            checkboard[x][y++] = EMPTY;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (y &gt;= QUEENS) &#123;</span><br><span class="line">            x--;</span><br><span class="line">            <span class="keyword">if</span> (x &lt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">            y = boardrow[x];</span><br><span class="line">            checkboard[x][y++] = EMPTY;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (collide(x, y)) &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœå†²çªï¼Œç§»åŠ¨è‡³å½“å‰è¡Œä¸‹ä¸€åˆ—</span></span><br><span class="line">            y++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// å¦‚æœä¸å†²çªï¼Œå¹¶ä¸”åœ¨èŒƒå›´å†…</span></span><br><span class="line">            <span class="comment">// é‚£ä¹ˆç§»åŠ¨è‡³ä¸‹ä¸€è¡Œé¦–åˆ—</span></span><br><span class="line">            checkboard[x][y] = FULL;</span><br><span class="line">            boardrow[x++] = y;</span><br><span class="line">            y = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> numOfSol;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> c = Queen();</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Number of Solution: %d&quot;</span>, c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¾ªç¯ç»“æŸçš„ç»ˆç‚¹æ¡ä»¶æ˜¯å½“å›æº¯åˆ°ç¬¬0è¡Œç¬¬4åˆ—æ—¶ï¼Œå°±ä¼šç»§ç»­å›æº¯åˆ°ç¬¬-1è¡Œï¼Œä¹Ÿå°±æ˜¯x&lt;0æ—¶ç»“æŸæ•´ä¸ªå¾ªç¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯æ³• </tag>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android studioä¸­logçš„å†…å®¹ä¸å®Œæ•´ï¼ˆlogè¢«æˆªæ–­ï¼‰</title>
      <link href="/2021/07/26/android/android-studio-zhong-log-de-nei-rong-bu-wan-zheng/"/>
      <url>/2021/07/26/android/android-studio-zhong-log-de-nei-rong-bu-wan-zheng/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨è°ƒè¯•Androidç¨‹åºçš„æ—¶å€™ï¼Œæƒ³è¦logä¸€æ®µjsonæ•°æ®ï¼Œæ•°æ®æŒºå¤§çš„ï¼ŒæŠ˜è…¾äº†åŠå¤©ï¼ŒåŸæ¥ä»¥ä¸ºæ˜¯JSONçš„é•¿åº¦ä¼šä¸ä¼šæ˜¯æœ‰ä¸Šé™çš„ï¼Œç»è¿‡æœç´¢å‘ç°å¹¶æ²¡æœ‰ï¼Œå‚è€ƒStackOverflowçš„ä¸¤ä¸ªé—®é¢˜<a href="https://stackoverflow.com/questions/57340897/what-is-limit-of-json-array-and-how-to-overcome-it">android- What is limit of json array and how to overcome it - StackOverflow</a>å’Œ<a href="https://stackoverflow.com/questions/1262376/is-there-a-limit-on-how-much-json-can-hold">Isthere a limit on how much JSON can hold? - StackOverflow</a>ã€‚æ­¤å¤–ï¼Œè¿˜è¯•å›¾ç ”ç©¶Javaä¸­Stringçš„é•¿åº¦ä¸Šé™ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://blog.csdn.net/cyw1900/article/details/48179911">javaä¸­Stringç±»å‹çš„æœ€å¤§é•¿åº¦_cyw1900çš„ä¸“æ -CSDNåšå®¢_stringç±»å‹çš„æœ€å¤§é•¿åº¦</a>ï¼Œå‘ç°Stringçš„ä¸Šé™è¿œæ¯”æˆ‘çš„æ•°æ®è¦å¤§çš„å¤šï¼Œæ€»ç»“å°±æ˜¯<mark>Stringç±»å‹çš„é•¿åº¦ä¸º320339960ï¼Œå…¶æœ€å¤§å®¹é‡ä¸è¶…è¿‡1ä¸ªG</mark>ã€‚</p><p>åæ¥å‘ç°æ˜¯Androidstudioçš„logçš„å­—ç¬¦ä¸²é•¿åº¦æ˜¯æœ‰ä¸Šé™çš„ï¼Œlogcatåœ¨å®ç°ä¸Šå¯¹äºmessageçš„å†…å­˜åˆ†é…å¤§æ¦‚æ˜¯4kå·¦å³ï¼Œå®é™…ä¸Šæ ¹æ®æˆ‘çš„ä¸ªäººçš„logæ¥çœ‹ï¼Œæˆªå–çš„éƒ¨åˆ†å¤§çº¦æ˜¯4056ä¸ªå­—ç¬¦ä¸²ï¼Œè¶…è¿‡çš„éƒ¨åˆ†éƒ½ä¼šè¢«æˆªæ–­ã€‚ç»è¿‡æœç´¢ï¼Œå‘ç°ç½‘ä¸Šä¸€ä¸ªåšä¸»è‡ªå·±å®šä¹‰ä¸€ä¸ªdebugå·¥å…·ç±»åˆ‡åˆ†è¶…è¿‡4kçš„messageï¼Œæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><span id="more"></span><p>å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DebugUtils</span> &#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨Logæ¥æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯,å› ä¸ºlogåœ¨å®ç°ä¸Šæ¯ä¸ªmessageæœ‰4kå­—ç¬¦é•¿åº¦é™åˆ¶</span></span><br><span class="line"><span class="comment">// æ‰€ä»¥è¿™é‡Œä½¿ç”¨è‡ªå·±åˆ†èŠ‚çš„æ–¹å¼æ¥è¾“å‡ºè¶³å¤Ÿé•¿åº¦çš„message</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(String str)</span> &#123;</span><br><span class="line">        str = str.trim();</span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxLength</span> <span class="operator">=</span> <span class="number">4000</span>;</span><br><span class="line">        String sub;</span><br><span class="line">        <span class="keyword">while</span> (index &lt; str.length()) &#123;</span><br><span class="line">            <span class="comment">// javaçš„å­—ç¬¦ä¸å…è®¸æŒ‡å®šè¶…è¿‡æ€»çš„é•¿åº¦end</span></span><br><span class="line">            <span class="keyword">if</span> (str.length() &lt;= index + maxLength) &#123;</span><br><span class="line">                sub = str.substring(index);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                sub = str.substring(index, maxLength);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            index += maxLength;</span><br><span class="line">            Log.i(<span class="string">&quot;qidizi_debug&quot;</span>, sub.trim());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æœ¬æ–‡å‚è€ƒæ–‡ç« ï¼š<a href="https://blog.csdn.net/qidizi/article/details/47291803">androidçš„logcatçš„messageæœ‰å­—ç¬¦é•¿åº¦çš„é™åˆ¶,è¶…è¿‡å°†ç›´æ¥æˆªæ–­</a>ï¼Œä»…ä½œä¸ºä¸ªäººç¬”è®°è®°å½•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
            <tag> Bug </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux ä½¿ç”¨è¿‡çš„å‘½ä»¤è®°å½•(ubuntu)</title>
      <link href="/2021/07/24/backend/linux-ming-ling-ji-lu/"/>
      <url>/2021/07/24/backend/linux-ming-ling-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ–‡è®°å½•ä¸€ä¸‹ä½¿ç”¨è¿‡æœç´¢è¿‡çš„Linuxçš„ä¸€äº›å‘½ä»¤ï¼Œä½œä¸ºä¸€ä¸ªLinuxæ–°æ‰‹ï¼Œå¾ˆå¤šå‘½ä»¤ç”¨äº†å°±å¿˜ï¼Œè¿˜æ˜¯ç¨å¾®è®°å½•ä¸€ä¸‹æ¯”è¾ƒå¥½ï¼Œå•çº¯çš„åšä¸ªç¬”è®°ã€‚</p><p><span id="more"></span></p><h2><span id="ç½‘ç»œ">ç½‘ç»œ</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæ‰€æœ‰ç½‘ç»œæ¥å£å’Œç›¸å…³IPåœ°å€çš„åˆ—è¡¨</span></span><br><span class="line">ip addr</span><br><span class="line"><span class="comment"># æ˜¾ç¤ºå†…éƒ¨IPåœ°å€</span></span><br><span class="line">hostname -I</span><br><span class="line">ifconfig</span><br><span class="line"><span class="comment"># æ£€æµ‹ç›‘å¬ç«¯å£22</span></span><br><span class="line"><span class="built_in">sudo</span> lsof -i:22</span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¿›ç¨‹</span></span><br><span class="line">ps -A | grep è¿›ç¨‹åç§°</span><br><span class="line">ps -A <span class="comment"># æŸ¥çœ‹æ‰€æœ‰</span></span><br><span class="line">ps -ef <span class="comment"># æ›´è¯¦å°½çš„ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># ç»“æŸè¿›ç¨‹</span></span><br><span class="line"><span class="built_in">kill</span> [ä¿¡å·ä»£ç ] è¿›ç¨‹PID <span class="comment"># kill -9 PID</span></span><br></pre></td></tr></table></figure><h2><span id="æ–‡ä»¶ç®¡ç†">æ–‡ä»¶ç®¡ç†</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ˜¾ç¤ºæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">ls</span> -t(æ—¶é—´é¡ºåº) -a(æ‰€æœ‰æ–‡ä»¶) </span><br><span class="line"><span class="comment"># è¿”å›å†å²ä¸Šä¸€çº§ç›®å½•</span></span><br><span class="line"><span class="built_in">cd</span> -</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$OLDPWD</span></span><br><span class="line"><span class="comment"># ç§»åŠ¨æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mv</span> [options] æºæ–‡ä»¶æˆ–ç›®å½• ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•</span><br><span class="line"><span class="comment"># é‡å‘½åæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">mv</span> abc 1234 é‡å‘½åæ–‡ä»¶åä¸º1234</span><br><span class="line"><span class="comment"># æ–°å»ºæ–‡ä»¶</span></span><br><span class="line"><span class="built_in">touch</span> filename OR vim newFileName</span><br></pre></td></tr></table></figure><h3><span id="æ–‡ä»¶å‹ç¼©">æ–‡ä»¶å‹ç¼©</span></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å‹ç¼©æ–‡ä»¶ file1 å’Œç›®å½• dir2 åˆ° test.tar.gz</span></span><br><span class="line">tar -zcvf test.tar.gz file1 dir2</span><br><span class="line"><span class="comment"># è§£å‹ test.tar.gzï¼ˆå°† c æ¢æˆ x å³å¯ï¼‰</span></span><br><span class="line">tar -zxvf test.tar.gz</span><br><span class="line"><span class="comment"># åˆ—å‡ºå‹ç¼©æ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">tar -ztvf test.tar.gz</span><br></pre></td></tr></table></figure><blockquote><p>z : ä½¿ç”¨ gzip æ¥å‹ç¼©å’Œè§£å‹æ–‡ä»¶ -v : --verbose è¯¦ç»†çš„åˆ—å‡ºå¤„ç†çš„æ–‡ä»¶ -f: --file=ARCHIVE ä½¿ç”¨æ¡£æ¡ˆæ–‡ä»¶æˆ–è®¾å¤‡ï¼Œè¿™ä¸ªé€‰é¡¹é€šå¸¸æ˜¯å¿…é€‰çš„ -c : --createåˆ›å»ºä¸€ä¸ªæ–°çš„å½’æ¡£ï¼ˆå‹ç¼©åŒ…ï¼‰ -x : ä»å‹ç¼©åŒ…ä¸­è§£å‡ºæ–‡ä»¶</p></blockquote><h2><span id="å¸è½½è½¯ä»¶">å¸è½½è½¯ä»¶</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å·²ç»å®‰è£…çš„è½¯ä»¶</span></span><br><span class="line">dpkg --list</span><br><span class="line"><span class="built_in">sudo</span> apt-get remove â€“-purge è¦å¸è½½çš„è½¯ä»¶çš„åå­— <span class="comment">#å¸è½½è½¯ä»¶åŒæ—¶åˆ é™¤é…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get remove è¦å¸è½½çš„è½¯ä»¶çš„åå­—  <span class="comment">#å¸è½½è¯¥è½¯ä»¶</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get clean <span class="comment"># aptç¼“å­˜åˆ é™¤</span></span><br></pre></td></tr></table></figure><h2><span id="æ—¶åŒº">æ—¶åŒº</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timedatectl status # æŸ¥çœ‹å½“å‰æ—¶é—´çŠ¶æ€</span><br><span class="line">timedatectl set-timezone &quot;Asia/Shanghai&quot; # ä¿®æ”¹æ—¶åŒºä¸ºä¸Šæµ·æ—¶é—´</span><br></pre></td></tr></table></figure><h2><span id="tmux">Tmux</span></h2><p>Tmuxæ˜¯ä¸€ä¸ªéå¸¸æ–¹ä¾¿çš„sessionç®¡ç†ä»¥åŠsessionå·¥å…·, æ•™ç¨‹å‚è§<a href="https://www.ruanyifeng.com/blog/2019/10/tmux.html">Tmuxä½¿ç”¨æ•™ç¨‹ï¼ˆé˜®ä¸€å³°ï¼‰</a></p><figure><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/tmux-help.png" alt="Tmuxå¿«æ·é”®æŒ‡å—"><figcaption aria-hidden="true">Tmuxå¿«æ·é”®æŒ‡å—</figcaption></figure>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ†</title>
      <link href="/2021/07/24/backend/zheng-xiang-dai-li-he-fan-xiang-dai-li-de-qu-fen/"/>
      <url>/2021/07/24/backend/zheng-xiang-dai-li-he-fan-xiang-dai-li-de-qu-fen/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«çº ç»“äº†å¥½ä¹…ï¼Œæ€»æ˜¯æ„Ÿè§‰æœ‰ç‚¹ç›¸ä¼¼ï¼Œåˆæœ‰äº›å¾®å¦™çš„å·®åˆ«ï¼Œä½†æ˜¯åˆè¯´ä¸ä¸Šåˆ°åº•å¦‚ä½•ç†è§£ï¼Œç»ˆäºæ‰¾åˆ°äº†ä¸€ç¯‡è®²å¾—æ¯”è¾ƒæ¸…æ™°å¥½ç†è§£çš„åšæ–‡ï¼Œé€‚åˆæˆ‘è¿™ç§æ–°æ‰‹å°ç™½ï¼Œè®°å½•ä¸€ä¸‹ï¼ŒåŸæ–‡åŸè½½äº<a href="https://cloud.tencent.com/developer/article/1418457">ç»ˆäºæœ‰äººæŠŠæ­£å‘ä»£ç†å’Œåå‘ä»£ç†è§£é‡Šçš„æ˜æ˜ç™½ç™½äº†ï¼- äº‘+ç¤¾åŒº - è…¾è®¯äº‘(tencent.com)</a>ï¼ŒåŸæ–‡å›¾æ–‡å¹¶èŒ‚ï¼Œç”ŸåŠ¨å½¢è±¡ï¼Œæœ¬æ–‡ç”±äºç‰ˆæƒåŸå› ï¼Œæ²¡æœ‰äº†å›¾ç‰‡ï¼Œæƒå½“ä¸ªäººç¬”è®°ï¼Œå¦‚æœ‰å…´è¶£ï¼Œå¯ä»¥ç›´æ¥å»çœ‹ä¸€çœ‹åŸæ–‡ã€‚</p><span id="more"></span><p><strong>æ­£å‘ä»£ç†</strong></p><p>æ­£å‘ä»£ç†ï¼ˆforwardproxyï¼‰ï¼šæ˜¯ä¸€ä¸ªä½äºå®¢æˆ·ç«¯å’Œç›®æ ‡æœåŠ¡å™¨ä¹‹é—´çš„æœåŠ¡å™¨(ä»£ç†æœåŠ¡å™¨)ï¼Œä¸ºäº†ä»ç›®æ ‡æœåŠ¡å™¨å–å¾—å†…å®¹ï¼Œå®¢æˆ·ç«¯å‘ä»£ç†æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚å¹¶æŒ‡å®šç›®æ ‡ï¼Œç„¶åä»£ç†æœåŠ¡å™¨å‘ç›®æ ‡æœåŠ¡å™¨è½¬äº¤è¯·æ±‚å¹¶å°†è·å¾—çš„å†…å®¹è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p><p>è¿™ç§ä»£ç†å…¶å®åœ¨ç”Ÿæ´»ä¸­æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œæ¯”å¦‚è®¿é—®å¤–å›½ç½‘ç«™æŠ€æœ¯ï¼Œå…¶ç”¨åˆ°çš„å°±æ˜¯ä»£ç†æŠ€æœ¯ã€‚</p><p>æœ‰æ—¶å€™ï¼Œç”¨æˆ·æƒ³è¦è®¿é—®æŸå›½å¤–ç½‘ç«™ï¼Œè¯¥ç½‘ç«™æ— æ³•åœ¨å›½å†…ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°ä¸€ä¸ªä»£ç†æœåŠ¡å™¨ï¼Œè¿™ä¸ªä»£ç†æœåŠ¡å™¨å¯ä»¥è®¿é—®åˆ°è¿™ä¸ªå›½å¤–ç½‘ç«™ã€‚è¿™æ ·å‘¢ï¼Œç”¨æˆ·å¯¹è¯¥å›½å¤–ç½‘ç«™çš„è®¿é—®å°±éœ€è¦é€šè¿‡ä»£ç†æœåŠ¡å™¨æ¥è½¬å‘è¯·æ±‚ï¼Œå¹¶ä¸”è¯¥ä»£ç†æœåŠ¡å™¨ä¹Ÿä¼šå°†è¯·æ±‚çš„å“åº”å†è¿”å›ç»™ç”¨æˆ·ã€‚è¿™ä¸ªä¸Šç½‘çš„è¿‡ç¨‹å°±æ˜¯ç”¨åˆ°äº†æ­£å‘ä»£ç†ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å…¶å®å’Œç§Ÿæˆ¿å­å¾ˆåƒã€‚</p><p>ç§Ÿæˆ¿å­çš„æ—¶å€™ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¾ˆéš¾è”ç³»åˆ°æˆ¿ä¸œï¼Œå› ä¸ºæœ‰äº›æˆ¿ä¸œä¸ºäº†å›¾æ–¹ä¾¿ï¼ŒåªæŠŠè‡ªå·±çš„æˆ¿å±‹ä¿¡æ¯å’Œé’¥åŒ™äº¤ç»™ä¸­ä»‹äº†ã€‚è€Œæˆ¿å®¢æƒ³è¦ç§Ÿæˆ¿å­ï¼Œåªèƒ½é€šè¿‡ä¸­ä»‹æ‰èƒ½è”ç³»åˆ°æˆ¿ä¸œã€‚è€Œå¯¹äºæˆ¿ä¸œæ¥è¯´ï¼Œä»–å¯èƒ½æ ¹æœ¬ä¸çŸ¥é“çœŸæ­£è¦ç§Ÿä»–çš„æˆ¿å­çš„äººæ˜¯è°ï¼Œä»–åªçŸ¥é“æ˜¯ä¸­ä»‹åœ¨è”ç³»ä»–ã€‚</p><p>è¿™é‡Œé¢ä¸€å…±æœ‰ä¸‰ä¸ªè§’è‰²ï¼Œç§Ÿå®¢ï¼ˆç”¨æˆ·ï¼‰ã€ä¸­ä»‹ï¼ˆä»£ç†æœåŠ¡å™¨ï¼‰å’Œæˆ¿ä¸œï¼ˆå›½å¤–ç½‘ç«™ï¼Œç›®æ ‡æœåŠ¡å™¨ï¼‰ã€‚å¼•å…¥ä¸­ä»‹ï¼ˆä»£ç†æœåŠ¡å™¨ï¼‰çš„åŸå› æ˜¯ç”¨æˆ·æ— æ³•è”ç³»ä¸Šæˆ¿ä¸œï¼ˆç”¨æˆ·æ— æ³•è®¿é—®å›½å¤–ç½‘ç«™ï¼‰ã€‚</p><p><strong>æ‰€ä»¥ï¼Œæ­£å‘ä»£ç†ï¼Œå…¶å®æ˜¯"ä»£ç†æœåŠ¡å™¨"ä»£ç†äº†"å®¢æˆ·ç«¯"ï¼Œå»å’Œ"ç›®æ ‡æœåŠ¡å™¨"è¿›è¡Œäº¤äº’ã€‚</strong></p><p>é€šè¿‡æ­£å‘ä»£ç†æœåŠ¡å™¨è®¿é—®ç›®æ ‡æœåŠ¡å™¨ï¼Œç›®æ ‡æœåŠ¡å™¨æ˜¯ä¸çŸ¥é“çœŸæ­£çš„å®¢æˆ·ç«¯æ˜¯è°çš„ï¼Œç”šè‡³ä¸çŸ¥é“è®¿é—®è‡ªå·±çš„æ˜¯ä¸€ä¸ªä»£ç†ï¼ˆæœ‰æ—¶å€™ä¸­ä»‹ä¹Ÿç›´æ¥å†’å……ç§Ÿå®¢ï¼‰ã€‚</p><h3><span id="æ­£å‘ä»£ç†çš„ç”¨é€”"><strong>æ­£å‘ä»£ç†çš„ç”¨é€”</strong></span></h3><p><strong>çªç ´è®¿é—®é™åˆ¶</strong></p><p>é€šè¿‡ä»£ç†æœåŠ¡å™¨ï¼Œå¯ä»¥çªç ´è‡ªèº«IPè®¿é—®é™åˆ¶ï¼Œè®¿é—®å›½å¤–ç½‘ç«™ï¼Œæ•™è‚²ç½‘ç­‰ã€‚</p><p>å³ï¼Œç§Ÿå®¢å¯ä»¥é€šè¿‡ä¸­ä»‹ï¼Œæ¥è§£å†³æ— æ³•è”ç³»ä¸Šæˆ¿ä¸œçš„é—®é¢˜ã€‚</p><p><strong>æé«˜è®¿é—®é€Ÿåº¦</strong></p><p>é€šå¸¸ä»£ç†æœåŠ¡å™¨éƒ½è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„ç¡¬ç›˜ç¼“å†²åŒºï¼Œä¼šå°†éƒ¨åˆ†è¯·æ±‚çš„å“åº”ä¿å­˜åˆ°ç¼“å†²åŒºä¸­ï¼Œå½“å…¶ä»–ç”¨æˆ·å†è®¿é—®ç›¸åŒçš„ä¿¡æ¯æ—¶ï¼Œåˆ™ç›´æ¥ç”±ç¼“å†²åŒºä¸­å–å‡ºä¿¡æ¯ï¼Œä¼ ç»™ç”¨æˆ·ï¼Œä»¥æé«˜è®¿é—®é€Ÿåº¦ã€‚</p><p>å³ï¼Œä¸­ä»‹æ‰‹é‡Œç•™å­˜äº†å¾ˆå¤šæˆ¿æºä¿¡æ¯å’Œé’¥åŒ™ï¼Œå¯ä»¥ç›´æ¥å¸¦ç§Ÿå®¢å»çœ‹æˆ¿ã€‚</p><p><strong>éšè—å®¢æˆ·ç«¯çœŸå®IP</strong></p><p>ä¸Šç½‘è€…ä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•éšè—è‡ªå·±çš„IPï¼Œå…å—æ”»å‡»ã€‚</p><p>å³ï¼Œæˆ¿ä¸œå¹¶ä¸çŸ¥é“ç§Ÿå®¢çš„çœŸå®èº«ä»½ã€‚PSï¼šä½†æ˜¯ä¸­ä»‹çŸ¥é“äº†ï¼Œå¯èƒ½éªšæ‰°æ›´å¤šâ€¦.</p><h3><span id="åå‘ä»£ç†"><strong>åå‘ä»£ç†</strong></span></h3><p>åå‘ä»£ç†ï¼ˆreverseproxyï¼‰ï¼šæ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><p>æˆ‘ä»¬åœ¨ç§Ÿæˆ¿å­çš„è¿‡ç¨‹ä¸­ï¼Œé™¤äº†æœ‰äº›æˆ¿æºéœ€è¦é€šè¿‡ä¸­ä»‹ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯å¯ä»¥ç›´æ¥é€šè¿‡æˆ¿ä¸œæ¥ç§Ÿçš„ã€‚ç”¨æˆ·ç›´æ¥æ‰¾åˆ°æˆ¿ä¸œç§Ÿæˆ¿çš„è¿™ç§æƒ…å†µå°±æ˜¯æˆ‘ä»¬ä¸ä½¿ç”¨ä»£ç†ç›´æ¥è®¿é—®å›½å†…çš„ç½‘ç«™çš„æƒ…å†µã€‚</p><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œå°±æ˜¯æˆ‘ä»¬ä»¥ä¸ºæˆ‘ä»¬æ¥è§¦çš„æ˜¯æˆ¿ä¸œï¼Œå…¶å®æœ‰æ—¶å€™ä¹Ÿæœ‰å¯èƒ½å¹¶éæˆ¿ä¸»æœ¬äººï¼Œæœ‰å¯èƒ½æ˜¯ä»–çš„äº²æˆšã€æœ‹å‹ï¼Œç”šè‡³æ˜¯äºŒæˆ¿ä¸œã€‚ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“å’Œæˆ‘ä»¬æ²Ÿé€šçš„å¹¶ä¸æ˜¯çœŸæ­£çš„æˆ¿ä¸œã€‚è¿™ç§å¸®åŠ©çœŸæ­£çš„æˆ¿ä¸»ç§Ÿæˆ¿çš„äºŒæˆ¿ä¸œå…¶å®å°±æ˜¯åå‘ä»£ç†æœåŠ¡å™¨ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åå‘ä»£ç†ã€‚</p><p>å¯¹äºå¸¸ç”¨çš„åœºæ™¯ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨Webå¼€å‘ä¸­ç”¨åˆ°çš„<a href="https://cloud.tencent.com/product/clb?from=10680">è´Ÿè½½å‡è¡¡</a>æœåŠ¡å™¨ï¼ˆäºŒæˆ¿ä¸œï¼‰ï¼Œå®¢æˆ·ç«¯ï¼ˆç§Ÿå®¢ï¼‰å‘é€è¯·æ±‚åˆ°è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ˆäºŒæˆ¿ä¸œï¼‰ä¸Šï¼Œè´Ÿè½½å‡è¡¡æœåŠ¡å™¨ï¼ˆäºŒæˆ¿ä¸œï¼‰å†æŠŠè¯·æ±‚è½¬å‘ç»™ä¸€å°çœŸæ­£çš„æœåŠ¡å™¨ï¼ˆæˆ¿ä¸œï¼‰æ¥æ‰§è¡Œï¼Œå†æŠŠæ‰§è¡Œç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼ˆç§Ÿå®¢ï¼‰ã€‚</p><p><strong>æ‰€ä»¥ï¼Œåå‘ä»£ç†ï¼Œå…¶å®æ˜¯"ä»£ç†æœåŠ¡å™¨"ä»£ç†äº†"ç›®æ ‡æœåŠ¡å™¨"ï¼Œå»å’Œ"å®¢æˆ·ç«¯"è¿›è¡Œäº¤äº’ã€‚</strong></p><p>é€šè¿‡åå‘ä»£ç†æœåŠ¡å™¨è®¿é—®ç›®æ ‡æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯æ˜¯ä¸çŸ¥é“çœŸæ­£çš„ç›®æ ‡æœåŠ¡å™¨æ˜¯è°çš„ï¼Œç”šè‡³ä¸çŸ¥é“è‡ªå·±è®¿é—®çš„æ˜¯ä¸€ä¸ªä»£ç†ã€‚</p><h3><span id="åå‘ä»£ç†çš„ç”¨é€”"><strong>åå‘ä»£ç†çš„ç”¨é€”</strong></span></h3><p><strong>éšè—æœåŠ¡å™¨çœŸå®IP</strong></p><p>ä½¿ç”¨åå‘ä»£ç†ï¼Œå¯ä»¥å¯¹å®¢æˆ·ç«¯éšè—æœåŠ¡å™¨çš„IPåœ°å€ã€‚</p><p>å³ï¼Œç§Ÿå®¢å¹¶ä¸æˆ¿ä¸œçŸ¥é“çš„çœŸå®èº«ä»½ã€‚</p><p><strong>è´Ÿè½½å‡è¡¡</strong></p><p>åå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥åšè´Ÿè½½å‡è¡¡ï¼Œæ ¹æ®æ‰€æœ‰çœŸå®æœåŠ¡å™¨çš„è´Ÿè½½æƒ…å†µï¼Œå°†å®¢æˆ·ç«¯è¯·æ±‚åˆ†å‘åˆ°ä¸åŒçš„çœŸå®æœåŠ¡å™¨ä¸Šã€‚</p><p>å³ï¼ŒäºŒæˆ¿ä¸œå‘ç°æˆ¿ä¸»æœ¬äººå¾ˆå¿™ï¼Œäºæ˜¯æ‰¾åˆ°æˆ¿ä¸»çš„å¦»å­å¸®å¿™å¤„ç†ç§Ÿæˆ¿äº‹å®œã€‚</p><p><strong>æé«˜è®¿é—®é€Ÿåº¦</strong></p><p>åå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥å¯¹äºé™æ€å†…å®¹åŠçŸ­æ—¶é—´å†…æœ‰å¤§é‡è®¿é—®è¯·æ±‚çš„åŠ¨æ€å†…å®¹æä¾›ç¼“å­˜æœåŠ¡ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚</p><p>å³ï¼ŒäºŒæˆ¿ä¸œåŒæ ·æœ‰æˆ¿å±‹ä¿¡æ¯å’Œé’¥åŒ™ã€‚</p><p><strong>æä¾›å®‰å…¨ä¿éšœ</strong></p><p>åå‘ä»£ç†æœåŠ¡å™¨å¯ä»¥ä½œä¸ºåº”ç”¨å±‚é˜²ç«å¢™ï¼Œä¸ºç½‘ç«™æä¾›å¯¹åŸºäºWebçš„æ”»å‡»è¡Œä¸ºï¼ˆä¾‹å¦‚DoS/DDoSï¼‰çš„é˜²æŠ¤ï¼Œæ›´å®¹æ˜“æ’æŸ¥æ¶æ„è½¯ä»¶ç­‰ã€‚è¿˜å¯ä»¥ä¸ºåç«¯æœåŠ¡å™¨ç»Ÿä¸€æä¾›åŠ å¯†å’ŒSSLåŠ é€Ÿï¼ˆå¦‚SSLç»ˆç«¯ä»£ç†ï¼‰ï¼Œæä¾›HTTPè®¿é—®è®¤è¯ç­‰ã€‚</p><p>å³ï¼ŒäºŒæˆ¿ä¸œå¯ä»¥æœ‰æ•ˆçš„ä¿æŠ¤æˆ¿ä¸œçš„å®‰å…¨ã€‚</p><h3><span id="æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«"><strong>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„åŒºåˆ«</strong></span></h3><p>è™½ç„¶æ­£å‘ä»£ç†æœåŠ¡å™¨å’Œåå‘ä»£ç†æœåŠ¡å™¨æ‰€å¤„çš„ä½ç½®éƒ½æ˜¯å®¢æˆ·ç«¯å’ŒçœŸå®æœåŠ¡å™¨ä¹‹é—´ï¼Œæ‰€åšçš„äº‹æƒ…ä¹Ÿéƒ½æ˜¯æŠŠå®¢æˆ·ç«¯çš„è¯·æ±‚è½¬å‘ç»™æœåŠ¡å™¨ï¼Œå†æŠŠæœåŠ¡å™¨çš„å“åº”è½¬å‘ç»™å®¢æˆ·ç«¯ï¼Œä½†æ˜¯äºŒè€…ä¹‹é—´è¿˜æ˜¯æœ‰ä¸€å®šçš„å·®å¼‚çš„ã€‚</p><p>1ã€<strong>æ­£å‘ä»£ç†å…¶å®æ˜¯å®¢æˆ·ç«¯çš„ä»£ç†</strong>ï¼Œå¸®åŠ©å®¢æˆ·ç«¯è®¿é—®å…¶æ— æ³•è®¿é—®çš„æœåŠ¡å™¨èµ„æºã€‚<strong>åå‘ä»£ç†åˆ™æ˜¯æœåŠ¡å™¨çš„ä»£ç†</strong>ï¼Œå¸®åŠ©æœåŠ¡å™¨åšè´Ÿè½½å‡è¡¡ï¼Œå®‰å…¨é˜²æŠ¤ç­‰ã€‚</p><p>2ã€<strong>æ­£å‘ä»£ç†ä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯æ¶è®¾çš„</strong>ï¼Œæ¯”å¦‚åœ¨è‡ªå·±çš„æœºå™¨ä¸Šå®‰è£…ä¸€ä¸ªä»£ç†è½¯ä»¶ã€‚è€Œ<strong>åå‘ä»£ç†ä¸€èˆ¬æ˜¯æœåŠ¡å™¨æ¶è®¾çš„</strong>ï¼Œæ¯”å¦‚åœ¨è‡ªå·±çš„æœºå™¨é›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚</p><p>3ã€<strong>æ­£å‘ä»£ç†ä¸­ï¼ŒæœåŠ¡å™¨ä¸çŸ¥é“çœŸæ­£çš„å®¢æˆ·ç«¯åˆ°åº•æ˜¯è°</strong>ï¼Œä»¥ä¸ºè®¿é—®è‡ªå·±çš„å°±æ˜¯çœŸå®çš„å®¢æˆ·ç«¯ã€‚è€Œåœ¨<strong>åå‘ä»£ç†ä¸­ï¼Œå®¢æˆ·ç«¯ä¸çŸ¥é“çœŸæ­£çš„æœåŠ¡å™¨æ˜¯è°</strong>ï¼Œä»¥ä¸ºè‡ªå·±è®¿é—®çš„å°±æ˜¯çœŸå®çš„æœåŠ¡å™¨ã€‚</p><p>4ã€æ­£å‘ä»£ç†å’Œåå‘ä»£ç†çš„ä½œç”¨å’Œç›®çš„ä¸åŒã€‚<strong>æ­£å‘ä»£ç†ä¸»è¦æ˜¯ç”¨æ¥è§£å†³è®¿é—®é™åˆ¶é—®é¢˜ã€‚è€Œåå‘ä»£ç†åˆ™æ˜¯æä¾›è´Ÿè½½å‡è¡¡ã€å®‰å…¨é˜²æŠ¤ç­‰ä½œç”¨ã€‚äºŒè€…å‡èƒ½æé«˜è®¿é—®é€Ÿåº¦ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> åç«¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PostgreSQLçš„ä¸ªäººä½¿ç”¨ç¬”è®°</title>
      <link href="/2021/07/23/backend/postgresql-de-ge-ren-shi-yong-bi-ji/"/>
      <url>/2021/07/23/backend/postgresql-de-ge-ren-shi-yong-bi-ji/</url>
      
        <content type="html"><![CDATA[<p>ä½œä¸ºä¸€ä¸ªæ•°æ®åº“å°ç™½ï¼ŒPostgreSQLå±…ç„¶æ˜¯æˆ‘ç¬¬ä¸€ä¸ªä½¿ç”¨çš„æ•°æ®åº“è€Œä¸æ˜¯MySQLã€‚æœ‰çš„æ—¶å€™æœ‰äº›æ“ä½œéš¾å…å¿˜è®°ï¼Œå°±åˆè¦åˆ°ç½‘ä¸Šå»æŸ¥è¯¢ï¼Œè¿™é‡Œå°±è®°å½•ä¸€ä¸‹æˆ‘å¿˜è®°çš„é‚£äº›ä¸€äº›ç”¨åˆ°è¿‡çš„SQLè¯­å¥å§ï¼ˆè™½ç„¶æœ‰äº›å¯èƒ½æ„Ÿè§‰æŒºè ¢çš„orzã€‚</p><span id="more"></span><h2><span id="æ·»åŠ å’Œåˆ é™¤uniqueçº¦æŸ">æ·»åŠ å’Œåˆ é™¤UNIQUEçº¦æŸ</span></h2><p>æˆ‘ä»¬ç°åœ¨ä½¿ç”¨ä¸€ä¸‹è¯­å¥åˆ›å»ºäº†ä¸€å¼ è¡¨ï¼Œç”¨æ¥è®°å½•appåœ¨æŸä¸€å¤©çš„ä½¿ç”¨æƒ…å†µï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> app_usage_info (</span><br><span class="line"><span class="keyword">day</span> <span class="type">date</span>,</span><br><span class="line">app_name text,</span><br><span class="line">package_name text,</span><br><span class="line">usage_time <span class="type">interval</span>,</span><br><span class="line">usage_count <span class="type">integer</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œåˆ›å»ºå¥½ä¹‹åæˆ‘å‘ç°ï¼Œæˆ‘éœ€è¦æ’å…¥çš„æ•°æ®åœ¨ç‰¹å®šçš„ä¸€å¤©ä¸­ï¼Œä¸€ä¸ªappåªèƒ½æ’å…¥ä¸€ç»„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ UNIQUEçº¦æŸï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> app_usage_info <span class="keyword">add</span> <span class="keyword">constraint</span> unique_app_one_day <span class="keyword">unique</span>(<span class="keyword">day</span>,app_name); </span><br></pre></td></tr></table></figure><p>æƒ³è¦åˆ é™¤è¿™ä¸€ä¸ªçº¦æŸï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸‹è¯­å¥ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> app_usage_info <span class="keyword">drop</span> <span class="keyword">constraint</span> unique_app_one_day;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬åœ¨å»ºè¡¨çš„æ—¶å€™å°±æ·»åŠ çº¦æŸï¼Œé‚£ä¹ˆåº”è¯¥è¿™æ ·å†™</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> app_usage_info (</span><br><span class="line"><span class="keyword">day</span> <span class="type">date</span>,</span><br><span class="line">app_name text,</span><br><span class="line">package_name text,</span><br><span class="line">usage_time <span class="type">interval</span>,</span><br><span class="line">usage_count <span class="type">integer</span>,</span><br><span class="line">    constaint unique_app_one_day <span class="keyword">unique</span>(<span class="keyword">day</span>,app_name)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2><span id="æ›´æ–°æ“ä½œupsert">æ›´æ–°æ“ä½œUPSERT</span></h2><p>UPSERTå°±æ˜¯è¯´å½“æˆ‘ä»¬åœ¨INSERTçš„æ—¶å€™ï¼Œå‘ç°ä¸çº¦æŸå†²çªï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥å¯¹åŸæœ‰çš„æ•°æ®è¿›è¡Œæ›´æ–°è€Œä¸æ˜¯æ’å…¥ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯¹ä¸Šé¢çš„è¡¨è¿›è¡ŒUPSERTï¼Œä¸‹é¢çš„SQLè¯­å¥ä¸­excludedä¸­çš„å†…å®¹å°±æ˜¯å‘ç”Ÿå†²çªçš„æ•°æ®ï¼Œæˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ•°æ®å¯¹å…¶è¿›è¡Œæ›´æ–°å³å¯ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> app_usage_info <span class="keyword">values</span> (<span class="string">&#x27;2021-07-16&#x27;</span>,<span class="string">&#x27;QQ&#x27;</span>,<span class="string">&#x27;com.tencent.mobileqq&#x27;</span>,<span class="string">&#x27;03:22:44&#x27;</span>,<span class="string">&#x27;20&#x27;</span>)</span><br><span class="line"><span class="keyword">on</span> conflict(<span class="keyword">day</span>,app_name) do <span class="keyword">update</span> </span><br><span class="line"><span class="keyword">set</span> &quot;usage_time&quot;<span class="operator">=</span>excluded.usage_time,&quot;usage_count&quot;<span class="operator">=</span>excluded.usage_count;</span><br></pre></td></tr></table></figure><h2><span id="åˆ é™¤æŸä¸ªå­—æ®µ">åˆ é™¤æŸä¸ªå­—æ®µ</span></h2><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¡¨ï¼Œç”¨æ¥è®°å½•appçš„æ´»åŠ¨æƒ…å†µï¼Œ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> DB_usage_events (</span><br><span class="line">app_name text,</span><br><span class="line">package_name text,</span><br><span class="line">start_time timestamptz,</span><br><span class="line">end_time, timestamptz</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬åˆ›å»ºå¥½ä¹‹åå‘ç°æˆ‘ä»¬å¯ä»¥ä¸éœ€è¦app_nameè¿™ä¸ªå­—æ®µï¼Œäºæ˜¯æˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€ä¸‹å‘½ä»¤åˆ å»ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> DB_usage_events <span class="keyword">drop</span> <span class="keyword">column</span> if <span class="keyword">exists</span> app_name;</span><br></pre></td></tr></table></figure><h2><span id="è®¾ç½®postgresqlæ—¶åŒº">è®¾ç½®PostgreSQLæ—¶åŒº</span></h2><p>åœ¨PostgreSQLä¸­çš„æ—¥æœŸ/æ—¶é—´ç±»å‹æœ‰æ—¶åŒºä¹‹å·®ï¼Œåœ¨ä½¿ç”¨ä¸­å‘ç°é»˜è®¤ä½¿ç”¨çš„æ˜¯é›¶æ—¶åŒºï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ‡æ¢ä¸€ä¸‹æ—¶åŒºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="type">time</span> zone; <span class="comment">-- æ˜¾ç¤ºå½“å‰æ—¶åŒº</span></span><br><span class="line"><span class="keyword">select</span> form now(); <span class="comment">-- æ˜¾ç¤ºå½“å‰æ—¶é—´</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> pg_timezone_names; <span class="comment">-- æŸ¥çœ‹æ”¯æŒçš„æ—¶åŒºåˆ—è¡¨</span></span><br><span class="line"><span class="keyword">set</span> <span class="type">time</span> zone <span class="string">&#x27;PRC&#x27;</span>; <span class="comment">-- è®¾ç½®æˆä¸œå…«åŒº åŒ—äº¬æ—¶é—´ UTC+8</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ–¹æ³•æ˜¯sessionçº§è®¾ç½®ï¼Œé€€å‡ºpsqlåªæœ‰å°±ä¸ä¼šå†ç”Ÿæ•ˆï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç”¨æˆ·çº§é…ç½®æˆ–è€…æ•°æ®åº“çº§é…ç½®</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ç”¨æˆ·çº§é…ç½®</span></span><br><span class="line"><span class="keyword">alter</span> role rolename <span class="keyword">set</span> timezone<span class="operator">=</span><span class="string">&#x27;PRC&#x27;</span>;</span><br><span class="line"><span class="keyword">alter</span> role <span class="keyword">all</span> <span class="keyword">set</span> timezone<span class="operator">=</span><span class="string">&#x27;PRC&#x27;</span>;</span><br><span class="line"><span class="comment">-- æ•°æ®åº“çº§é…ç½®</span></span><br><span class="line"><span class="keyword">alter</span> database dbname <span class="keyword">set</span> timezone<span class="operator">=</span><span class="string">&#x27;PRC&#x27;</span>;</span><br></pre></td></tr></table></figure><p>æ›´åŠ è¯¦ç»†çš„PostgreSQLæ—¥æœŸ/æ—¶é—´/æ—¶åŒºç›¸å…³å¯ä»¥å‚è€ƒè¿™ç¯‡åšæ–‡<a href="https://blog.csdn.net/wangkai_123456/article/details/106333521">PostgreSQLæ—¶åŒºã€æ—¶é—´ä¸ä¸€è‡´ã€å·®8å°æ—¶</a></p><h2><span id="schema-åˆ·æ–°-schemareloading">Schema åˆ·æ–° (SchemaReloading)</span></h2><p>åœ¨ä½¿ç”¨RESTfulAPIçš„æ—¶å€™ï¼Œå¦‚æœåœ¨æ•°æ®åº“ä¸­åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆè¦æƒ³åœ¨RESTfulAPIä¸­ä½¿ç”¨è¿™ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬éœ€è¦reloadSchemaï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥åœ¨ä¸ä¸­æ–­PostgreSQLServiceæœåŠ¡çš„åŒæ—¶åˆ·æ–°Schema</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall -SIGUSR1 postgrest</span><br></pre></td></tr></table></figure><p>å‚è€ƒ<a href="https://postgrest.org/en/stable/admin.html#schema-reloading">HardeningPostgREST â€” PostgREST 7.0.1 documentation</a></p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Javaæ—¥æœŸä¸æ ¼å¼åŒ–ï¼šDate,Calendar,DateFormatå’ŒSimpleDateFormatç±»</title>
      <link href="/2021/07/22/java/java-ri-qi-ge-shi-hua-dateformat-lei-he-simpledateformat-lei/"/>
      <url>/2021/07/22/java/java-ri-qi-ge-shi-hua-dateformat-lei-he-simpledateformat-lei/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘çš„ä¸€ä¸ªé¡¹ç›®ä¸­æœ‰ç€å¤§é‡å…³äºæ—¶é—´å’Œæ—¥æœŸçš„åº”ç”¨ï¼Œä»ç½‘ä¸Šæ‰¾åˆ°ä¸€ç¯‡æ•™ç¨‹è®°å½•ä¸€ä¸‹ï¼Œå°±å½“æ”¾è¿›æ”¶è—å¤¹é‡Œå¥½äº†ã€‚</p><p><code>Date</code>å’Œ<code>Calendar</code>åŸè½½äº<a href="http://c.biancheng.net/view/876.html">Javaæ—¶é—´æ—¥æœŸçš„å¤„ç†ï¼šJavaDateç±»ã€Calendarç±»è¯¦è§£ (biancheng.net)</a></p><p><code>DateFormat</code>å’Œ<code>SimpleDateFormat</code>åŸè½½äº<a href="http://c.biancheng.net/view/878.html">Javaæ—¥æœŸæ ¼å¼åŒ–ï¼ˆDateFormatç±»å’ŒSimpleDateFormatç±»ï¼‰(biancheng.net)</a></p><span id="more"></span><p>åœ¨ <a href="http://c.biancheng.net/java/">Java</a>ä¸­è·å–å½“å‰æ—¶é—´ï¼Œå¯ä»¥ä½¿ç”¨ java.util.Date ç±»å’Œ java.util.Calendarç±»å®Œæˆã€‚å…¶ä¸­ï¼ŒDate ç±»ä¸»è¦å°è£…äº†ç³»ç»Ÿçš„æ—¥æœŸå’Œæ—¶é—´çš„ä¿¡æ¯ï¼ŒCalendarç±»åˆ™ä¼šæ ¹æ®ç³»ç»Ÿçš„æ—¥å†æ¥è§£é‡Š Dateå¯¹è±¡ã€‚ä¸‹é¢è¯¦ç»†ä»‹ç»è¿™ä¸¤ä¸ªç±»çš„å…·ä½“ä½¿ç”¨ã€‚</p><h2><span id="date-ç±»">Date ç±»</span></h2><p>Date ç±»è¡¨ç¤ºç³»ç»Ÿç‰¹å®šçš„æ—¶é—´æˆ³ï¼Œå¯ä»¥ç²¾ç¡®åˆ°æ¯«ç§’ã€‚Dateå¯¹è±¡è¡¨ç¤ºæ—¶é—´çš„é»˜è®¤é¡ºåºæ˜¯æ˜ŸæœŸã€æœˆã€æ—¥ã€å°æ—¶ã€åˆ†ã€ç§’ã€å¹´ã€‚</p><h3><span id="æ„é€ æ–¹æ³•">æ„é€ æ–¹æ³•</span></h3><p>Date ç±»æœ‰å¦‚ä¸‹ä¸¤ä¸ªæ„é€ æ–¹æ³•ã€‚</p><ul><li>Date()ï¼šæ­¤ç§å½¢å¼è¡¨ç¤ºåˆ†é… Dateå¯¹è±¡å¹¶åˆå§‹åŒ–æ­¤å¯¹è±¡ï¼Œä»¥è¡¨ç¤ºåˆ†é…å®ƒçš„æ—¶é—´ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰ï¼Œä½¿ç”¨è¯¥æ„é€ æ–¹æ³•åˆ›å»ºçš„å¯¹è±¡å¯ä»¥è·å–æœ¬åœ°çš„å½“å‰æ—¶é—´ã€‚</li><li>Date(long date)ï¼šæ­¤ç§å½¢å¼è¡¨ç¤ºä» GMT æ—¶é—´ï¼ˆæ ¼æ—å°¼æ²»æ—¶é—´ï¼‰1970 å¹´ 1 æœˆ1 æ—¥ 0 æ—¶ 0 åˆ† 0 ç§’å¼€å§‹ç»è¿‡å‚æ•° date æŒ‡å®šçš„æ¯«ç§’æ•°ã€‚</li></ul><p>è¿™ä¸¤ä¸ªæ„é€ æ–¹æ³•çš„ä½¿ç”¨ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();    <span class="comment">// è°ƒç”¨æ— å‚æ•°æ„é€ å‡½æ•°</span></span><br><span class="line">System.out.println(date1.toString());    <span class="comment">// è¾“å‡ºï¼šWed May 18 21:24:40 CST 2016</span></span><br><span class="line"><span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="number">60000</span>);    <span class="comment">// è°ƒç”¨å«æœ‰ä¸€ä¸ªlongç±»å‹å‚æ•°çš„æ„é€ å‡½æ•°</span></span><br><span class="line">System.out.println(date2);    <span class="comment">// è¾“å‡ºï¼šThu Jan 0108:01:00 CST 1970</span></span><br></pre></td></tr></table></figure><p>Dateç±»çš„æ— å‚æ•°æ„é€ æ–¹æ³•è·å–çš„æ˜¯ç³»ç»Ÿå½“å‰çš„æ—¶é—´ï¼Œæ˜¾ç¤ºçš„é¡ºåºä¸ºæ˜ŸæœŸã€æœˆã€æ—¥ã€å°æ—¶ã€åˆ†ã€ç§’ã€å¹´ã€‚</p><p>Date ç±»å¸¦ long ç±»å‹å‚æ•°çš„æ„é€ æ–¹æ³•è·å–çš„æ˜¯è·ç¦» GMTæŒ‡å®šæ¯«ç§’æ•°çš„æ—¶é—´ï¼Œ60000 æ¯«ç§’æ˜¯ä¸€åˆ†é’Ÿï¼Œè€Œ GMTï¼ˆæ ¼æ—å°¼æ²»æ ‡å‡†æ—¶é—´ï¼‰ä¸CSTï¼ˆä¸­å¤®æ ‡å‡†æ—¶é—´ï¼‰ç›¸å·® 8 å°æ—¶ï¼Œä¹Ÿå°±æ˜¯è¯´ 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 GMTä¸ 1970 å¹´ 1 æœˆ 1 æ—¥ 08:00:00 CST è¡¨ç¤ºçš„æ˜¯åŒä¸€æ—¶é—´ã€‚ å› æ­¤è·ç¦» 1970 å¹´ 1æœˆ 1 æ—¥ 00:00:00 CST ä¸€åˆ†é’Ÿçš„æ—¶é—´ä¸º 1970 å¹´ 1 æœˆ 1 æ—¥ 00:01:00CSTï¼Œå³ä½¿ç”¨ Date å¯¹è±¡è¡¨ç¤ºä¸º Thu Jan 01 08:01:00 CST 1970ã€‚</p><h3><span id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</span></h3><p>Date ç±»æä¾›äº†è®¸å¤šä¸æ—¥æœŸå’Œäº‹ä»¶ç›¸å…³çš„æ–¹æ³•ï¼Œå…¶ä¸­å¸¸è§çš„æ–¹æ³•å¦‚è¡¨ 1æ‰€ç¤ºã€‚</p><table><colgroup><col style="width: 35%"><col style="width: 64%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>boolean after(Date when)</code></td><td>åˆ¤æ–­æ­¤æ—¥æœŸæ˜¯å¦åœ¨æŒ‡å®šæ—¥æœŸä¹‹å</td></tr><tr><td><code>boolean before(Date when)</code></td><td>åˆ¤æ–­æ­¤æ—¥æœŸæ˜¯å¦åœ¨æŒ‡å®šæ—¥æœŸä¹‹å‰</td></tr><tr><td><code>int compareTo(Date anotherDate)</code></td><td>æ¯”è¾ƒä¸¤ä¸ªæ—¥æœŸçš„é¡ºåº</td></tr><tr><td><code>boolean equals(Object obj)</code></td><td>æ¯”è¾ƒä¸¤ä¸ªæ—¥æœŸçš„ç›¸ç­‰æ€§</td></tr><tr><td><strong><code>long getTime()</code></strong></td><td>è¿”å›è‡ª 1970 å¹´ 1 æœˆ 1 æ—¥ 00:00:00 GMT ä»¥æ¥ï¼Œæ­¤ Dateå¯¹è±¡è¡¨ç¤ºçš„æ¯«ç§’æ•°</td></tr><tr><td><code>String toString()</code></td><td>æŠŠæ­¤ Date å¯¹è±¡è½¬æ¢ä¸ºä»¥ä¸‹å½¢å¼çš„ String: dow mon dd hh:mm:ss zzzyyyyã€‚ å…¶ä¸­ dow æ˜¯ä¸€å‘¨ä¸­çš„æŸä¸€å¤©(Sunã€Monã€Tueã€Wedã€Thuã€Fri åŠSat)</td></tr></tbody></table><h3><span id="ä¾‹-1">ä¾‹ 1</span></h3><p>ä¸‹é¢ä½¿ç”¨ä¸€ä¸ªå®ä¾‹æ¥å…·ä½“æ¼”ç¤º Dateç±»çš„ä½¿ç”¨ã€‚å‡è®¾ï¼ŒæŸä¸€å¤©ç‰¹å®šæ—¶é—´è¦å»åšä¸€ä»¶äº‹ï¼Œè€Œä¸”é‚£ä¸ªæ—¶é—´å·²ç»è¿‡å»ä¸€åˆ†é’Ÿä¹‹åæ‰æƒ³èµ·æ¥è¿™ä»¶äº‹è¿˜æ²¡æœ‰åŠï¼Œè¿™æ—¶ç³»ç»Ÿå°†ä¼šæç¤ºå·²ç»è¿‡å»äº†å¤šé•¿æ—¶é—´ã€‚å…·ä½“çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test11</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Scanner</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">        System.out.println(<span class="string">&quot;è¯·è¾“å…¥è¦åšçš„äº‹æƒ…ï¼š&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">title</span> <span class="operator">=</span> input.next();</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">// è·å–å½“å‰æ—¥æœŸ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;[&quot;</span> + title + <span class="string">&quot;] è¿™ä»¶äº‹å‘ç”Ÿæ—¶é—´ä¸ºï¼š&quot;</span> + date1);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">60000</span>);<span class="comment">// æš‚åœ 1 åˆ†é’Ÿ</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">date2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;ç°åœ¨æ—¶é—´ä¸ºï¼š&quot;</span> + date2);</span><br><span class="line">        <span class="keyword">if</span> (date2.before(date1)) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ä½ è¿˜æœ‰ &quot;</span> + (date2.getTime() - date1.getTime()) / <span class="number">1000</span> + <span class="string">&quot; ç§’éœ€è¦å»å®Œæˆã€&quot;</span> + title + <span class="string">&quot;ã€‘è¿™ä»¶äº‹ï¼&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;ã€&quot;</span> + title + <span class="string">&quot;ã€‘äº‹æƒ…å·²ç»è¿‡å»äº† &quot;</span> + (date2.getTime() - date1.getTime()) / <span class="number">1000</span> + <span class="string">&quot; ç§’&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¯¥ç¨‹åºä¸­ï¼Œåˆ†åˆ«ä½¿ç”¨ Date ç±»çš„æ— å‚æ•°æ„é€ æ–¹æ³•åˆ›å»ºäº†ä¸¤ä¸ª Dateå¯¹è±¡ã€‚åœ¨åˆ›å»ºå®Œç¬¬ä¸€ä¸ª Date å¯¹è±¡åï¼Œä½¿ç”¨ Thread.sleep() æ–¹æ³•è®©ç¨‹åºä¼‘çœ  60ç§’ï¼Œç„¶åå†åˆ›å»ºç¬¬äºŒä¸ª Date å¯¹è±¡ï¼Œè¿™æ ·ç¬¬äºŒä¸ª Dateå¯¹è±¡æ‰€è¡¨ç¤ºçš„æ—¶é—´å°†ä¼šåœ¨ç¬¬ä¸€ä¸ª Dateå¯¹è±¡æ‰€è¡¨ç¤ºæ—¶é—´ä¹‹åï¼Œå› æ­¤â€œdate2.before(date1)â€æ¡ä»¶è¡¨è¾¾å¼ä¸æˆç«‹ï¼Œä»è€Œæ‰§è¡Œelse å—ä¸­çš„ä»£ç ï¼Œè¡¨ç¤ºäº‹æƒ…å·²ç»å‘ç”Ÿè¿‡ã€‚</p><p>è¿è¡Œè¯¥ç¨‹åºï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¯·è¾“å…¥è¦åšçš„äº‹æƒ…ï¼š</span><br><span class="line">æ”¶å¿«é€’</span><br><span class="line">ã€æ”¶å¿«é€’ã€‘è¿™ä»¶äº‹å‘ç”Ÿæ—¶é—´ä¸ºï¼šFri Oct 12 11:11:07 CST 2018</span><br><span class="line">ç°åœ¨æ—¶é—´ä¸ºï¼šFri Oct 12 11:12:07 CST 2018</span><br><span class="line">ã€æ”¶å¿«é€’ã€‘äº‹æƒ…å·²ç»è¿‡å»äº† 60 ç§’</span><br></pre></td></tr></table></figure><h2><span id="calendar-ç±»">Calendar ç±»</span></h2><p>Calendar ç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒä¸ºç‰¹å®šç¬é—´ä¸YEARã€MONTHã€DAY_OFâ€”MONTHã€HOURç­‰æ—¥å†å­—æ®µä¹‹é—´çš„è½¬æ¢æä¾›äº†ä¸€äº›æ–¹æ³•ï¼Œå¹¶ä¸ºæ“ä½œæ—¥å†å­—æ®µï¼ˆå¦‚è·å¾—ä¸‹æ˜ŸæœŸçš„æ—¥æœŸï¼‰æä¾›äº†ä¸€äº›æ–¹æ³•ã€‚</p><p>åˆ›å»º Calendar å¯¹è±¡ä¸èƒ½ä½¿ç”¨ new å…³é”®å­—ï¼Œå› ä¸º Calendarç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†æ˜¯å®ƒæä¾›äº†ä¸€ä¸ª<code>getInstance()</code>æ–¹æ³•æ¥è·å¾—Calendarç±»çš„å¯¹è±¡ã€‚<code>getInstance()</code> æ–¹æ³•è¿”å›ä¸€ä¸ª Calendarå¯¹è±¡ï¼Œå…¶æ—¥å†å­—æ®µå·²ç”±å½“å‰æ—¥æœŸå’Œæ—¶é—´åˆå§‹åŒ–ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Calendar c = Calendar.getInstance();</span><br></pre></td></tr></table></figure><p>å½“åˆ›å»ºäº†ä¸€ä¸ª Calendar å¯¹è±¡åï¼Œå°±å¯ä»¥é€šè¿‡ Calendarå¯¹è±¡ä¸­çš„ä¸€äº›æ–¹æ³•æ¥å¤„ç†æ—¥æœŸã€æ—¶é—´ã€‚Calendar ç±»çš„å¸¸ç”¨æ–¹æ³•å¦‚è¡¨ 2 æ‰€ç¤ºã€‚</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>void add(int field, int amount)</code></td><td>æ ¹æ®æ—¥å†çš„è§„åˆ™ï¼Œä¸ºç»™å®šçš„æ—¥å†å­—æ®µ field æ·»åŠ æˆ–å‡å»æŒ‡å®šçš„æ—¶é—´é‡amount</td></tr><tr><td><code>boolean after(Object when)</code></td><td>åˆ¤æ–­æ­¤ Calendar è¡¨ç¤ºçš„æ—¶é—´æ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´ whenä¹‹åï¼Œå¹¶è¿”å›åˆ¤æ–­ç»“æœ</td></tr><tr><td><code>boolean before(Object when)</code></td><td>åˆ¤æ–­æ­¤ Calendar è¡¨ç¤ºçš„æ—¶é—´æ˜¯å¦åœ¨æŒ‡å®šæ—¶é—´ whenä¹‹å‰ï¼Œå¹¶è¿”å›åˆ¤æ–­ç»“æœ</td></tr><tr><td><code>void clear()</code></td><td>æ¸…ç©º Calendar ä¸­çš„æ—¥æœŸæ—¶é—´å€¼</td></tr><tr><td><code>int compareTo(Calendar anotherCalendar)</code></td><td>æ¯”è¾ƒä¸¤ä¸ª Calendar å¯¹è±¡è¡¨ç¤ºçš„æ—¶é—´å€¼ï¼ˆä»æ ¼æ—å¨æ²»æ—¶é—´ 1970 å¹´ 01 æœˆ 01æ—¥ 00 æ—¶ 00 åˆ† 00 ç§’è‡³ç°åœ¨çš„æ¯«ç§’åç§»é‡ï¼‰ï¼Œå¤§åˆ™è¿”å› 1ï¼Œå°åˆ™è¿”å›-1ï¼Œç›¸ç­‰è¿”å› 0</td></tr><tr><td><code>int get(int field)</code></td><td>è¿”å›æŒ‡å®šæ—¥å†å­—æ®µçš„å€¼</td></tr><tr><td><code>int getActualMaximum(int field)</code></td><td>è¿”å›æŒ‡å®šæ—¥å†å­—æ®µå¯èƒ½æ‹¥æœ‰çš„æœ€å¤§å€¼</td></tr><tr><td><code>int getActualMinimum(int field)</code></td><td>è¿”å›æŒ‡å®šæ—¥å†å­—æ®µå¯èƒ½æ‹¥æœ‰çš„æœ€å°å€¼</td></tr><tr><td><code>int getFirstDayOfWeek()</code></td><td>è·å–ä¸€æ˜ŸæœŸçš„ç¬¬ä¸€å¤©ã€‚æ ¹æ®ä¸åŒçš„å›½å®¶åœ°åŒºï¼Œè¿”å›ä¸åŒçš„å€¼</td></tr><tr><td><code>static Calendar getInstance()</code></td><td>ä½¿ç”¨é»˜è®¤æ—¶åŒºå’Œè¯­è¨€åå¢ƒè·å¾—ä¸€ä¸ªæ—¥å†</td></tr><tr><td><code>static Calendar getInstance(TimeZone zone)</code></td><td>ä½¿ç”¨æŒ‡å®šæ—¶åŒºå’Œé»˜è®¤è¯­è¨€ç¯å¢ƒè·å¾—ä¸€ä¸ªæ—¥å†</td></tr><tr><td><strong><code>static Calendar getInstance(TimeZone zone, Locale aLocale)</code></strong></td><td>ä½¿ç”¨æŒ‡å®šæ—¶åŒºå’Œè¯­è¨€ç¯å¢ƒè·å¾—ä¸€ä¸ªæ—¥å†</td></tr><tr><td><strong><code>Date getTime()</code></strong></td><td>è¿”å›ä¸€ä¸ªè¡¨ç¤ºæ­¤ Calendar æ—¶é—´å€¼ï¼ˆä»æ ¼æ—å¨æ²»æ—¶é—´ 1970 å¹´ 01 æœˆ 01 æ—¥00 æ—¶ 00 åˆ† 00 ç§’è‡³ç°åœ¨çš„æ¯«ç§’åç§»é‡ï¼‰çš„ Date å¯¹è±¡</td></tr><tr><td><strong><code>long getTimeInMillis()</code></strong></td><td>è¿”å›æ­¤ Calendar çš„æ—¶é—´å€¼ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½</td></tr><tr><td><code>void set(int field, int value)</code></td><td>ä¸ºæŒ‡å®šçš„æ—¥å†å­—æ®µè®¾ç½®ç»™å®šå€¼</td></tr><tr><td><code>void set(int year, int month, int date)</code></td><td>è®¾ç½®æ—¥å†å­—æ®µ YEARã€MONTH å’Œ DAY_OF_MONTH çš„å€¼</td></tr><tr><td><code>void set(int year, int month, int date, int hourOfDay, int minute, int second)</code></td><td>è®¾ç½®å­—æ®µ YEARã€MONTHã€DAY_OF_MONTHã€HOURã€ MINUTE å’Œ SECONDçš„å€¼</td></tr><tr><td><code>void setFirstDayOfWeek(int value)</code></td><td>è®¾ç½®ä¸€æ˜ŸæœŸçš„ç¬¬ä¸€å¤©æ˜¯å“ªä¸€å¤©</td></tr><tr><td><strong><code>void setTimeInMillis(long millis)</code></strong></td><td>ç”¨ç»™å®šçš„ long å€¼è®¾ç½®æ­¤ Calendar çš„å½“å‰æ—¶é—´å€¼</td></tr></tbody></table><p>Calendar å¯¹è±¡å¯ä»¥è°ƒç”¨ set() æ–¹æ³•å°†æ—¥å†ç¿»åˆ°ä»»ä½•ä¸€ä¸ªæ—¶é—´ï¼Œå½“å‚æ•° yearå–è´Ÿæ•°æ—¶è¡¨ç¤ºå…¬å…ƒå‰ã€‚Calendar å¯¹è±¡è°ƒç”¨ get()æ–¹æ³•å¯ä»¥è·å–æœ‰å…³å¹´ã€æœˆã€æ—¥ç­‰æ—¶é—´ä¿¡æ¯ï¼Œå‚æ•° field çš„æœ‰æ•ˆå€¼ç”± Calendaré™æ€å¸¸é‡æŒ‡å®šã€‚</p><p>Calendar ç±»ä¸­å®šä¹‰äº†è®¸å¤šå¸¸é‡ï¼Œåˆ†åˆ«è¡¨ç¤ºä¸åŒçš„æ„ä¹‰ã€‚</p><ul><li><code>Calendar.YEAR</code>ï¼šå¹´ä»½ã€‚</li><li><code>Calendar.MONTH</code>ï¼šæœˆä»½ã€‚</li><li><code>Calendar.DATE</code>ï¼šæ—¥æœŸã€‚</li><li><code>Calendar.DAY_OF_MONTH</code>ï¼šæ—¥æœŸï¼Œå’Œä¸Šé¢çš„å­—æ®µæ„ä¹‰å®Œå…¨ç›¸åŒã€‚</li><li><code>Calendar.HOUR</code>ï¼š12å°æ—¶åˆ¶çš„å°æ—¶ã€‚</li><li><code>Calendar.HOUR_OF_DAY</code>ï¼š24 å°æ—¶åˆ¶çš„å°æ—¶ã€‚</li><li><code>Calendar.MINUTE</code>ï¼šåˆ†é’Ÿã€‚</li><li><code>Calendar.SECOND</code>ï¼šç§’ã€‚</li><li><code>Calendar.DAY_OF_WEEK</code>ï¼šæ˜ŸæœŸå‡ ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œè¦è·å–å½“å‰æœˆä»½å¯ç”¨å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int month = Calendar.getInstance().get(Calendar.MONTH);</span><br></pre></td></tr></table></figure><p>å¦‚æœæ•´å‹å˜é‡ month çš„å€¼æ˜¯ 0ï¼Œè¡¨ç¤ºå½“å‰æ—¥å†æ˜¯åœ¨ 1 æœˆä»½ï¼›å¦‚æœå€¼æ˜¯11ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ—¥å†åœ¨ 12 æœˆä»½ã€‚</p><p>ä½¿ç”¨ Calendar ç±»å¤„ç†æ—¥æœŸæ—¶é—´çš„å®ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance(); <span class="comment">// å¦‚æœä¸è®¾ç½®æ—¶é—´ï¼Œåˆ™é»˜è®¤ä¸ºå½“å‰æ—¶é—´</span></span><br><span class="line">calendar.setTime(<span class="keyword">new</span> <span class="title class_">Date</span>()); <span class="comment">// å°†ç³»ç»Ÿå½“å‰æ—¶é—´èµ‹å€¼ç»™ Calendar å¯¹è±¡</span></span><br><span class="line">System.out.println(<span class="string">&quot;ç°åœ¨æ—¶åˆ»ï¼š&quot;</span> + calendar.getTime()); <span class="comment">// è·å–å½“å‰æ—¶é—´</span></span><br><span class="line"><span class="type">int</span> <span class="variable">year</span> <span class="operator">=</span> calendar.get(Calendar.YEAR); <span class="comment">// è·å–å½“å‰å¹´ä»½</span></span><br><span class="line">System.out.println(<span class="string">&quot;ç°åœ¨æ˜¯&quot;</span> + year + <span class="string">&quot;å¹´&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">month</span> <span class="operator">=</span> calendar.get(Calendar.MONTH) + <span class="number">1</span>; <span class="comment">// è·å–å½“å‰æœˆä»½ï¼ˆæœˆä»½ä» 0 å¼€å§‹ï¼Œæ‰€ä»¥åŠ  1ï¼‰</span></span><br><span class="line">System.out.print(month + <span class="string">&quot;æœˆ&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> calendar.get(Calendar.DATE); <span class="comment">// è·å–æ—¥</span></span><br><span class="line">System.out.print(day + <span class="string">&quot;æ—¥&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">week</span> <span class="operator">=</span> calendar.get(Calendar.DAY_OF_WEEK) - <span class="number">1</span>; <span class="comment">// è·å–ä»Šå¤©æ˜ŸæœŸå‡ ï¼ˆä»¥æ˜ŸæœŸæ—¥ä¸ºç¬¬ä¸€å¤©ï¼‰</span></span><br><span class="line">System.out.print(<span class="string">&quot;æ˜ŸæœŸ&quot;</span> + week);</span><br><span class="line"><span class="type">int</span> <span class="variable">hour</span> <span class="operator">=</span> calendar.get(Calendar.HOUR_OF_DAY); <span class="comment">// è·å–å½“å‰å°æ—¶æ•°ï¼ˆ24 å°æ—¶åˆ¶ï¼‰</span></span><br><span class="line">System.out.print(hour + <span class="string">&quot;æ—¶&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">minute</span> <span class="operator">=</span> calendar.get(Calendar.MINUTE); <span class="comment">// è·å–å½“å‰åˆ†é’Ÿ</span></span><br><span class="line">System.out.print(minute + <span class="string">&quot;åˆ†&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">second</span> <span class="operator">=</span> calendar.get(Calendar.SECOND); <span class="comment">// è·å–å½“å‰ç§’æ•°</span></span><br><span class="line">System.out.print(second + <span class="string">&quot;ç§’&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">millisecond</span> <span class="operator">=</span> calendar.get(Calendar.MILLISECOND); <span class="comment">// è·å–æ¯«ç§’æ•°</span></span><br><span class="line">System.out.print(millisecond + <span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">dayOfMonth</span> <span class="operator">=</span> calendar.get(Calendar.DAY_OF_MONTH); <span class="comment">// è·å–ä»Šå¤©æ˜¯æœ¬æœˆç¬¬å‡ å¤©</span></span><br><span class="line">System.out.println(<span class="string">&quot;ä»Šå¤©æ˜¯æœ¬æœˆçš„ç¬¬ &quot;</span> + dayOfMonth + <span class="string">&quot; å¤©&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">dayOfWeekInMonth</span> <span class="operator">=</span> calendar.get(Calendar.DAY_OF_WEEK_IN_MONTH); <span class="comment">// è·å–ä»Šå¤©æ˜¯æœ¬æœˆç¬¬å‡ å‘¨</span></span><br><span class="line">System.out.println(<span class="string">&quot;ä»Šå¤©æ˜¯æœ¬æœˆç¬¬ &quot;</span> + dayOfWeekInMonth + <span class="string">&quot; å‘¨&quot;</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">many</span> <span class="operator">=</span> calendar.get(Calendar.DAY_OF_YEAR); <span class="comment">// è·å–ä»Šå¤©æ˜¯ä»Šå¹´ç¬¬å‡ å¤©</span></span><br><span class="line">System.out.println(<span class="string">&quot;ä»Šå¤©æ˜¯ä»Šå¹´ç¬¬ &quot;</span> + many + <span class="string">&quot; å¤©&quot;</span>);</span><br><span class="line"><span class="type">Calendar</span> <span class="variable">c</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">c.set(<span class="number">2012</span>, <span class="number">8</span>, <span class="number">8</span>); <span class="comment">// è®¾ç½®å¹´æœˆæ—¥ï¼Œæ—¶åˆ†ç§’å°†é»˜è®¤é‡‡ç”¨å½“å‰å€¼</span></span><br><span class="line">System.out.println(<span class="string">&quot;è®¾ç½®æ—¥æœŸä¸º 2012-8-8 åçš„æ—¶é—´ï¼š&quot;</span> + c.getTime()); <span class="comment">// è¾“å‡ºæ—¶é—´</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ç¤ºä¾‹ä»£ç æ¼”ç¤ºäº† Calendarç±»ä¸­çš„æ–¹æ³•ä¸å¸¸é‡çš„ç»“åˆä½¿ç”¨ï¼Œä»è€Œå®Œæˆå¤„ç†æ—¥æœŸçš„æ“ä½œã€‚ ### ä¾‹ 2</p><p>ä¸‹é¢ä½¿ç”¨ Calendar ç±»æ¥å®ç°æ—¥å†çš„æ‰“å°åŠŸèƒ½ï¼Œä»£ç å®ç°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Calendar;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalendarDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">        calendar.set(<span class="number">2016</span>, <span class="number">5</span>, <span class="number">1</span>); <span class="comment">// å®é™…çš„calendarå¯¹è±¡æ‰€è¡¨ç¤ºçš„æ—¥æœŸä¸º2016å¹´6æœˆ1æ—¥</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­2016å¹´6æœˆ1æ—¥ä¸ºä¸€å‘¨ä¸­çš„ç¬¬å‡ å¤©</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> calendar.get(Calendar.DAY_OF_WEEK) - <span class="number">1</span>;</span><br><span class="line">        <span class="type">char</span>[] title = &#123; <span class="string">&#x27;æ—¥&#x27;</span>, <span class="string">&#x27;ä¸€&#x27;</span>, <span class="string">&#x27;äºŒ&#x27;</span>, <span class="string">&#x27;ä¸‰&#x27;</span>, <span class="string">&#x27;å››&#x27;</span>, <span class="string">&#x27;äº”&#x27;</span>, <span class="string">&#x27;å…­&#x27;</span> &#125;; <span class="comment">// å­˜æ”¾æ—¥å†çš„å¤´éƒ¨</span></span><br><span class="line">        <span class="type">int</span> daysArray[][] = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">6</span>][<span class="number">7</span>];<span class="comment">// å­˜æ”¾æ—¥å†çš„æ•°æ®</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">daysInMonth</span> <span class="operator">=</span> <span class="number">31</span>; <span class="comment">// è¯¥æœˆçš„å¤©æ•°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">day</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">// è‡ªåŠ¨å¢é•¿</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> index; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// å¡«å……ç¬¬ä¸€å‘¨çš„æ—¥æœŸæ•°æ®ï¼Œå³æ—¥å†ä¸­çš„ç¬¬ä¸€è¡Œ</span></span><br><span class="line">            daysArray[<span class="number">0</span>][i] = day++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// å¡«å……å…¶ä»–å‘¨çš„æ—¥å†æ•°æ®ï¼Œæ§åˆ¶è¡Œ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœå½“å‰dayè¡¨ç¤ºçš„æ˜¯æœ¬æœˆæœ€åä¸€å¤©ï¼Œåˆ™åœæ­¢å‘æ•°ç»„ä¸­ç»§ç»­èµ‹å€¼</span></span><br><span class="line">                <span class="keyword">if</span> (day &gt; daysInMonth) &#123;</span><br><span class="line">                    i = <span class="number">6</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                daysArray[i][j] = day++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------2016 å¹´ 6 æœˆ--------------------\n&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; title.length; i++) &#123;</span><br><span class="line">            System.out.print(title[i] + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="comment">// è¾“å‡ºäºŒå…ƒæ•°ç»„daysArrayä¸­çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">7</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (daysArray[i][j] == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (i != <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="comment">// å¦‚æœåˆ°æœˆæœ«ï¼Œåˆ™å®Œæˆæ˜¾ç¤ºæ—¥å†çš„ä»»åŠ¡ï¼Œåœæ­¢è¯¥æ–¹æ³•çš„æ‰§è¡Œ</span></span><br><span class="line">                        <span class="keyword">return</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    System.out.print(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.print(daysArray[i][j] + <span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.print(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçœ‹ä¼¼å¤æ‚å…¶å®å¾ˆç®€å•ã€‚å› ä¸º Calendar ç±»æ‰€è¡¨ç¤ºçš„æ—¶é—´æœˆä»½æ˜¯ set()æ–¹æ³•ä¸­è¡¨ç¤ºæœˆä»½çš„å‚æ•°å€¼ +1ï¼Œå› æ­¤ Calendar ç±»çš„å®é™…æ—¶é—´ä¸º 2016 å¹´ 6 æœˆ 1æ—¥ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­åˆ†åˆ«è·å– 6 æœˆ 1æ—¥ä¸ºæœ¬å‘¨ä¸­çš„ç¬¬å‡ å¤©ï¼Œä»¥ä¾¿åœ¨ç›¸åº”çš„æ˜ŸæœŸä¸‹å¼€å§‹è¾“å‡º 6 æœˆä»½çš„æ—¥å†ã€‚ç¨‹åºä¸­çš„<code>daysArray</code>æ˜¯ä¸€ä¸ªäºŒå…ƒæ•°ç»„ï¼Œè¯¥äºŒå…ƒæ•°ç»„æ§åˆ¶äº†æ—¥å†çš„æ ¼å¼è¾“å‡ºï¼Œç¬¬ä¸€ä¸ªå­æ•°ç»„æ§åˆ¶æ—¥å†çš„è¡Œï¼Œç¬¬äºŒä¸ªå­æ•°ç»„æ§åˆ¶æ›°å†çš„åˆ—ï¼Œå³å¯è¾“å‡ºäºŒå…ƒæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚</p><p>è¿è¡Œç¨‹åºï¼Œæ‰§è¡Œç»“æœå¦‚ä¸‹æ‰€ç¤ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">------------------2016 å¹´ 6 æœˆ--------------------</span><br><span class="line"></span><br><span class="line">æ—¥ ä¸€ äºŒ ä¸‰ å›› äº” å…­</span><br><span class="line">   1 2 3 4</span><br><span class="line">5 6 7 8 9 10 11</span><br><span class="line">12 13 14 15 16 17 18</span><br><span class="line">19 20 21 22 23 24 25</span><br><span class="line">26 27 28 29 30 31 </span><br></pre></td></tr></table></figure><p>æ—¥æœŸæ ¼å¼åŒ–ï¼šæ ¼å¼åŒ–æ—¥æœŸè¡¨ç¤ºå°†æ—¥æœŸ/æ—¶é—´æ ¼å¼è½¬æ¢ä¸ºé¢„å…ˆå®šä¹‰çš„æ—¥æœŸ/æ—¶é—´æ ¼å¼ã€‚ä¾‹å¦‚å°†æ—¥æœŸâ€œFriMay 18 15:46:24 CST2016â€ æ ¼å¼è½¬æ¢ä¸º â€œ2016-5-18 15:46:24æ˜ŸæœŸäº”â€çš„æ ¼å¼ã€‚</p><p>åœ¨ <a href="http://c.biancheng.net/java/">Java</a> ä¸­ï¼Œå¯ä»¥ä½¿ç”¨<code>DateFormat</code> ç±»å’Œ<code>SimpleDateFormat</code>ç±»æ¥æ ¼å¼åŒ–æ—¥æœŸï¼Œä¸‹é¢è¯¦ç»†ä»‹ç»è¿™ä¸¤ä¸ªæ ¼å¼åŒ–æ—¥æœŸç±»çš„ä½¿ç”¨ã€‚</p><h2><span id="dateformat-ç±»">DateFormat ç±»</span></h2><p><code>DateFormat</code>æ˜¯æ—¥æœŸ/æ—¶é—´æ ¼å¼åŒ–å­ç±»çš„æŠ½è±¡ç±»ï¼Œå®ƒä»¥ä¸è¯­è¨€æ— å…³çš„æ–¹å¼æ ¼å¼åŒ–å¹¶è§£ææ—¥æœŸæˆ–æ—¶é—´ã€‚æ—¥æœŸ/æ—¶é—´æ ¼å¼åŒ–å­ç±»ï¼ˆå¦‚<code>SimpleDateFormat</code>ï¼‰å…è®¸è¿›è¡Œæ ¼å¼åŒ–ï¼ˆä¹Ÿå°±æ˜¯æ—¥æœŸâ†’æ–‡æœ¬ï¼‰ã€è§£æï¼ˆæ–‡æœ¬â†’æ—¥æœŸï¼‰å’Œæ ‡å‡†åŒ–æ—¥æœŸã€‚</p><p>åœ¨åˆ›å»º<code>DateFormat</code> å¯¹è±¡æ—¶ä¸èƒ½ä½¿ç”¨ new å…³é”®å­—ï¼Œè€Œåº”è¯¥ä½¿ç”¨<code>DateFormat</code> ç±»ä¸­çš„é™æ€æ–¹æ³•<code>getDateInstance()</code>ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DateFormat</span> <span class="variable">df</span> <span class="operator">=</span> DateFormat.getDatelnstance();</span><br></pre></td></tr></table></figure><p>åœ¨åˆ›å»ºäº†ä¸€ä¸ª <code>DateFormat</code>å¯¹è±¡åï¼Œå¯ä»¥è°ƒç”¨è¯¥å¯¹è±¡ä¸­çš„æ–¹æ³•æ¥å¯¹æ—¥æœŸ/æ—¶é—´è¿›è¡Œæ ¼å¼åŒ–ã€‚<code>DateFormat</code>ç±»ä¸­å¸¸ç”¨æ–¹æ³•å¦‚è¡¨ 1 æ‰€ç¤ºã€‚</p><table><colgroup><col style="width: 50%"><col style="width: 50%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>String format(Date date)</code></td><td>å°† Date æ ¼å¼åŒ–æ—¥æœŸ/æ—¶é—´å­—ç¬¦ä¸²</td></tr><tr><td><code>Calendar getCalendar()</code></td><td>è·å–ä¸æ­¤æ—¥æœŸ/æ—¶é—´æ ¼å¼ç›¸å…³è”çš„æ—¥å†</td></tr><tr><td><code>static DateFormat getDateInstance()</code></td><td>è·å–å…·æœ‰é»˜è®¤æ ¼å¼åŒ–é£æ ¼å’Œé»˜è®¤è¯­è¨€ç¯å¢ƒçš„<strong>æ—¥æœŸ</strong>æ ¼å¼</td></tr><tr><td><code>static DateFormat getDateInstance(int style)</code></td><td>è·å–å…·æœ‰æŒ‡å®šæ ¼å¼åŒ–é£æ ¼å’Œé»˜è®¤è¯­è¨€ç¯å¢ƒçš„<strong>æ—¥æœŸ</strong>æ ¼å¼</td></tr><tr><td><strong><code>static DateFormat getDateInstance(int style, Locale locale)</code></strong></td><td>è·å–å…·æœ‰æŒ‡å®šæ ¼å¼åŒ–é£æ ¼å’ŒæŒ‡å®šè¯­è¨€ç¯å¢ƒçš„<strong>æ—¥æœŸ</strong>æ ¼å¼</td></tr><tr><td><code>static DateFormat getDateTimeInstance()</code></td><td>è·å–å…·æœ‰é»˜è®¤æ ¼å¼åŒ–é£æ ¼å’Œé»˜è®¤è¯­è¨€ç¯å¢ƒçš„<strong>æ—¥æœŸ/æ—¶é—´</strong>æ ¼å¼</td></tr><tr><td><code>static DateFormat getDateTimeInstance(int dateStyle,int timeStyle)</code></td><td>è·å–å…·æœ‰æŒ‡å®šæ—¥æœŸ/æ—¶é—´æ ¼å¼åŒ–é£æ ¼å’Œé»˜è®¤è¯­è¨€ç¯å¢ƒçš„<strong>æ—¥æœŸ/æ—¶é—´</strong>æ ¼å¼</td></tr><tr><td><strong><code>static DateFormat getDateTimeInstance(int dateStyle,int timeStyle,Locale locale)</code></strong></td><td>è·å–å…·æœ‰æŒ‡å®šæ—¥æœŸ/æ—¶é—´æ ¼å¼åŒ–é£æ ¼å’ŒæŒ‡å®šè¯­è¨€ç¯å¢ƒçš„<strong>æ—¥æœŸ/æ—¶é—´</strong>æ ¼å¼</td></tr><tr><td><code>static DateFormat getTimeInstance()</code></td><td>è·å–å…·æœ‰é»˜è®¤æ ¼å¼åŒ–é£æ ¼å’Œé»˜è®¤è¯­è¨€ç¯å¢ƒçš„<strong>æ—¶é—´</strong>æ ¼å¼</td></tr><tr><td><code>static DateFormat getTimeInstance(int style)</code></td><td>è·å–å…·æœ‰æŒ‡å®šæ ¼å¼åŒ–é£æ ¼å’Œé»˜è®¤è¯­è¨€ç¯å¢ƒçš„<strong>æ—¶é—´</strong>æ ¼å¼</td></tr><tr><td><strong><code>static DateFormat getTimeInstance(int style, Locale locale)</code></strong></td><td>è·å–å…·æœ‰æŒ‡å®šæ ¼å¼åŒ–é£æ ¼å’ŒæŒ‡å®šè¯­è¨€ç¯å¢ƒçš„<strong>æ—¶é—´</strong>æ ¼å¼</td></tr><tr><td><code>void setCalendar(Calendar newCalendar)</code></td><td>ä¸ºæ­¤æ ¼å¼è®¾ç½®æ—¥å†</td></tr><tr><td><code>Date parse(String source)</code></td><td>å°†ç»™å®šçš„å­—ç¬¦ä¸²è§£ææˆæ—¥æœŸ/æ—¶é—´</td></tr></tbody></table><p>æ ¼å¼åŒ–æ ·å¼(<code>dateStyle</code>)ä¸»è¦é€šè¿‡ <code>DateFormat</code>å¸¸é‡è®¾ç½®ã€‚å°†ä¸åŒçš„å¸¸é‡ä¼ å…¥åˆ°è¡¨ 1æ‰€ç¤ºçš„æ–¹æ³•ä¸­ï¼Œä»¥æ§åˆ¶ç»“æœçš„é•¿åº¦ã€‚<code>DateFormat</code>ç±»çš„å¸¸é‡å¦‚ä¸‹ã€‚</p><ul><li>SHORTï¼šå®Œå…¨ä¸ºæ•°å­—ï¼Œå¦‚ 12.5.10 æˆ– 5:30pmã€‚</li><li><strong>MEDIUMï¼šè¾ƒé•¿ï¼Œå¦‚ May 10ï¼Œ2016ã€‚</strong><mark>ä¸ªäººæ„Ÿè§‰ç”¨çš„æ¯”è¾ƒå¤š</mark></li><li>LONGï¼šæ›´é•¿ï¼Œå¦‚ May 12ï¼Œ2016 æˆ– 11:15:32amã€‚</li><li>FULLï¼šæ˜¯å®Œå…¨æŒ‡å®šï¼Œå¦‚ Tuesdayã€May 10ã€2012 AD æˆ– 11:15:42amCSTã€‚</li></ul><p>ä½¿ç”¨ <code>DateFormat</code> ç±»æ ¼å¼åŒ–æ›°æœŸ/æ—¶é—´çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–ä¸åŒæ ¼å¼åŒ–é£æ ¼å’Œä¸­å›½ç¯å¢ƒçš„æ—¥æœŸ</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df1</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.SHORT, Locale.CHINA);</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df2</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.FULL, Locale.CHINA);</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df3</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.MEDIUM, Locale.CHINA);</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df4</span> <span class="operator">=</span> DateFormat.getDateInstance(DateFormat.LONG, Locale.CHINA);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å–ä¸åŒæ ¼å¼åŒ–é£æ ¼å’Œä¸­å›½ç¯å¢ƒçš„æ—¶é—´</span></span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df5</span> <span class="operator">=</span> DateFormat.getTimeInstance(DateFormat.SHORT, Locale.CHINA);</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df6</span> <span class="operator">=</span> DateFormat.getTimeInstance(DateFormat.FULL, Locale.CHINA);</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df7</span> <span class="operator">=</span> DateFormat.getTimeInstance(DateFormat.MEDIUM, Locale.CHINA);</span><br><span class="line"><span class="type">DateFormat</span> <span class="variable">df8</span> <span class="operator">=</span> DateFormat.getTimeInstance(DateFormat.LONG, Locale.CHINA);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ä¸åŒæ ¼å¼åŒ–é£æ ¼çš„æ—¥æœŸæ ¼å¼åŒ–ä¸ºæ—¥æœŸå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">String</span> <span class="variable">date1</span> <span class="operator">=</span> df1.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">date2</span> <span class="operator">=</span> df2.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">date3</span> <span class="operator">=</span> df3.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">date4</span> <span class="operator">=</span> df4.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ä¸åŒæ ¼å¼åŒ–é£æ ¼çš„æ—¶é—´æ ¼å¼åŒ–ä¸ºæ—¶é—´å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="type">String</span> <span class="variable">time1</span> <span class="operator">=</span> df5.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">time2</span> <span class="operator">=</span> df6.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">time3</span> <span class="operator">=</span> df7.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="type">String</span> <span class="variable">time4</span> <span class="operator">=</span> df8.format(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºæ—¥æœŸ</span></span><br><span class="line">System.out.println(<span class="string">&quot;SHORTï¼š&quot;</span> + date1 + <span class="string">&quot; &quot;</span> + time1);</span><br><span class="line">System.out.println(<span class="string">&quot;FULLï¼š&quot;</span> + date2 + <span class="string">&quot; &quot;</span> + time2);</span><br><span class="line">System.out.println(<span class="string">&quot;MEDIUMï¼š&quot;</span> + date3 + <span class="string">&quot; &quot;</span> + time3);</span><br><span class="line">System.out.println(<span class="string">&quot;LONGï¼š&quot;</span> + date4 + <span class="string">&quot; &quot;</span> + time4);</span><br></pre></td></tr></table></figure><p>è¿è¡Œè¯¥æ®µä»£ç ï¼Œè¾“å‡ºçš„ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SHORTï¼š18-10-15 ä¸Šåˆ9:30</span><br><span class="line">FULLï¼š2018å¹´10æœˆ15æ—¥ æ˜ŸæœŸä¸€ ä¸Šåˆ09æ—¶30åˆ†43ç§’ CST</span><br><span class="line">MEDIUMï¼š2018-10-15 9:30:43</span><br><span class="line">LONGï¼š2018å¹´10æœˆ15æ—¥ ä¸Šåˆ09æ—¶30åˆ†43ç§’</span><br></pre></td></tr></table></figure><p>è¯¥ç¤ºä¾‹ä¸»è¦ä»‹ç»äº† <code>DateFormat</code>ç±»ä¸­æ–¹æ³•ä¸å¸¸é‡çš„ç»“åˆä½¿ç”¨ï¼Œé€šè¿‡ä½¿ç”¨<code>DateFomat</code>ç±»å¯ä»¥å¯¹æ—¥æœŸè¿›è¡Œä¸åŒé£æ ¼çš„æ ¼å¼åŒ–ã€‚</p><h2><span id="simpledateformat-ç±»">SimpleDateFormat ç±»</span></h2><p>å¦‚æœä½¿ç”¨ <code>DateFormat</code>ç±»æ ¼å¼åŒ–æ—¥æœŸ/æ—¶é—´å¹¶ä¸èƒ½æ»¡è¶³è¦æ±‚ï¼Œé‚£ä¹ˆå°±éœ€è¦ä½¿ç”¨ <code>DateFormat</code>ç±»çš„å­ç±»â€”â€”<code>SimpleDateFormat</code>ã€‚</p><p><code>SimpleDateFormat</code>æ˜¯ä¸€ä¸ªä»¥ä¸è¯­è¨€ç¯å¢ƒæœ‰å…³çš„æ–¹å¼æ¥æ ¼å¼åŒ–å’Œè§£ææ—¥æœŸçš„å…·ä½“ç±»ï¼Œå®ƒå…è®¸è¿›è¡Œæ ¼å¼åŒ–ï¼ˆæ—¥æœŸâ†’æ–‡æœ¬ï¼‰ã€è§£æï¼ˆæ–‡æœ¬â†’æ—¥æœŸï¼‰å’Œè§„èŒƒåŒ–ã€‚<code>SimpleDateFormat</code>ä½¿å¾—å¯ä»¥é€‰æ‹©ä»»ä½•ç”¨æˆ·å®šä¹‰çš„æ—¥æœŸ/æ—¶é—´æ ¼å¼çš„æ¨¡å¼ã€‚</p><p><code>SimpleDateFormat</code> ç±»ä¸»è¦æœ‰å¦‚ä¸‹ 3 ç§æ„é€ æ–¹æ³•ã€‚</p><ul><li><code>SimpleDateFormat()</code>ï¼šç”¨é»˜è®¤çš„æ ¼å¼å’Œé»˜è®¤çš„è¯­è¨€ç¯å¢ƒæ„é€ <code>SimpleDateFormat</code>ã€‚</li><li><code>SimpleDateFormat(String pattern)</code>ï¼šç”¨æŒ‡å®šçš„æ ¼å¼å’Œé»˜è®¤çš„è¯­è¨€ç¯å¢ƒæ„é€ <code>SimpleDateFormat</code>ã€‚</li><li><code>SimpleDateFormat(String pattern,Locale locale)</code>ï¼šç”¨æŒ‡å®šçš„æ ¼å¼å’ŒæŒ‡å®šçš„è¯­è¨€ç¯å¢ƒæ„é€ <code>SimpleDateFormat</code>ã€‚</li></ul><p><code>SimpleDateFormat</code> è‡ªå®šä¹‰æ ¼å¼ä¸­å¸¸ç”¨çš„å­—æ¯åŠå«ä¹‰å¦‚è¡¨ 2æ‰€ç¤ºã€‚</p><table><colgroup><col style="width: 3%"><col style="width: 48%"><col style="width: 48%"></colgroup><thead><tr><th>å­—æ¯</th><th>å«ä¹‰</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>y</td><td>å¹´ä»½ã€‚ä¸€èˆ¬ç”¨ yy è¡¨ç¤ºä¸¤ä½å¹´ä»½ï¼Œyyyy è¡¨ç¤º 4 ä½å¹´ä»½</td><td>ä½¿ç”¨ yy è¡¨ç¤ºçš„å¹´æ‰®ï¼Œå¦‚ 11ï¼› ä½¿ç”¨ yyyy è¡¨ç¤ºçš„å¹´ä»½ï¼Œå¦‚ 2011</td></tr><tr><td>M</td><td>æœˆä»½ã€‚ä¸€èˆ¬ç”¨ MM è¡¨ç¤ºæœˆä»½ï¼Œå¦‚æœä½¿ç”¨ MMMï¼Œåˆ™ä¼šæ ¹æ®è¯­è¨€ç¯å¢ƒæ˜¾ç¤ºä¸åŒè¯­è¨€çš„æœˆä»½</td><td>ä½¿ç”¨ MM è¡¨ç¤ºçš„æœˆä»½ï¼Œå¦‚ 05ï¼› ä½¿ç”¨ MMM è¡¨ç¤ºæœˆä»½ï¼Œåœ¨ Locale.CHINAè¯­è¨€ç¯å¢ƒä¸‹ï¼Œå¦‚â€œåæœˆâ€ï¼›åœ¨ Locale.US è¯­è¨€ç¯å¢ƒä¸‹ï¼Œå¦‚ Oct</td></tr><tr><td>d</td><td>æœˆä»½ä¸­çš„å¤©æ•°ã€‚ä¸€èˆ¬ç”¨ dd è¡¨ç¤ºå¤©æ•°</td><td>ä½¿ç”¨ dd è¡¨ç¤ºçš„å¤©æ•°ï¼Œå¦‚ 10</td></tr><tr><td>D</td><td>å¹´ä»½ä¸­çš„å¤©æ•°ã€‚è¡¨ç¤ºå½“å¤©æ˜¯å½“å¹´çš„ç¬¬å‡ å¤©ï¼Œ ç”¨ D è¡¨ç¤º</td><td>ä½¿ç”¨ D è¡¨ç¤ºçš„å¹´ä»½ä¸­çš„å¤©æ•°ï¼Œå¦‚ 295</td></tr><tr><td>E</td><td>æ˜ŸæœŸå‡ ã€‚ç”¨ E è¡¨ç¤ºï¼Œä¼šæ ¹æ®è¯­è¨€ç¯å¢ƒçš„ä¸åŒï¼Œ æ˜¾ç¤ºä¸ åŒè¯­è¨€çš„æ˜ŸæœŸå‡ </td><td>ä½¿ç”¨ E è¡¨ç¤ºæ˜ŸæœŸå‡ ï¼Œåœ¨ Locale.CHINA è¯­ è¨€ç¯å¢ƒä¸‹ï¼Œå¦‚â€œæ˜ŸæœŸå››â€ï¼›åœ¨Locale.US è¯­ è¨€ç¯å¢ƒä¸‹ï¼Œå¦‚ Thu</td></tr><tr><td>H</td><td>ä¸€å¤©ä¸­çš„å°æ—¶æ•°ï¼ˆ0~23)ã€‚ä¸€èˆ¬ç”¨ HH è¡¨ç¤ºå°æ—¶æ•°</td><td>ä½¿ç”¨ HH è¡¨ç¤ºçš„å°æ—¶æ•°ï¼Œå¦‚ 18</td></tr><tr><td>h</td><td>ä¸€å¤©ä¸­çš„å°æ—¶æ•°ï¼ˆ1~12)ã€‚ä¸€èˆ¬ä½¿ç”¨ hh è¡¨ç¤ºå°æ—¶æ•°</td><td>ä½¿ç”¨ hh è¡¨ç¤ºçš„å°æ—¶æ•°ï¼Œå¦‚ 10 (æ³¨æ„ 10 æœ‰ å¯èƒ½æ˜¯ 10 ç‚¹ï¼Œä¹Ÿå¯èƒ½æ˜¯ 22ç‚¹ï¼‰</td></tr><tr><td>m</td><td>åˆ†é’Ÿæ•°ã€‚ä¸€èˆ¬ä½¿ç”¨ mm è¡¨ç¤ºåˆ†é’Ÿæ•°</td><td>ä½¿ç”¨ mm è¡¨ç¤ºçš„åˆ†é’Ÿæ•°ï¼Œå¦‚ 29</td></tr><tr><td>s</td><td>ç§’æ•°ã€‚ä¸€èˆ¬ä½¿ç”¨ ss è¡¨ç¤ºç§’æ•°</td><td>ä½¿ç”¨ ss è¡¨ç¤ºçš„ç§’æ•°ï¼Œå¦‚ 38</td></tr><tr><td>S</td><td>æ¯«ç§’æ•°ã€‚ä¸€èˆ¬ä½¿ç”¨ SSS è¡¨ç¤ºæ¯«ç§’æ•°</td><td>ä½¿ç”¨ SSS è¡¨ç¤ºçš„æ¯«ç§’æ•°ï¼Œå¦‚ 156</td></tr></tbody></table><h3><span id="ä¾‹-1">ä¾‹ 1</span></h3><p>ç¼–å†™ Java ç¨‹åºï¼Œä½¿ç”¨ <code>SimpleDateFormat</code>ç±»æ ¼å¼åŒ–å½“å‰æ—¥æœŸå¹¶æ‰“å°ï¼Œæ—¥æœŸæ ¼å¼ä¸ºâ€œxxxx å¹´ xx æœˆ xx æ—¥æ˜ŸæœŸ xxx ç‚¹ xx åˆ†xx ç§’â€ï¼Œå…·ä½“çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test13</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Date</span> <span class="variable">now</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>(); <span class="comment">// åˆ›å»ºä¸€ä¸ªDateå¯¹è±¡ï¼Œè·å–å½“å‰æ—¶é—´</span></span><br><span class="line">        <span class="comment">// æŒ‡å®šæ ¼å¼åŒ–æ ¼å¼</span></span><br><span class="line">        <span class="type">SimpleDateFormat</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;ä»Šå¤©æ˜¯ &quot;</span> + <span class="string">&quot;yyyy å¹´ MM æœˆ dd æ—¥ E HH ç‚¹ mm åˆ† ss ç§’&quot;</span>);</span><br><span class="line">        System.out.println(f.format(now)); <span class="comment">// å°†å½“å‰æ—¶é—´è¢¼å¼åŒ–ä¸ºæŒ‡å®šçš„æ ¼å¼</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯¥ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»Šå¤©æ˜¯ 2018 å¹´ 10 æœˆ 15 æ—¥ æ˜ŸæœŸä¸€ 09 ç‚¹ 26 åˆ† 23 ç§’</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Android PackageManager ä½¿ç”¨ç®€å•è®°å½•</title>
      <link href="/2021/07/22/android/android-packagemanager-shi-yong-jian-dan-ji-lu/"/>
      <url>/2021/07/22/android/android-packagemanager-shi-yong-jian-dan-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>Androidä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªèƒ½å¤Ÿè·å–Packageçš„ä¿¡æ¯çš„ç±»<code>PackageManager</code>ï¼Œä»ä¸­æˆ‘ä»¬å¯ä»¥é€šè¿‡åŒ…åè·å–åˆ°ä¾‹å¦‚Appåç§°ï¼Œæ¡Œé¢å›¾æ ‡ç­‰åº”ç”¨ä¿¡æ¯ã€‚ç®€å•è®°å½•ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨PackageManagerè·å–å¯¹åº”çš„ä¿¡æ¯å§ã€‚</p><span id="more"></span><h4><span id="è·å–app-name">è·å–App Name</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getApplicationNameByPackageName</span><span class="params">(Context context, String packageName)</span> &#123;</span><br><span class="line">    <span class="type">PackageManager</span> <span class="variable">pm</span> <span class="operator">=</span> context.getPackageManager();</span><br><span class="line">    String Name;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Name = pm.getApplicationLabel(pm.getApplicationInfo(packageName, PackageManager.GET_META_DATA)).toString();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">        Name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="è·å–æ¡Œé¢å›¾æ ‡">è·å–æ¡Œé¢å›¾æ ‡</span></h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Drawable <span class="title function_">getAppIconByPacakgeName</span><span class="params">(Context context, String packageName)</span> &#123;</span><br><span class="line">    <span class="type">PackageManager</span> <span class="variable">pm</span> <span class="operator">=</span> context.getPackageManager();</span><br><span class="line">    Drawable icon;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        icon = pm.getApplicationIcon(packageName);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">        icon = ContextCompat.getDrawable(context, R.mipmap.ic_launcher);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> icon;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaè·å–å½“å¤©å¼€å§‹ç»“æŸæ—¶é—´</title>
      <link href="/2021/07/22/java/java-huo-qu-dang-tian-kai-shi-jie-shu-shi-jian/"/>
      <url>/2021/07/22/java/java-huo-qu-dang-tian-kai-shi-jie-shu-shi-jian/</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ç»™å®šä¸€ä¸ªæ—¶é—´æˆ³ï¼ŒJavaè·å–è¿™ä¸€å¤©å¼€å§‹å’Œç»“æŸæ—¶é—´çš„æ–¹æ³•ï¼Œä¸»è¦è¿˜æ˜¯æ²¡æœ‰ç³»ç»Ÿçš„å­¦ä¹ è¿‡Javaæ—¶é—´ç›¸å…³çš„ç±»å’Œä½¿ç”¨æ–¹æ³•</p><span id="more"></span><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è·å–æŒ‡å®šæŸä¸€å¤©çš„å¼€å§‹æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> timeStamp æ¯«ç§’çº§æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> timeZone  å¦‚ GMT+8:00</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getDailyStartTime</span><span class="params">(Long timeStamp, String timeZone)</span> &#123;</span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">    calendar.setTimeZone(TimeZone.getTimeZone(timeZone));</span><br><span class="line">    calendar.setTimeInMillis(timeStamp);</span><br><span class="line">    calendar.set(Calendar.HOUR_OF_DAY, <span class="number">0</span>);</span><br><span class="line">    calendar.set(Calendar.SECOND, <span class="number">0</span>);</span><br><span class="line">    calendar.set(Calendar.MINUTE, <span class="number">0</span>);</span><br><span class="line">    calendar.set(Calendar.MILLISECOND, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> calendar.getTimeInMillis();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è·å–æŒ‡å®šæŸä¸€å¤©çš„ç»“æŸæ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> timeStamp æ¯«ç§’çº§æ—¶é—´æˆ³</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> timeZone  å¦‚ GMT+8:00</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title function_">getDailyEndTime</span><span class="params">(Long timeStamp, String timeZone)</span> &#123;</span><br><span class="line">    <span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();</span><br><span class="line">    calendar.setTimeZone(TimeZone.getTimeZone(timeZone));</span><br><span class="line">    calendar.setTimeInMillis(timeStamp);</span><br><span class="line">    calendar.set(Calendar.HOUR_OF_DAY, <span class="number">23</span>);</span><br><span class="line">    calendar.set(Calendar.MINUTE, <span class="number">59</span>);</span><br><span class="line">    calendar.set(Calendar.SECOND, <span class="number">59</span>);</span><br><span class="line">    calendar.set(Calendar.MILLISECOND, <span class="number">999</span>);</span><br><span class="line">    <span class="keyword">return</span> calendar.getTimeInMillis();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…³äº<code>TimeZone</code>çš„ç”¨æ³•å¯ä»¥å‚è€ƒ<a href="https://www.jb51.net/article/85930.htm#:~:text=TimeZoneå¯ä»¥ç”¨æ¥è·å–æˆ–è€…è§„å®šæ—¶åŒº%2Cä¹Ÿå¯ä»¥ç”¨æ¥è®¡ç®—æ—¶å·®%2Cè¿™é‡Œæˆ‘ä»¬å°±æ¥è¯¦è§£Javaä¸­çš„æ—¶åŒºç±»TimeZoneçš„ç”¨æ³•%2Cç‰¹åˆ«è¦æ³¨æ„ä¸‹é¢æ‰€æåˆ°çš„TimeZoneç›¸å…³çš„æ—¶é—´æ ¡å‡†é—®é¢˜.%20TimeZone%20è¡¨ç¤ºæ—¶åŒºåç§»é‡ï¼Œä¹Ÿå¯ä»¥è®¡ç®—å¤ä»¤æ—¶ã€‚%20åœ¨æ“ä½œ%20Date%2C%20Calendarç­‰è¡¨ç¤ºæ—¥æœŸ%2Fæ—¶é—´çš„å¯¹è±¡æ—¶ï¼Œç»å¸¸ä¼šç”¨åˆ°TimeZoneï¼›å› ä¸ºä¸åŒçš„æ—¶åŒºï¼Œæ—¶é—´ä¸åŒã€‚%20ä¸‹é¢è¯´è¯´TimeZoneå¯¹è±¡çš„,2ç§å¸¸ç”¨åˆ›å»ºæ–¹å¼ã€‚%20å…³äº%20getTimeZone%20(String%20id)%20è¿™ç§æ–¹å¼æ”¯æŒçš„å…¨éƒ¨idå‚æ•°çš„å–å€¼ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æŸ¥æ‰¾ï¼š%20ä¾‹å¦‚ï¼Œåˆ›å»ºä¸Šé¢ç¬¬2ä¸ªæ‰“å°å€¼%22Etc%2FGMT%2B11%22å¯¹åº”çš„TimeZoneã€‚%20æ–¹æ³•å¦‚ä¸‹ï¼š">è¯¦è§£Javaä¸­çš„æ—¶åŒºç±»TimeZoneçš„ç”¨æ³•_java_è„šæœ¬ä¹‹å®¶(jb51.net)</a>ï¼Œè·å–é»˜è®¤<code>TimeZone</code>å¯ä»¥ä½¿ç”¨<code>TimeZone.getDefault().getID()</code>ã€‚</p><p>åŸæ–‡æ¥è‡ªäº<a href="https://www.cnblogs.com/lingyejun/p/11298186.html">Javaè·å–å½“å¤©ã€å½“å‰æœˆã€å½“å‰å¹´(ä»Šå¹´)çš„å¼€å§‹å’Œç»“æŸæ—¶é—´æˆ³- ç¿é‡ - åšå®¢å›­</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>138. å¤åˆ¶å¸¦éšæœºæŒ‡é’ˆçš„é“¾è¡¨</title>
      <link href="/2021/07/22/leetcode/138-fu-zhi-dai-sui-ji-zhi-zhen-de-lian-biao/"/>
      <url>/2021/07/22/leetcode/138-fu-zhi-dai-sui-ji-zhi-zhen-de-lian-biao/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º n çš„é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åŒ…å«ä¸€ä¸ªé¢å¤–å¢åŠ çš„éšæœºæŒ‡é’ˆ randomï¼Œè¯¥æŒ‡é’ˆå¯ä»¥æŒ‡å‘é“¾è¡¨ä¸­çš„ä»»ä½•èŠ‚ç‚¹æˆ–ç©ºèŠ‚ç‚¹ã€‚</p><p>æ„é€ è¿™ä¸ªé“¾è¡¨çš„ æ·±æ‹·è´ã€‚ æ·±æ‹·è´åº”è¯¥æ­£å¥½ç”± n ä¸ª å…¨æ–°èŠ‚ç‚¹ç»„æˆï¼Œå…¶ä¸­æ¯ä¸ªæ–°èŠ‚ç‚¹çš„å€¼éƒ½è®¾ä¸ºå…¶å¯¹åº”çš„åŸèŠ‚ç‚¹çš„å€¼ã€‚æ–°èŠ‚ç‚¹çš„ nextæŒ‡é’ˆå’Œ randomæŒ‡é’ˆä¹Ÿéƒ½åº”æŒ‡å‘å¤åˆ¶é“¾è¡¨ä¸­çš„æ–°èŠ‚ç‚¹ï¼Œå¹¶ä½¿åŸé“¾è¡¨å’Œå¤åˆ¶é“¾è¡¨ä¸­çš„è¿™äº›æŒ‡é’ˆèƒ½å¤Ÿè¡¨ç¤ºç›¸åŒçš„é“¾è¡¨çŠ¶æ€ã€‚å¤åˆ¶é“¾è¡¨ä¸­çš„æŒ‡é’ˆéƒ½ä¸åº”æŒ‡å‘åŸé“¾è¡¨ä¸­çš„èŠ‚ç‚¹ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœåŸé“¾è¡¨ä¸­æœ‰ X å’Œ Y ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ <code>X.randomâ†’Y</code>ã€‚é‚£ä¹ˆåœ¨å¤åˆ¶é“¾è¡¨ä¸­å¯¹åº”çš„ä¸¤ä¸ªèŠ‚ç‚¹ x å’Œ y ï¼ŒåŒæ ·æœ‰ <code>x.randomâ†’y</code>ã€‚</p><p>è¿”å›å¤åˆ¶é“¾è¡¨çš„å¤´èŠ‚ç‚¹ã€‚</p><span id="more"></span><p>ç”¨ä¸€ä¸ªç”± n ä¸ªèŠ‚ç‚¹ç»„æˆçš„é“¾è¡¨æ¥è¡¨ç¤ºè¾“å…¥/è¾“å‡ºä¸­çš„é“¾è¡¨ã€‚æ¯ä¸ªèŠ‚ç‚¹ç”¨ä¸€ä¸ª[val, random_index] è¡¨ç¤ºï¼š</p><p><code>val</code>ï¼šä¸€ä¸ªè¡¨ç¤º <code>Node.val</code>çš„æ•´æ•°ã€‚random_indexï¼šéšæœºæŒ‡é’ˆæŒ‡å‘çš„èŠ‚ç‚¹ç´¢å¼•ï¼ˆèŒƒå›´ä» 0 åˆ°n-1ï¼‰ï¼›å¦‚æœä¸æŒ‡å‘ä»»ä½•èŠ‚ç‚¹ï¼Œåˆ™ä¸º null ã€‚ ä½ çš„ä»£ç  åª æ¥å—åŸé“¾è¡¨çš„å¤´èŠ‚ç‚¹head ä½œä¸ºä¼ å…¥å‚æ•°ã€‚</p><p>ç¤ºä¾‹ 1ï¼š</p><figure><img src="https://i.loli.net/2021/07/22/PuImxiYAStbcj3O.png" alt="138_example1"><figcaption aria-hidden="true">138_example1</figcaption></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;è¾“å…¥ï¼šhead = [[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br><span class="line">&gt;è¾“å‡ºï¼š[[7,null],[13,0],[11,4],[10,2],[1,0]]</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="comment">// Definition for a Node.</span></span><br><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">   <span class="type">int</span> val;</span><br><span class="line">   Node next;</span><br><span class="line">   Node random;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">          <span class="built_in">this</span>.val = val;</span><br><span class="line">          <span class="built_in">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">          <span class="built_in">this</span>.random = <span class="literal">null</span>;</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>çœ‹åˆ°è¿™é“é¢˜ç¬¬ä¸€ä¸ªååº”å°±æ˜¯è¿™ä¸ªé“¾è¡¨ä¸æ˜¯ä¸€ä¸ªæ™®é€šçš„é“¾è¡¨ï¼Œæœ¬è´¨ä¸Šå®ƒå¯ä»¥è½¬åŒ–ä¸ºæœ‰å‘å›¾ï¼Œæ‰€ä»¥è¿™é“é¢˜æœ¬è´¨å¯ä»¥è¯´æ˜¯å›¾çš„æ·±æ‹·è´ã€‚ä¸‹é¢è¿™å¼ å›¾å°±æ˜¯æˆ‘ä»¬å°†è¿™ä¸ªé“¾è¡¨è½¬åŒ–ä¸ºä¸€å¼ å›¾ä¹‹åçš„æ ·å­ã€‚</p><figure><img src="https://i.loli.net/2021/07/22/PBhuRnt3eiOqKAN.png" alt="138_diagram"><figcaption aria-hidden="true">138_diagram</figcaption></figure><p>æ‰€ä»¥ï¼Œç”±æ­¤æˆ‘ä»¬å¯ä»¥é‡‡å–ç±»ä¼¼BFSçš„æ€è·¯å¯¹è¿™ä¸ªé“¾è¡¨è¿›è¡Œæ·±æ‹·è´ã€‚å½“éå†åˆ°ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å’ŒéšæœºèŠ‚ç‚¹åˆ†åˆ«è¿›è¡Œæ‹·è´ã€‚ä¸ºäº†ä¿è¯ä¸€ä¸ªä¸ä¼šé‡å¤æ‹·è´å·²ç»æ‹·è´è¿‡çš„èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å“ˆå¸Œè¡¨å¯¹èŠ‚ç‚¹çš„æ‹·è´æƒ…å†µè¿›è¡Œè®°å½•ã€‚ä»¥ä¸‹æ˜¯ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;Node,Node&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Node,Node&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!map.containsKey(head)) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">newHead</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(head.val);</span><br><span class="line">            map.put(head, newHead);</span><br><span class="line">            newHead.next = copyRandomList(head.next);</span><br><span class="line">            newHead.random = copyRandomList(head.random);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map.get(head);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦å¤–ä¸€ç§æ€è·¯æ˜¯åœ¨è¯„è®ºåŒºé‡Œçœ‹åˆ°çš„ï¼Œæ„Ÿè§‰ä¹Ÿéå¸¸çš„å®¹æ˜“ç†è§£ï¼Œä¹Ÿè®°å½•ä¸€ä¸‹ã€‚æ€è·¯éå¸¸æ¸…æ™°ï¼Œé¦–å…ˆéå†ä¸€éé“¾è¡¨ï¼Œæ‹·è´æ¯ä¸ªèŠ‚ç‚¹çš„å€¼åˆ°æ–°èŠ‚ç‚¹ä¸­ï¼Œå¹¶ä¸”æ”¾å…¥å“ˆå¸Œè¡¨ä¸­è®°å½•ï¼Œä½†æ˜¯å¹¶æ‹·è´èŠ‚ç‚¹çš„ä¸¤ä¸ªæŒ‡é’ˆã€‚ç„¶åç¬¬äºŒæ¬¡éå†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ–°åˆ›å»ºçš„æ¯ä¸ªæŒ‡é’ˆçš„èŠ‚ç‚¹éƒ½å‚¨å­˜åœ¨å“ˆå¸Œè¡¨ä¸­äº†ï¼Œæˆ‘ä»¬å°±ç›´æ¥å¯ä»¥ç”¨<code>next</code>å’Œ<code>random</code>æŒ‡é’ˆç›´æ¥æŒ‡å‘äº†ã€‚æ€»ä½“çš„æ€è·¯å°±æ˜¯ï¼Œå…ˆåˆ›å»ºå•ä¸ªèŠ‚ç‚¹ï¼Œå†å°†ä»–ä»¬è¿æ¥èµ·æ¥ã€‚ä¸‹é¢æ˜¯ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Node <span class="title function_">copyRandomList</span><span class="params">(Node head)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        Map&lt;Node,Node&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Node,Node&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> head; node != <span class="literal">null</span>; node = node.next) &#123;</span><br><span class="line">            map.put(node, <span class="keyword">new</span> <span class="title class_">Node</span>(node.val));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> head; node != <span class="literal">null</span>; node = node.next) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">newNode</span> <span class="operator">=</span> map.get(node);</span><br><span class="line">            newNode.next = map.get(node.next);</span><br><span class="line">            newNode.random = map.get(node.random);</span><br><span class="line">            map.put(node, newNode);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> map.get(head);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="é™„">é™„</span></h2><p>æ³¨æ„åˆ°ç¬¬ä¸€ç§è§£æ³•çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå°†<code>newNode</code>åŠ å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œä¹‹åå†æ”¹å˜å®ƒçš„ä¸¤ä¸ªæŒ‡é’ˆï¼Œç”±æ­¤å¯ä»¥åˆ¤æ–­å‡ºæˆ‘ä»¬åŠ å…¥å“ˆå¸Œè¡¨ä¸­çš„Objectå®é™…ä¸Šåº”è¯¥æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬æ”¹å˜åŸæœ¬çš„å€¼å°±ä¼šç›´æ¥å½±å“åˆ°å“ˆå¸Œè¡¨ä¸­å­˜å‚¨çš„å€¼ï¼Œå†™äº†ä»¥ä¸‹ä»£ç è¿›è¡ŒéªŒè¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">            Node next;</span><br><span class="line">            <span class="type">int</span> val;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">                <span class="built_in">this</span>.val = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Map&lt;Node, Node&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="number">2</span>);</span><br><span class="line">        node1.next = node2;</span><br><span class="line">        node2.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(node1.val);</span><br><span class="line">        map.put(node1, newNode);</span><br><span class="line">        newNode.val = <span class="number">4</span>;</span><br><span class="line">        newNode.next = node2;</span><br><span class="line">        System.out.println(map.get(node1).val);</span><br><span class="line">        System.out.println(map.get(node1).next.val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">* 4</span></span><br><span class="line"><span class="comment">* 2</span></span><br><span class="line"><span class="comment">/</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> Java </tag>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰‘æŒ‡ Offer 52. ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹</title>
      <link href="/2021/07/21/leetcode/jian-zhi-offer-52-liang-ge-lian-biao-de-di-yi-ge-gong-gong-jie-dian/"/>
      <url>/2021/07/21/leetcode/jian-zhi-offer-52-liang-ge-lian-biao-de-di-yi-ge-gong-gong-jie-dian/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>æ¯”è¾ƒç»å…¸çš„ç®€å•é¢˜ç›®ï¼Œç¨å¾®è®°å½•ä¸€ä¸‹æ€è·¯</p><blockquote><p>è¾“å…¥ä¸¤ä¸ªé“¾è¡¨ï¼Œæ‰¾å‡ºå®ƒä»¬çš„ç¬¬ä¸€ä¸ªå…¬å…±èŠ‚ç‚¹ã€‚</p><p>å¦‚ä¸‹é¢çš„ä¸¤ä¸ªé“¾è¡¨ï¼š</p><figure><img src="https://i.loli.net/2021/07/21/uiplfmB3PqCkht6.png" alt="160_statement"><figcaption aria-hidden="true">160_statement</figcaption></figure><p>åœ¨èŠ‚ç‚¹ c1 å¼€å§‹ç›¸äº¤ã€‚</p><span id="more"></span><p>ç¤ºä¾‹ 1ï¼š</p><figure><img src="https://i.loli.net/2021/07/21/PdIR6xC4V7Uhp3o.png" alt="160_example_1"><figcaption aria-hidden="true">160_example_1</figcaption></figure><p>è¾“å…¥ï¼šintersectVal = 8, listA = [4,1,8,4,5], listB = [5,0,1,8,4,5],skipA = 2, skipB = 3 è¾“å‡ºï¼šReference of the node with value = 8è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 8 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [4,1,8,4,5]ï¼Œé“¾è¡¨ B ä¸º[5,0,1,8,4,5]ã€‚åœ¨ A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3ä¸ªèŠ‚ç‚¹ã€‚</p><p>ç¤ºä¾‹ 2ï¼š</p><figure><img src="https://i.loli.net/2021/07/21/3ZU2Afnc5eNs9rk.png" alt="160_example_2"><figcaption aria-hidden="true">160_example_2</figcaption></figure><p>è¾“å…¥ï¼šintersectVal = 2, listA = [0,9,1,2,4], listB = [3,2,4], skipA =3, skipB = 1 è¾“å‡ºï¼šReference of the node with value = 2è¾“å…¥è§£é‡Šï¼šç›¸äº¤èŠ‚ç‚¹çš„å€¼ä¸º 2 ï¼ˆæ³¨æ„ï¼Œå¦‚æœä¸¤ä¸ªåˆ—è¡¨ç›¸äº¤åˆ™ä¸èƒ½ä¸º0ï¼‰ã€‚ä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º [0,9,1,2,4]ï¼Œé“¾è¡¨ B ä¸º [3,2,4]ã€‚åœ¨A ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼›åœ¨ B ä¸­ï¼Œç›¸äº¤èŠ‚ç‚¹å‰æœ‰ 1 ä¸ªèŠ‚ç‚¹ã€‚</p><p>ç¤ºä¾‹ 3ï¼š</p><figure><img src="https://i.loli.net/2021/07/21/GTQD9AjXB2nJzyh.png" alt="160_example_3"><figcaption aria-hidden="true">160_example_3</figcaption></figure><p>è¾“å…¥ï¼šintersectVal = 0, listA = [2,6,4], listB = [1,5], skipA = 3,skipB = 2 è¾“å‡ºï¼šnull è¾“å…¥è§£é‡Šï¼šä»å„è‡ªçš„è¡¨å¤´å¼€å§‹ç®—èµ·ï¼Œé“¾è¡¨ A ä¸º[2,6,4]ï¼Œé“¾è¡¨ B ä¸º [1,5]ã€‚ç”±äºè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œæ‰€ä»¥ intersectVal å¿…é¡»ä¸º0ï¼Œè€Œ skipA å’Œ skipB å¯ä»¥æ˜¯ä»»æ„å€¼ã€‚ è§£é‡Šï¼šè¿™ä¸¤ä¸ªé“¾è¡¨ä¸ç›¸äº¤ï¼Œå› æ­¤è¿”å›nullã€‚</p></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>è¿™é“é¢˜é‡‡ç”¨åŒæŒ‡é’ˆçš„æ€æƒ³å°±å¯ä»¥è½»æ¾è§£å†³ã€‚æˆ‘ä»¬æ³¨æ„åˆ°ï¼Œæ— è®ºæŒ‡é’ˆä»å“ªä¸ªç«¯ç‚¹å‡ºå‘ï¼Œéå†ä¸¤ä¸ªé“¾è¡¨ä¸€å…±èµ°çš„æ­¥æ•°æ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä»–ä»¬å»é™¤ä»–ä»¬çš„å…¬å…±éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«ä»Aå’ŒBçš„å¤´å‡ºå‘çš„è¯ï¼Œæœ€åä»–ä»¬ä¸€å®šä¼šåŒæ—¶åˆ°è¾¾ç¬¬ä¸€ä¸ªç›¸äº¤çš„å…¬å…±èŠ‚ç‚¹ã€‚å¹¶ä¸”ï¼Œå¦‚æœè¯´è¿™ä¸¤ä¸ªé“¾è¡¨æ²¡æœ‰å…¬å…±èŠ‚ç‚¹ï¼Œé‚£ä¹ˆä»–ä»¬æœ€åä¸€å®šä¼šåŒæ—¶åˆ°è¾¾ä¸¤ä¸ªé“¾è¡¨çš„æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯<code>null</code>ã€‚æ€è·¯å‡ºæ¥äº†ï¼Œä»£ç ä¹Ÿå°±å¾ˆå®¹æ˜“äº†ï¼Œæ—¶é—´å¤æ‚åº¦<strong>O(N)</strong>ï¼Œç©ºé—´å¤æ‚åº¦<strong>O(1)</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">nodeA</span> <span class="operator">=</span> headA, nodeB = headB;</span><br><span class="line">        <span class="keyword">if</span> (nodeA == <span class="literal">null</span> || nodeB == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (nodeA != nodeB) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nodeA == <span class="literal">null</span>) nodeA = headB;</span><br><span class="line">            <span class="keyword">else</span> nodeA = nodeA.next;</span><br><span class="line">            <span class="keyword">if</span> (nodeB == <span class="literal">null</span>) nodeB = headA;</span><br><span class="line">            <span class="keyword">else</span> nodeB = nodeB.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nodeA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> LeetCode </tag>
            
            <tag> Java </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NexTä¸»é¢˜é…ç½®è®°å½•</title>
      <link href="/2021/07/18/other/next-zhu-ti-pei-zhi-ji-lu/"/>
      <url>/2021/07/18/other/next-zhu-ti-pei-zhi-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>åŸæ¥æŠ˜è…¾äº†å¾ˆä¹…çš„Yiliaä¸»é¢˜ï¼Œç„¶è€Œæäº†åŠå¤©ç»ˆäºè¿˜æ˜¯æ¥åˆ°äº†NexTçš„æ€€æŠ±ï¼ŒNexTæä¾›çš„åŠŸèƒ½ç›¸æ¯”äºYiliaç¡®å®å¤šäº†ä¸å°‘ï¼Œè¿™ç¯‡å°±ä½œä¸ºä¸€ä¸ªè®°å½•ï¼Œç¨å¾®è®°è½½ä¸‹NexTä¸­çš„ä¸€äº›é…ç½®å§ã€‚</p><hr><p>2022.9.10 æ›´æ–° ä»¥åæ‰“ç®—å°±åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹å¯¹åšå®¢çš„æ›´æ–°æƒ…å†µ<span id="more"></span></p><ul><li><label><input type="checkbox">è‹±æ–‡ç‰ˆç½‘é¡µï¼Œè‹±æ–‡è¡Œè·å­—ä½“ç­‰ç­‰</label></li><li>2024.9.18 æ›´æ–°ä½œå“é›†é¡µé¢(AIçœŸå¥½ç”¨)</li><li>2024.2.15 ä¿®æ”¹é»˜è®¤å­—ä½“</li><li>2023.12.24æ·»åŠ twentytwentyå›¾ç‰‡å¯¹æ¯”æ’ä»¶ï¼Œä½†æ˜¯ä»æœ‰å¾ˆå¤šé—®é¢˜æœ‰å¾…è§£å†³</li><li>2022.12.5æ·»åŠ hexo-auto-categoryï¼Œè‡ªåŠ¨æ ¹æ®æ–‡ä»¶å¤¹ç›®å½•è®¾ç½®categories</li><li>2022.9.11 ä¸­è‹±æ–‡åˆ‡æ¢åŠŸèƒ½ï¼Œä¸­è‹±æ–‡æ¿å—åˆ†ç¦»;</li><li>2022.9.10 å¢åŠ Portfolioé¡µé¢; æ·»åŠ DarkModeä»¥åŠåˆ‡æ¢åŠŸèƒ½;</li><li>2021.7.18 åˆ‡æ¢ä¸»é¢˜ä¸ºNextä¸»é¢˜å¹¶è¿›è¡Œé…ç½®;</li></ul><h2><span id="ä¿®æ”¹é»˜è®¤å­—ä½“">ä¿®æ”¹é»˜è®¤å­—ä½“</span></h2><p>Nextçš„é…ç½®é¡¹ä¸­å¯ä»¥ç›´æ¥å¯¹å­—ä½“è¿›è¡Œæ›´æ”¹ï¼Œç›¸å…³é…ç½®å¦‚ä¸‹ <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Font Settings</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Find fonts on Google Fonts (https://fonts.google.com)</span></span><br><span class="line"><span class="comment"># All fonts set here will have the following styles:</span></span><br><span class="line"><span class="comment">#   light | light italic | normal | normal italic | bold | bold italic</span></span><br><span class="line"><span class="comment"># Be aware that setting too much fonts will cause site running slowly</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"><span class="comment"># Web Safe fonts are recommended for `global` (and `title`):</span></span><br><span class="line"><span class="comment"># Arial | Tahoma | Helvetica | Times New Roman | Courier New | Verdana | Georgia | Palatino | Garamond | Comic Sans MS | Trebuchet MS</span></span><br><span class="line"><span class="comment"># ---------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="attr">font:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="string">enable</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Uri of fonts host, e.g. https://fonts.googleapis.com (Default).</span></span><br><span class="line">  <span class="attr">host:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font options:</span></span><br><span class="line">  <span class="comment"># `external: true` will load this font family from `host` above.</span></span><br><span class="line">  <span class="comment"># `family: Times New Roman`. Without any quotes.</span></span><br><span class="line">  <span class="comment"># `size: x.x`. Use `em` as unit. Default: 1 (16px)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Global font settings used for all elements inside &lt;body&gt;.</span></span><br><span class="line">  <span class="attr">global:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Inter</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for site title (.site-title).</span></span><br><span class="line">  <span class="attr">title:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Noto</span> <span class="string">Serif</span> <span class="string">SC</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;).</span></span><br><span class="line">  <span class="attr">headings:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Noto</span> <span class="string">Serif</span> <span class="string">SC</span></span><br><span class="line">    <span class="attr">size:</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for posts (.post-body).</span></span><br><span class="line">  <span class="attr">posts:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Noto</span> <span class="string">Serif</span> <span class="string">SC</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Font settings for &lt;code&gt; and code blocks.</span></span><br><span class="line">  <span class="attr">codes:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">family:</span> <span class="string">Fira</span> <span class="string">Code</span></span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ç›´æ¥ç»Ÿä¸€è°ƒæˆäº†ä¸­æ–‡å­—ä½“ï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯æœ‰ç‚¹æƒ³è¦ä¸­è‹±æ–‡å­—ä½“è¿›è¡Œä¸€ä¸‹åŒºåˆ†ï¼Œå‚è€ƒ<a href="https://bambrow.com/20200718-hexo-next-font-settings/">Hexo NexTä¸»é¢˜çš„å­—ä½“æ›´æ¢</a>ï¼Œä½†æ˜¯æœ€åæ²¡æœ‰æˆåŠŸä¸çŸ¥é“ä¸ºä»€ä¹ˆã€‚</p><h2><span id="hexoå›¾ç‰‡å¯¹æ¯”æ’ä»¶">Hexoå›¾ç‰‡å¯¹æ¯”æ’ä»¶</span></h2><p>ä½œä¸ºä¸€ä¸ªå›¾å½¢å­¦é€‰æ‰‹ï¼Œæ¸²æŸ“çš„ç»“æœç»å¸¸éœ€è¦è¿›è¡Œå¯¹æ¯”ã€‚jQueryçš„twentytwentyæ’ä»¶èƒ½å¤Ÿæ–¹ä¾¿çš„æä¾›åŒå›¾ä»¥è‡³å››å›¾çš„å¯¹æ¯”ï¼Œæ‰€ä»¥æˆ‘å°±è¯•å›¾å¯»æ‰¾ä¸€ä¸ªæ’ä»¶å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚<a href="https://github.com/tea3/hexo-tag-twentytwenty">hexo-tag-twentytwenty</a>åˆšå¥½å¯ä»¥ã€‚ä½†æ˜¯è¿™ä¸ªæ’ä»¶è¿˜æœ‰ä¸€äº›é—®é¢˜ï¼ŒæŒ‰ç…§githubä¸Šçš„æè¿°ä»cdnä¸­åŠ è½½twentytwenty.jsæ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ä¼¼ä¹è¿™ä¸ªç‰ˆæœ¬å¹¶ä¸æ˜¯å¾ˆå¥½ï¼Œåœ¨cdnä¸Šä¹Ÿå¹¶æ²¡æœ‰æ‰¾åˆ°ä¸€ä¸ªæ›´å¥½çš„å…¶ä»–çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªç‰ˆæœ¬çš„é—®é¢˜åœ¨äºï¼Œä¸€æ— æ³•å±…ä¸­å¯¹é½ï¼ŒäºŒæ— æ³•è®¾ç½®<code>alt</code>å‚æ•°ã€‚æˆ‘åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªæˆ‘æœŸæœ›çš„twentytwentyç‰ˆæœ¬ï¼Œä½†æ˜¯å°è¯•å„ç§æ–¹æ³•ä¹‹åï¼Œå‘ç°éƒ½å¾ˆéš¾é€šè¿‡æœ¬åœ°è·¯å¾„åµŒå…¥åˆ°é™æ€ç½‘é¡µå½“ä¸­å»ï¼Œæ„Ÿè§‰è‚¯å®šæ˜¯æœ‰åŠæ³•çš„ï¼Œä½†æ˜¯ç¡®å®ä¸æ˜¯å¾ˆç†Ÿæ‚‰ã€‚ä»¥åå¦‚æœæœ‰ç©ºå†å°è¯•å°è¯•å§ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªæ’ä»¶å¤ªè€äº†ï¼Œè€Œä¸”ç°åœ¨çš„nextæ²¡æœ‰äº†jqueryï¼Œæ‰€ä»¥åœ¨ä»–çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€äº›æ›´æ”¹ã€‚ä»£ç å¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&#x27;use strict&#x27;</span>;</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">filter</span>.<span class="title function_">register</span>(<span class="string">&#x27;theme_inject&#x27;</span>, <span class="keyword">function</span> (<span class="params">injects</span>) &#123;</span><br><span class="line">  injects.<span class="property">postBodyEnd</span>.<span class="title function_">raw</span>(<span class="string">&#x27;jquery&#x27;</span>, <span class="string">&#x27;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.0/jquery.min.js&quot;&gt;&lt;/script&gt;&#x27;</span>, &#123;&#125;, &#123; <span class="attr">cache</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  injects.<span class="property">postBodyEnd</span>.<span class="title function_">raw</span>(<span class="string">&#x27;jquerymove&#x27;</span>, <span class="string">&#x27;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/mhayes-twentytwenty/1.0.0/js/jquery.event.move.min.js&quot;&gt;&lt;/script&gt;&#x27;</span>, &#123;&#125;, &#123; <span class="attr">cache</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  injects.<span class="property">postBodyEnd</span>.<span class="title function_">raw</span>(<span class="string">&#x27;twtwscript&#x27;</span>, <span class="string">&#x27;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/mhayes-twentytwenty/1.0.0/js/jquery.twentytwenty.min.js&quot;&gt;&lt;/script&gt;&#x27;</span>, &#123;&#125;, &#123; <span class="attr">cache</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  injects.<span class="property">postBodyEnd</span>.<span class="title function_">raw</span>(<span class="string">&#x27;twtwcss&#x27;</span>, <span class="string">&#x27;&lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/mhayes-twentytwenty/1.0.0/css/twentytwenty.min.css&quot;/&gt;&#x27;</span>, &#123;&#125;, &#123; <span class="attr">cache</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">  injects.<span class="property">postBodyEnd</span>.<span class="title function_">file</span>(<span class="string">&#x27;twtwscripts&#x27;</span>, <span class="string">&#x27;js/twtw.swig&#x27;</span>, &#123;&#125;, &#123; <span class="attr">cache</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">hexo.<span class="property">extend</span>.<span class="property">tag</span>.<span class="title function_">register</span>(<span class="string">&#x27;twtw&#x27;</span>, <span class="keyword">function</span>(<span class="params">args, content</span>)&#123;</span><br><span class="line">  <span class="keyword">var</span> beforeImg       = args[<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">var</span> afterImg        = args[<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">var</span> imgWidth        = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> maxWidth        = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">var</span> imgHeight       = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(args.<span class="property">length</span> &gt; <span class="number">2</span>)&#123;</span><br><span class="line">    imgWidth = <span class="string">&#x27; data-width=&quot;&#x27;</span> + args[<span class="number">2</span>] + <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">    maxWidth = <span class="string">&#x27; style=&quot;max-width:&#x27;</span> + args[<span class="number">2</span>] + <span class="string">&#x27;px&quot;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(args.<span class="property">length</span> &gt; <span class="number">3</span>)&#123;</span><br><span class="line">    imgHeight = <span class="string">&#x27; data-height=&quot;&#x27;</span> + args[<span class="number">3</span>] + <span class="string">&#x27;&quot;&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> returnHTML  = <span class="string">&#x27;&lt;div class=&quot;twentytwenty-container&quot;&#x27;</span> + maxWidth + <span class="string">&#x27;&gt;\n&#x27;</span></span><br><span class="line">            + <span class="string">&#x27;&lt;img src=&quot;&#x27;</span>+ beforeImg +<span class="string">&#x27;&quot;&#x27;</span> + imgWidth + imgHeight + <span class="string">&#x27;&gt;\n&#x27;</span></span><br><span class="line">            + <span class="string">&#x27;&lt;img src=&quot;&#x27;</span>+ afterImg +<span class="string">&#x27;&quot;&#x27;</span> + imgWidth + imgHeight + <span class="string">&#x27;&gt;\n&#x27;</span></span><br><span class="line">            + <span class="string">&#x27;&lt;/div&gt;&#x27;</span>;</span><br><span class="line">  <span class="keyword">return</span> returnHTML;</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">async</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">ends</span>: <span class="literal">false</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>å¹¶ä¸”åœ¨<code>styles.styl</code>ä¸­éœ€è¦æ·»åŠ ä»¥ä¸‹æ ¼å¼</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.post-body</span> <span class="selector-class">.twentytwenty-container</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: auto</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.post-body</span> <span class="selector-class">.twentytwenty-container</span> <span class="selector-tag">img</span> &#123;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">0px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨æ ¹ç›®å½•ä¸‹æ·»åŠ <code>js/twtw.swig</code>ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥è‡ªè¡Œæ›´æ”¹è·¯å¾„å’Œåç§°æ²¡æœ‰ä»€ä¹ˆè§„å®šã€‚<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">  $(<span class="variable language_">document</span>).<span class="title function_">ready</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">initialize_twentytwenty</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  );</span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">function</span> <span class="title function_">initialize_twentytwenty</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">if</span>($(<span class="string">&quot;.twentytwenty-container&quot;</span>).<span class="property">twentytwenty</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">      $(<span class="string">&quot;.twentytwenty-container&quot;</span>).<span class="title function_">twentytwenty</span>();</span></span><br><span class="line"><span class="language-javascript">    &#125;<span class="keyword">else</span>&#123;</span></span><br><span class="line"><span class="language-javascript">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">initialize_twentytwenty</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;,<span class="number">250</span>);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">  &#125;</span></span><br><span class="line"><span class="language-javascript">&#125;)();</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ç¬¬ä¸€è¡Œcsså°±æ˜¯å°è¯•è®©å›¾ç‰‡å±…ä¸­ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¸ºå›¾ç‰‡è®¾ç½®åˆé€‚å¤§å°çš„widthï¼Œæ‰èƒ½æ­£å¸¸å±…ä¸­ï¼Œå¦åˆ™å› ä¸º<code>twentytwenty-container</code>é»˜è®¤æ˜¯fullwidthï¼Œä¼šå æ®æ•´ä¸ªé¡µé¢ï¼Œè€Œå›¾ç‰‡åœ¨å³ä¾§ï¼Œåªèƒ½æš‚æ—¶é€šè¿‡è¿™ç§æ–¹å¼è§£å†³ï¼Œæ›´åŠ åˆç†çš„è§£å†³åŠæ³•è¿˜æœ‰å¾…ç ”ç©¶ã€‚å¦å¤–ç›®å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œä¼¼ä¹ä¸¤è¾¹çš„å›¾ç‰‡æœ‰ç‚¹è‰²å·®ï¼Œä¸çŸ¥é“æ˜¯ä»€ä¹ˆå¯¼è‡´çš„é—®é¢˜â€¦â€¦ä¸è¿‡ä¹Ÿåªèƒ½å…ˆå‡‘æ´»ç€ç”¨ç€</p><h2><span id="hexoåšå®¢ä¸­è‹±æ–‡æ¿å—ä»¥åŠåˆ‡æ¢">Hexoåšå®¢ä¸­è‹±æ–‡æ¿å—ä»¥åŠåˆ‡æ¢</span></h2><p>ç”±äºä¸€äº›åŸå› å‡†å¤‡ç»™åšå®¢æ·»åŠ è‹±æ–‡æ¿å—ï¼Œä¸»è¦æƒ³è¦å®ç°çš„åŠŸèƒ½æ˜¯ä¸­è‹±æ–‡æ¿å—å•ç‹¬åˆ†ç¦»ï¼Œç”¨æˆ·åœ¨ç‚¹å‡»ä¸­è‹±æ–‡åˆ‡æ¢çš„æŒ‰é’®åè·³è½¬åˆ°å¯¹åº”çš„é¡µé¢ã€‚NextåŸæœ¬å°±æ”¯æŒåŒè¯­åˆ‡æ¢ï¼Œä½†æ˜¯åªæœ‰Menuç­‰å°‘éƒ¨åˆ†å…ƒç´ çš„åˆ‡æ¢ï¼Œå¹¶ä¸æ˜¯æƒ³è¦çš„æ•ˆæœã€‚åœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆå¤šç›¸å…³çš„èµ„æ–™ï¼Œæœ€ç»ˆå†³å®šè¿˜æ˜¯ä½¿ç”¨æœ€ç®€å•çš„åŠæ³•ï¼šåœ¨githubä¸­åˆ›ä¸¤ä¸ªä»“åº“ï¼Œhexo_zhå’Œhexo_enï¼Œåˆ†åˆ«ä½œä¸ºä¸­æ–‡åšå®¢å’Œè‹±æ–‡åšå®¢ï¼Œå¹¶ä¸”åœ¨Menuä¸Šæ·»åŠ å¤–é“¾ï¼Œç‚¹å‡»å¯ä»¥è¿›è¡Œè·³è½¬ã€‚</p><p>éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ä¸»è¦æœ‰ï¼š</p><ol type="1"><li><p>enåšå®¢åˆ é™¤_postä¸­ä¸éœ€è¦çš„ä¸­æ–‡åšå®¢</p></li><li><p>ä¿®æ”¹<code>_config.yml</code>çš„URL</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## If your site is put in a subdirectory, set url as &#x27;http://example.com/child&#x27; and root as &#x27;/child/&#x27;</span></span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯ä¸­è‹±æ–‡å¯¹åº”çš„urlï¼Œç”±äºæ˜¯subdirectoryï¼Œæ‰€ä»¥éœ€è¦æŒ‰ç…§ä»¥ä¸‹å†™æ³•</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://lucas-hao.github.io/hexo_en/</span></span><br><span class="line"><span class="attr">root:</span> <span class="string">/hexo_en/</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:year/:month/:day/:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"><span class="attr">pretty_urls:</span></span><br><span class="line">  <span class="attr">trailing_index:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  <span class="attr">trailing_html:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹<code>_config.next.yml</code>ï¼ˆå³ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼Œå‚è§<a href="https://theme-next.js.org/docs/getting-started/configuration">Configuration| NexT(theme-next.js.org)</a>ï¼‰çš„Menuï¼Œæ·»åŠ åˆ‡æ¢çš„å¤–é“¾ã€‚è¿™é‡Œè¿˜æœ‰ä¸€äº›Bugæ²¡æœ‰è§£å†³ï¼Œç›®å‰ä»ç„¶å­˜åœ¨çš„é—®é¢˜æ˜¯ç‚¹å‡»åˆ‡æ¢æŒ‰é’®ååªæœ‰å†…å®¹æ¿å—åˆ‡æ¢åˆ°äº†ä¸­è‹±æ–‡å¯¹åº”çš„posté¡µé¢ï¼Œä½†æ˜¯å…¶ä»–åŒ…æ‹¬å·¦ä¾§çš„è¾¹æ ä»¥åŠè¯„è®ºæ¿å—éƒ½æ²¡æœ‰åˆ·æ–°ï¼Œä¹Ÿå°±æ˜¯è¯´å› ä¸ºenå’Œzhåœ¨åŒä¸€ä¸ªrootä¸‹ï¼Œæ‰€ä»¥hexoé»˜è®¤ä¸ºç«™å†…çš„åˆ‡æ¢è€Œå¹¶éå¤–é“¾ï¼Œæœ‰å¾…å¯»æ‰¾è§£å†³åŠæ³•ã€‚<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">menu:</span></span><br><span class="line">     <span class="attr">home:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-home</span></span><br><span class="line">     <span class="attr">about:</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-user</span></span><br><span class="line">     <span class="attr">tags:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-tags</span></span><br><span class="line">     <span class="attr">categories:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-th</span></span><br><span class="line">     <span class="attr">portfolio:</span> <span class="string">/portfolio/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-archive</span></span><br><span class="line">     <span class="string">ä¸­æ–‡:</span> <span class="string">https://lucas-hao.github.io/hexo_zh/</span> <span class="string">||</span> <span class="string">fa</span> <span class="string">fa-language</span></span><br><span class="line">     <span class="comment">#archives: /archives/ || fa fa-archive</span></span><br><span class="line">     <span class="comment">#schedule: /schedule/ || fa fa-calendar</span></span><br><span class="line">     <span class="comment">#sitemap: /sitemap.xml || fa fa-sitemap</span></span><br><span class="line">     <span class="comment">#commonweal: /404/ || fa fa-heartbeat</span></span><br></pre></td></tr></table></figure></p></li><li><p>ä¿®æ”¹Deployçš„gitåœ°å€</p></li></ol><blockquote><p><strong>å‚è€ƒèµ„æ–™</strong> - <a href="https://youngforest.github.io/2021/09/07/Setup-English-blog/">Hexoåˆ›å»ºä¸­è‹±æ–‡åšå®¢ | YoungForest's blog</a> - <a href="https://tstrs.me/1448.html?utm_source=blog_decay_fun">Hexoæ·»åŠ å¤šè¯­è¨€æ”¯æŒã€Œå›½é™…åŒ–i18nã€- SaltyLeo's Blog (tstrs.me)</a> - <a href="https://siriusq.top/Hexo-Next-8-%E5%8F%8C%E8%AF%AD%E5%88%87%E6%8D%A2.html">HexoNext 8 åŒè¯­åˆ‡æ¢</a></p></blockquote><h2><span id="hexoç«™ç‚¹å†…é¡µé¢è·³è½¬çš„é—®é¢˜">Hexoç«™ç‚¹å†…é¡µé¢è·³è½¬çš„é—®é¢˜</span></h2><p>åœ¨Hexoç«™ç‚¹å†…éƒ¨æ–‡ç« é¡µé¢è·³è½¬åœ¨hexoä¸­å¯ä»¥ä½¿ç”¨<code>My portfolio: &#123;% poge_link "Post Name"&#125;</code>è¿™ç§æ–¹å¼ç®€ä¾¿çš„å®ç°ï¼Œä½†æ˜¯ç”±äºæˆ‘æƒ³è¦å®ç°çš„æ˜¯ä¸¤ä¸ªPageä¹‹é—´çš„è·³è½¬ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªpostè·³è½¬åˆ°å¦ä¸€ä¸ªpostï¼Œè¿™ç§æ–¹å¼å°±æ— æ³•å®ç°äº†ã€‚æœ€å‚»çš„åŠæ³•å°±æ˜¯ç›´æ¥ä½¿ç”¨markdownä¼ ç»Ÿçš„ç½‘å€é“¾æ¥çš„æ–¹å¼ï¼Œä½†æ˜¯æ„Ÿè§‰æœ‰ç‚¹ä¸æ˜¯å¤ªæ–¹ä¾¿ï¼Œå…·ä½“çš„é¡µé¢è·³è½¬çš„æ–¹å¼æœ‰å¾…æŸ¥è¯(TODO)</p><blockquote><p><strong>å‚è€ƒèµ„æ–™</strong></p><ul><li><a href="https://hexo.io/zh-cn/docs/tag-plugins.html#å¼•ç”¨æ–‡ç« ">æ ‡ç­¾æ’ä»¶ï¼ˆTagPluginsï¼‰ | Hexo</a></li></ul></blockquote><h2><span id="æ·»åŠ å¯ä»¥åˆ‡æ¢æ¨¡å¼çš„darkmodeæ”¯æŒ">æ·»åŠ å¯ä»¥åˆ‡æ¢æ¨¡å¼çš„DarkModeæ”¯æŒ</span></h2><p>ç›®å‰Nextä¸»é¢˜å·²ç»æ”¯æŒDarkModeäº†ï¼Œå¯ä»¥ç›´æ¥åœ¨<code>_config.yml</code>ä¸­è¿›è¡Œé…ç½®ï¼Œä½†æ˜¯æ²¡æœ‰åˆ‡æ¢çš„åŠŸèƒ½ï¼Œæ‰€ä»¥é‡‡ç”¨äº†<a href="https://github.com/rqh656418510/hexo-next-darkmode">hexo-dark-mode</a>æ’ä»¶æ¥å®ç°æ·±è‰²æ¨¡å¼ã€‚å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰stylçš„æ–¹å¼åˆ†åˆ«è®¾ç½®æµ…è‰²æ·±è‰²æ¨¡å¼çš„èƒŒæ™¯ï¼Œè®©èƒŒæ™¯å›¾ç‰‡å’Œä¸»é¢˜æ›´æ­ä¸€äº›ã€‚è‡ªå®šä¹‰styléœ€è¦åœ¨<code>source/</code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»º<code>_data/</code>æ–‡ä»¶å¤¹ï¼Œç„¶åå†åˆ›å»ºä¸€ä¸ª<code>styles.styl</code>æ–‡ä»¶ï¼Œå¹¶åœ¨<code>_config.next.yml</code>ä¸­è®¾ç½®<code>custom_file_path</code>ã€‚</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(/images/body-light.jpg); <span class="comment">// å¯ä»¥æ˜¯è·¯å¾„ä¹Ÿå¯ä»¥æ˜¯é“¾æ¥</span></span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat; <span class="comment">// ä¸é‡å¤</span></span><br><span class="line">    <span class="attribute">background-attachment</span>:fixed; <span class="comment">// å›ºå®šä½èƒŒæ™¯å›¾ç‰‡</span></span><br><span class="line">    <span class="attribute">background-position</span>:<span class="number">50%</span> <span class="number">50%</span>; <span class="comment">// å›¾ç‰‡ä½ç½®ï¼šå±…ä¸­</span></span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">100%</span> <span class="number">100%</span>; <span class="comment">// å›¾ç‰‡é•¿å®½æ‰©å……ä¸º100%</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-tag">body</span><span class="selector-class">.darkmode--activated</span> &#123;</span><br><span class="line">    <span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&#x27;/images/body-dark.jpg&#x27;</span>)</span><br><span class="line">    <span class="attribute">background-repeat</span>: no-repeat;</span><br><span class="line">    <span class="attribute">background-attachment</span>: fixed;</span><br><span class="line">    <span class="attribute">background-position</span>: <span class="number">50%</span>, <span class="number">50%</span>;</span><br><span class="line">    <span class="attribute">background-size</span>: <span class="number">100%</span>, <span class="number">100%</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/Darkmode.gif"></p><blockquote><p><strong>å‚è€ƒèµ„æ–™</strong></p><ul><li><a href="https://www.techgrow.cn/posts/abf4aee1.html">Hexo Next 8.xä¸»é¢˜æ·»åŠ å¯åˆ‡æ¢çš„æš—é»‘æ¨¡å¼ | Clay çš„æŠ€æœ¯åšå®¢ (techgrow.cn)</a></li></ul></blockquote><h2><span id="ä½¿ç”¨mathjaxå¯¹latexå…¬å¼è¿›è¡Œæ¸²æŸ“">ä½¿ç”¨mathjaxå¯¹<span class="math inline">\(\LaTeX\)</span>å…¬å¼è¿›è¡Œæ¸²æŸ“</span></h2><p>æˆ‘ä»¬åœ¨markdownä¸­æˆ–å¤šæˆ–å°‘éƒ½ä¼šç”¨åˆ°Latexæ¥ä¹¦å†™æ•°å­¦ç¬¦å·ï¼ŒNexTå°±ä¸º<span class="math inline">\(\LaTeX\)</span>æä¾›äº†éå¸¸æ–¹ä¾¿çš„æ¸²æŸ“æ–¹å¼ã€‚æˆ‘ä»¬åªéœ€è¦æ‰¾åˆ°<code>/next/__config.yml</code>ï¼Œç„¶åæ‰¾åˆ°å¦‚ä¸‹é…ç½®å¹¶ä¿®æ”¹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mathjax:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Available values: none | ams | all</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="string">none</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œï¼Œç”±äºhexoè‡ªå¸¦çš„<code>hexo-renderer-marked</code>ä¼šé€ æˆä¸€äº›bugï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨pandocä¼šæ›´åŠ å¥½ä¸€ç‚¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm uninstall hexo-renderer-marked --save</span><br><span class="line">npm install hexo-renderer-pandoc --save</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œè¿›è¡Œéƒ¨ç½²å°±ä¼šå‘ç°æ¸²æŸ“æˆåŠŸå•¦</p><p>æ›´æ–°2022.9.12</p><p>ä»Šå¤©å†™çš„æ—¶å€™å‘ç°ä¸€ä¸ªé—®é¢˜ï¼Œ<code>$$</code>ç¬¦å·æ²¡æœ‰éšè—ï¼Œç„¶åå‘ç°æ˜¯å› ä¸ºä¼¼ä¹pandocè‡ªåŠ¨æ¸²æŸ“äº†<code>\begin&#123;align&#125;</code>ä¸­çš„å…¬å¼ï¼Œæ‰€ä»¥å¤–å±‚çš„<code>$$</code>å°±è¢«å¿½ç•¥äº†ï¼Œæ‰€ä»¥å»æ‰å°±å¥½äº†ï¼Œä½†æ˜¯è¿™æ ·å­å°±ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯åœ¨typoraä¸­æ˜¯æ— æ³•é¢„è§ˆçš„ï¼Œä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä¹Ÿè®¸æœ‰æœºä¼šç ”ç©¶ä¸€ä¸‹å¦‚ä½•è§£å†³å§(TODO)</p><blockquote><p>å‚è€ƒèµ„æ–™</p><ul><li><a href="https://nokiasonic.github.io/2020/12/17/%5BHexo%5DNextä¸»é¢˜æ›´å¥½åœ°æ”¯æŒLaTeXæ•°å­¦å…¬å¼/">ã€Hexoã€‘Nextä¸»é¢˜æ›´å¥½åœ°æ”¯æŒLaTeXæ•°å­¦å…¬å¼</a></li></ul></blockquote><h2><span id="nextä¸»é¢˜çš„ç›®å½•å±‚çº§é—®é¢˜">NexTä¸»é¢˜çš„ç›®å½•å±‚çº§é—®é¢˜</span></h2><p>å‘ç°å¦‚æœè·¨çº§ä½¿ç”¨ç›®å½•çš„è¯ï¼Œå°±ä¼šé€ æˆbugå¯¼è‡´ç›®å½•ä¸‹çš„å±‚çº§é”™ä¹±ï¼Œè¿™å°±æ˜¯ç”±äºæˆ‘æ¯”è¾ƒå–œæ¬¢äºŒçº§æ ‡é¢˜è·Ÿç€å››çº§æ ‡é¢˜ï¼Œå¦‚æœæ ‡é¢˜é€çº§é€’å‡å°±ä¸ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†ï¼ŒæŠŠå››çº§æ ‡é¢˜éƒ½æ”¹æˆä¸‰çº§æ ‡é¢˜å°±å¥½äº†</p><p><img title src="https://i.loli.net/2021/07/23/rHYxJv5Rk96UNpd.png" alt="image-20210723224432413" width="387"></p><p>æ›´æ–° (2022.10.6)æœ€è¿‘åˆå‡ºç°äº†ç›®å½•ä¹±ä¸ƒå…«ç³Ÿçš„é—®é¢˜ï¼Œè¿™æ¬¡æ˜¯äºŒçº§æ ‡é¢˜+ä¸‰çº§æ ‡é¢˜ä½†æ˜¯è¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå°è¯•äº†ä¸€ä¸‹ä¸¥æ ¼çš„ä½¿ç”¨ä¸€çº§æ ‡é¢˜äºŒçº§æ ‡é¢˜ï¼Œå‘ç°å°±å¥½äº†ï¼Œä»¥åè¿˜æ˜¯ä¸€çº§æ ‡é¢˜èµ·æ‰‹å§orzã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PostgreSQLç”ŸæˆRESTfulç¥å™¨PostgREST</title>
      <link href="/2021/07/17/backend/postgresql-sheng-cheng-restful-shen-qi-postgrest/"/>
      <url>/2021/07/17/backend/postgresql-sheng-cheng-restful-shen-qi-postgrest/</url>
      
        <content type="html"><![CDATA[<p>å½“æˆ‘ä»¬æƒ³è¦å¯¹PostgreSQLè¿›è¡Œå®¢æˆ·ç«¯ä¸Šçš„æ“ä½œæ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿œç«¯å¯¹æ•°æ®åº“è¿›è¡Œè®¿é—®ã€‚è¿™ä¸ªæ—¶å€™PostgreSQLçš„ç¥å™¨PostgRESTå°±å¯ä»¥å‡ºé©¬äº†ã€‚PostgRESTæ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸€ç³»åˆ—ç”¨äºæ“ä½œPostgreSQLæ•°æ®åº“çš„RESTfulAPIçš„æœåŠ¡å™¨ã€‚ä¹‹å‰æˆ‘è¿˜å°è¯•è¿‡ç›´æ¥ä½¿ç”¨Nginxä¸­çš„ngx_postgresæ¨¡å—è¿›è¡Œæ•°æ®çš„æ“ä½œï¼Œä½†æ˜¯å®é™…ä½¿ç”¨ä¸‹æ¥å‘ç°éå¸¸çš„éº»çƒ¦ï¼Œå¹¶ä¸”RESTfulstyleè¦æ±‚æ¯ä¸ªç½‘å€ä»£è¡¨ä¸€ç§èµ„æºï¼Œåœ¨ç½‘å€ä¸­ä¸èƒ½æœ‰åŠ¨è¯ï¼Œåªèƒ½æœ‰åè¯ï¼Œè€Œä¸”æ‰€ç”¨çš„åè¯ä¸€èˆ¬å’Œæ•°æ®åº“åç§°ç›¸åŒã€‚ç„¶è€Œï¼Œæˆ‘åœ¨Nginxçš„ä½¿ç”¨ä¸­è¿˜å¹¶æ²¡æœ‰æ‰¾åˆ°ä¸€ç§å¯ä»¥é€‚é…è¿™ç§æ ·å¼çš„æ–¹æ³•ï¼Œå…³äºngx_postgresè¿™ä¸ªæ¨¡å—ï¼Œå¯ä»¥çœ‹ä¸€çœ‹æˆ‘çš„è¿™ç¯‡åšå®¢<a href="https://lucas-hao.github.io/2021/07/06/nginx-yi-ji-ngx-postgres-an-zhuang-yi-ji-pei-zhi/#more">Nginxä»¥åŠngx_postgreså®‰è£…ä»¥åŠé…ç½®| Lucasçš„åšå®¢</a> å’Œè¿™ä¸€ç¯‡<a href="https://lucas-hao.github.io/2021/07/08/shi-yong-java-tong-guo-nginx-fan-xiang-dai-li-fu-wu-qi-cao-zuo-postgresql-shu-ju-ku/">ä½¿ç”¨Javaé€šè¿‡Nginxåå‘ä»£ç†æœåŠ¡å™¨æ“ä½œPostgreSQLæ•°æ®åº“| Lucasçš„åšå®¢ )</a> ã€‚</p><span id="more"></span><h2><span id="postgrestçš„é…ç½®">PostgRESTçš„é…ç½®</span></h2><p>PostgRESTçš„ä¸‹è½½å®‰è£…ä¹Ÿéå¸¸çš„æ–¹ä¾¿ï¼Œé¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥æ”¾ç½®PostgRESTçš„å®‰è£…ç›®å½•ã€‚è¿™é‡Œæˆ‘é€‰æ‹©åœ¨<code>/opt</code>ç›®å½•ä¸‹åˆ›å»ºæ–‡ä»¶å¤¹<code>postgrest</code>ï¼Œç„¶åä¸‹è½½å‹ç¼©åŒ…åˆ°<code>~/pacakges</code>ï¼Œå‹ç¼©åŒ…æœ€æ–°ç‰ˆæœ¬å¯ä»¥åœ¨<a href="https://github.com/PostgREST/postgrest/releases/tag/v7.0.1">Releasev7.0.1 Â· PostgREST/postgrest(github.com)</a>é‡Œé¢æ‰¾åˆ°ï¼Œè¿™é‡Œæˆ‘ä¸‹è½½çš„æ˜¯7.0.1ç‰ˆæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> wget https://github.com/PostgREST/postgrest/releases/download/v7.0.1/postgrest-v7.0.1-linux-x64-static.tar.xz</span><br></pre></td></tr></table></figure><p>å°†å‹ç¼©åŒ…è§£å‹åˆ°postgrestä¸­</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/packages</span><br><span class="line"><span class="built_in">sudo</span> tar -xvf postgrest-v7.0.1-linux-x64-static.tar.xz -C /opt/postgrest</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥postgrestç›®å½•ä¸­ï¼Œè§£å‹ååªæœ‰ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶<code>postgrest</code>ï¼Œæ‰§è¡Œè§£å‹åçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/postgrest</span><br><span class="line">./postgrest</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹åçœ‹åˆ°æç¤ºè¯´æ˜é…ç½®æˆåŠŸ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db-uri = <span class="string">&quot;postgres://user:pass@localhost:5432/dbname&quot;</span></span><br><span class="line">db-schema = <span class="string">&quot;public&quot;</span></span><br><span class="line">db-anon-role = <span class="string">&quot;postgres&quot;</span></span><br><span class="line">db-pool = 10</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥é…ç½®é…ç½®æ–‡ä»¶ï¼Œæ–°å»ºæ–‡ä»¶<code>default.conf</code>ï¼Œé…ç½®æ–‡ä»¶å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># postgrest.conf</span></span><br><span class="line"><span class="comment"># The standard connection URI format, documented at</span></span><br><span class="line"><span class="comment"># &lt;https://www.postgresql.org/docs/current/static/libpq-connect.html#AEN45347&gt;</span></span><br><span class="line">db-uri       = <span class="string">&quot;postgres://postgres:password@127.0.0.1:5432/dbname&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The name of which database schema to expose to REST clients</span></span><br><span class="line">db-schema    = <span class="string">&quot;public&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The database role to use when no client authentication is provided.</span></span><br><span class="line"><span class="comment"># Can (and probably should) differ from user in db-uri</span></span><br><span class="line">db-anon-role = <span class="string">&quot;postgres&quot;</span></span><br></pre></td></tr></table></figure><p>ç”¨è®¾ç½®å¥½çš„é…ç½®æ–‡ä»¶å¯åŠ¨postgrest</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/postgrest</span><br><span class="line"><span class="built_in">sudo</span> ./postgrest default.conf</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åï¼Œå°±ä¼šçœ‹åˆ°æ—¥å¿—ç›´æ¥è¾“å‡ºï¼Œå¯ä»¥é€šè¿‡Ctrl-Cåœæ­¢ç¨‹åºã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´å°†æ—¥å¿—è¾“å‡ºåˆ°æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”åå°è¿è¡Œç¨‹åºï¼Œæ—¥å¿—æ–‡ä»¶åº”è¯¥ä¿å­˜åœ¨å½“å‰ç”¨æˆ·ç©ºé—´ä¸­ï¼Œå¦åˆ™ä¼šå‡ºç°æƒé™é—®é¢˜ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">nohup</span> postgrest default.conf&gt;~/postgrest.log &amp;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡PostgRESTè¿›è¡ŒQueryæˆ–è€…Insertionäº†ã€‚</p><p>å¦‚æœæƒ³è¦åœæ­¢PostgRESTï¼Œéœ€è¦å…ˆæ‰¾åˆ°å®ƒçš„è¿›ç¨‹ï¼Œç„¶åkillå°±å¥½äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ps -A | grep postgrest  # æŸ¥çœ‹è¿›ç¨‹</span><br><span class="line">sudo lsof -i:3000# æŸ¥çœ‹ç«¯å£ï¼Œä¹Ÿä¼šæ˜¾ç¤ºè¿›ç¨‹PID</span><br><span class="line">kill PID# æ€æ­»è¿›ç¨‹</span><br></pre></td></tr></table></figure><h2><span id="postgrestå’Œnignxè”åˆä½¿ç”¨">PostgRESTå’ŒNignxè”åˆä½¿ç”¨</span></h2><p>è™½ç„¶PostgRESTèƒ½å¤Ÿä¸ºæˆ‘ä»¬æä¾›å¼ºå¤§çš„RESTfulAPIå¸®åŠ©ï¼Œä½†æ˜¯å®ƒå¹¶æœªæä¾›ä¸€äº›å®‰å…¨ä¸Šçš„ä¿éšœå’Œæªæ–½ã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ­é…å¼ºå¤§çš„Nginxï¼Œç”¨Nginxåå‘ä»£ç†PostgRESTã€‚æˆ‘ä»¬åœ¨Nginxçš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream postgrest &#123;</span><br><span class="line">server localhost:3000;</span><br><span class="line">    keepalive 64;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">location /api/ &#123;</span><br><span class="line">        default_type  application/json;</span><br><span class="line">        proxy_hide_header Content-Location;</span><br><span class="line">        add_header Content-Location  /api/<span class="variable">$upstream_http_content_location</span>;</span><br><span class="line">        proxy_set_header  Connection <span class="string">&quot;&quot;</span>;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_pass http://postgrest/;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ç›´æ¥é€šè¿‡<code>http://hostname/api/</code>æ¥å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œ</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/cunchen/p/9464115.html">ã€PostgRESTåŸºæœ¬æ•™ç¨‹ï¼ˆä¸€ï¼‰ã€‘ PostgRESTå¿«é€Ÿæ­å»º )</a></p><p>ä½¿ç”¨æ•™ç¨‹ï¼š<a href="https://postgrest.org/en/stable/">å®˜æ–¹æ–‡æ¡£</a></p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PostgreSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hexoä¸‹yiliaä¸»é¢˜åšå®¢ä¸ªæ€§åŒ–è‡ªå®šä¹‰</title>
      <link href="/2021/07/16/other/hexo-zhu-ti-yilia-pei-zhi-ji-lu/"/>
      <url>/2021/07/16/other/hexo-zhu-ti-yilia-pei-zhi-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘çš„åšå®¢é‡‡ç”¨çš„hexoä¸‹çš„yiliaä¸»é¢˜ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹è‡ªå·±æŠ˜è…¾é…ç½®åšå®¢çš„æ–¹æ³•å’Œç»è¿‡ã€‚é¦–å…ˆæ˜¯åˆ›å»ºåšå®¢çš„åŸºæœ¬çš„å‡ ä¸ªå‘½ä»¤ <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hexo g # ç”Ÿæˆåšå®¢ç½‘é¡µæ–‡ä»¶</span><br><span class="line">hexo s # æœ¬åœ°é¢„è§ˆåšå®¢ï¼Œæ‰“å¼€æœ¬åœ°ç½‘å€http://localhost:4000/è¿›è¡Œé¢„è§ˆ</span><br><span class="line">hexo d # ä¸Šä¼ ç½‘é¡µæ–‡ä»¶åˆ°github</span><br><span class="line">hexo new post &quot;Article Title&quot; # æ–°å»ºä¸€ç¯‡åšå®¢</span><br><span class="line">hexo cl &amp;&amp; hexo g &amp;&amp;ã€€hexo s # ä¸€æ­¥å®ç°æ¸…é™¤é‡æ„æœ¬åœ°é¢„è§ˆ</span><br></pre></td></tr></table></figure> <span id="more"></span></p><h2><span id="yiliaä¸»é¢˜ä¸‹çš„æˆªæ–­åŠŸèƒ½åŠä¼˜åŒ–">yiliaä¸»é¢˜ä¸‹çš„æˆªæ–­åŠŸèƒ½åŠä¼˜åŒ–</span></h2><p>ä¸€ç¯‡æ–‡ç« å¤ªé•¿ï¼Œä¸éœ€è¦å°†å…¶å…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ï¼Œåœ¨yiliaä¸»é¢˜ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨æˆ‘ä»¬çš„markdownæ–‡ä»¶ä¸­éœ€è¦æˆªæ–­çš„åœ°æ–¹æ’å…¥<code>&lt;!-- more --&gt;</code>å°±å¯ä»¥å®ç°é˜¶æ®µäº†ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™å‘ç°ï¼Œåœ¨æˆªæ–­çš„åœ°æ–¹ä¼šæœ‰ä¸€ä¸ª<code>more&gt;&gt;</code>çš„æ ‡å¿—å‡ºç°ï¼Œä¸å±•å¼€å…¨æ–‡é‡å¤äº†</p><figure><img src="https://i.loli.net/2021/04/06/XcU5V76DT3HniFN.png" alt="image-20210406213135567"><figcaption aria-hidden="true">image-20210406213135567</figcaption></figure><p>ä¸ºäº†å»é™¤è¿™ä¸ª<code>more&gt;&gt;</code>ï¼Œåœ¨<code>themes/_config.yml</code>ï¼Œä¿®æ”¹excerpt_linkå‚æ•°:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">excerpt_linkï¼šä¹‹åçš„moreå•è¯æ¢æˆç©ºæ ¼</span><br><span class="line">æ³¨ï¼šâ€˜excerpt_linkï¼š â€™ã€‚å…¶ä¸­ï¼šåæœ‰ä¸€ä¸ªç©ºæ ¼é”®</span><br></pre></td></tr></table></figure><h2><span id="ä¼˜å…ˆçº§é…ç½®">ä¼˜å…ˆçº§é…ç½®</span></h2><p>ä¿®æ”¹æ ¹ç›®å½•é…ç½®æ–‡ä»¶<code>/_config.yml</code>,topå€¼-1æ ‡ç¤ºæ ¹æ®topå€¼å€’åºï¼ˆæ­£åºè®¾ç½®ä¸º1å³å¯ï¼‰ï¼ŒåŒæ ·<code>date</code>ä¹Ÿæ˜¯æ ¹æ®åˆ›å»ºæ—¥æœŸå€’åºã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">index_generator</span>:</span><br><span class="line">  <span class="attr">path</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">per_page</span>: <span class="number">10</span></span><br><span class="line">  <span class="attr">order_by</span>:</span><br><span class="line">    <span class="attr">top</span>: -<span class="number">1</span></span><br><span class="line">    <span class="attr">date</span>: -<span class="number">1</span></span><br></pre></td></tr></table></figure><h2><span id="åœ¨å·¦è¾¹æ æ˜¾ç¤ºæ€»æ–‡ç« æ•°">åœ¨å·¦è¾¹æ æ˜¾ç¤ºæ€»æ–‡ç« æ•°</span></h2><p>å°†<code>themes\yilia\layout_partial\left-col.ejs</code>æ–‡ä»¶çš„</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;nav <span class="keyword">class</span>=<span class="string">&quot;header-menu&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &lt;% for (var i in theme.menu)&#123; %&gt;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;&lt;%- url_for(theme.menu[i]) %&gt;&quot;</span>&gt;</span>&lt;%= i %&gt;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    &lt;%&#125;%&gt;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure><p>åé¢åŠ ä¸Š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;nav&gt;</span><br><span class="line">    æ€»æ–‡ç« æ•° &lt;%=site.<span class="property">posts</span>.<span class="property">length</span>%&gt;</span><br><span class="line">&lt;/nav&gt;</span><br></pre></td></tr></table></figure><h2><span id="æ·»åŠ ç½‘ç«™æµé‡è®¡æ•°åŠŸèƒ½">æ·»åŠ ç½‘ç«™æµé‡è®¡æ•°åŠŸèƒ½</span></h2><ul><li><p>åœ¨<code>_config.yml</code>ä¸­æ·»åŠ  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></p></li><li><p>å°†themes/yilia/layout/_partial/footer.ejsæ›¿æ¢ä¸ºä¸€ä¸‹ä»£ç <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;footer id=<span class="string">&quot;footer&quot;</span>&gt;</span><br><span class="line"> <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;outer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;footer-info&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-left&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">       <span class="symbol">&amp;copy;</span> &lt;%= date(new Date(), &#x27;YYYY&#x27;) %&gt; &lt;%= config.author || config.title %&gt;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;footer-right&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;http://hexo.io/&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>Hexo<span class="tag">&lt;/<span class="name">a</span>&gt;</span>  Theme <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/litten/hexo-theme-yilia&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span>&gt;</span>Yilia<span class="tag">&lt;/<span class="name">a</span>&gt;</span> by Litten</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">calss</span>=<span class="string">&quot;count-span&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_container_site_pv&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         æ€»è®¿é—®é‡: <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_site_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">async</span> <span class="attr">src</span>=<span class="string">&quot;//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br></pre></td></tr></table></figure></p></li><li><p>æ‰“å¼€<code>\themes\yilia\layout\_partial\article.ejs</code>ï¼Œåœ¨<code>&lt;header class="article-header"&gt;</code>é‡ŒåŠ å…¥ä»¥ä¸‹ä»£ç :<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- æ·»åŠ ä»£ç  è®¿é—®ç»Ÿè®¡ --&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span> ( !index )&#123; %&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;archive-article-date&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        é˜…è¯»é‡ <span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span>=<span class="string">&quot;busuanzi_value_page_pv&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&lt;% &#125; %&gt;</span><br></pre></td></tr></table></figure></p></li></ul><figure><img src="https://i.loli.net/2021/04/06/tPHydr4apl3oUDx.png" alt="image-20210406210243081"><figcaption aria-hidden="true">image-20210406210243081</figcaption></figure><p>å‚è€ƒèµ„æº: <a href="https://blog.csdn.net/weixin_43864927/article/details/106970576">Hexoä¸ªäººåšå®¢ä¹‹yiliaä¸»é¢˜é˜…è¯»é‡å’Œæ–‡ç« å­—æ•°ç»Ÿè®¡</a></p><h2><span id="æ·»åŠ å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é•¿åŠŸèƒ½">æ·»åŠ å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é•¿åŠŸèƒ½</span></h2><ul><li><p><strong>å®‰è£…hexo-wordcount</strong></p><p>åœ¨ç»ˆç«¯ä¸­åšå®¢ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤(å®‰è£…wordcountæ’ä»¶) <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i â€“save hexo-wordcount</span><br></pre></td></tr></table></figure></p></li><li><p><strong>é…ç½®ä¿®æ”¹</strong></p><p>åœ¨theme_partial.ejsæ–‡ä»¶ï¼š</p><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=<span class="string">&quot;margin-top:10px;&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-time&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-item-icon&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-keyboard-o&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-item-text&quot;</span>&gt;</span>  å­—æ•°ç»Ÿè®¡: <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-count&quot;</span>&gt;</span>&lt;%= wordcount(post.content) %&gt;å­—<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-time&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="symbol">&amp;nbsp;</span> | <span class="symbol">&amp;nbsp;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-item-icon&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-hourglass-half&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-item-text&quot;</span>&gt;</span>  é˜…è¯»æ—¶é•¿: <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-count&quot;</span>&gt;</span>&lt;%= min2read(post.content) %&gt;åˆ†<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></p><p>åœ¨<code>\themes\yilia\layout\_partial\article.ejs</code>ä¸­æ·»åŠ </p><p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- éœ€è¦æ·»åŠ çš„ä½ç½® --&gt;</span><br><span class="line">&lt;!-- å¼€å§‹æ·»åŠ å­—æ•°ç»Ÿè®¡--&gt;</span><br><span class="line">&lt;% <span class="keyword">if</span>(theme.<span class="property">word_count</span> &amp;&amp; !post.<span class="property">no_word_count</span>)&#123;%&gt;</span><br><span class="line">    &lt;%- <span class="title function_">partial</span>(<span class="string">&#x27;post/word&#x27;</span>) %&gt;</span><br><span class="line">        &lt;% &#125; %&gt;</span><br><span class="line">            &lt;!-- æ·»åŠ å®Œæˆ --&gt;</span><br></pre></td></tr></table></figure></p><figure><img src="https://i.loli.net/2021/04/06/BIudtvj9NOxirUS.png" alt="image-20210406210706379"><figcaption aria-hidden="true">image-20210406210706379</figcaption></figure></li></ul><p>å‚è€ƒèµ„æº: <a href="https://blog.csdn.net/weixin_43864927/article/details/106970576">Hexoä¸ªäººåšå®¢ä¹‹yiliaä¸»é¢˜é˜…è¯»é‡å’Œæ–‡ç« å­—æ•°ç»Ÿè®¡</a></p><h2><span id="live-2dçœ‹æ¿å¨˜">Live 2Dçœ‹æ¿å¨˜</span></h2><p>åœ¨åšå®¢çš„æ ¹ç›®å½•è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save hexo-helper-live2d</span><br></pre></td></tr></table></figure><p>å®‰è£…æƒ³è¦çš„live2dåŠ¨ç”»äººç‰©æ¨¡å‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install live2d-widget-model-haru</span><br></pre></td></tr></table></figure><p>live2d-widget-model-haruè¿™ä¸ªæ˜¯ä¸€ä¸ªåŠ¨ç”»çš„æ ·å¼modelï¼Œä½ å¯ä»¥åœ¨ç½‘ä¸Šæœåˆ°å¾ˆå¤šã€‚</p><p>å®‰è£…æˆåŠŸåï¼Œä½ å¯ä»¥åœ¨ä½ çš„<code>åšå®¢æ ¹æ–‡ä»¶å¤¹/node_modules/</code>åº•ä¸‹æ‰¾åˆ°<code>live2d-widget-model-haru</code>è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚æ¨¡å‹å¯ä»¥åœ¨<a href="https://github.com/xiazeyu/live2d-widget-models">live2d-widget-models</a>ä¸­æ‰¾åˆ°ã€‚</p><p>ä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"># <span class="number">7.</span>live2dé…ç½®å® ç‰©</span><br><span class="line">live2d<span class="punctuation">:</span></span><br><span class="line">  # å½“enable ä¸º<span class="literal"><span class="keyword">true</span></span>çš„æ—¶å€™ï¼Œä¼šå¯ç”¨yaliyaä¸»é¢˜è‡ªå¸¦å® ç‰©shizuku<span class="punctuation">,</span>æ©˜å¤´å‘å°å§å§ï¼Œè€Œä¸”ä¸å¯ä»¥é…ç½®ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦è®²enableæ³¨é‡Šæ‰</span><br><span class="line">  # enable<span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span></span><br><span class="line">  scriptFrom<span class="punctuation">:</span> local</span><br><span class="line">  pluginRootPath<span class="punctuation">:</span> live2dw/</span><br><span class="line">  pluginJsPath<span class="punctuation">:</span> lib/</span><br><span class="line">  pluginModelPath<span class="punctuation">:</span> assets/</span><br><span class="line">  model<span class="punctuation">:</span></span><br><span class="line">  # æˆ‘ç”¨çš„æ˜¯åˆéŸ³çš„æ¨¡å‹(è€äºŒæ¬¡å…ƒäº†)</span><br><span class="line">  use<span class="punctuation">:</span> live2d-widget-model-miku</span><br><span class="line">    # live2d-widget-model-wanko æ˜¯ä¸€åªè¶´åœ¨ç¢—é‡Œçš„ç‹—ç‹—</span><br><span class="line">    # use<span class="punctuation">:</span> live2d-widget-model-wanko # é€šè¿‡ä¿®æ”¹useæ¥ç¡®å®šä½¿ç”¨å“ªç§model</span><br><span class="line">    # hibiki æ˜¯ä¸€ä¸ªå¾¡å§</span><br><span class="line">    # use<span class="punctuation">:</span> live2d-widget-model-hibiki</span><br><span class="line">    # haruto æµ·å†›æœå¥³å­©ï¼Œæœ‰ç‚¹éš¾çœ‹</span><br><span class="line">    # use<span class="punctuation">:</span> live2d-widget-model-haruto</span><br><span class="line">  display<span class="punctuation">:</span></span><br><span class="line">    position<span class="punctuation">:</span> left</span><br><span class="line">    width<span class="punctuation">:</span> <span class="number">150</span></span><br><span class="line">    height<span class="punctuation">:</span> <span class="number">300</span></span><br><span class="line">    # ä¸€ä¸ªæ¯”è¾ƒå¯çˆ±çš„ä½ç½®</span><br><span class="line">    # hOffset<span class="punctuation">:</span> <span class="number">200</span> </span><br><span class="line">    # vOffset<span class="punctuation">:</span> <span class="number">-100</span></span><br><span class="line">    # ç¬¬äºŒä¸ªä½ç½®é…ç½®ï¼Œè¿™ä¸ªåœ¨å·¦ä¾§è¾¹æ ä½ç½®å¾ˆå±…ä¸­</span><br><span class="line">    hOffset<span class="punctuation">:</span> <span class="number">80</span>  # è°ƒèŠ‚æ°´å¹³ä½ç½®</span><br><span class="line">    vOffset<span class="punctuation">:</span> <span class="number">-50</span>  # è°ƒèŠ‚å‚ç›´ä½ç½®</span><br><span class="line">  mobile<span class="punctuation">:</span></span><br><span class="line">    show<span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br></pre></td></tr></table></figure><p>å‚è€ƒèµ„æ–™:</p><p><a href="https://www.jianshu.com/p/5b5c61323772">hexo-æ·»åŠ Live2dçœ‹æ¿åŠ¨ç”»ï¼ˆæ·»åŠ å® ç‰©ï¼‰- yaliya ä¸»é¢˜ ä¸€ä¸ªå°å‘</a></p><p><a href="https://wu_aquarius.gitee.io/live2d/">Hexoåšå®¢æ·»åŠ çœ‹æ¿å¨˜</a></p><h2><span id="yiliaæ›¿æ¢èƒŒæ™¯">yiliaæ›¿æ¢èƒŒæ™¯</span></h2><p>é¦–å…ˆï¼Œå·¦ä¾§æ æ›¿æ¢èƒŒæ™¯</p><p>æ‰¾åˆ°<code>themes/yilia/layout/_partial/left-col.ejs</code>ï¼Œå°†</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;overlay&quot;</span> <span class="attr">style</span>=<span class="string">&quot;background: &lt;%= theme.style &amp;&amp; theme.style.header ? theme.style.header : defaultBg %&gt;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> --&gt;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šæ‰ï¼Œç„¶ååœ¨<code>themes\yilia\source\main.0cf68a.css</code>ä¸­ä¿®æ”¹æ ·å¼ï¼Œæ³¨é‡Šæ‰åŸæœ‰çš„èƒŒæ™¯é¢œè‰²</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.left-col</span> &#123;</span><br><span class="line">    <span class="comment">/* background:#fff; */</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>), <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>)), <span class="built_in">url</span>(<span class="string">&#x27;image-url&#x27;</span>) no-repeat <span class="number">0%</span> <span class="number">20%</span>/ cover;</span><br><span class="line">    <span class="attribute">width</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">position</span>: fixed;</span><br><span class="line">    <span class="attribute">opacity</span>: <span class="number">1</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all .<span class="number">2s</span> ease-in;</span><br><span class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">z-index</span>: <span class="number">999</span>;</span><br><span class="line">    <span class="attribute">overflow</span>: hidden;</span><br><span class="line">    <span class="attribute">overflow-y</span>: auto;</span><br><span class="line">    <span class="attribute">margin-bottom</span>: <span class="number">15px</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå³ä¾§ä¸»é¢˜åŒºåŸŸæ›¿æ¢èƒŒæ™¯ã€‚è¿™é‡Œè°ƒæ•´çš„æ˜¯å³ä¾§æ˜¾ç¤ºæ–‡ç« çš„åŒºåŸŸã€‚åœ¨è¿™é‡Œå¦‚æœå°†ä»£ç ä½œä¸€ä¸‹å˜åŒ–ï¼Œé‚£ä¹ˆå³ä¾§æ–‡ç« åŒºåŸŸå°±ä¼šå‘ˆç°åŠé€æ˜çš„çŠ¶æ€ã€‚æˆ‘ä¸ºäº†ç®€æ´ï¼Œè¿˜æ˜¯é€‰æ‹©è¿™å—åŒºåŸŸå‘ˆç°å‡ºä¸é€æ˜çš„çŠ¶æ€ã€‚</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.article</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">30px</span>;</span><br><span class="line">    <span class="attribute">position</span>: relative;</span><br><span class="line">    <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">    <span class="attribute">border-top</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="attribute">border-bottom</span>: <span class="number">1px</span> solid <span class="number">#fff</span>;</span><br><span class="line">    <span class="comment">/* background: #fff; */</span></span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">rgba</span>(<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>,.<span class="number">5</span>);</span><br><span class="line">    <span class="attribute">transition</span>: all .<span class="number">2s</span> ease-in</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œä¸€ä¸ªæ˜¯<code>.mid-col</code>ä¸­çš„èƒŒæ™¯å’Œ<code>body</code>ä¸­çš„èƒŒæ™¯</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.mid-col</span> &#123;</span><br><span class="line">    <span class="attribute">position</span>: absolute;</span><br><span class="line">    <span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="comment">/* background: #eaeaea; */</span></span><br><span class="line">    <span class="attribute">left</span>: <span class="number">300px</span>;</span><br><span class="line">    <span class="attribute">width</span>: auto</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line"></span><br><span class="line">  *<span class="attribute">overflow-y</span>*: hidden;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* background: #eaeaea */</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸¤å¤„éƒ½éœ€è¦æŠŠèƒŒæ™¯æ³¨é‡Šæ‰ï¼Œå¦åˆ™ä¼šé®æŒ¡èƒŒæ™¯å›¾ç‰‡å¯¼è‡´å›¾ç‰‡æ— æ³•æ˜¾ç¤ºã€‚</p><p>ç„¶ååœ¨<code>body</code>ä¸­è®¾ç½®èƒŒæ™¯å›¾ç‰‡ï¼ˆå’Œä¸Šé¢çš„bodyä¸æ˜¯ä¸€ä¸ªbodyï¼Œå¯ä»¥ä½¿ç”¨vscodeä¸­çš„æœç´¢åŠŸèƒ½æœç´¢ï¼‰</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">font-size</span>: <span class="number">14px</span>;</span><br><span class="line">    <span class="attribute">font-family</span>: Helvetica Neue, Helvetica, STHeiTi, Arial, sans-serif;</span><br><span class="line">    <span class="attribute">line-height</span>: <span class="number">1.5</span>;</span><br><span class="line">    <span class="attribute">color</span>: <span class="number">#333</span>;</span><br><span class="line">    <span class="comment">/* background-color: #fff; */</span></span><br><span class="line">    <span class="attribute">min-height</span>: <span class="number">100%</span>;</span><br><span class="line">    <span class="attribute">background</span>: <span class="built_in">linear-gradient</span>(<span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>), <span class="built_in">rgba</span>(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>, <span class="number">0.5</span>)), </span><br><span class="line">    <span class="built_in">url</span>(<span class="string">&#x27;image-url&#x27;</span>) no-repeat <span class="number">0%</span> <span class="number">0%</span>/ cover;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›®å‰å·¦ä¾§æ çš„èƒŒæ™¯æˆåŠŸæ›´æ”¹äº†ï¼Œä½†æ˜¯å³ä¾§åŒºåŸŸçš„èƒŒæ™¯è¿˜æ˜¯æ²¡æœ‰æˆåŠŸæ›´æ”¹ã€‚</p><p>å‚è€ƒèµ„æ–™:</p><p><a href="https://blog.csdn.net/weixin_41287260/article/details/103050813?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.control&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.control">hexo+yiliaæ·»åŠ èƒŒæ™¯å›¾ç‰‡</a></p><p><a href="https://blog.csdn.net/weixin_44330881/article/details/103293892?utm_medium=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.control&amp;dist_request_id=&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.control">hexoä¹‹yiliaä¸»é¢˜æ·»åŠ èƒŒæ™¯å›¾ç‰‡</a></p><h2><span id="ä¿®æ”¹ç¿»é¡µä¸èƒ½æ­£ç¡®æ˜¾ç¤ºçš„bug">ä¿®æ”¹ç¿»é¡µä¸èƒ½æ­£ç¡®æ˜¾ç¤ºçš„bug</span></h2><p>é»˜è®¤çš„Yiliaä¸»é¢˜ä¸‹çš„ç¿»é¡µä¼šæœ‰bugï¼Œåœ¨ä¸»é¡µä¸‹çš„ä¸Šä¸‹ç¿»é¡µä¼šæœ‰å¦‚ä¸‹çš„bugï¼ŒHTMLçš„ç‰¹æ®Šç¬¦å·æ— æ³•æ­£ç¡®æ˜¾ç¤ºã€‚</p><figure><img src="https://i.loli.net/2021/07/16/RNO63KuTbWn8tPH.png" alt="image-20210716214619724"><figcaption aria-hidden="true">image-20210716214619724</figcaption></figure><p>å¼ºè¿«ç—‡çœ‹ç€éå¸¸éš¾å—ï¼Œç´¢æ€§ç›´æ¥æ”¹æˆä¸­æ–‡ä¸Šä¸€é¡µå’Œä¸‹ä¸€é¡µï¼Œæ‰¾åˆ°<code>yilia/layout/_partial/archive.ejs</code>åˆ†åˆ«ä¿®æ”¹<strong>ç¬¬8,9è¡Œ</strong>å’Œ<strong>ç¬¬37,38è¡Œ</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://i.loli.net/2021/07/16/BH5FIjKzf7eQCDp.png" alt="image-20210716215012720"><figcaption aria-hidden="true">image-20210716215012720</figcaption></figure><p>ä¿®æ”¹å®Œä¹‹åï¼Œå†æ‰¾åˆ°æ–‡ä»¶<code>yilia/layout/_partial/script.ejs</code>ï¼Œæœç´¢<code>&amp;laquo; Prev</code>å’Œ<code>Next &amp;raquo;</code>å¹¶ä¸”åˆ é™¤ï¼Œç„¶åæœ¬æ¥çš„Prevå’ŒNextå°±å˜æˆäº†â€œä¸Šä¸€é¡µâ€å’Œâ€ä¸‹ä¸€é¡µâ€œã€‚å‚è€ƒ<a href="https://blog.csdn.net/CYK5201995/article/details/107769487">è½¯ä»¶ |hexoåšå®¢ä¸»é¢˜yiliaä¸Šä¸€é¡µä¸‹ä¸€é¡µæ˜¾ç¤ºçš„é—®é¢˜_RyanCYKçš„è®¡ç®—æœºä¸–ç•Œ-CSDNåšå®¢</a></p><h2><span id="gitalk-è¯„è®º">Gitalk è¯„è®º</span></h2><p>åœ¨<a href="https://github.com/settings/applications/new">New OAuthApplication (github.com)</a>ä¸­è¿›è¡Œæ³¨å†Œï¼Œå¦‚ä¸‹å›¾ï¼š</p><figure><img src="https://i.loli.net/2021/07/17/9qHwNdr5CxtZ3Sz.png" alt="image-20210717000639493"><figcaption aria-hidden="true">image-20210717000639493</figcaption></figure><p>æ³¨å†Œå¥½ä¹‹åï¼Œå°±å¯ä»¥å¾—åˆ°Client IDå’ŒClientSecretï¼Œç„¶åæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä»¶ä»“åº“ç”¨æ¥æ‰¿æ¥gitalkçš„è¯„è®ºã€‚</p><p>åœ¨ä¸»é¢˜ä¸‹çš„<code>_config.yml</code>ä¸­æ‰¾åˆ°gitalké…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">gitalk:</span></span><br><span class="line">    <span class="attr">githubID:</span> <span class="comment"># å¡«ä½ çš„ github ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">repo:</span> <span class="string">xxx.github.io</span> <span class="comment"># æ‰¿è½½è¯„è®ºçš„ä»“åº“ï¼Œä¸€èˆ¬ä½¿ç”¨ Github Page ä»“åº“</span></span><br><span class="line">    <span class="attr">ClientID:</span> <span class="comment"># ç¬¬1æ­¥è·å¾— Client ID</span></span><br><span class="line">    <span class="attr">ClientSecret:</span> <span class="comment"># ç¬¬1æ­¥è·å¾— Client Secret</span></span><br><span class="line">    <span class="attr">adminUser:</span> <span class="comment"># Github ç”¨æˆ·å</span></span><br><span class="line">    <span class="attr">distractionFreeMode:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line">    <span class="attr">perPage:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°éƒ¨ç½²åšå®¢é¡µé¢å°±å¯ä»¥çœ‹åˆ°è¯„è®ºåŒºå‡ºç°äº†</p><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://yelog.org/2020/05/23/3-hexo-comment/">3-hexoè¯„è®ºè®¾ç½® |å¶è½é˜ (yelog.org)</a> è¿™ä¸ªåšä¸»çš„yiliaè¿˜è›®å…¨é¢çš„</p><p>åœ¨ä½¿ç”¨çš„æ—¶å€™å‘ç°äº†ä»¥ä¸‹å¼‚å¸¸ï¼ŒGitalkå‡ºç°Error:ValidationFailedé—®é¢˜ï¼Œç»è¿‡æŸ¥è¯¢å‘ç°è¿™æ˜¯ç”±äºGitalkçš„idæœ‰é•¿åº¦é™åˆ¶ï¼Œè€Œåœ¨yiliaä¸­é»˜è®¤æ˜¯å°†é€šè¿‡urlè®¾ç½®ä¸ºidï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“é•¿åº¦è¶…è¿‡50ï¼Œè§£å†³åŠæ³•ï¼šæˆ‘ä»¬å¯ä»¥æŠŠidè®¾ç½®ä¸ºæ–‡ç« æ ‡é¢˜ï¼Œè¿™æ ·å­å°±ä¸å®¹æ˜“è¶…è¿‡50äº†ã€‚ä¿®æ”¹<code>yilia/layout/_partial/post/gitment.ejs</code>ï¼Œç¬¬6è¡Œä¿®æ”¹ä¸º<code>id: "&lt;%=post.title%&gt;"</code>ï¼Œé—®é¢˜è§£å†³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Javaé€šè¿‡Nginxåå‘ä»£ç†æœåŠ¡å™¨æ“ä½œPostgreSQLæ•°æ®åº“</title>
      <link href="/2021/07/08/java/shi-yong-java-tong-guo-nginx-fan-xiang-dai-li-fu-wu-qi-cao-zuo-postgresql-shu-ju-ku/"/>
      <url>/2021/07/08/java/shi-yong-java-tong-guo-nginx-fan-xiang-dai-li-fu-wu-qi-cao-zuo-postgresql-shu-ju-ku/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œéœ€è¦è®²AndroidAppå’ŒæœåŠ¡å™¨ä¸Šçš„PostgreSQLè¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯AndroidStudioä¸èƒ½å¤Ÿç›´æ¥é€šè¿‡JDBCè¿›è¡Œè¿æ¥ï¼Œæ‰€ä»¥é€‰æ‹©é€šè¿‡Nginxä½œä¸ºä¸­é—´æœåŠ¡å™¨å¯¹PostgreSQLè¿›è¡Œæ“ä½œï¼Œè¿™ç¯‡æ–‡ç« ç´§æ¥<a href="https://lucas-hao.github.io/2021/07/06/nginx-yi-ji-ngx-postgres-an-zhuang-yi-ji-pei-zhi/#more">Nginxä»¥åŠngx_postgreså®‰è£…ä»¥åŠé…ç½®</a>ã€‚</p><p><strong>æ›´æ–°ï¼šåæ¥å‘ç°ä½¿ç”¨nginxçš„æ•ˆæœå¹¶ä¸å¥½ï¼Œæ›´å¥½çš„æ–¹æ³•å¯èƒ½æ˜¯ä½¿ç”¨PostgREST+Nginxåå‘ä»£ç†å¯¹æ•°æ®åº“è¿›è¡Œæ“ä½œï¼Œå› ä¸ºPostgRESTç›´æ¥æä¾›äº†å¤„ç†PostgreSQLæ•°æ®åº“çš„RESTfulæ¥å£ï¼Œæ›´åŠ æ–¹ä¾¿ã€‚è¯¦ç»†æ•™ç¨‹å¯ä»¥å»ç½‘ä¸Šæœä¸€æœã€‚</strong></p><span id="more"></span><p>æˆ‘ä»¬çš„æ•°æ®åº“ä¸­çš„æ•°æ®ä¸»è¦å­˜å‚¨çš„æ˜¯Androidappä¸­çš„ä½¿ç”¨ä¿¡æ¯ï¼Œå®šä¹‰app_usage_infoè¡¨æ‹¥æœ‰ä»¥ä¸‹å­—æ®µ</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">day</span> <span class="type">date</span>,</span><br><span class="line">app_name text,</span><br><span class="line">package_name text,</span><br><span class="line">app_usage_time <span class="type">interval</span>,</span><br><span class="line">app_usage_count <span class="type">integer</span></span><br></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯¹nginxçš„é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼Œnginxçš„é…ç½®æ–‡ä»¶ä¸€èˆ¬æ˜¯åœ¨nginxçš„å®‰è£…ç›®å½•ä¸‹çš„/conf/nginx.confï¼Œæ¯”å¦‚åœ¨æˆ‘çš„ç³»ç»Ÿä¸­å°±æ˜¯/opt/nginx/conf/nginx.confï¼Œæ‰“å¼€é…ç½®æ–‡ä»¶æˆ‘ä»¬å°±å¯ä»¥è¿›è¡Œé…ç½®ã€‚Nginxçš„é…ç½®æ–‡ä»¶ç»“æ„å¯ä»¥åœ¨<a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html">Nginxé…ç½®è¯¦è§£ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a>ä¸­ç®€å•å­¦ä¹ ä¸€ä¸‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 1;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">        include         mime.types;</span><br><span class="line">        default_type    application/octet-stream;</span><br><span class="line">    sendfile        on;</span><br><span class="line">        keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    upstream database &#123;</span><br><span class="line">        postgres_server 172.29.118.77 dbname=postgres user=postgres password=511668;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line"></span><br><span class="line">        charset utf-8;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name localhost;</span><br><span class="line"></span><br><span class="line">        location /insert &#123;</span><br><span class="line">            postgres_pass database;</span><br><span class="line">            rds_json on;</span><br><span class="line">            postgres_query &quot;insert into app_usage_info VALUES (&#x27;$arg_day&#x27;, &#x27;$arg_app_name&#x27;, &#x27;$arg_package_name&#x27;, &#x27;$arg_time&#x27;, &#x27;$arg_count&#x27;);</span><br><span class="line">            postgres_rewrite no_changes 410;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /query-all &#123;</span><br><span class="line">            postgres_pass database;</span><br><span class="line">            rds_json on;</span><br><span class="line">            postgres_query &quot;select * from app_usage_info&quot;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location /query-day &#123;</span><br><span class="line">            postgres_pass database;</span><br><span class="line">            rds_json on;</span><br><span class="line"></span><br><span class="line">            postgres_query      HEAD GET &quot;SELECT * FROM app_usage_info WHERE day=&#x27;$arg_day&#x27;&quot;;</span><br><span class="line">            postgres_rewrite    HEAD GET no_rows 410;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">               root   html;</span><br><span class="line">               index  index.html index.htm;</span><br><span class="line">        &#125;</span><br><span class="line">       # é”™è¯¯é¡µé¢ </span><br><span class="line">        error_page   500 502 503 504  /50x.html;</span><br><span class="line">        location = /50x.html &#123;</span><br><span class="line">                root    html;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯æˆ‘çš„ä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œä¸ºäº†å¯¹æ•°æ®åº“åšä¸åŒçš„å¤„ç†ï¼Œæˆ‘å®šä¹‰äº†inserté¡µé¢ï¼Œquery-dayï¼ˆæŸ¥è¯¢æŒ‡å®šå¤©æ•°ï¼‰é¡µé¢ï¼Œquery-allï¼ˆæŸ¥è¯¢æ•´ä¸ªè¡¨ï¼‰é¡µé¢ã€‚è¿™é‡Œé¢è¿˜æ¶‰åŠåˆ°å…³äºNginxä¸­å˜é‡çš„ä½¿ç”¨ï¼Œå¯ä»¥çœ‹è¿™ä¸€ç¯‡<a href="https://www.jianshu.com/p/44680c081ea0">Nginxå˜é‡ä½¿ç”¨æ–¹æ³•è¯¦è§£ -ç®€ä¹¦(jianshu.com)</a>ï¼Œè®²å¾—è¿˜æ˜¯éå¸¸çš„æ¸…æ¥šçš„ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†<code>$arg_XXX</code>å˜é‡ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡httpç½‘å€è¿›è¡Œå‚æ•°çš„è®¾å®šäº†ï¼Œä¹Ÿå°±å¾ˆæ–¹ä¾¿çš„å¯ä»¥é€šè¿‡JAVAçš„Httpè¯·æ±‚æ‰§è¡Œå¯¹åº”çš„æ•°æ®åº“æ“ä½œã€‚</p><p>ä¸‹é¢æ˜¯ç”¨æ¥å®ç°Httpè¯·æ±‚çš„Javaç±»ï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« å®ç°<a href="https://www.jb51.net/article/206762.htm#:~:text=JAVAå‘é€HTTPè¯·æ±‚çš„å››ç§æ–¹å¼æ€»ç»“%201%20HttpURLConnection%202,URLConnection%203%20HttpClient%204%20Socket">JAVAå‘é€HTTPè¯·æ±‚çš„å››ç§æ–¹å¼æ€»ç»“_java_è„šæœ¬ä¹‹å®¶(jb51.net)</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HttpUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String uri;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HttpUtils</span><span class="params">(String hostname)</span> &#123;</span><br><span class="line">        uri = hostname;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendRequest</span><span class="params">(String url, Callback callback)</span> &#123;</span><br><span class="line">        <span class="type">OkHttpClient</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OkHttpClient</span>();</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Builder().url(url).build();</span><br><span class="line">        client.newCall(request).enqueue(callback);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sendRequestWithHttpURL</span><span class="params">(String urlParam,String requestType)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">HttpURLConnection</span> <span class="variable">con</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">StringBuffer</span> <span class="variable">resultBuffer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(urlParam);</span><br><span class="line">            <span class="comment">//å¾—åˆ°è¿æ¥å¯¹è±¡</span></span><br><span class="line">            con = (HttpURLConnection) url.openConnection();</span><br><span class="line">            <span class="comment">//è®¾ç½®è¯·æ±‚ç±»å‹</span></span><br><span class="line">            con.setRequestMethod(requestType);</span><br><span class="line">            <span class="comment">//è®¾ç½®è¯·æ±‚éœ€è¦è¿”å›çš„æ•°æ®ç±»å‹å’Œå­—ç¬¦é›†ç±»å‹</span></span><br><span class="line">            con.setRequestProperty(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;application/json;charset=utf-8&quot;</span>);</span><br><span class="line">            <span class="comment">//å…è®¸å†™å‡º</span></span><br><span class="line">            con.setDoOutput(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//å…è®¸è¯»å…¥</span></span><br><span class="line">            con.setDoInput(<span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//ä¸ä½¿ç”¨ç¼“å­˜</span></span><br><span class="line">            con.setUseCaches(<span class="literal">false</span>);</span><br><span class="line">            <span class="comment">//å¾—åˆ°å“åº”ç </span></span><br><span class="line">            <span class="type">int</span> <span class="variable">responseCode</span> <span class="operator">=</span> con.getResponseCode();</span><br><span class="line">            System.out.println(urlParam + <span class="string">&quot;: &quot;</span> + responseCode);</span><br><span class="line">            <span class="keyword">if</span>(responseCode == HttpURLConnection.HTTP_OK)&#123;</span><br><span class="line">                <span class="comment">//å¾—åˆ°å“åº”æµ</span></span><br><span class="line">                <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> con.getInputStream();</span><br><span class="line">                <span class="comment">//å°†å“åº”æµè½¬æ¢æˆå­—ç¬¦ä¸²</span></span><br><span class="line">                resultBuffer = <span class="keyword">new</span> <span class="title class_">StringBuffer</span>();</span><br><span class="line">                String line;</span><br><span class="line">                buffer = <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream, <span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">                <span class="keyword">while</span> ((line = buffer.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                    resultBuffer.append(line);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> resultBuffer.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ProtocolException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Failed!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(String day, String app_name, String package_name, String interval, <span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseData</span> <span class="operator">=</span> sendRequestWithHttpURL(uri+<span class="string">&quot;/insert?&quot;</span>+<span class="string">&quot;day=&quot;</span>+day+<span class="string">&quot;&amp;app_name=&quot;</span>+app_name+<span class="string">&quot;&amp;package_name=&quot;</span>+package_name+<span class="string">&quot;&amp;time=&quot;</span>+interval+<span class="string">&quot;&amp;count=&quot;</span>+count, <span class="string">&quot;POST&quot;</span>);</span><br><span class="line">        System.out.println(responseData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryAll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseData</span> <span class="operator">=</span> sendRequestWithHttpURL(uri+<span class="string">&quot;/query-all&quot;</span>, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        System.out.println(responseData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryDay</span><span class="params">(String day)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">responseData</span> <span class="operator">=</span> sendRequestWithHttpURL(uri+<span class="string">&quot;/query-day?day=&quot;</span>+day, <span class="string">&quot;GET&quot;</span>);</span><br><span class="line">        System.out.println(responseData);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>mainå‡½æ•°æ‰€åœ¨ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span><span class="string">&quot;your host address&quot;</span>;</span><br><span class="line">        <span class="type">HttpUtils</span> <span class="variable">http</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpUtils</span>(url);</span><br><span class="line">        http.queryAll();</span><br><span class="line">        http.queryDay(<span class="string">&quot;2021-07-07&quot;</span>);</span><br><span class="line">        http.insert(<span class="string">&quot;2021-07-08&quot;</span>, <span class="string">&quot;åä¸ºæ¡Œé¢&quot;</span>, <span class="string">&quot;com.huawei.android.launcher&quot;</span>,</span><br><span class="line">                <span class="string">&quot;00:18:41&quot;</span>, <span class="number">63</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¨‹åºè¿è¡Œç»“æœ</p><figure><img src="https://i.loli.net/2021/07/16/DJsO18TfyU29MSz.png" alt="image-20210708152524585"><figcaption aria-hidden="true">image-20210708152524585</figcaption></figure><h4><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h4><p>[1] <a href="https://www.runoob.com/w3cnote/nginx-setup-intro.html">Nginxé…ç½®è¯¦è§£ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><p>[2] <a href="https://www.jianshu.com/p/44680c081ea0">Nginxå˜é‡ä½¿ç”¨æ–¹æ³•è¯¦è§£ -ç®€ä¹¦ (jianshu.com)</a></p><p>[3] <a href="https://www.jb51.net/article/206762.htm#:~:text=JAVAå‘é€HTTPè¯·æ±‚çš„å››ç§æ–¹å¼æ€»ç»“%201%20HttpURLConnection%202,URLConnection%203%20HttpClient%204%20Socket">JAVAå‘é€HTTPè¯·æ±‚çš„å››ç§æ–¹å¼æ€»ç»“_java_è„šæœ¬ä¹‹å®¶(jb51.net)</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> PostgreSQL </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginxä»¥åŠngx_postgreså®‰è£…ä»¥åŠé…ç½®</title>
      <link href="/2021/07/06/backend/nginx-yi-ji-ngx-postgres-an-zhuang-yi-ji-pei-zhi/"/>
      <url>/2021/07/06/backend/nginx-yi-ji-ngx-postgres-an-zhuang-yi-ji-pei-zhi/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšä¸€ä¸ªé¡¹ç›®ï¼Œéœ€è¦è®²AndroidAppå’ŒæœåŠ¡å™¨ä¸Šçš„PostgreSQLè¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯AndroidStudioä¸èƒ½å¤Ÿç›´æ¥é€šè¿‡JDBCè¿›è¡Œè¿æ¥ï¼Œæ‰€ä»¥é€‰æ‹©é€šè¿‡Nginxä½œä¸ºä¸­é—´æœåŠ¡å™¨å¯¹PostgreSQLè¿›è¡Œæ“ä½œã€‚ä»¥ä¸‹ç®€å•è®°å½•ä¸€ä¸‹å®‰è£…nginxå’Œé…ç½®ngx_postgresçš„è¿‡ç¨‹<span id="more"></span></p><p>é¦–å…ˆï¼Œç”±äºæˆ‘ä»¬åœ¨æ‰‹åŠ¨å®‰è£…çš„è¿‡ç¨‹ä¸­éœ€è¦å¯¹nginxçš„æºç è¿›è¡Œç¼–è¯‘ï¼Œæ‰€ä»¥é¦–å…ˆç³»ç»Ÿä¸­å¿…é¡»å…·æœ‰C/C++çš„ç¼–è¯‘å™¨ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰‹åŠ¨å®‰è£…ä¸€ä¸‹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> apt-get install gcc <span class="comment"># å®‰è£…Cè¯­è¨€ç¼–è¯‘å™¨gcc</span></span><br><span class="line"><span class="built_in">sudo</span> apt-get install g++ <span class="comment"># å®‰è£…C++ç¼–è¯‘å™¨g++</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¾æ¬¡å®‰è£…æˆ‘ä»¬éœ€è¦çš„åŒ…ï¼Œè¿™é‡Œæˆ‘å…¨éƒ¨å®‰è£…åˆ°<code>~/packages</code>è·¯å¾„ä¸‹ã€‚å¯¹äºå‹ç¼©åŒ…ä½¿ç”¨<code>wget address</code>å‘½ä»¤ä¸‹è½½ï¼Œä½¿ç”¨<code>tar -zxvf filename.tar.gz</code>è¿›è¡Œè§£å‹ï¼›å¯¹äºgithubä¸Šçš„ä»“åº“ï¼Œä½¿ç”¨<code>git clone github_address</code>å…‹éš†åˆ°æœ¬åœ°ã€‚</p><ul><li><p>nginx http://nginx.org/download/nginx-1.20.1.tar.gz</p><p>åœ¨å®˜ç½‘http://nginx.org/download/æ‰¾åˆ°å¯¹åº”çš„å‹ç¼©åŒ…ï¼Œç„¶åä¸‹è½½è§£å‹</p></li><li><p>ngx_postgres https://github.com/FRiCKLE/ngx_postgres.git</p></li><li><p>ngx_postgresè¿˜éœ€è¦ä¸‹è½½å®‰è£…libpqï¼Œå¦åˆ™å°±ä¼šåœ¨ç¼–è¯‘çš„æ—¶å€™å‡ºç°é”™è¯¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure: error: ngx_postgres addon was unable to find the libpq library.</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>sudo apt-get install libpq-dev</code>è¿›è¡Œå®‰è£…</p></li><li><p>ngx_devel_kithttps://github.com/vision5/ngx_devel_kit.git</p></li><li><p>rds-json-nginx-modulehttps://github.com/openresty/rds-json-nginx-module.git</p></li><li><p>form-input-nginx-modulehttps://github.com/nginx-modules/form-input-nginx-module.git</p></li></ul><p>è¿˜æœ‰å‡ ä¸ªnginxæœ¬èº«éœ€è¦ä¾èµ–çš„åŒ…ï¼Œå³ä½¿ä¸ä½¿ç”¨ngx_postgresä¹Ÿæ˜¯éœ€è¦ä¸‹è½½å®‰è£…çš„</p><ul><li><p>pcre:https://jaist.dl.sourceforge.net/project/pcre/pcre/8.45/pcre-8.45.tar.gz</p><p>åœ¨è¿™ä¸ªç½‘ç«™å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å‹ç¼©åŒ…http://sourceforge.net/projects/pcre/files/pcre/</p></li><li><p>zlib:https://jaist.dl.sourceforge.net/project/libpng/zlib/1.2.11/zlib-1.2.11.tar.gz</p><p>å®˜ç½‘ https://www.zlib.net/</p><figure><img src="https://i.loli.net/2021/07/16/zT3L16CWE8FmY9v.png" alt="zlib"><figcaption aria-hidden="true">zlib</figcaption></figure></li><li><p>openssl Github åœ°å€:https://github.com/openssl/openssl.git</p></li></ul><p>å…¨éƒ¨ä¸‹è½½å®Œæˆä¹‹ååº”è¯¥æœ‰ä»¥ä¸‹æ–‡ä»¶å¤¹</p><figure><img src="https://i.loli.net/2021/07/16/H9VpaqmzQldSgnR.png" alt="packages"><figcaption aria-hidden="true">packages</figcaption></figure><p>ç„¶åè¿›å…¥nginx-1.20.1ç›®å½•ä¸‹ï¼Œè¿™ä¸ªç›®å½•ä¸‹æœ‰ä¸€ä¸ªconfigureå¯æ‰§è¡Œæ–‡ä»¶ï¼Œåœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/opt/nginx \\</span><br><span class="line">--with-pcre=/home/ubuntu/packages/pcre-8.45 \\ </span><br><span class="line">--with-zlib=/home/ubuntu/packages/zlib-1.2.11 \\ </span><br><span class="line">--with-openssl=/home/ubuntu/packages/openssl \\ </span><br><span class="line">--add-module=/home/ubuntu/packages/ngx_postgres \\</span><br><span class="line">--add-module=/home/ubuntu/packages/rds-json-nginx-module \\ </span><br><span class="line">--add-module=/home/ubuntu/packages/ngx_devel_kit \\</span><br><span class="line">--add-module=/home/ubuntu/packages/form-input-nginx-module</span><br></pre></td></tr></table></figure><p><code>--prefix=/opt/nginx</code>ä»£è¡¨æˆ‘æŠŠnginxå®‰è£…åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œä¸‹é¢å‡ è¡Œæ˜¯æ‰€æ·»åŠ çš„moduleå’ŒåŒ…ï¼Œå¡«ä¸Šè‡ªå·±çš„æ–‡ä»¶è·¯å¾„å°±å¯ä»¥äº†ã€‚ç„¶åè¿è¡Œå‘½ä»¤<code>make</code>ï¼Œå¦‚æœæ²¡æœ‰ä¸‹è½½makeçš„è¯ä½¿ç”¨<code>apt-get</code>å®‰è£…ä»¥ä¸‹å°±å¥½äº†ã€‚æ‰§è¡Œäº†<code>make</code>ä¹‹åï¼Œå‡ºç°äº†ä»¥ä¸‹é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/home/ubuntu/packages/ngx_postgres/src/ngx_postgres_module.c:1323:21: error: â€˜ngx_http_upstream_srv_conf_tâ€™ &#123;aka â€˜struct ngx_http_upstream_srv_conf_sâ€™&#125; has no member named â€˜default_portâ€™</span><br><span class="line"> 1323 |         <span class="keyword">if</span> (uscfp[i]-&gt;default_port &amp;&amp; url-&gt;default_port</span><br><span class="line">      |                     ^~</span><br><span class="line">/home/ubuntu/packages/ngx_postgres/src/ngx_postgres_module.c:1324:25: error: â€˜ngx_http_upstream_srv_conf_tâ€™ &#123;aka â€˜struct ngx_http_upstream_srv_conf_sâ€™&#125; has no member named â€˜default_portâ€™</span><br><span class="line"> 1324 |             &amp;&amp; (uscfp[i]-&gt;default_port != url-&gt;default_port))</span><br></pre></td></tr></table></figure><p>åˆ°nginxçš„<code>src/http/ngx_http_upstream.h</code>æ–‡ä»¶æ‰¾åˆ°<code>ngx_http_upstream_srv_conf_s</code>ç»“æ„æ·»åŠ <code>in_port_t default_port;</code></p><p><img src="https://i.loli.net/2021/07/16/OjwVoBn2Xzg7ypc.png"></p><p>ç„¶åæ‰§è¡Œå‘½ä»¤<code>make</code>ï¼Œæ²¡æœ‰é—®é¢˜ä¹‹åæ‰§è¡Œ<code>make install</code>å°±å¯ä»¥æˆåŠŸå®‰è£…äº†ã€‚</p><p>å®‰è£…æˆåŠŸï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„å®‰è£…è·¯å¾„ä¸‹<code>/opt/nginx</code>æ‰¾åˆ°å¯¹åº”çš„å®‰è£…ç›®å½•ï¼Œnginxå¯æ‰§è¡Œæ–‡ä»¶å°±æ˜¯/opt/nginx/sbin/nginxè¿™ä¸ªè·¯å¾„ã€‚</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨nginxæœåŠ¡</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /opt/nginx/sbin/nginx -c /opt/nginx/conf/nginx.conf</span><br></pre></td></tr></table></figure><p>æœ€åæˆ‘ä»¬å¯ä»¥åˆ›å»ºè½¯é“¾æ¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ç”¨è‡ªå·±æ‰‹åŠ¨é…ç½®äº†ï¼Œåªéœ€è¦è¾“å…¥sudonginxå°±å¯ä»¥å¯åŠ¨äº†</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ln -s /opt/nginx/sbin/nginx /usr/bin/nginx</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>sudo nginx</code>å¼€å§‹nginxï¼Œ<code>nginx -s stop</code>åœæ­¢nginxã€‚æ‰“å¼€nginxä¹‹åï¼Œå°±å¯ä»¥åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨åŸŸåä¸‹çœ‹åˆ°å¦‚ä¸‹çš„é¡µé¢</p><p><img src="https://i.loli.net/2021/07/16/ibrBwHGD3h9aIAO.png"></p><h4><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h4><p>[1]çŸ¥ä¹ï¼Œ<em>nginxå®‰è£…åŠå…¶é…ç½®è¯¦ç»†æ•™ç¨‹</em>ï¼Œhttps://zhuanlan.zhihu.com/p/83890573</p><p>[2] CSDNï¼Œ<em>ubuntuæ‰‹åŠ¨å®‰è£…nginx</em>ï¼Œhttps://blog.csdn.net/xiaoyou625/article/details/112006193</p><p>[3] HostAdvice, <em>How to Install PostgreSQL on an Ubuntu VPSRunning Nginx</em>,https://hostadvice.com/how-to/how-to-install-postgresql-on-nginx-web-servers/</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PostgreSQL </tag>
            
            <tag> Nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå®ç°ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨</title>
      <link href="/2021/07/01/java/java-jian-dan-de-ji-suan-qi/"/>
      <url>/2021/07/01/java/java-jian-dan-de-ji-suan-qi/</url>
      
        <content type="html"><![CDATA[<h1><span id="javaå®ç°ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨">Javaå®ç°ä¸€ä¸ªç®€å•çš„è®¡ç®—å™¨</span></h1><p>åœ¨LeetCodeä¸Šæœ‰å‡ é“é¢˜ç›®å®ç°ç®€å•çš„è®¡ç®—å™¨ï¼Œæœ€è¿‘åˆšåˆšåœ¨Algorithms (4thedition)ä¸Šå­¦ä¹ äº†åˆ©ç”¨æ ˆå®ç°ç®€å•çš„è®¡ç®—å™¨ï¼Œä½¿ç”¨çš„æ˜¯E.W.Dijkstraåœ¨1960sæå‡ºçš„æ ˆç®—æ³•å®ç°çš„ã€‚åˆ©ç”¨æ ˆåè¿›å…ˆå‡ºçš„ç‰¹æ€§ï¼Œå¯ä»¥å®ç°å¯¹æ‹¬å·ä»¥åŠä¼˜å…ˆçº§çš„å¤„ç†ã€‚ç¬¬ä¸€æ¬¡å°è¯•è¿™ç§ç®—æ³•ï¼Œå†™å‡ºæ¥çš„ä»£ç æ•ˆç‡ä¹Ÿä¸æ˜¯å¾ˆé«˜ã€‚</p><span id="more"></span><h3><span id="åŸºæœ¬æƒ³æ³•">åŸºæœ¬æƒ³æ³•</span></h3><p>é¦–å…ˆï¼Œåˆå§‹åŒ–ä¸¤ä¸ªæ ˆï¼Œä¸€ä¸ªç”¨æ¥å­˜å‚¨è¿ç®—ç¬¦ï¼ˆåŒ…æ‹¬æ‹¬å·å’Œå„ç§è¿ç®—ç¬¦)ã€‚<code>Stack&lt;String&gt; ops = new Stack&lt;String&gt;();</code><code>Stack&lt;Integer&gt; vals = new Stack&lt;Integer&gt;();</code>ç¬¬ä¸€ä¸ªç¨‹åºå®ç°çš„æ˜¯åªåŒ…æ‹¬åŠ å‡çš„ï¼Œå› æ­¤æ²¡æœ‰è¿ç®—ä¼˜å…ˆé¡ºåºï¼Œåªéœ€è¦è€ƒè™‘æ‹¬å·ï¼Œç©ºæ ¼ç­‰å­—ç¬¦ã€‚åŸºæœ¬æƒ³æ³•æ˜¯ï¼šå‘standardinputå†…è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨è¾¾å¼ï¼Œç„¶åå¯¹æ•°å­—å’Œç¬¦å·è¿›è¡Œå„è‡ªå¯¹åº”çš„å¤„ç†ã€‚é‡åˆ°ä¸€ä¸ªæ•°å­—ï¼Œpushè¿›<code>vals</code>æ ˆï¼Œé‡åˆ°ä¸€ä¸ªè¿ç®—ç¬¦ï¼Œå…ˆåˆ¤æ–­åœ¨<code>ops</code>ä¸­çš„ä¸Šä¸€ä¸ªå­—ç¬¦æ˜¯å¦å¯ä»¥è¿›è¡Œè¿ç®—ï¼ˆä¹‹æ‰€ä»¥è¿™æ ·å­åšæ˜¯å› ä¸ºè¿™æ ·å­ä¹Ÿå¯ä»¥æ–¹ä¾¿åˆ¤æ–­ä¼˜å…ˆçº§ï¼‰ï¼Œè‹¥å¯ä»¥è¿›è¡Œè¿ç®—ï¼Œé‚£ä¹ˆå°±å°†<code>ops</code>ä¸­çš„ä¸€ä¸ªç¬¦å·å’Œ<code>vals</code>çš„æ•°popå‡ºæ¥è¿›è¡Œå¯¹åº”çš„è¿ç®—ï¼Œç„¶åå°†å½“å‰çš„è¿ç®—ç¬¦pushè¿›<code>ops</code>ï¼Œå¦åˆ™ï¼Œç›´æ¥å°†å½“å‰ç¬¦å·pushè¿›<code>ops</code>ã€‚å¦‚æœé‡åˆ°å³æ‹¬å·ï¼Œç›´æ¥å¯¹æ ˆä¸­çš„å…ƒç´ è¿›è¡Œè¿ç®—ç›´åˆ°é‡åˆ°å·¦æ‹¬å·ã€‚</p><h3><span id="å¯¹äºå­—ç¬¦ä¸²è½¬æ•´å‹çš„å¤„ç†">å¯¹äºå­—ç¬¦ä¸²è½¬æ•´å‹çš„å¤„ç†</span></h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ª<code>int flag = 0</code>ï¼Œè‹¥è¯»å–çš„å½“å‰å­—ç¬¦ä¸ºæ•°å­—ï¼Œé‚£ä¹ˆå°±å°†<code>flag</code>çš„å€¼è®¾ä¸º1ï¼Œå¹¶ä¸”å°†è¿™ä¸ªæ•°å­—è½¬åŒ–ä¸º<code>int</code>å…¥æ ˆã€‚è‹¥å½“å‰çš„å­—ç¬¦ä¸ä¸ºæ•°å­—ï¼Œè®°å¾—ä¸€å®šè¦å°†<code>flag</code>çš„å€¼é‡æ–°è®¾ä¸º0ã€‚ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++)&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">currentString</span> <span class="operator">=</span> s.subString(i,i+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(currentChar.charAt(<span class="number">0</span>) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; currentChar.charAt(<span class="number">0</span>) &lt;= <span class="string">&#x27;9&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(flag == <span class="number">0</span>)</span><br><span class="line">            vals.push(Integer.parseInt(currentChar));</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">       vals.push(Integer.parseInt(Integer.toString(vals.pop())+currentChar()));</span><br><span class="line">        flag = <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </span></h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">calculate</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> s.length();</span><br><span class="line">        Stack&lt;String&gt; ops = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;String&gt;();</span><br><span class="line">        Stack&lt;Integer&gt; vals = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">currentChar</span> <span class="operator">=</span> s.substring(i, i + <span class="number">1</span>);</span><br><span class="line">            <span class="comment">//å°†å½“å‰ä½ç½®çš„å­—ç¬¦è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">            <span class="keyword">if</span> (currentChar.equals(<span class="string">&quot; &quot;</span>))</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span> (currentChar.charAt(<span class="number">0</span>) &gt;= <span class="string">&#x27;0&#x27;</span> &amp;&amp; currentChar.charAt(<span class="number">0</span>) &lt;= <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (flag == <span class="number">0</span>)</span><br><span class="line">                    vals.push(Integer.parseInt(currentChar));</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    vals.push(Integer.parseInt(Integer.toString(vals.pop()) + currentChar));</span><br><span class="line">                flag = <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (currentChar.equals(<span class="string">&quot;(&quot;</span>);</span><br><span class="line">                ops.push(currentChar);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (currentChar.equals(<span class="string">&quot;+&quot;</span>) || currentChar.equals(<span class="string">&quot;-&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">if</span>(ops.isEmpty());</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(ops.peek().equals(<span class="string">&quot;+&quot;</span>) || ops.peek().equals(<span class="string">&quot;-&quot;</span>))&#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> vals.pop();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">op</span> <span class="operator">=</span> ops.pop();</span><br><span class="line">                    <span class="keyword">if</span>(op.equals(<span class="string">&quot;+&quot;</span>))</span><br><span class="line">                        x = vals.pop() + x;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(op.equals(<span class="string">&quot;-&quot;</span>))</span><br><span class="line">                        x = vals.pop() - x;</span><br><span class="line">                    vals.push(x);</span><br><span class="line">                &#125;</span><br><span class="line">                ops.push(currentChar);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (currentChar.equals(<span class="string">&quot;)&quot;</span>)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">op</span> <span class="operator">=</span> ops.pop();</span><br><span class="line">                <span class="keyword">while</span> (!op.equals(<span class="string">&quot;(&quot;</span>)) &#123;</span><br><span class="line">                    <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> vals.pop();</span><br><span class="line">                    <span class="keyword">if</span> (op.equals(<span class="string">&quot;+&quot;</span>))</span><br><span class="line">                        x = vals.pop() + x;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (op.equals(<span class="string">&quot;-&quot;</span>))</span><br><span class="line">                        x = vals.pop() - x;</span><br><span class="line">                    vals.push(x);</span><br><span class="line">                    <span class="keyword">if</span> (!ops.isEmpty())</span><br><span class="line">                        op = ops.pop();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!ops.isEmpty()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">op</span> <span class="operator">=</span> ops.pop();</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> vals.pop();</span><br><span class="line">            <span class="keyword">if</span> (op.equals(<span class="string">&quot;+&quot;</span>))</span><br><span class="line">                x = vals.pop() + x;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (op.equals(<span class="string">&quot;-&quot;</span>))</span><br><span class="line">                x = vals.pop() - x;</span><br><span class="line">            vals.push(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> vals.pop();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
            <tag> Java </tag>
            
            <tag> æ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA Stringå­¦ä¹ ç¬”è®°</title>
      <link href="/2021/07/01/java/java-string-xue-xi-bi-ji/"/>
      <url>/2021/07/01/java/java-string-xue-xi-bi-ji/</url>
      
        <content type="html"><![CDATA[<p>Stringæ˜¯ä¸€ç§ç‰¹æ®Šçš„å¯¹è±¡ï¼ˆä¸åŒäº8ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼‰ã€‚Stringç±»çš„ç‰¹æ®Šæ€§å¯ä»¥å®ƒçš„ä¸¤ä¸ªå…¶ä»–çš„ç±»ä¸å…·æœ‰çš„ç‰¹ç‚¹ä½“ç°å‡ºæ¥<span id="more"></span></p><ul><li><p>åœ¨åˆ›å»ºä¸€ä¸ªStringå¯¹è±¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥é€šè¿‡å’Œå…¶ä»–ç±»ç±»ä¼¼çš„åˆ›å»ºæ–¹å¼ï¼Œé€šè¿‡<code>new</code>çš„æ–¹å¼åˆ›å»ºï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡èµ‹å€¼åˆ›å»º<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">newStr1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;content&quot;</span>); <span class="comment">// å’Œå…¶ä»–å¯¹è±¡ç±»ä¼¼çš„åˆ›å»ºæ–¹å¼</span></span><br><span class="line"><span class="type">String</span> <span class="variable">newStr2</span> <span class="operator">=</span>  <span class="string">&quot;content&quot;</span>;</span><br><span class="line"><span class="comment">// String ç‰¹æ®Šçš„åˆ›å»ºæ–¹å¼</span></span><br></pre></td></tr></table></figure></p></li><li><p>Stringå¯ä»¥ç›´æ¥è¿›è¡Œ+è¿ç®—ï¼Œè¾¾åˆ°å­—ç¬¦ä¸²è¿æ¥çš„æ•ˆæœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> <span class="string">&quot;One String&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str4</span> <span class="operator">=</span> <span class="string">&quot; Another String&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str5</span> <span class="operator">=</span> str3 + str4;</span><br><span class="line"><span class="comment">// str5 = &quot;One String Another String&quot;</span></span><br></pre></td></tr></table></figure></li></ul><p>å¦å¤–ä¸€ä¸ªéœ€è¦æ³¨æ„çš„ç‚¹ï¼šStringå¯ä»¥ä¸ºç©ºï¼Œä½†æ˜¯ç©ºå­—ç¬¦ä¸²ä¸ä»£è¡¨<code>null</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str6</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">str7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();</span><br><span class="line"><span class="type">String</span> <span class="variable">str8</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">/* str6å’Œstr7ä¸€æ ·,ä½†å’Œstr8ä¸ä¸€æ · */</span></span><br></pre></td></tr></table></figure><p>Stringä½œä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå…·æœ‰ä¸€ä¸ªå¯¹è±¡åº”è¯¥å…·æœ‰åŸºæœ¬å…ƒç´ ã€‚Stringçš„fieldéƒ½æ˜¯privateçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿä¸éœ€è¦çŸ¥é“ä»–ä»¬çš„å…·ä½“å†…å®¹ã€‚Stringæä¾›çš„methodå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å¾ˆå¤šå¯¹Stringçš„æ“ä½œ</p><ul><li><p><code>char charAt(int i)</code> è¿”å›Stringåœ¨ç¬¬<span class="math inline">\(i\)</span>ä¸ªä½ç½®çš„å­—ç¬¦</p></li><li><p><code>int compareTo(String anotherString)</code>è¿”å›å€¼æ˜¯æ•´å‹ï¼Œå®ƒæ˜¯å…ˆæ¯”è¾ƒå¯¹åº”å­—ç¬¦çš„å¤§å°(ASCIIç é¡ºåº)ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦å’Œå‚æ•°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ç­‰ï¼Œç»“æŸæ¯”è¾ƒï¼Œè¿”å›ä»–ä»¬ä¹‹é—´çš„<strong>å·®å€¼</strong>ï¼Œå¦‚æœç¬¬ä¸€ä¸ªå­—ç¬¦å’Œå‚æ•°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ç›¸ç­‰ï¼Œåˆ™ä»¥ç¬¬äºŒä¸ªå­—ç¬¦å’Œå‚æ•°çš„ç¬¬äºŒä¸ªå­—ç¬¦åšæ¯”è¾ƒï¼Œä»¥æ­¤ç±»æ¨,ç›´è‡³æ¯”è¾ƒçš„å­—ç¬¦æˆ–è¢«æ¯”è¾ƒçš„å­—ç¬¦æœ‰ä¸€æ–¹ç»“æŸã€‚ï¼ˆ<a href="https://www.runoob.com/java/java-string-compareto.html">èœé¸Ÿæ•™ç¨‹</a>ï¼‰</p></li><li><p><code>String concat(String str)</code>å’ŒåŠ æ³•è¿ç®—ç¬¦ç›¸åŒçš„æ•ˆæœ</p></li><li><p><code>int indexOf(int ch)</code><code>int indexOf(int ch, int fromIndex)</code><code>int indexOf(String str)</code><code>int indexOf(String str, int fromIndex)</code>è¿”å›Stringä¸­å‡ºç°çš„ç¬¬ä¸€ä¸ªç›¸åº”çš„å‚æ•°å­—ç¬¦çš„ä¸‹æ ‡ï¼Œ<code>fromIndex</code>è¡¨ç¤ºä»æ­¤å¤„å¼€å§‹æœç´¢ã€‚å¯¹åº”çš„æœ‰<code>int lastIndexOf(parameters)</code>è¡¨ç¤ºæœ€åä¸€ä¸ªå‡ºç°çš„å­—ç¬¦ä¸‹æ ‡</p></li><li><p><code>boolean isEmpty()</code>åˆ¤æ–­ä¸€ä¸ªStringæ˜¯å¦ä¸ºç©ºï¼Œè‹¥æ˜¯è¿”å›trueã€‚</p></li><li><p><code>String replace(char oldChar, char newChar)</code>å°†åŸæœ¬çš„å­—ç¬¦ä¸²ä¸­çš„æ‰€æœ‰<code>oldchar</code>ç”¨<code>newChar</code>ä»£æ›¿ï¼Œè¿”å›æ›¿æ¢åçš„å­—ç¬¦ä¸²</p></li><li><p><code>String[] split(String regex, int limit)</code>ä»¥<code>regex</code>ä¸ºç•Œé™åˆ†å‰²Stringå¾—åˆ°ä¸€ä¸ªæ•°ç»„ã€‚å‚æ•°<code>int limit</code>(optional)è¡¨ç¤ºåˆ†å‰²çš„ä¸Šé™æ¬¡æ•°ï¼ˆä»¥å‰limit-1çš„<code>regex</code>è¿›è¡Œåˆ†å‰²ï¼Œå…±åˆ†æˆlimitä¸ªStringï¼‰ï¼Œlimit&lt;=0è¡¨ç¤ºæ— ç•Œé™ã€‚</p><p>e.g. åœ¨ä¸‹é¢è¿™ç§æƒ…å†µä¸­ï¼Œ<code>|</code>è¢«ç¼–è¯‘å™¨é»˜è®¤è®¤ä¸ºæ˜¯æˆ–è¿ç®—ç¬¦,æ‰€ä»¥æˆ‘ä»¬éœ€è¦ç”¨<code>"\\|"</code>è¿›è¡ŒåŒºåˆ†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">String s=â€œABC|DEF|GHIâ€;</span><br><span class="line">s.split(â€œ|â€)</span><br><span class="line"><span class="comment">/*-&gt; [ â€œAâ€, â€œBâ€, â€œCâ€, â€œ|â€, â€œDâ€, â€œEâ€, â€œFâ€, â€œ|â€, â€œGâ€, â€œHâ€, â€œIâ€];*/</span></span><br><span class="line">String s=â€œABC|DEF|GHIâ€;</span><br><span class="line">s.split(â€œ\\|â€);</span><br><span class="line"><span class="comment">/* -&gt; [ â€œABCâ€, â€œDEFâ€, â€œGHIâ€]; */</span></span><br></pre></td></tr></table></figure></li><li><p><code>String substring(int beginIndex, int endIndex)</code>è¿”å›ä»<code>beginIndex</code>å¼€å§‹åˆ°<code>endIndex</code>ï¼ˆä¸åŒ…æ‹¬ï¼‰çš„substringã€‚</p></li><li><p><code>String trim()</code> è¿”å›æ¶ˆé™¤äº†æ‰€æœ‰ç©ºæ ¼ä¹‹åçš„å­—ç¬¦ä¸²</p><ul><li>æœ‰å…³Stringæ›´è¯¦ç»†çš„æ–¹æ³•å¯ä»¥å‚è€ƒ<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/String.html">å®˜æ–¹æ–‡æ¡£</a></li></ul></li></ul><p>Stringä¸€æ—¦è¢«åˆ›å»ºå°±ä¸èƒ½å†æ›´æ”¹ï¼ˆæ³¨ï¼š<code>String.concat()</code>å’Œè¿ç®—ç¬¦"+"éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Stringå¯¹è±¡è€Œä¸æ˜¯åœ¨åŸæ¥çš„StringåŸºç¡€ä¸Šè¿›è¡Œæ›´æ”¹ï¼‰ï¼Œæ‰€ä»¥Javaæä¾›äº†å¦ä¸€ä¸ªç±»æ¥å®ç°Stringçš„æ›´æ”¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuilder</span> <span class="variable">strbui</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(<span class="string">&quot;something &quot;</span>);</span><br><span class="line">strbui.append(<span class="string">&quot;another thing &quot;</span>);</span><br><span class="line"><span class="comment">// strbui: something another thing</span></span><br></pre></td></tr></table></figure><p>ç›¸æ¯”äº<code>concat</code>å’ŒåŠ æ³•è¿ç®—ï¼Œä½¿ç”¨StringBuilderçš„å¥½å¤„å°±æ˜¯æé«˜äº†æ•ˆç‡</p><p>æ•°å­—å’Œå­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢</p><ul><li><p>Integerä¸Stringè½¬åŒ–</p><ul><li><p><code>Integer.parseInt(str)</code>å°†<code>str</code>è½¬åŒ–ä¸ºå¯¹åº”çš„Integer</p></li><li><p>Integerè½¬åŒ–ä¸ºå¯¹åº”çš„å­—ç¬¦ä¸²</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span> + <span class="number">123</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> Integer.toString(<span class="number">123</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> String.valueOf(<span class="number">123</span>);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Doubleä¸Stringè½¬åŒ–</p><ul><li><p><code>Double.parseDouble(str)</code>å°†<code>str</code>è½¬åŒ–ä¸ºå¯¹åº”çš„Double</p></li><li><p>Doubleè½¬åŒ–ä¸ºStringä½¿ç”¨<code>String.valueOf(double d)</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> <span class="variable">d</span> <span class="operator">=</span> <span class="number">11.01</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> String.valueOf(d);</span><br></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaé“¾è¡¨ã€æ ˆã€é˜Ÿåˆ—ã€å“ˆå¸Œè¡¨ã€é›†åˆ</title>
      <link href="/2021/07/01/java/java-lian-biao-zhan-dui-lie-ha-xi-biao-ji-he/"/>
      <url>/2021/07/01/java/java-lian-biao-zhan-dui-lie-ha-xi-biao-ji-he/</url>
      
        <content type="html"><![CDATA[<p>æ€»ç»“ä¸€ä¸‹JAVAä¸­å¸¸è§çš„ä¸€äº›ä¸æ•°æ®ç»“æ„æœ‰å…³çš„æŒæœ‰å¯¹è±¡ä»¥åŠä»–ä»¬çš„å¸¸è§çš„æ–¹æ³•(å¹¶ä¸æ˜¯å…¨éƒ¨å› ä¸ºå…¨éƒ¨å¤ªå¤šäº†orz)</p><span id="more"></span><h2><span id="åˆ—è¡¨-list">åˆ—è¡¨ List</span></h2><table><colgroup><col style="width: 52%"><col style="width: 47%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>boolean add(E e)</code></td><td>åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ </td></tr><tr><td><code>void add(int index, E e)</code></td><td>åœ¨æŒ‡å®šçš„ä¸‹æ ‡å¤„æ·»åŠ å…ƒç´ </td></tr><tr><td><code>void clear()</code></td><td>æ¸…é™¤åˆ—è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ </td></tr><tr><td><code>boolean contains(Object o)</code></td><td>åˆ¤æ–­åˆ—è¡¨ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„å…ƒç´ </td></tr><tr><td><code>E get(int index)</code></td><td>è¿”å›æŒ‡å®šä¸‹æ ‡å‡ºçš„å…ƒç´ </td></tr><tr><td><code>int indexOf(Object o)</code></td><td>è¿”å›æŒ‡å®šå…ƒç´ çš„ä¸‹æ ‡ï¼Œå¦‚æœåˆ—è¡¨ä¸­ä¸å­˜åœ¨è¿”å›-1</td></tr><tr><td><code>boolean isEmpty()</code></td><td>åˆ¤æ–­åˆ—è¡¨æ˜¯å¦ä¸ºç©º</td></tr><tr><td><code>E remove(int index)</code></td><td>åˆ é™¤æŒ‡å®šä¸‹æ ‡å¤„çš„å…ƒç´ </td></tr><tr><td><code>boolean remove(Object o)</code></td><td>åˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œå¦‚æœä¸å­˜åœ¨è¿”å›<code>false</code></td></tr><tr><td><code>E set(int index, E element)</code></td><td>å°†æŒ‡å®šä¸‹æ ‡å¤„çš„å…ƒç´ ç”¨æ–°çš„å…ƒç´ ä»£æ›¿</td></tr><tr><td><code>int size()</code></td><td>è¿”å›åˆ—è¡¨çš„å¤§å°</td></tr><tr><td><code>default void sort(Comparator&lt;? super E&gt; c)</code></td><td>å¯¹åˆ—è¡¨è¿›è¡ŒæŒ‰ç…§ç»™å®šçš„Compartorçš„æ’åº</td></tr><tr><td><code>Object[] toArray()</code></td><td>å°†åˆ—è¡¨è½¬åŒ–ä¸ºå¯¹åº”å…ƒç´ çš„ä¸€ä¸ªæ•°ç»„</td></tr></tbody></table><h3><span id="åˆ—è¡¨ä¸æ•°ç»„ä¹‹é—´çš„ç›¸äº’è½¬åŒ–">åˆ—è¡¨ä¸æ•°ç»„ä¹‹é—´çš„ç›¸äº’è½¬åŒ–</span></h3><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œæ•°ç»„å’Œåˆ—è¡¨çš„ç›¸äº’è½¬åŒ–ä¹Ÿæ˜¯ç»å¸¸éœ€è¦ç”¨åˆ°çš„ï¼Œå¥ˆä½•æœ¬äººè®°æ€§å¤ªå·®ï¼Œè€æ˜¯è®°ä¸ä½ï¼Œå°è±¡ä¸­å·²ç»æ˜¯æŸ¥äº†Næ¬¡äº†ï¼Œæœç„¶å¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ï¼Œè¿˜æ˜¯è®°ä¸€ä¸‹å§ï¼ŒåŸæ–‡ï¼š<a href="https://blog.csdn.net/lpq374606827/article/details/93203927">JavaListå’ŒArrayä¹‹é—´çš„è½¬æ¢</a></p><h4><span id="array-è½¬ä¸ºlist">Array è½¬ä¸ºList</span></h4><ol type="1"><li><p>å®ç°æ–¹æ³• :javaä¸­æ•°ç»„è½¬listä½¿ç”¨Arrays.asList(T... a)æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Array2List</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        List&lt;String&gt; listA=Arrays.asList(<span class="string">&quot;dog&quot;</span>,<span class="string">&quot;cat&quot;</span>,<span class="string">&quot;cow&quot;</span>);</span><br><span class="line">        String[] strs=&#123;<span class="string">&quot;dog&quot;</span>,<span class="string">&quot;cat&quot;</span>,<span class="string">&quot;cow&quot;</span>&#125;;</span><br><span class="line">        List&lt;String&gt; listB= Arrays.asList(strs);</span><br><span class="line">        System.out.println(listA);</span><br><span class="line">        System.out.println(listB);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ³¨æ„äº‹é¡¹</p><p>1ï¼‰<code>Arrays.asList()</code>æ–¹æ³•è¿”å›çš„å¯¹è±¡æ˜¯Arraysçš„å†…éƒ¨ç±»ï¼Œå¯¹listçš„æ“ä½œä»ç„¶åæ˜ åœ¨åŸæ•°ç»„ä¸Šï¼Œå› æ­¤è¿™ä¸ªlistæ˜¯å®šé•¿çš„ï¼Œä¸æ”¯æŒaddã€removeæ“ä½œï¼›</p><p>2ï¼‰ç”±äº<code>asList</code>æ–¹æ³•æ¥å—çš„æ³›å‹å‚æ•°ï¼Œå› æ­¤ä¸èƒ½ç”¨äºåŸºæœ¬ç±»å‹ï¼Œåªèƒ½ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ï¼š</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Array2List</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        <span class="type">int</span>[] a=&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>&#125;;</span><br><span class="line">        List&lt;Integer&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:a)&#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li></ol><h4><span id="listè½¬ä¸ºarray">Listè½¬ä¸ºArray</span></h4><ol type="1"><li><p>å®ç°ï¼šä½¿ç”¨<code>list.toArray()</code></p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Array2List</span> &#123;    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        List&lt;String&gt; list=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;dog&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;cat&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;cow&quot;</span>);</span><br><span class="line">        String[] animals=list.toArray(<span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">for</span>(String animal:animals)&#123;</span><br><span class="line">            System.out.println(animal);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li><li><p>æ³¨æ„äº‹é¡¹</p><p>ç”±äº<code>list.toArray()</code>è¿”å›çš„æ˜¯Objectå¯¹è±¡æ•°ç»„ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è½¬åŒ–ä¸ºåŸºæœ¬ç±»å‹æ•°ç»„ï¼Œæ¯”å¦‚è¯´<code>List&lt;Integer&gt;</code>è½¬åŒ–ä¸º<code>int[]</code>ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>steam()</code>ï¼š</p><p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.stream().mapToInt(Integer::intValue).toArray();</span><br></pre></td></tr></table></figure></p></li></ol><h2><span id="åŒç«¯é˜Ÿåˆ—-deque-1">åŒç«¯é˜Ÿåˆ— Deque [1]</span></h2><table><colgroup><col style="width: 3%"><col style="width: 24%"><col style="width: 24%"><col style="width: 23%"><col style="width: 23%"></colgroup><thead><tr><th></th><th>First Element (Head)</th><th></th><th><strong>Last Element (Tail)</strong></th><th></th></tr></thead><tbody><tr><td></td><td><em>Throws exception</em></td><td><em>Special value</em></td><td><em>Throws exception</em></td><td><em>Special value</em></td></tr><tr><td><strong>Insert</strong></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#addFirst(E)"><code>addFirst(e)</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#offerFirst(E)"><code>offerFirst(e)</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#addLast(E)"><code>addLast(e)</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#offerLast(E)"><code>offerLast(e)</code></a></td></tr><tr><td><strong>Remove</strong></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#removeFirst()"><code>removeFirst()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#pollFirst()"><code>pollFirst()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#removeLast()"><code>removeLast()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#pollLast()"><code>pollLast()</code></a></td></tr><tr><td><strong>Examine</strong></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#getFirst()"><code>getFirst()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#peekFirst()"><code>peekFirst()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#getLast()"><code>getLast()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#peekLast()"><code>peekLast()</code></a></td></tr></tbody></table><table><colgroup><col style="width: 47%"><col style="width: 52%"></colgroup><thead><tr><th><strong><code>Queue</code> Method</strong></th><th><strong>Equivalent <code>Deque</code> Method</strong></th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html#add(E)"><code>add(e)</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#addLast(E)"><code>addLast(e)</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html#offer(E)"><code>offer(e)</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#offerLast(E)"><code>offerLast(e)</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html#remove()"><code>remove()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#removeFirst()"><code>removeFirst()</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html#poll()"><code>poll()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#pollFirst()"><code>pollFirst()</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html#element()"><code>element()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#getFirst()"><code>getFirst()</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Queue.html#peek()"><code>peek()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#peek()"><code>peekFirst()</code></a></td></tr></tbody></table><table><colgroup><col style="width: 46%"><col style="width: 53%"></colgroup><thead><tr><th><strong>Stack Method</strong></th><th><strong>Equivalent <code>Deque</code> Method</strong></th></tr></thead><tbody><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#push(E)"><code>push(e)</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#addFirst(E)"><code>addFirst(e)</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#pop()"><code>pop()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#removeFirst()"><code>removeFirst()</code></a></td></tr><tr><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#peek()"><code>peek()</code></a></td><td><a href="https://docs.oracle.com/javase/7/docs/api/java/util/Deque.html#peekFirst()"><code>peekFirst()</code></a></td></tr></tbody></table><h3><span id="arraylist">ArrayList</span></h3><p>ArrayListæ˜¯Listæ¥å£çš„å¯å˜æ•°ç»„å®ç°ï¼Œæ‰€æœ‰çš„æ–¹æ³•å’ŒListåŸºæœ¬ä¸€è‡´ã€‚æ—¶é—´å¤æ‚åº¦æ–¹é¢ï¼Œå¢çš„æ—¶é—´å¤æ‚åº¦å‡æ‘Šä¸‹æ¥æ˜¯å¸¸æ•°çš„ï¼Œä½†æ˜¯å‡ ä¹å…¶ä»–çš„æ“ä½œéƒ½æ˜¯çº¿æ€§æ—¶é—´å¤æ‚åº¦ï¼Œä¼˜ç‚¹æ˜¯å¸¸æ•°å› å­ç›¸æ¯”äºLinkedListæ¥è¯´æ¯”è¾ƒå°ã€‚</p><table><colgroup><col style="width: 44%"><col style="width: 55%"></colgroup><thead><tr><th>ç‰¹æœ‰çš„æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>void ensureCapcity(int minCapacity)</code></td><td>å°†åŠ¨æ€æ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œç¡®ä¿åˆ—è¡¨èƒ½å¤Ÿå®¹çº³ç»™å®šçš„æœ€å°å®¹é‡</td></tr><tr><td><code>void trimToSize()</code></td><td>å°†åŠ¨æ€æ•°ç»„çš„å®¹é‡è°ƒæ•´ä¸ºæ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°</td></tr></tbody></table><h3><span id="linkedlist">LinkedList</span></h3><p>LinkedListæ˜¯Listæ¥å£å’ŒDequeæ¥å£çš„åŒå‘é“¾è¡¨å®ç°ï¼Œæ‰€æ‹¥æœ‰çš„æ–¹æ³•ä¸ºListæ¥å£å’ŒDequeæ¥å£çš„é›†åˆã€‚é“¾è¡¨å®ç°ä½¿å¾—å¢ã€åˆ æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œä½†æ˜¯æ²¡æœ‰äº†ArrayListä¸­çš„ç´¢å¼•æœºåˆ¶ï¼Œå¯¼è‡´å¯¹äºç‰¹å®šä½ç½®çš„å…ƒç´ æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</p><h2><span id="å›¾-map-é”®å€¼å¯¹">å›¾ Map ï¼ˆé”®å€¼å¯¹ï¼‰</span></h2><table><colgroup><col style="width: 39%"><col style="width: 60%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>void clear()</code></td><td>æ¸…é™¤å›¾ä¸­æ‰€æœ‰çš„å…ƒç´ </td></tr><tr><td><code>boolean containsKey(Object key)</code></td><td>åˆ¤æ–­æ˜¯å¦åŒ…å«æˆ‘ä»¬ç»™å®šé”®çš„é”®å€¼å¯¹</td></tr><tr><td><code>boolean containsValue(Object value)</code></td><td>åˆ¤æ–­æ˜¯å¦åŒ…å«æˆ‘ä»¬ç»™å®šå€¼çš„é”®å€¼å¯¹</td></tr><tr><td><code>Set&lt;Map.Entry&lt;K, V&gt;&gt; entrySet()</code></td><td>è¿”å›Mapçš„é›†åˆ(Set)è§†å›¾</td></tr><tr><td><code>V get (Object key)</code></td><td>è¿”å›ç»™å®šé”®çš„å¯¹åº”å€¼ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œè¿”å›null</td></tr><tr><td><code>default V getOrDefault(Object key, V defaultValue)</code></td><td>è¿”å›ç»™å®šé”®çš„å¯¹åº”å€¼ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œè¿”å›è®¾å®šçš„é»˜è®¤å€¼</td></tr><tr><td><code>boolean isEmpty()</code></td><td>åˆ¤æ–­Mapæ˜¯å¦ä¸ºç©º</td></tr><tr><td><code>Set&lt;K&gt; keySet()</code></td><td>è¿”å›Mapä¸­é”®çš„é›†åˆ(Set)è§†å›¾</td></tr><tr><td><code>V put(K key, V value)</code></td><td>å°†ç»™å®šçš„é”®å€¼å¯¹æ’å…¥åˆ°Mapä¸­ï¼Œè‹¥å·²ç»å­˜åœ¨å¯¹åº”çš„keyï¼Œåˆ™æ›¿æ¢valueï¼Œè¿”å›æ—§çš„valueï¼Œè‹¥ä¸å­˜åœ¨ï¼Œè¿”å›null</td></tr><tr><td><code>default V putIfAbsent(K key, V value)</code></td><td>å¦‚æœä¸å­˜åœ¨ç»™å®šçš„é”®çš„é”®å€¼å¯¹ï¼Œåˆ™æ’å…¥ï¼Œå¦åˆ™ï¼Œè¿”å›å½“å‰é”®å¯¹åº”çš„å€¼</td></tr><tr><td><code>V remove(Object key)</code></td><td>åˆ é™¤ç»™å®šé”®çš„é”®å€¼å¯¹</td></tr><tr><td><code>default boolean remove(Object key, Object value)</code></td><td>åˆ é™¤ç»™å®šçš„é”®å€¼å¯¹ï¼Œè¿”å›æ˜¯å¦åˆ é™¤æˆåŠŸ</td></tr><tr><td><code>default V replace(K key, V value)</code></td><td>å¦‚æœå­˜åœ¨ç»™å®šé”®çš„é”®å€¼å¯¹ï¼Œæ›¿æ¢é”®çš„å½“å‰å€¼ä¸ºç»™å®šçš„æ–°å€¼</td></tr><tr><td><code>default boolean replace(K key, V oldValue, V newValue)</code></td><td>å¦‚æœå­˜åœ¨ç»™å®šé”®å€¼å¯¹ï¼Œæ›¿æ¢ç»™å®šé”®å€¼å¯¹ä¸­çš„å€¼ä¸ºæ–°å€¼ï¼Œè¿”å›æ˜¯å¦æ›¿æ¢æˆåŠŸ</td></tr><tr><td><code>int size()</code></td><td>è¿”å›Mapä¸­çš„é”®å€¼å¯¹æ•°ç›®</td></tr></tbody></table><h3><span id="hashmapå’Œhashtable">HashMapå’ŒHashtable</span></h3><p>Mapæ¥å£çš„å“ˆå¸Œè¡¨å®ç°ï¼ŒHashMapåŸºæœ¬ä¸Hashtableç›¸åŒï¼Œé™¤äº†HashMapæ˜¯å¼‚æ­¥çš„å¹¶ä¸”å…è®¸nullkeyã€‚æ—¶é—´å¤æ‚åº¦æ–¹é¢ï¼Œå¯¹äºåŸºæœ¬çš„å¢æŸ¥æ“ä½œ (get andput)ï¼ŒHashMapå¯ä»¥è¾¾åˆ°å¸¸æ•°çš„æ—¶é—´å¤æ‚åº¦ã€‚å…³äºHashMapå’ŒHashtableçš„åŒºåˆ†ï¼Œè¯¦æƒ…å¯ä»¥å‚è€ƒè¿™ä¸€ç¯‡åšæ–‡<a href="https://www.cnblogs.com/lchzls/p/6714335.html">2</a></p><p>æ„é€ å™¨Constructorï¼šinitialCapcacityå’ŒloadFactorå½±å“HashMapçš„æ€§èƒ½ã€‚å½“å½“å‰çš„entryæ•°é‡è¶…è¿‡loadFactorå’Œå½“å‰å®¹é‡çš„ä¹˜ç§¯ï¼Œå“ˆå¸Œè¡¨å°±ä¼šè¢«rehashï¼Œæ‰©å®¹è‡³åŸæ¥çš„ä¸¤å€[3]ã€‚é»˜è®¤æƒ…å†µä¸‹initialCapacityä¸º16ï¼ŒloadFactorä¸º0.75ï¼Œè¿™æ ·çš„æƒ…å†µä¸‹æ€§èƒ½æ˜¯æ¯”è¾ƒå¥½çš„ã€‚</p><table><colgroup><col style="width: 100%"></colgroup><thead><tr><th>æ„é€ å™¨ Constructor</th></tr></thead><tbody><tr><td>HashMap(): é»˜è®¤çš„initialCapacityä¸º16ï¼ŒloadFactorä¸º0.75</td></tr><tr><td>HashMap(int initialCapacity)ï¼šè®¾å®šåˆå§‹åŒ–å®¹é‡</td></tr><tr><td>HashMap(int initialCapacity, floatloadFactor)ï¼šè®¾å®šåˆå§‹åŒ–å®¹é‡å’Œè´Ÿè½½ç³»æ•°</td></tr></tbody></table><h3><span id="treemap">TreeMap</span></h3><p>NavigableMapæ¥å£çš„çº¢é»‘æ ‘å®ç°ï¼Œå…·æœ‰æ’åºçš„èƒ½åŠ›ï¼Œé»˜è®¤æƒ…å†µå¯¹é”®å€¼çš„è¿›è¡Œé»˜è®¤çš„æ’åºï¼Œä¹Ÿå¯ä»¥æŒ‡å®šComparatorè¿›è¡Œæ’åºã€‚TreeMapä¸æ™®é€šçš„Mapä¸åŒçš„æ–¹æ³•åœ¨äºä¸€äº›å’Œé”®å€¼é¡ºåºæœ‰å…³çš„å‡½æ•°ï¼Œä¸‹é¢ç®€è¦åˆ—ä¸¾ä¸€ä¸‹</p><table><colgroup><col style="width: 47%"><col style="width: 52%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>Map.Entry&lt;K,V&gt; ceilingEntry(K key)</code></td><td>æœ€å°çš„é”®å¤§äºç­‰äºç»™å®šå€¼çš„é”®å€¼å¯¹</td></tr><tr><td><code>K ceilingKey(K key)</code></td><td>æœ€å°çš„å¤§äºç­‰äºç»™å®šå€¼çš„é”®</td></tr><tr><td><code>NavigableSet&lt;K&gt; descendingKeySet()</code></td><td>é™åºæ’åˆ—çš„é”®é›†åˆ</td></tr><tr><td><code>NavigableMap&lt;K,V&gt; descendingMap()</code></td><td>æŒ‰é”®é™åºæ’åˆ—çš„Map</td></tr><tr><td><code>Map.Entry&lt;K,V&gt; firstEntry()</code></td><td>é”®æœ€å°çš„é”®å€¼å¯¹</td></tr><tr><td><code>K firstKey()</code></td><td>æœ€å°çš„é”®</td></tr><tr><td><code>Map.Entry&lt;K,v&gt; floorEntry(K key)</code></td><td>æœ€å¤§çš„é”®å°äºç­‰äºç»™å®šå€¼çš„é”®å€¼å¯¹</td></tr><tr><td><code>K floorKey(K key)</code></td><td>æœ€å¤§çš„å°äºç­‰äºç»™å®šå€¼çš„é”®</td></tr><tr><td><code>SortedMap&lt;K,V&gt; headMap(K toKey)</code></td><td>è¿”å›å°äºç»™å®šé”®çš„æ‰€æœ‰é”®å€¼å¯¹çš„ä¸€ä¸ªmap</td></tr><tr><td><code>NavigableMap&lt;K,V&gt; headMap(K toKey, boolean inclusive)</code></td><td>è¿”å›å°äºï¼ˆæˆ–ç­‰äºï¼‰ç»™å®šé”®çš„æ‰€æœ‰é”®å€¼å¯¹çš„ä¸€ä¸ªmapï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›null</td></tr><tr><td><code>Map.Entry&lt;K,V&gt; higherEntry(K key)</code></td><td>æœ€å°çš„é”®ä¸¥æ ¼å¤§äºç»™å®šé”®çš„é”®å€¼å¯¹</td></tr><tr><td><code>K higherKey(K key)</code></td><td>æœ€å°çš„ä¸¥æ ¼å¤§äºç»™å®šé”®çš„é”®å€¼å¯¹</td></tr><tr><td><code>Map.Entry&lt;K,V&gt; lastEntry()</code></td><td>é”®æœ€å¤§çš„é”®å€¼å¯¹</td></tr><tr><td><code>K lastKey()</code></td><td>æœ€å¤§çš„é”®</td></tr><tr><td><code>Map.Entry&lt;K,V&gt; lowerEntry(K key)</code></td><td>æœ€å¤§çš„é”®ä¸¥æ ¼å°äºç»™å®šé”®çš„é”®å€¼å¯¹</td></tr><tr><td><code>K lowerKey(K key)</code></td><td>æœ€å¤§çš„ä¸¥æ ¼å°äºç»™å®šé”®çš„é”®å€¼å¯¹</td></tr><tr><td><code>Map.Entry&lt;K,V&gt;   pollFirstEntry()</code></td><td>åˆ é™¤å¹¶è¿”å›é”®æœ€å°çš„é”®å€¼å¯¹</td></tr><tr><td><code>Map.Entry&lt;K,V&gt;   pollLastEntry()</code></td><td>åˆ é™¤å¹¶è¿”å›é”®æœ€å¤§çš„é”®å€¼å¯¹</td></tr><tr><td><code>SortedMap&lt;K,V&gt; headMap(K toKey)</code></td><td>è¿”å›å¤§äºç­‰äºç»™å®šé”®çš„æ‰€æœ‰é”®å€¼å¯¹çš„ä¸€ä¸ªmap</td></tr><tr><td><code>NavigableMap&lt;K,V&gt; headMap(K toKey, boolean inclusive)</code></td><td>è¿”å›å¤§äºï¼ˆæˆ–ç­‰äºï¼‰ç»™å®šé”®çš„æ‰€æœ‰é”®å€¼å¯¹çš„ä¸€ä¸ªmapï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿”å›null</td></tr></tbody></table><h2><span id="é›†åˆ-set-æ¥å£">é›†åˆ Set æ¥å£</span></h2><p>é›†åˆçš„æ–¹æ³•å°±æ¯”è¾ƒç®€å•äº†ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ä¹‹å‰çš„ä¸€äº›ç®€å•é‡å¤ï¼Œç®€å•åˆ—ä¸¾ä¸€ä¸‹</p><table><colgroup><col style="width: 35%"><col style="width: 27%"><col style="width: 37%"></colgroup><thead><tr><th>æ–¹æ³•</th><th>æ–¹æ³•</th><th>æ–¹æ³•</th></tr></thead><tbody><tr><td><code>boolean add(E e)</code></td><td><code>void clear()</code></td><td><code>boolean contains(Object o)</code></td></tr><tr><td><code>boolean equals(Object o)</code></td><td><code>boolean isEmpty()</code></td><td><code>boolean remove(Object o)</code></td></tr><tr><td><code>int size()</code></td><td><code>Object[] toArray()</code></td><td></td></tr></tbody></table><p>å¸¸ç”¨çš„é›†åˆç±»æœ‰HashSetï¼ˆåŸºäºHashMapå®ç°ï¼‰ä»¥åŠå®ƒçš„å­ç±»LinkedHashSetã€‚</p><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><p>[1] <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Deque.html">Deque(Java Platform SE 8 ) (oracle.com)</a></p><p>[2] <a href="https://www.cnblogs.com/lchzls/p/6714335.html">JAVAä¸­HashMapå’ŒHashtableåŒºåˆ«- çŸ¥æˆ‘è€…ï¼Œè¶³ä»¥ - åšå®¢å›­ (cnblogs.com)</a></p><p>[3] <a href="https://www.cnblogs.com/crelle/p/13657214.html">HashMapä¸­çš„InitialCapacityå’ŒLoad Factory - æˆ‘è¦å»å·´è¨ - åšå®¢å›­ (cnblogs.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WSLé—®é¢˜:Temporary failure resolving &#39;&#39;archive.ubuntu.com&#39;&#39;</title>
      <link href="/2021/06/29/bug/bugwsl-wen-ti-temporary-failure-resolving-archive-ubuntu-com/"/>
      <url>/2021/06/29/bug/bugwsl-wen-ti-temporary-failure-resolving-archive-ubuntu-com/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©åœ¨WSLè¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼Œå‘ç°ä»ç½‘ç»œä¸Šä¸‹è½½ä¸œè¥¿æ— æ³•æˆåŠŸï¼ŒåŒ…æ‹¬wgetã€apt-get ç­‰å‘½ä»¤éƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨ï¼Œæ¯”å¦‚æ‰§è¡Œsudo apt-get updateçš„æ—¶å€™ä¼šæç¤º</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Err:1 http://security.ubuntu.com/ubuntu bionic-security InRelease</span><br><span class="line">  Temporary failure resolving <span class="string">&#x27;security.ubuntu.com&#x27;</span></span><br><span class="line">Err:2 http://archive.ubuntu.com/ubuntu bionic InRelease</span><br><span class="line">  Temporary failure resolving <span class="string">&#x27;archive.ubuntu.com&#x27;</span></span><br><span class="line">Err:3 http://archive.ubuntu.com/ubuntu bionic-updates InRelease</span><br><span class="line">  Temporary failure resolving <span class="string">&#x27;archive.ubuntu.com&#x27;</span></span><br><span class="line">Err:4 http://archive.ubuntu.com/ubuntu bionic-backports InRelease</span><br><span class="line">  Temporary failure resolving <span class="string">&#x27;archive.ubuntu.com&#x27;</span></span><br><span class="line">Reading package lists... Done</span><br><span class="line">W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/bionic/InRelease  Temporary failure resolving <span class="string">&#x27;archive.ubuntu.com&#x27;</span></span><br><span class="line">W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/bionic-updates/InRelease  Temporary failure resolving <span class="string">&#x27;archive.ubuntu.com&#x27;</span></span><br><span class="line">W: Failed to fetch http://archive.ubuntu.com/ubuntu/dists/bionic-backports/InRelease  Temporary failure resolving <span class="string">&#x27;archive.ubuntu.com&#x27;</span></span><br><span class="line">W: Failed to fetch http://security.ubuntu.com/ubuntu/dists/bionic-security/InRelease  Temporary failure resolving <span class="string">&#x27;security.ubuntu.com&#x27;</span></span><br><span class="line">W: Some index files failed to download. They have been ignored, or old ones used instead.</span><br></pre></td></tr></table></figure><p>ç»è¿‡æŸ¥è¯¢å’Œæœç´¢ï¼ˆè§£å†³bugçœŸçš„ç—›è‹¦ğŸ˜«ï¼‰ï¼Œå‘ç°é€šè¿‡ä¸€ä¸‹å‡ è¡Œå‘½ä»¤å¯ä»¥è§£å†³</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> <span class="built_in">rm</span> /etc/resolv.conf</span><br><span class="line"><span class="built_in">sudo</span> bash -c <span class="string">&#x27;echo &quot;nameserver 8.8.8.8&quot; &gt; /etc/resolv.conf&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> bash -c <span class="string">&#x27;echo &quot;[network]&quot; &gt; /etc/wsl.conf&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> bash -c <span class="string">&#x27;echo &quot;generateResolvConf = false&quot; &gt;&gt; /etc/wsl.conf&#x27;</span></span><br><span class="line"><span class="built_in">sudo</span> chattr +i /etc/resolv.conf</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ä¸‹è½½ä¸œè¥¿å°±éƒ½æ²¡æœ‰é—®é¢˜äº†ã€‚</p><blockquote><p>2021.11.20è¡¥å……ï¼šä»Šå¤©åˆç¢°åˆ°è¿™ä¸ªé—®é¢˜äº†ï¼Œè¿™æ¬¡æ˜¯sshçš„æ—¶å€™æ— æ³•è§£æhostnameï¼Œ</p><p>åˆgetåˆ°äº†ä¸€ç§æ–°çš„è§£å†³åŠæ³•ï¼š</p><p>ç›´æ¥åœ¨/etc/resolv.confä¸­åŠ å…¥dnsæœåŠ¡å™¨åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nameserver 202.96.134.133</span><br><span class="line">nameserver 8.8.8.8</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°å¯åŠ¨wslå°±å¯ä»¥äº†</p></blockquote><p>å‚è€ƒèµ„æ–™:</p><p><a href="https://github.com/microsoft/WSL/issues/5420#issuecomment-646479747">Githubä¸Šçš„ä¸€ä¸ªissue</a></p><p><a href="https://blog.csdn.net/weixin_38204723/article/details/78316940">ubuntuapt-get é”™è¯¯ Temporary failure resolving 'us.archive.ubuntu.com'è§£å†³</a></p>]]></content>
      
      
      <categories>
          
          <category> Bug </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Bug </tag>
            
            <tag> WSL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS EC2ä¸Šéƒ¨ç½²PostgreSQL + TimeScaleDB</title>
      <link href="/2021/06/29/backend/aws-ec2-shang-bu-shu-postgresql-timescaledb/"/>
      <url>/2021/06/29/backend/aws-ec2-shang-bu-shu-postgresql-timescaledb/</url>
      
        <content type="html"><![CDATA[<h4><span id="åœ¨ec2ä¸Šéƒ¨ç½²postgresqltimescaledb">åœ¨EC2ä¸Šéƒ¨ç½²PostgreSQL+TimescaleDB</span></h4><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªUbuntuå®ä¾‹ï¼Œä½¿ç”¨sshè¿æ¥åˆ°è¿™ä¸ªæœåŠ¡å™¨ä¸Šï¼ˆä½¿ç”¨WSLè¿›è¡Œè¿æ¥å¯ä»¥çœ‹è¿™ä¸€ç¯‡åšæ–‡<a href="https://lucas-hao.github.io/2021/06/29/aws-ec2-shang-chuang-jian-yi-ge-ubuntu-instance-bing-shi-yong-wsl-lian-jie/">AWSEC2ä¸Šåˆ›å»ºä¸€ä¸ªUbuntu Instanceå¹¶ä½¿ç”¨WSLè¿æ¥)</a>ï¼‰ã€‚è¿æ¥å¥½ä¹‹åï¼Œå°±å¯ä»¥æŒ‰ç…§<a href="https://docs.timescale.com/timescaledb/latest/how-to-guides/install-timescaledb/self-hosted/ubuntu/installation-apt-ubuntu/#apt-installation-ubuntu">Timescaleæ–‡æ¡£</a>ï¼Œè¿›è¡ŒPostgreSQL+TimeScaleDBçš„å®‰è£…å’Œéƒ¨ç½²äº†ã€‚</p><span id="more"></span><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># `lsb_release -c -s` should return the correct codename of your OS</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;deb &lt;http://apt.postgresql.org/pub/repos/apt/&gt; <span class="subst">$(lsb_release -c -s)</span>-pgdg main&quot;</span> | <span class="built_in">sudo</span> <span class="built_in">tee</span> /etc/apt/sources.list.d/pgdg.list</span><br><span class="line">wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | <span class="built_in">sudo</span> apt-key add -</span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Add our PPA</span></span><br><span class="line"><span class="built_in">sudo</span> add-apt-repository ppa:timescale/timescaledb-ppa</span><br><span class="line"><span class="built_in">sudo</span> apt-get update</span><br><span class="line"></span><br><span class="line"><span class="comment"># Now install appropriate package for PG version</span></span><br><span class="line"><span class="built_in">sudo</span> apt install timescaledb-2-postgresql-13</span><br><span class="line"></span><br><span class="line"><span class="built_in">sudo</span> timescaledb-tune (y/y/n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Restart PostgreSQL instance</span></span><br><span class="line"><span class="built_in">sudo</span> service postgresql restart</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä»¥ä¸Šæ­¥éª¤æ“ä½œå®Œæˆä¹‹åï¼ŒPostgreSQLå°±å·²ç»å®‰è£…æˆåŠŸäº†ã€‚å¯ä»¥é€šè¿‡<code>psql --version</code>æŸ¥çœ‹PostgreSQLç‰ˆæœ¬ä¿¡æ¯ã€‚æ¥ä¸‹æ¥ï¼Œä¸ºäº†è®©æˆ‘ä»¬çš„PostgreSQLè¢«è¿œç¨‹è®¿é—®ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å®ƒè¿›è¡Œé…ç½®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> nano /etc/postgresql/13/main/postgresql.conf</span><br></pre></td></tr></table></figure><p>æ‰“å¼€é…ç½®æ–‡ä»¶ï¼Œæ‰¾åˆ°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#listen_addresses = &#x27;localhost&#x27;</span></span><br></pre></td></tr></table></figure><p>å»æ‰æ³¨é‡Šï¼Œä¿®æ”¹ä¸ºï¼ˆè¿™æ ·ä¿®æ”¹å…è®¸æ•°æ®åº“èƒ½å¤Ÿç›‘å¬æ‰€æœ‰çš„åœ°å€ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">listen_addresses = &#x27;*&#x27;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ‰“å¼€å¦å¤–ä¸€ä¸ªé…ç½®æ–‡ä»¶è¿›è¡Œä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/postgresql/13/main/pg_hba.conf</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°æœ€åå‡ è¡Œï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹æ ·å¼ï¼Œè¿™æ ·ä¿®æ”¹æ˜¯ä¸ºäº†èƒ½å¤Ÿè¿œç¨‹è®¿é—®åˆ°æ•°æ®åº“ã€‚</p><figure><img src="https://i.loli.net/2021/07/16/LH8432jpWqN5GAh.png" alt="pg_hba-conf"><figcaption aria-hidden="true">pg_hba-conf</figcaption></figure><p>ç„¶åé‡æ–°å¯åŠ¨PostgreSQLæœåŠ¡<code>sudo service postgresql restart</code>ï¼Œé…ç½®å®Œæˆä¹‹åï¼Œè¾“å…¥å‘½ä»¤<code>sudo -u postgres psql postgres</code>ä½¿ç”¨postgreSQLé»˜è®¤çš„ç”¨æˆ·postgresè¿›å…¥æ•°æ®åº“ï¼Œä½¿ç”¨<code>\password</code>è®¾ç½®å¯†ç ï¼Œç„¶åå°±å¯ä»¥æ­£å¸¸ä½¿ç”¨æ•°æ®åº“äº†ã€‚</p><h4><span id="ä½¿ç”¨pgadminè¿æ¥">ä½¿ç”¨pgAdminè¿æ¥</span></h4><p>æ‰“å¼€pgAdminï¼Œå³é”®Serversâ†’Createâ†’Server...ï¼Œå’Œæ­£å¸¸è¿æ¥åˆ°æ•°æ®åº“ä¸€æ ·ï¼Œé¦–å…ˆç»™ä¸€ä¸ªå‘½åï¼Œç„¶ååœ¨Connectionä¸­ï¼Œå’Œåœ¨æœ¬åœ°è¿æ¥æ•°æ®åº“ä¸€æ ·ï¼Œå¡«å†™ç›¸å…³çš„ä¿¡æ¯ï¼Œå¯†ç å°±æ˜¯äº‘ç«¯ä¸Šæ•°æ®åº“çš„å¯†ç ã€‚</p><figure><img src="https://i.loli.net/2021/07/16/zNyjnduafTb4cP8.png" alt="pgAdmin-connection"><figcaption aria-hidden="true">pgAdmin-connection</figcaption></figure><p>ç„¶åï¼Œåœ¨SSH Tunnelä¸­ï¼Œåœ¨Tunnel hostè¾“å…¥AWS EC2å®ä¾‹çš„public IPv4DNSï¼ŒTunnelportå¡«22ï¼Œusernameå°±æ˜¯æœåŠ¡å™¨çš„ç”¨æˆ·åï¼ŒUbuntuæœåŠ¡å™¨çš„é»˜è®¤ç”¨æˆ·åå°±æ˜¯ubuntuã€‚Authenticationé€‰æ‹©Identityfileï¼Œç„¶åIdentity fileä¸€æ é€‰ä¸­ä¹‹å‰ä¸‹è½½çš„å¯†é’¥å¯¹</p><figure><img src="https://i.loli.net/2021/07/16/PMASp6fxsUlZNXw.png" alt="pgAdmin-SSH"><figcaption aria-hidden="true">pgAdmin-SSH</figcaption></figure><p>ç‚¹å‡»SaveæŒ‰é’®å°±å¯ä»¥æˆåŠŸè¿æ¥ã€‚</p><h4><span id="å‘½ä»¤è¡Œè¿œç¨‹è¿æ¥æ•°æ®åº“">å‘½ä»¤è¡Œè¿œç¨‹è¿æ¥æ•°æ®åº“</span></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒAWSEC2å¼€æ”¾çš„ç«¯å£åªæœ‰SSHé»˜è®¤çš„ç«¯å£22ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³è¦è¿œç¨‹è®¿é—®çš„æ˜¯PostgreSQLçš„ç«¯å£5432ï¼Œæ‰€ä»¥åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ— æ³•è¿œç¨‹è®¿é—®PostgreSQLæ•°æ®åº“ã€‚åœ¨æˆ‘ä»¬è¾“å…¥å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql postgres://username:password@hostname:port/dbname</span><br></pre></td></tr></table></figure><p>ä¹‹åï¼Œå°±ä¼šå¾—åˆ°æŠ¥é”™ä¿¡æ¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psql: é”™è¯¯: æ— æ³•è”æ¥åˆ°æœåŠ¡å™¨: Connection timed out (0x0000274C/10060)</span><br><span class="line">        æœåŠ¡å™¨æ˜¯å¦åœ¨ä¸»æœº <span class="string">&quot;hostname&quot;</span> ä¸Šè¿è¡Œå¹¶ä¸”å‡†å¤‡æ¥å—åœ¨ç«¯å£</span><br><span class="line">5432 ä¸Šçš„ TCP/IP è”æ¥?</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé”™è¯¯ä¿¡æ¯å°±æç¤ºæˆ‘ä»¬éœ€è¦æ‰“å¼€AWSEC2æ•°æ®åº“ä¸­çš„5432ç«¯å£ï¼Œæˆ‘ä»¬æ‰å¯ä»¥å¯¹æ•°æ®åº“è¿›è¡Œè¿œç¨‹è®¿é—®ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€EC2æ§åˆ¶å°ï¼Œç„¶åæ‰“å¼€SecurityGroups (å®‰å…¨ç»„)ï¼Œé€‰ä¸­ä¸€ä¸ªå®‰å…¨ç»„ï¼Œç„¶åè¿›å…¥Actionsä¸‹çš„Edit inbound rules(ç¼–è¾‘å…¥ç«™è§„åˆ™)ã€‚</p><figure><img src="https://i.loli.net/2021/07/16/1LodksGSKBmIMgt.png" alt="edit-bound-rules"><figcaption aria-hidden="true">edit-bound-rules</figcaption></figure><p>é»˜è®¤æƒ…å†µä¸‹åªæœ‰ä¸€ä¸ªç±»å‹ä¸ºSSHçš„è§„åˆ™ï¼Œç‚¹å‡»Addruleï¼Œç±»å‹é€‰æ‹©PostgreSQLï¼Œç‚¹å‡»Save rulesä¿å­˜å³å¯ã€‚</p><figure><img src="https://i.loli.net/2021/07/16/7fHB4xqA51uR9lE.png" alt="inbound-rules"><figcaption aria-hidden="true">inbound-rules</figcaption></figure><p>ç„¶åæˆ‘ä»¬ç›´æ¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨å‘½ä»¤å°±å¯ä»¥è¿›è¡Œè¿æ¥å•¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">psql postgres://postgres:yourpassword@ec2-34-200-222-92.compute-1.amazonaws.com:5432/postgres</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Javaä¸­çš„jdbcè¿æ¥æ•°æ®åº“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">      <span class="keyword">final</span> <span class="type">String</span> <span class="variable">connUrl</span> <span class="operator">=</span> <span class="string">&quot;jdbc:postgresql://ec2-34-200-222-92.compute-1.amazonaws.com:5432/postgres?user=postgres&amp;password=yourpassword&quot;</span>;</span><br><span class="line">      <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(connUrl)) &#123;</span><br><span class="line">          System.out.println(conn.getClientInfo());</span><br><span class="line">      &#125; <span class="keyword">catch</span> (SQLException ex) &#123;</span><br><span class="line">          System.err.println(<span class="string">&quot;SQLState: &quot;</span> + ex.getSQLState() +  <span class="string">&quot;\\t&quot;</span> + ex.getMessage());</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç¤ºç»“æœ</p><blockquote><p>{ApplicationName=PostgreSQL JDBC Driver}</p></blockquote><p>æˆåŠŸè¿æ¥ï¼</p>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> PostgreSQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWS EC2ä¸Šåˆ›å»ºä¸€ä¸ªUbuntu Instance å¹¶ä½¿ç”¨WSLè¿æ¥</title>
      <link href="/2021/06/29/backend/aws-ec2-shang-chuang-jian-yi-ge-ubuntu-instance-bing-shi-yong-wsl-lian-jie/"/>
      <url>/2021/06/29/backend/aws-ec2-shang-chuang-jian-yi-ge-ubuntu-instance-bing-shi-yong-wsl-lian-jie/</url>
      
        <content type="html"><![CDATA[<h4><span id="åœ¨aws-ec2ä¸Šéƒ¨ç½²ubuntu">åœ¨AWS EC2ä¸Šéƒ¨ç½²Ubuntu</span></h4><ol type="1"><li><p>ç™»å½•AWSï¼Œè¿›å…¥EC2 Dashboardï¼Œç‚¹å‡»Launch instanceæ¥æ–°å»ºä¸€ä¸ªå®ä¾‹ã€‚<img src="https://i.loli.net/2021/07/16/XOg3CIUzjirtlhw.png" alt="Ubuntu-lauch-instance"></p><p><span id="more"></span></p></li><li><p>é€‰æ‹©AMIï¼Œè¿™é‡Œæˆ‘é€‰æ‹©äº†Ubuntu 20.04 <img src="https://i.loli.net/2021/07/16/ClQOwTNs6BJj13m.png" alt="choose-ami"></p></li><li><p>é€‰æ‹©æƒ³è¦çš„InstanceTypeï¼Œå¯ä»¥æ ¹æ®è‡ªå·±çš„å®é™…éœ€æ±‚è¿›è¡Œé€‰æ‹©ï¼Œå¦‚æœæ˜¯è¿›è¡Œå­¦ä¹ çš„è¯ï¼ŒAWSå¯¹äºç¬¬ä¸€æ¬¡æ³¨å†Œçš„ç”¨æˆ·åœ¨12ä¸ªæœˆå†…æä¾›å…è´¹çš„å¥—é¤ï¼Œå¦‚æœæˆ‘æ²¡æœ‰è®°é”™çš„è¯åº”è¯¥æ˜¯t2.microã€‚é€‰æ‹©å¥½ä¹‹åï¼Œé»˜è®¤æƒ…å†µä¸‹æˆ‘ä»¬ç›´æ¥ç‚¹å‡»Reviewand Launchã€‚ <img src="https://i.loli.net/2021/07/16/ObrBC8DadxVcq3e.png"></p></li><li><p>ä¹‹åé¡µé¢ä¸Šä¼šæ˜¾ç¤ºåˆ›å»ºçš„å®ä¾‹çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚æœæœ‰éœ€è¦æ”¹å˜çš„åœ°æ–¹ï¼Œå¯ä»¥è¿™é‡Œè¿›è¡Œæ”¹å˜ã€‚åœ¨è¿™é‡Œï¼Œç”±äºæˆ‘çš„ç›®çš„æ˜¯ä¸ºè¿™ä¸€ä¸ªå®ä¾‹ä¸Šéƒ¨ç½²ä¸€ä¸ªPostgreSQLæ•°æ®åº“ï¼Œç„¶åä»è¿œç¨‹è®¿é—®è¿™ä¸ªæ•°æ®åº“ï¼Œæ‰€ä»¥æˆ‘éœ€è¦å¯¹SecurityGroupsè¿›è¡Œä¸€äº›è®¾ç½®å’Œä¿®æ”¹ï¼Œè¯¦æƒ…å¯ä»¥çœ‹è¿™ä¸€ç¯‡åšæ–‡<a href="https://lucas-hao.github.io/2021/06/29/aws-ec2-shang-bu-shu-postgresql-timescaledb/#more">AWSEC2ä¸Šéƒ¨ç½²PostgreSQL + TimeScaleDB)</a>ã€‚ <img src="https://i.loli.net/2021/07/16/GmKzbHiEfoO6CJs.png" alt="review-instance-launch"></p></li><li><p>è®¾ç½®å®Œæˆä¹‹åç‚¹å‡»Launchï¼Œè·³å‡ºå¦‚ä¸‹é¡µé¢ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æˆ–è€…åˆ›å»ºä¸€ä¸ªå¯†é’¥å¯¹</p><p><img src="https://i.loli.net/2021/07/16/XZeKmCSxHiFzoTD.png" alt="key-pair">è¾“å…¥å¯†é’¥å¯¹çš„åå­—ä¹‹åï¼Œæˆ‘ä»¬å°†è¿™ä¸ªå¯†é’¥å¯¹ä¸‹è½½åˆ°æˆ‘ä»¬çš„ç”µè„‘é‡Œé¢ï¼Œè¿™ä¸ªå¯†é’¥å¯¹ä¸€å®šè¦ä¿å­˜å¥½ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦è¿™ä¸ªå¯†é’¥å¯¹è¿œç¨‹é€šè¿‡SSHè¿æ¥è¿™ä¸ªæœåŠ¡å™¨ã€‚ç„¶åç‚¹å‡»LaunchInstanceså°±æˆåŠŸåœ¨EC2ä¸Šéƒ¨ç½²äº†ä¸€ä¸ªUbuntuçš„å®ä¾‹ã€‚</p></li></ol><h4><span id="ä½¿ç”¨wslè¿›è¡ŒæœåŠ¡å™¨è¿œç¨‹è®¿é—®">ä½¿ç”¨WSLè¿›è¡ŒæœåŠ¡å™¨è¿œç¨‹è®¿é—®</span></h4><p>é¦–å…ˆè¦ç¡®ä¿Windowsä¸Šå®‰è£…äº†WSLå’ŒLinuxå­ç³»ç»Ÿã€‚æƒ³è¦è¿æ¥åˆ°EC2ï¼Œé¦–å…ˆè¦å°†ä¸‹è½½åˆ°Windowsä¸­çš„å¯†é’¥å¯¹æ–‡ä»¶å¤åˆ¶åˆ°WSLä¸­çš„è·¯å¾„ä¸­ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ol type="1"><li><p>ä½¿ç”¨å‘½ä»¤è¡Œå‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> /mnt/&lt;Windows drive letter&gt;/path/my-key-pair.pem ~/WSL-path/my-key-pair.pem</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šWindowsæœ¬åœ°çš„æ–‡ä»¶å¤¹å¯ä»¥åœ¨WSLä¸‹çš„mntæ–‡ä»¶å¤¹ä¸­è¿›è¡Œè®¿é—®</p></li><li><p>å¯ä»¥åœ¨Windowsä¸­çš„æ–‡ä»¶ç®¡ç†å™¨ä¸­ç›´æ¥åœ¨åœ°å€æ ä¸­è¾“å…¥<code>\\wsl$</code>å¯ä»¥åœ¨ç½‘ç»œä¸­æ‰“å¼€WSLçš„æ–‡ä»¶ç®¡ç†ï¼Œç„¶åç›´æ¥å°†å¯†é’¥å¯¹å¤åˆ¶åˆ°å¯¹åº”çš„è·¯å¾„ä¸‹å°±å¯ä»¥äº†ã€‚</p></li></ol><p>è¿™ä¸ªæ—¶å€™ï¼Œè¿˜éœ€è¦å°†å¯†é’¥å¯¹çš„æƒé™æ›´æ”¹ä¸€ä¸‹ï¼Œå¦åˆ™çš„è¯ç”±äºæˆ‘ä»¬æ²¡æœ‰å¯¹å¯†é’¥å¯¹è¿›è¡Œæƒé™è®¾ç½®ï¼Œç›´æ¥è¿æ¥çš„è¯å°±ä¼šæŠ¥é”™ã€‚<img src="https://i.loli.net/2021/07/16/wB8JRmPL5ldi2AD.png" alt="wsl-warning"></p><p>é€šè¿‡å‘½ä»¤<code>chmod 400 filename.pem</code>æ›´æ”¹æ–‡ä»¶æƒé™ï¼Œè¿™ä¸ªé—®é¢˜å°±èƒ½å¤Ÿè§£å†³äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå‘½ä»¤è¿æ¥åˆ°EC2ä¸Šã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -i /path/my-key-pair.pem my-instance-user-name@my-instance-public-dns-name</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ä¸ºå‚æ•°çš„è§£é‡Š</p><ol type="1"><li><p>/path/my-key-pair.pem å½“ç„¶å°±æ˜¯å¯†é’¥å¯¹æ‰€åœ¨çš„è·¯å¾„äº†</p></li><li><p>my-instance-user-nameå°±æ˜¯æ‰€åˆ›å»ºçš„EC2å®ä¾‹çš„ç”¨æˆ·åï¼Œä¸‹é¢æ˜¯é»˜è®¤çš„ç”¨æˆ·å</p><p>å¯¹äº Amazon Linux 2 æˆ– Amazon Linux AMIï¼Œç”¨æˆ·åç§°æ˜¯ ec2-userã€‚</p><p>å¯¹äº CentOS AMIï¼Œç”¨æˆ·åç§°æ˜¯ centosã€‚</p><p>å¯¹äº Debian AMIï¼Œç”¨æˆ·åç§°æ˜¯ adminã€‚</p><p>å¯¹äº Fedora AMIï¼Œç”¨æˆ·åä¸º ec2-user æˆ– fedoraã€‚</p><p>å¯¹äº RHEL AMIï¼Œç”¨æˆ·åç§°æ˜¯ ec2-user æˆ– rootã€‚</p><p>å¯¹äº SUSE AMIï¼Œç”¨æˆ·åç§°æ˜¯ ec2-user æˆ– rootã€‚</p><p>å¯¹äº Ubuntu AMIï¼Œç”¨æˆ·åç§°æ˜¯ ubuntuã€‚</p></li><li><p>my-instance-public-dns-name æ˜¯åˆ›å»ºçš„EC2å®ä¾‹çš„public IPv4DNSï¼Œåœ¨AWS EC2Dashboardä¸­æ‰“å¼€å®ä¾‹å°±å¯ä»¥æ‰¾åˆ°ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œé‚£ä¹ˆåœ¨å³ä¸Šè§’çš„è®¾ç½®ä¸­æ‰“å¼€æ˜¾ç¤ºå³å¯ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Backend </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWS </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Androidè·å–åº”ç”¨ä½¿ç”¨æ—¶é•¿å’Œæ¬¡æ•°-UsageStatsManagerä½¿ç”¨</title>
      <link href="/2021/06/02/android/android-huo-qu-ying-yong-shi-yong-shi-chang-he-ci-shu-usagestatsmanager-shi-yong/"/>
      <url>/2021/06/02/android/android-huo-qu-ying-yong-shi-yong-shi-chang-he-ci-shu-usagestatsmanager-shi-yong/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘åœ¨åšæš‘ç ”ï¼Œè¦æ±‚æ˜¯éœ€è¦è·å–åˆ°Androidæ‰‹æœºä¸­çš„åº”ç”¨ä½¿ç”¨æƒ…å†µï¼Œç»è¿‡æŸ¥æ‰¾ï¼Œå‘ç°Androidæä¾›äº†<code>UsageStatsManager</code>ç±»æ¥å¸®åŠ©è¿›è¡Œåº”ç”¨ä½¿ç”¨ä¿¡æ¯çš„ç»Ÿè®¡ï¼ˆæ³¨æ˜ï¼ŒAndroid5.0ç³»ç»Ÿå¤§éƒ¨åˆ†æ‰‹æœºä¸æ”¯æŒè¿™ä¸ªç±»ï¼ŒAndroid5.1ç³»ç»Ÿä¹‹åå®Œå…¨æ”¯æŒ[1],æ˜¾ç„¶ç°åœ¨å¤§éƒ¨åˆ†æ‰‹æœºéƒ½æ˜¯æ”¯æŒçš„ï¼‰ï¼Œè¿™ç¯‡æ–‡ç« ä¸»è¦è®°å½•ä¸€ä¸‹è¿™ä¸ªç±»çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><span id="more"></span><h4><span id="æˆæƒ">æˆæƒ</span></h4><p>æƒ³è¦ä½¿ç”¨è¿™ä¸ªç±»æ¥è·å–åº”ç”¨ä½¿ç”¨ä¿¡æ¯ï¼Œé¦–å…ˆéœ€è¦å¯¹appè¿›è¡Œæˆæƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨AndroidManifest.xmlæ–‡ä»¶ä¸­åŠ å…¥<code>uses-permission</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:name</span>=<span class="string">&quot;android.permission.PACKAGE_USAGE_STATS&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:ignore</span>=<span class="string">&quot;ProtectedPermissions&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åéœ€è¦æˆ‘ä»¬åœ¨è®¾ç½®-å®‰å…¨-æ›´å¤šå®‰å…¨è®¾ç½®-ä½¿ç”¨æƒ…å†µè®¿é—®æƒé™ä¸­ç»™å¯¹åº”çš„appæ‰“å¼€ä½¿ç”¨æƒé™ï¼ˆåä¸ºp30proï¼‰ã€‚æˆ‘ä»¬åœ¨ä»£ç ä¸­ä¹Ÿå¯ä»¥è¿›è¡Œåˆ¤æ–­ï¼Œä¸»åŠ¨è¦æ±‚ç”¨æˆ·æ‰“å¼€è¯¥è®¾ç½®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆåˆ¤æ–­è·å–åˆ°çš„listæ˜¯å¦ä¸ºç©º if (packageInfoList == null)</span></span><br><span class="line"><span class="keyword">if</span> (Build.VERSION.SDK_INT &gt; Build.VERSION_CODES.LOLLIPOP) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        startActivity(<span class="keyword">new</span> <span class="title class_">Intent</span>(Settings.ACTION_USAGE_ACCESS_SETTINGS));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Toast.makeText(MainActivity.<span class="built_in">this</span>,<span class="string">&quot;æ— æ³•å¼€å¯å…è®¸æŸ¥çœ‹ä½¿ç”¨æƒ…å†µçš„åº”ç”¨ç•Œé¢&quot;</span>,Toast.LENGTH_LONG).show();</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="å¯¹è±¡åˆå§‹åŒ–">å¯¹è±¡åˆå§‹åŒ–</span></h4><p>åˆå§‹åŒ–<code>UsageStatsManager</code>ç±»æˆ‘ä»¬éœ€è¦ä»¥ä¸‹ä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UsageStatsManager</span> <span class="variable">usm</span> <span class="operator">=</span> (UsageStatsManager)getSystemService(Context.USAGE_STATS_SERVICE);</span><br></pre></td></tr></table></figure><h4><span id="è·å–usagestats">è·å–UsageStats</span></h4><p><code>UsageStatsManager</code>æä¾›äº†ä¸€äº›æ–¹æ³•è®©æˆ‘ä»¬è·å–åº”ç”¨çš„<code>UsageStats</code>ï¼Œæ¯”å¦‚<code>Map&lt;String, UsageStats&gt; queryAndAggregateUsageStats(long beginTime, long endTime)</code>å’Œ<code>List&lt;EventsStats&gt; queryEventStats(int intervalType, long beginTime, long endTime)</code>ï¼Œé€šè¿‡ä¼ å…¥å¼€å§‹æ—¶é—´ï¼Œç»“æŸæ—¶é—´å’Œä¸€ä¸ªé—´éš”ç±»å‹(intervalType)æ¥è·å–åœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…çš„<code>UsageStats</code>åˆ—è¡¨ã€‚å…¶ä¸­ï¼ŒAndroidç»™äº†ä»¥ä¸‹å‡ ç§intervalType</p><table><colgroup><col style="width: 26%"><col style="width: 73%"></colgroup><thead><tr><th>Constants</th><th>Meaning</th></tr></thead><tbody><tr><td><code>int INTERVAL_DAILY</code></td><td>An interval type that spans a day.</td></tr><tr><td><code>int INTERVAL_MONTHLY</code></td><td>An interval type that spans a month.</td></tr><tr><td><code>int INTERVAL_WEEKLY</code></td><td>An interval type that spans a week.</td></tr><tr><td><code>int INTERVAL_YEARLY</code></td><td>An interval type that spans a year.</td></tr><tr><td><code>int INTERVAL_BEST</code></td><td>An interval type that will use the best fit interval for the giventime range.</td></tr></tbody></table><p><code>queryAndAggregateUsageStats</code>é»˜è®¤çš„é—´éš”ç±»å‹æ˜¯<code>INTERVAL_BEST</code>ã€‚</p><p>ä¸‹é¢çš„å›¾ç‰‡ä»£è¡¨äº†æˆ‘ä»¬ä¼ å…¥çš„æ—¶é—´å’Œæˆ‘ä»¬çš„é—´éš”ç±»å‹ç»“åˆåº”è¯¥å¾—åˆ°çš„æ—¶é—´èŒƒå›´ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>æˆ‘ä»¬ä¼ å…¥çš„beginTimeå’ŒendTimeä¸å®Œå…¨æ˜¯ç³»ç»Ÿè·å–appä¿¡æ¯çš„å¼€å§‹å’Œç»“æŸæ—¶é—´ï¼ŒbeginTimeå’ŒendTimeæ˜¯åŒ…å«åœ¨å¼€å§‹å’Œç»“æŸæ—¶é—´ä¹‹ä¸­</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬çš„é—´éš”ç±»å‹è®¾ç½®ä¸º<code>INTERVAL_DAILY</code>ï¼Œæˆ‘ä»¬è·å–çš„ä½¿ç”¨ä¿¡æ¯çš„å¼€å§‹æ—¶é—´å¯èƒ½æ˜¯beginTimeçš„å½“å¤©0æ—¶ï¼Œç»“æŸæ—¶é—´å¯èƒ½æ˜¯endTimeçš„å½“å¤©23:59ï¼Œè¿™ä¸ªæ—¶é—´å…·ä½“è¿˜å’Œæ—¶åŒºç›¸å…³ï¼Œæ‰€ä»¥å…·ä½“æƒ…å†µéœ€è¦è§†å®é™…æƒ…å†µè€Œå®šï¼Œæ›´è¯¦ç»†çš„è§£æå¯ä»¥çœ‹è¿™ä¸€ç¯‡[2]<a href="https://blog.csdn.net/liuwan1992/article/details/83625520">å…³äºUsageStatsManager.queryUsageStats çš„æ³¨æ„äº‹é¡¹åŠ UsageStatsServiceçš„ç®€å•åŸç†_èœé¸Ÿçš„è‡ªæˆ‘ä¿®å…»-CSDNåšå®¢</a>ã€‚</p><figure><img src="https://i.loli.net/2021/06/02/qDJ56Ld182YUrof.png" alt="image-20210602210207843"><figcaption aria-hidden="true">image-20210602210207843</figcaption></figure><h4><span id="è·å–åº”ç”¨ååº”ç”¨åŒ…åä½¿ç”¨æ—¶é•¿">è·å–åº”ç”¨åï¼Œåº”ç”¨åŒ…åï¼Œä½¿ç”¨æ—¶é•¿</span></h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>UsageStats.getPackageName()</code>è¿™ä¸ªæ–¹æ³•æ¥è·å–åº”ç”¨çš„åŒ…åï¼Œé€šè¿‡<code>UsageStats.getTotalTimeInForeground()</code>è¿™ä¸ªæ–¹æ³•è·å–åº”ç”¨åœ¨å‰å°çš„ä½¿ç”¨æ—¶é—´ã€‚</p><p>è·å–åº”ç”¨çš„åå­—æˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>PackageManger</code>ä¸­çš„<code>getApplcationLabel(ApplicationInfo info)</code>è¿™ä¸ªæ–¹æ³•ï¼Œè·å–<code>ApplicationInfo</code>å¯ä»¥ä½¿ç”¨<code>getApplicationInfo(String packageName, int flags)</code>è¿™ä¸ªæ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">getApplicationNameByPackageName</span><span class="params">(Context context, String packageName)</span> &#123;</span><br><span class="line">    <span class="type">PackageManager</span> <span class="variable">pm</span> <span class="operator">=</span> context.getPackageManager();</span><br><span class="line">    String Name;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Name = pm.getApplicationLabel(pm.getApplicationInfo(packageName, PackageManager.GET_META_DATA)).toString();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (PackageManager.NameNotFoundException e) &#123;</span><br><span class="line">        Name = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Name;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="è·å–åº”ç”¨ä½¿ç”¨æ¬¡æ•°">è·å–åº”ç”¨ä½¿ç”¨æ¬¡æ•°</span></h4><p>è‡³äºåº”ç”¨ä½¿ç”¨æ¬¡æ•°ï¼Œé€šè¿‡æŸ¥è¯¢å‘ç°<code>UsageStats</code>ä¸­æœ‰<code>mLauchCount</code>è¿™ä¸ªå˜é‡ï¼Œä½†æ˜¯Androidæ²¡æœ‰æä¾›å¯¹åº”çš„getæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±éœ€è¦ç”¨åå°„æ¥è·å–ä½¿ç”¨æ¬¡æ•°[3]ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨åå°„ï¼Œè·å–UsageStatsä¸­ç»Ÿè®¡çš„åº”ç”¨ä½¿ç”¨æ¬¡æ•°</span></span><br><span class="line"><span class="meta">@RequiresApi(api = Build.VERSION_CODES.LOLLIPOP)</span></span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getLaunchCount</span><span class="params">(UsageStats usageStats)</span> <span class="keyword">throws</span> IllegalAccessException &#123;</span><br><span class="line">    <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        field = usageStats.getClass().getDeclaredField(<span class="string">&quot;mLaunchCount&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        Log.e(TAG, <span class="string">&quot;getLaunchCount: NoSuchFieldException&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Log.i(TAG, <span class="string">&quot;getLaunchCount: &quot;</span> + <span class="string">&quot;Package Name: &quot;</span> + usageStats.getPackageName() +</span><br><span class="line">          <span class="string">&quot;\t&quot;</span> + (<span class="type">int</span>) field.get(usageStats));</span><br><span class="line">    <span class="keyword">return</span> (<span class="type">int</span>) field.get(usageStats);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å®é™…ä½¿ç”¨ä¸‹æ¥çš„æƒ…å†µå‘ç°ï¼Œå¾—åˆ°çš„æ•°æ®å¯èƒ½ä¸º0ï¼ŒåŸå› ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæ‰€ä»¥è¿˜å¯ä»¥é€šè¿‡ä¸€ç§è¾ƒä¸ºå¤æ‚çš„æ–¹æ³•è¿›è¡Œå®ç°ã€‚é€šè¿‡<code>UsageStatsManager.queryEvents(long beginTime, long endTime)</code>è·å–Androidæä¾›çš„å¦ä¸€ä¸ªç±»<code>UsageEvents</code>ï¼Œéå†å¯ä»¥è·å–åˆ°æ‰€æœ‰çš„eventsï¼Œé€šè¿‡<code>getEventType()</code>æ–¹æ³•å¯ä»¥å¾—åˆ°å¯¹åº”çš„eventtypeï¼Œå…¶ä¸­<code>ACTIVITY_PAUSED</code>å’Œ<code>ACTIVITY_RESUMED</code>åˆ†åˆ«ä»£è¡¨äº†æ´»åŠ¨ç§»åŠ¨åˆ°äº†åå°å’Œç§»åŠ¨åˆ°å‰å°ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªæ´»åŠ¨çš„æ¬¡æ•°æ¥è®¡ç®—å‡ºåº”ç”¨ä½¿ç”¨æ¬¡æ•°ã€‚è¯¦ç»†ä»£ç å¯ä»¥å‚è€ƒ[3]<a href="https://blog.csdn.net/github_37271067/article/details/85292543">androidç»Ÿè®¡æ‰‹æœºåº”ç”¨ä½¿ç”¨æ—¶é•¿ä»¥åŠå¼€å¯æ¬¡æ•°_github_37271067çš„åšå®¢-CSDNåšå®¢</a>ã€‚</p><h4><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h4><p>[1] <a href="https://mp.weixin.qq.com/s?__biz=MzI0NDYzMzg0OQ==&amp;mid=2247483683&amp;idx=1&amp;sn=1cceed0d62a5fbfcc373d5ec45370ed9&amp;chksm=e95b98b5de2c11a37c180d231633245e94c9ede239dbdfcca769afe09f1461e6d995c81241ec#rdä½œè€…ï¼šå”ç å†œé“¾æ¥ï¼šhttps://www.jianshu.com/p/f88b6a9f7462æ¥æºï¼šç®€ä¹¦è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚">Android5.0ä»¥ä¸Šé€šè¿‡UsageStatsManagerç±» è·å–åº”ç”¨ä½¿ç”¨æƒ…å†µï¼ˆç²¾å“ï¼‰ (qq.com)</a></p><p>[2] <a href="https://blog.csdn.net/liuwan1992/article/details/83625520">å…³äºUsageStatsManager.queryUsageStats çš„æ³¨æ„äº‹é¡¹åŠ UsageStatsServiceçš„ç®€å•åŸç†_èœé¸Ÿçš„è‡ªæˆ‘ä¿®å…»-CSDNåšå®¢</a></p><p>[3] <a href="https://blog.csdn.net/github_37271067/article/details/85292543">androidç»Ÿè®¡æ‰‹æœºåº”ç”¨ä½¿ç”¨æ—¶é•¿ä»¥åŠå¼€å¯æ¬¡æ•°_github_37271067çš„åšå®¢-CSDNåšå®¢</a></p><p>[4] <a href="https://developer.android.com/reference">GoogleDevelopers</a></p>]]></content>
      
      
      <categories>
          
          <category> Android </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Android </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€å“ˆå¸Œè¡¨uthashçš„ä½¿ç”¨</title>
      <link href="/2021/05/16/algorithms/c-yu-yan-ha-xi-biao-uthash-de-shi-yong/"/>
      <url>/2021/05/16/algorithms/c-yu-yan-ha-xi-biao-uthash-de-shi-yong/</url>
      
        <content type="html"><![CDATA[<p>Cè¯­è¨€çš„æ ‡å‡†åº“ä¸­æ²¡æœ‰å“ˆå¸Œè¡¨çš„å‡½æ•°å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡ç¬¬ä¸‰æ–¹å¤´æ–‡ä»¶<code>uthash.h</code>è¿™ä¸ªåŒ…æ¥å®ç°å“ˆå¸Œè¡¨çš„æ“ä½œã€‚é¦–å…ˆï¼Œæƒ³è¦ä½¿ç”¨è¿™ä¸ªåŒ…ï¼Œå¯ä»¥è®¿é—®å®ƒçš„githubç½‘ç«™https://github.com/troydhanson/uthashä¸‹è½½<code>uthash.h</code>æ–‡ä»¶ã€‚</p><span id="more"></span><h2><span id="ä½¿ç”¨è¯´æ˜">ä½¿ç”¨è¯´æ˜</span></h2><p>åœ¨ä½ çš„ç¨‹åºä¸­ï¼Œé¦–å…ˆéœ€è¦å®šä¹‰ä¸€ä¸ªç»“æ„ä½“ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;uthash.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> id;                    <span class="comment">/* key */</span></span><br><span class="line">    <span class="type">char</span> name[<span class="number">10</span>];</span><br><span class="line">    UT_hash_handle hh;         <span class="comment">/* makes this structure hashable */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“ä½ æ·»åŠ ä¸€ä¸ªç»“æ„ä½“å˜é‡åˆ°å“ˆå¸Œè¡¨ä¸­æ—¶ï¼Œè¿™ä¸ªç»“æ„ä½“ä¸ä¼šè¢«å¤åˆ¶æˆ–è€…ç§»åŠ¨åˆ°å…¶ä»–åœ°å€ï¼Œæ‰€ä»¥ä½ è¿˜æ˜¯å¯ä»¥åœ¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­å®‰å…¨çš„æŒ‡å‘è¿™ä¸ªç»“æ„ä½“å˜é‡çš„åœ°å€ã€‚æ¯ä¸€ä¸ªè¿™æ ·çš„ç»“æ„ä½“ç”±ä¸€ä¸ªid(è¢«å½“ä½œé”®å€¼ä½¿ç”¨)ï¼Œä¸€ä¸ªè¦å‚¨å­˜çš„å˜é‡ï¼Œå’Œä¸€ä¸ª<code>UT_hash_handle</code>å˜é‡ã€‚<code>UT_hash_handle</code>æ˜¯éå¸¸é‡è¦çš„å˜é‡ï¼Œå®ƒæ˜¯è¿™ä¸ªç»“æ„ä½“èƒ½å¤Ÿå®ç°å“ˆå¸Œè¡¨æ“ä½œçš„å…³é”®ã€‚</p><p>ç„¶åéœ€è¦å®šä¹‰ä¸€ä¸ªå…¨å±€çš„<code>my_struct</code>å˜é‡ <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">users</span> =</span> <span class="literal">NULL</span> <span class="comment">/* important! initialize to NULL */</span></span><br></pre></td></tr></table></figure></p><h4><span id="æ·»åŠ å…ƒç´ ">æ·»åŠ å…ƒç´ </span></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">add_user</span><span class="params">(<span class="type">int</span> user_id, <span class="type">char</span> *name)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line">    HASH_FIND_INT(users, &amp;user_id, s);  <span class="comment">/* id already in the hash? */</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      s = (<span class="keyword">struct</span> my_struct *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> *s);</span><br><span class="line">      s-&gt;id = user_id;</span><br><span class="line">      HASH_ADD_INT(users, id, s);  <span class="comment">/* id: name of key field */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(s-&gt;name, name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œé€šè¿‡<code>HASH_FIND_INT</code>é¦–å…ˆç¡®å®šå½“å‰idçš„å”¯ä¸€æ€§ï¼Œç„¶åå†é€šè¿‡<code>HASH_ADD_INT</code>æ·»åŠ å…ƒç´ ã€‚å¦‚æœå½“å‰å…ƒç´ å·²ç»å­˜åœ¨ï¼Œé‚£ä¹ˆä¿®æ”¹å®ƒå‚¨å­˜çš„å…ƒç´ å€¼ã€‚</p><h4><span id="æŸ¥æ‰¾å…ƒç´ ">æŸ¥æ‰¾å…ƒç´ </span></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> my_struct *<span class="title function_">find_user</span><span class="params">(<span class="type">int</span> user_id)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line"></span><br><span class="line">    HASH_FIND_INT(users, &amp;user_id, s);  <span class="comment">/* s: output pointer */</span></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="åˆ é™¤å…ƒç´ ">åˆ é™¤å…ƒç´ </span></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delete_user</span><span class="params">(<span class="keyword">struct</span> my_struct *user)</span> &#123;</span><br><span class="line">    HASH_DEL(users, user);  <span class="comment">/* user: pointer to deletee */</span></span><br><span class="line">    <span class="built_in">free</span>(user);             <span class="comment">/* optional; it&#x27;s up to you! */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="æ¸…ç©ºè¡¨">æ¸…ç©ºè¡¨</span></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">delete_all</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">current_user</span>, *<span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line">  HASH_ITER(hh, users, current_user, tmp) &#123;</span><br><span class="line">    HASH_DEL(users, current_user);  <span class="comment">/* delete; users advances to next */</span></span><br><span class="line">    <span class="built_in">free</span>(current_user);             <span class="comment">/* optional- if you want to free  */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="è®¡ç®—å…ƒç´ ä¸ªæ•°">è®¡ç®—å…ƒç´ ä¸ªæ•°</span></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> <span class="type">int</span> num_users;</span><br><span class="line">num_users = HASH_COUNT(users);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;there are %u users\n&quot;</span>, num_users);</span><br></pre></td></tr></table></figure><h4><span id="éå†æ‰“å°æ‰€æœ‰å…ƒç´ ">éå†æ‰“å°æ‰€æœ‰å…ƒç´ </span></h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">print_users</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (s = users; s != <span class="literal">NULL</span>; s = s-&gt;hh.next) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;user id %d: name %s\n&quot;</span>, s-&gt;id, s-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4><span id="æ’åº">æ’åº</span></h4><ol type="1"><li>é€šè¿‡idæ’åº <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">name_sort</span><span class="params">(<span class="keyword">struct</span> my_struct *a, <span class="keyword">struct</span> my_struct *b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strcmp</span>(a-&gt;name, b-&gt;name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sort_by_name</span><span class="params">()</span> &#123;</span><br><span class="line">    HASH_SORT(users, name_sort);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li>é€šè¿‡é”®å€¼æ’åº <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">id_sort</span><span class="params">(<span class="keyword">struct</span> my_struct *a, <span class="keyword">struct</span> my_struct *b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (a-&gt;id - b-&gt;id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sort_by_id</span><span class="params">()</span> &#123;</span><br><span class="line">    HASH_SORT(users, id_sort);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2><span id="å®Œæ•´çš„ä¾‹å­">å®Œæ•´çš„ä¾‹å­</span></h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span>   <span class="comment">/* gets */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span>  <span class="comment">/* atoi, malloc */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span>  <span class="comment">/* strcpy */</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;uthash.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> &#123;</span></span><br><span class="line">    <span class="type">int</span> id;                    <span class="comment">/* key */</span></span><br><span class="line">    <span class="type">char</span> name[<span class="number">10</span>];</span><br><span class="line">    UT_hash_handle hh;         <span class="comment">/* makes this structure hashable */</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">users</span> =</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">add_user</span><span class="params">(<span class="type">int</span> user_id, <span class="type">char</span> *name)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line"></span><br><span class="line">    HASH_FIND_INT(users, &amp;user_id, s);  <span class="comment">/* id already in the hash? */</span></span><br><span class="line">    <span class="keyword">if</span> (s == <span class="literal">NULL</span>) &#123;</span><br><span class="line">      s = (<span class="keyword">struct</span> my_struct *)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span> *s);</span><br><span class="line">      s-&gt;id = user_id;</span><br><span class="line">      HASH_ADD_INT(users, id, s);  <span class="comment">/* id: name of key field */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">strcpy</span>(s-&gt;name, name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> my_struct *<span class="title function_">find_user</span><span class="params">(<span class="type">int</span> user_id)</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line"></span><br><span class="line">    HASH_FIND_INT(users, &amp;user_id, s);  <span class="comment">/* s: output pointer */</span></span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delete_user</span><span class="params">(<span class="keyword">struct</span> my_struct *user)</span> &#123;</span><br><span class="line">    HASH_DEL(users, user);  <span class="comment">/* user: pointer to deletee */</span></span><br><span class="line">    <span class="built_in">free</span>(user);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">delete_all</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">current_user</span>, *<span class="title">tmp</span>;</span></span><br><span class="line"></span><br><span class="line">  HASH_ITER(hh, users, current_user, tmp) &#123;</span><br><span class="line">    HASH_DEL(users, current_user);  <span class="comment">/* delete it (users advances to next) */</span></span><br><span class="line">    <span class="built_in">free</span>(current_user);             <span class="comment">/* free it */</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">print_users</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (s = users; s != <span class="literal">NULL</span>; s = (<span class="keyword">struct</span> my_struct*)(s-&gt;hh.next)) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;user id %d: name %s\n&quot;</span>, s-&gt;id, s-&gt;name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">name_sort</span><span class="params">(<span class="keyword">struct</span> my_struct *a, <span class="keyword">struct</span> my_struct *b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">strcmp</span>(a-&gt;name, b-&gt;name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">id_sort</span><span class="params">(<span class="keyword">struct</span> my_struct *a, <span class="keyword">struct</span> my_struct *b)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (a-&gt;id - b-&gt;id);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sort_by_name</span><span class="params">()</span> &#123;</span><br><span class="line">    HASH_SORT(users, name_sort);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">sort_by_id</span><span class="params">()</span> &#123;</span><br><span class="line">    HASH_SORT(users, id_sort);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> &#123;</span><br><span class="line">    <span class="type">char</span> in[<span class="number">10</span>];</span><br><span class="line">    <span class="type">int</span> id = <span class="number">1</span>, running = <span class="number">1</span>;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">my_struct</span> *<span class="title">s</span>;</span></span><br><span class="line">    <span class="type">unsigned</span> num_users;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (running) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 1. add user\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 2. add/rename user by id\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 3. find user\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 4. delete user\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 5. delete all users\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 6. sort items by name\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 7. sort items by id\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 8. print users\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot; 9. count users\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;10. quit\n&quot;</span>);</span><br><span class="line">        gets(in);</span><br><span class="line">        <span class="keyword">switch</span>(atoi(in)) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;name?\n&quot;</span>);</span><br><span class="line">                add_user(id++, gets(in));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;id?\n&quot;</span>);</span><br><span class="line">                gets(in); id = atoi(in);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;name?\n&quot;</span>);</span><br><span class="line">                add_user(id, gets(in));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;id?\n&quot;</span>);</span><br><span class="line">                s = find_user(atoi(gets(in)));</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;user: %s\n&quot;</span>, s ? s-&gt;name : <span class="string">&quot;unknown&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;id?\n&quot;</span>);</span><br><span class="line">                s = find_user(atoi(gets(in)));</span><br><span class="line">                <span class="keyword">if</span> (s) delete_user(s);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;id unknown\n&quot;</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">                delete_all();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">6</span>:</span><br><span class="line">                sort_by_name();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">7</span>:</span><br><span class="line">                sort_by_id();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">8</span>:</span><br><span class="line">                print_users();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">9</span>:</span><br><span class="line">                num_users = HASH_COUNT(users);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;there are %u users\n&quot;</span>, num_users);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">10</span>:</span><br><span class="line">                running = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    delete_all();  <span class="comment">/* free any structures */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h2><p><a href="https://troydhanson.github.io/uthash/userguide.html">uthashç”¨æˆ·ä½¿ç”¨æŒ‡å—</a><a href="https://www.cnblogs.com/dongxb/p/14212531.html">uthashç®€ä»‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> å“ˆå¸Œè¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>421.æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„æœ€å¤§å¼‚æˆ–å€¼</title>
      <link href="/2021/05/16/leetcode/421-shu-zu-zhong-liang-ge-shu-de-zui-da-yi-huo-zhi/"/>
      <url>/2021/05/16/leetcode/421-shu-zu-zhong-liang-ge-shu-de-zui-da-yi-huo-zhi/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¿”å› <code>nums[i]</code> XOR<code>nums[j]</code> çš„æœ€å¤§è¿ç®—ç»“æœï¼Œå…¶ä¸­ <code>0 â‰¤ i â‰¤ j &lt; n</code>ã€‚ - è¦æ±‚åœ¨<code>O(n)</code>æ—¶é—´å†…è§£å†³è¿™ä¸ªé—®é¢˜ -é™åˆ¶ï¼š<code>1 &lt;= nums.length &lt;= 2 * 10^4</code><code>0 &lt;= nums[i] &lt;= 2^31 - 1</code></p><span id="more"></span><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>å¼‚æˆ–è¿ç®—çš„çœŸå€¼è¡¨å¦‚ä¸‹ (ç›¸åŒä¸º0ï¼Œä¸åŒä¸º1)ï¼Œåˆç§°ä¸ºä¸è¿›ä½åŠ æ³•ï¼š</p><figure><img src="https://i.loli.net/2021/05/16/EYtfh6gJrATMFIQ.png" alt="å›¾"><figcaption aria-hidden="true">å›¾</figcaption></figure><p>è¦æ‰¾åˆ°æœ€å¤§çš„æ•°ï¼Œæˆ‘ä»¬è¦å°½é‡é€‰æ‹©é«˜ä½å¼‚æˆ–ç»“æœä¸ºâ€œ1â€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†numsä¸­çš„æ•°åŠ å…¥ä¸€ä¸ªTrieä¸­ï¼Œç„¶åæ¯æ¬¡è´ªå¿ƒçš„è¿›è¡ŒåŒ¹é…ï¼Œæ‰¾åˆ°å¯ä»¥ä½¿å¾—å½“å‰ä½ä¸º1çš„èŠ‚ç‚¹ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node[] node = <span class="keyword">new</span> <span class="title class_">Node</span>[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">31</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">u</span> <span class="operator">=</span> (x &gt;&gt; i) &amp; <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (p.node[u] == <span class="literal">null</span>) p.node[u] = <span class="keyword">new</span> <span class="title class_">Node</span>(); </span><br><span class="line">            p = p.node[u];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getVal</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> node;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">31</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> (x &gt;&gt; i) &amp; <span class="number">1</span>, b = <span class="number">1</span> - a;</span><br><span class="line">            <span class="keyword">if</span> (p.node[b] != <span class="literal">null</span>) &#123;</span><br><span class="line">                ans |= (b &lt;&lt; i);</span><br><span class="line">                p = p.node[b];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ans |= (a &lt;&lt; i);</span><br><span class="line">                p = p.node[a];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMaximumXOR</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i : nums) &#123;</span><br><span class="line">            add(i);</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> getVal(i);</span><br><span class="line">            ans = Math.max(ans, i ^ j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><p><a href="https://leetcode-cn.com/problems/maximum-xor-of-two-numbers-in-an-array/solution/gong-shui-san-xie-noxiang-xin-ke-xue-xi-bmjdg/">ã€å®«æ°´ä¸‰å¶ã®ç›¸ä¿¡ç§‘å­¦ç³»åˆ—ã€‘è¯¦è§£ä¸ºä½•èƒ½ç”¨ã€Œè´ªå¿ƒã€&amp;ã€ŒTrieã€æ‰¾ã€Œæœ€å¤§å¼‚æˆ–ç»“æœã€- æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„æœ€å¤§å¼‚æˆ–å€¼ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> ä½è¿ç®— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é¢è¯•é¢˜ 17.21. ç›´æ–¹å›¾çš„æ°´é‡</title>
      <link href="/2021/04/26/leetcode/mian-shi-ti-17-21-zhi-fang-tu-de-shui-liang/"/>
      <url>/2021/04/26/leetcode/mian-shi-ti-17-21-zhi-fang-tu-de-shui-liang/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ç»™å®šä¸€ä¸ªç›´æ–¹å›¾(ä¹Ÿç§°æŸ±çŠ¶å›¾)ï¼Œå‡è®¾æœ‰äººä»ä¸Šé¢æºæºä¸æ–­åœ°å€’æ°´ï¼Œæœ€åç›´æ–¹å›¾èƒ½å­˜å¤šå°‘æ°´é‡?ç›´æ–¹å›¾çš„å®½åº¦ä¸º1ã€‚<img src="https://i.loli.net/2021/04/06/Yyt1qnaTPRZAIhQ.png" alt="LeetCode: é¢è¯•é¢˜17.21"></p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ï¼š</span><br><span class="line">è¾“å…¥: [0,1,0,2,1,0,1,3,2,1,2,1]</span><br><span class="line">è¾“å‡º: 6</span><br></pre></td></tr></table></figure><span id="more"></span><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>æ€è·¯ï¼šå½“å‰ä½ç½®èƒ½å‚¨å­˜çš„æ°´é‡å–å†³äºå·¦å³ä¸¤è¾¹é‡åˆ°çš„æœ€å¤§å€¼ä¸­çš„æœ€å°å€¼(min(leftTop,rightTop))ã€‚</p><p>æ–¹æ³•ï¼šåŒæŒ‡é’ˆã€‚ä¸€ä¸ªå·¦æŒ‡é’ˆï¼Œä¸€ä¸ªå³æŒ‡é’ˆã€‚å·¦æŒ‡é’ˆå°äºå³æŒ‡é’ˆï¼Œå½“å‰ä½ç½®å¯ä»¥å­˜æ°´ï¼Œå¤§å°ä¸ºleftTop-leftï¼Œç„¶åå³ç§»å·¦æŒ‡é’ˆï¼Œæ›´æ–°leftTopã€‚åŒç†ï¼Œå³æŒ‡é’ˆå°äºå·¦æŒ‡é’ˆï¼Œå½“å‰ä½ç½®å¯ä»¥å­˜å‚¨rightTop-rightçš„æ°´é‡ï¼Œå·¦ç§»å³æŒ‡é’ˆï¼Œæ›´æ–°rightTopã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">trap</span><span class="params">(<span class="type">int</span>* height, <span class="type">int</span> heightSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (heightSize &lt; <span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;   <span class="comment">// å¤§å°ä¸è¶³3ï¼Œå¿…å®šä¸èƒ½å­˜æ°´</span></span><br><span class="line">    <span class="type">int</span> lefttop = <span class="number">0</span>, righttop = heightSize - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (lefttop+<span class="number">1</span> &lt; heightSize &amp;&amp; height[lefttop+<span class="number">1</span>] &gt;= height[lefttop]) lefttop++;</span><br><span class="line">    <span class="keyword">while</span>(righttop - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; height[righttop<span class="number">-1</span>] &gt;= height[righttop]) righttop--;</span><br><span class="line">    <span class="type">int</span> left = lefttop, right = righttop, capacity = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="keyword">if</span> (height[left] &lt;= height[right]) &#123;</span><br><span class="line">            capacity += height[lefttop] - height[left];</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">if</span> (height[left] &gt; height[lefttop]) lefttop = left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (height[left] &gt; height[right]) &#123;</span><br><span class="line">            capacity += height[righttop] - height[right];</span><br><span class="line">            right--;</span><br><span class="line">            <span class="keyword">if</span> (height[right] &gt; height[righttop]) righttop = right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> capacity;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>71. ç®€åŒ–è·¯å¾„</title>
      <link href="/2021/04/08/leetcode/71-jian-hua-lu-jing/"/>
      <url>/2021/04/08/leetcode/71-jian-hua-lu-jing/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² path ï¼Œè¡¨ç¤ºæŒ‡å‘æŸä¸€æ–‡ä»¶æˆ–ç›®å½•çš„Unix é£æ ¼ç»å¯¹è·¯å¾„ï¼ˆä»¥'/' å¼€å¤´ï¼Œè¯·ä½ å°†å…¶è½¬åŒ–ä¸ºæ›´åŠ ç®€æ´çš„è§„èŒƒè·¯å¾„ã€‚</p><p>åœ¨ Unix é£æ ¼çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªç‚¹ï¼ˆ.ï¼‰è¡¨ç¤ºå½“å‰ç›®å½•æœ¬èº«ï¼›æ­¤å¤–ï¼Œä¸¤ä¸ªç‚¹ï¼ˆ..ï¼‰è¡¨ç¤ºå°†ç›®å½•åˆ‡æ¢åˆ°ä¸Šä¸€çº§ï¼ˆæŒ‡å‘çˆ¶ç›®å½•ï¼‰ï¼›ä¸¤è€…éƒ½å¯ä»¥æ˜¯å¤æ‚ç›¸å¯¹è·¯å¾„çš„ç»„æˆéƒ¨åˆ†ã€‚ä»»æ„å¤šä¸ªè¿ç»­çš„æ–œæ ï¼ˆå³ï¼Œ'//'ï¼‰éƒ½è¢«è§†ä¸ºå•ä¸ªæ–œæ '/' ã€‚å¯¹äºæ­¤é—®é¢˜ï¼Œä»»ä½•å…¶ä»–æ ¼å¼çš„ç‚¹ï¼ˆä¾‹å¦‚ï¼Œ'...'ï¼‰å‡è¢«è§†ä¸ºæ–‡ä»¶/ç›®å½•åç§°ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿”å›çš„ è§„èŒƒè·¯å¾„ å¿…é¡»éµå¾ªä¸‹è¿°æ ¼å¼ï¼š</p><p>å§‹ç»ˆä»¥æ–œæ  '/' å¼€å¤´ã€‚ ä¸¤ä¸ªç›®å½•åä¹‹é—´å¿…é¡»åªæœ‰ä¸€ä¸ªæ–œæ  '/' ã€‚æœ€åä¸€ä¸ªç›®å½•åï¼ˆå¦‚æœå­˜åœ¨ï¼‰ä¸èƒ½ ä»¥ '/' ç»“å°¾ã€‚æ­¤å¤–ï¼Œè·¯å¾„ä»…åŒ…å«ä»æ ¹ç›®å½•åˆ°ç›®æ ‡æ–‡ä»¶æˆ–ç›®å½•çš„è·¯å¾„ä¸Šçš„ç›®å½•ï¼ˆå³ï¼Œä¸å« '.' æˆ–'..'ï¼‰ã€‚ è¿”å›ç®€åŒ–åå¾—åˆ°çš„ è§„èŒƒè·¯å¾„ ã€‚</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼špath = &quot;/home/&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;/home&quot;</span><br><span class="line">è§£é‡Šï¼šæ³¨æ„ï¼Œæœ€åä¸€ä¸ªç›®å½•ååé¢æ²¡æœ‰æ–œæ ã€‚ </span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼špath = &quot;/../&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;/&quot;</span><br><span class="line">è§£é‡Šï¼šä»æ ¹ç›®å½•å‘ä¸Šä¸€çº§æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºæ ¹ç›®å½•æ˜¯ä½ å¯ä»¥åˆ°è¾¾çš„æœ€é«˜çº§ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 3ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼špath = &quot;/home//foo/&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;/home/foo&quot;</span><br><span class="line">è§£é‡Šï¼šåœ¨è§„èŒƒè·¯å¾„ä¸­ï¼Œå¤šä¸ªè¿ç»­æ–œæ éœ€è¦ç”¨ä¸€ä¸ªæ–œæ æ›¿æ¢ã€‚</span><br><span class="line"></span><br><span class="line">ç¤ºä¾‹ 4ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼špath = &quot;/a/./b/../../c/&quot;</span><br><span class="line">è¾“å‡ºï¼š&quot;/c&quot; </span><br></pre></td></tr></table></figure><p>æç¤ºï¼š</p><p>1 &lt;= path.length &lt;= 3000</p><ul><li>path ç”±è‹±æ–‡å­—æ¯ï¼Œæ•°å­—ï¼Œ'.'ï¼Œ'/' æˆ– '_' ç»„æˆã€‚</li><li>path æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ Unix é£æ ¼ç»å¯¹è·¯å¾„ã€‚</li></ul></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>åˆ©ç”¨æ ˆï¼Œåˆ†å„ç§æƒ…å†µè®¨è®ºã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> * <span class="title function_">simplifyPath</span><span class="params">(<span class="type">char</span> * path)</span>&#123;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(path);</span><br><span class="line">    <span class="keyword">if</span> (path == <span class="literal">NULL</span> || len == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span> * simPath = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">char</span>) * (len + <span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span> (simPath == <span class="literal">NULL</span>) &#123; <span class="built_in">printf</span>(<span class="string">&quot;Error\n&quot;</span>); <span class="keyword">return</span> <span class="literal">NULL</span>; &#125;</span><br><span class="line">    <span class="type">int</span> top = <span class="number">0</span>, numOfDots = <span class="number">0</span>, isDir = <span class="number">0</span>;      <span class="comment">// æ ˆé¡¶ä¸‹æ ‡ï¼Œ&#x27;.&#x27;çš„æ•°é‡ï¼Œå½“å‰è¾“å…¥å­—ç¬¦æ˜¯å¦ä¸ºè·¯å¾„</span></span><br><span class="line">    <span class="keyword">if</span> (path[<span class="number">0</span>] != <span class="string">&#x27;/&#x27;</span>) &#123; <span class="built_in">printf</span>(<span class="string">&quot;Invalid Input\n&quot;</span>); <span class="keyword">return</span> <span class="literal">NULL</span>; &#125;</span><br><span class="line">    simPath[<span class="number">0</span>] = path[<span class="number">0</span>];                       <span class="comment">// ç¬¬ä¸€ä½ä¸º&#x27;/&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (path[i] == <span class="string">&#x27;.&#x27;</span>) &#123;                   <span class="comment">// å½“å‰å­—ç¬¦ä¸º&#x27;.&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> (!isDir) numOfDots++;            <span class="comment">// è‹¥å½“å‰å­—ç¬¦ä¸æ˜¯è·¯å¾„ï¼Œ&#x27;.&#x27;çš„æ•°é‡å¢åŠ 1</span></span><br><span class="line">            simPath[++top] = <span class="string">&#x27;.&#x27;</span>;               <span class="comment">// &#x27;.&#x27;å…¥æ ˆ</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;                                <span class="comment">// å½“å‰å­—ç¬¦ä¸ä¸º&#x27;.&#x27;</span></span><br><span class="line">            <span class="keyword">if</span> (path[i] != <span class="string">&#x27;/&#x27;</span>) &#123;               <span class="comment">// å½“å‰å­—ç¬¦ä¸ä¸º&#x27;/&#x27;</span></span><br><span class="line">                numOfDots = <span class="number">0</span>;                  <span class="comment">// å½“å‰è¾“å…¥ä¸ºè·¯å¾„ï¼Œæ‰€ä»¥&#x27;.&#x27;çš„æ•°é‡æ›´æ–°ä¸º0</span></span><br><span class="line">                isDir = <span class="number">1</span>;                      <span class="comment">// å½“å‰è¾“å…¥ä¸ºè·¯å¾„</span></span><br><span class="line">                simPath[++top] = path[i];       <span class="comment">// å½“å‰è·¯å¾„å­—ç¬¦å…¥æ ˆ</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numOfDots == <span class="number">1</span>) &#123;        <span class="comment">// æ ˆé¡¶ä¸º&#x27;.&#x27;</span></span><br><span class="line">                top -= <span class="number">2</span>;                       <span class="comment">// &#x27;/.&#x27;å‡ºæ ˆ</span></span><br><span class="line">                <span class="keyword">if</span>(top == <span class="number">-1</span>)                   <span class="comment">// ç¢°åˆ°æ ¹ç›®å½•</span></span><br><span class="line">                    simPath[++top] = <span class="string">&#x27;/&#x27;</span>;       <span class="comment">// &#x27;/&#x27;å…¥æ ˆ</span></span><br><span class="line">                numOfDots = <span class="number">0</span>;                  <span class="comment">// é‡ç½®&#x27;.&#x27;çš„æ•°é‡</span></span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (numOfDots == <span class="number">2</span>) &#123;        <span class="comment">// æ ˆé¡¶ä¸º&#x27;..&#x27;</span></span><br><span class="line">                top -= <span class="number">3</span>;                       <span class="comment">// å‡ºæ ˆ&#x27;/..&#x27;</span></span><br><span class="line">                <span class="keyword">if</span>(top == <span class="number">-1</span>)                   <span class="comment">// ç¢°åˆ°æ ¹ç›®å½•</span></span><br><span class="line">                    simPath[++top] = <span class="string">&#x27;/&#x27;</span>;       <span class="comment">// &#x27;/&#x27;å…¥æ ˆ</span></span><br><span class="line">                <span class="keyword">while</span>(top &gt;= <span class="number">0</span> &amp;&amp; simPath[top] != <span class="string">&#x27;/&#x27;</span>) top--;   <span class="comment">// å‡ºæ ˆç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª&#x27;/&#x27;</span></span><br><span class="line">                numOfDots = <span class="number">0</span>;                  <span class="comment">// é‡ç½®&#x27;.&#x27;çš„æ•°é‡</span></span><br><span class="line">            &#125;                          </span><br><span class="line">            <span class="keyword">if</span> (path[i] ==<span class="string">&#x27;/&#x27;</span> &amp;&amp; simPath[top] != <span class="string">&#x27;/&#x27;</span>)&#123;<span class="comment">// å½“å‰å­—ç¬¦ä¸º&#x27;/&#x27;</span></span><br><span class="line">                simPath[++top] = path[i];       <span class="comment">// æ ˆé¡¶ä¸æ˜¯&#x27;/&#x27;ï¼Œå…¥æ ˆ&#x27;/&#x27;</span></span><br><span class="line">                isDir = <span class="number">0</span>;                      <span class="comment">// å½“å‰è¾“å…¥éè·¯å¾„æ–‡ä»¶åç§°</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (numOfDots == <span class="number">1</span>) top -= <span class="number">2</span>;               <span class="comment">// å¤„ç†&#x27;.&#x27;æ²¡æœ‰è¢«å¤„ç†çš„æƒ…å†µ</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (numOfDots == <span class="number">2</span>) &#123;</span><br><span class="line">        top -= <span class="number">3</span>;</span><br><span class="line">        <span class="keyword">while</span>(top &gt;= <span class="number">0</span> &amp;&amp; simPath[top] != <span class="string">&#x27;/&#x27;</span>) top--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (top == <span class="number">-1</span>) simPath[++top] = <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span> (top &gt; <span class="number">0</span> &amp;&amp; simPath[top] == <span class="string">&#x27;/&#x27;</span>)  top--; <span class="comment">// æœ€åä¸€ä¸ªå­—ç¬¦ä¸º&#x27;/&#x27;      </span></span><br><span class="line">    simPath[++top] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> simPath;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> æ ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>81. æœç´¢æ—‹è½¬æ’åºæ•°ç»„II</title>
      <link href="/2021/04/07/leetcode/81-sou-suo-xuan-zhuan-pai-xu-shu-zu-ii/"/>
      <url>/2021/04/07/leetcode/81-sou-suo-xuan-zhuan-pai-xu-shu-zu-ii/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>å·²çŸ¥å­˜åœ¨ä¸€ä¸ªæŒ‰éé™åºæ’åˆ—çš„æ•´æ•°æ•°ç»„ numsï¼Œæ•°ç»„ä¸­çš„å€¼ä¸å¿…äº’ä¸ç›¸åŒã€‚</p><p>åœ¨ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ï¼Œnums åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªä¸‹æ ‡ kï¼ˆ0 &lt;= k &lt;nums.lengthï¼‰ä¸Šè¿›è¡Œäº† æ—‹è½¬ ï¼Œä½¿æ•°ç»„å˜ä¸º [nums[k], nums[k+1], ...,nums[n-1], nums[0], nums[1], ..., nums[k-1]]ï¼ˆä¸‹æ ‡ ä» 0 å¼€å§‹è®¡æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œ [0,1,2,4,4,4,5,6,6,7] åœ¨ä¸‹æ ‡ 5 å¤„ç»æ—‹è½¬åå¯èƒ½å˜ä¸º[4,5,6,6,7,0,1,2,4,4] ã€‚</p><p>ç»™ä½ æ—‹è½¬åçš„æ•°ç»„numså’Œä¸€ä¸ªæ•´æ•°targetï¼Œè¯·ä½ ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥åˆ¤æ–­ç»™å®šçš„ç›®æ ‡å€¼æ˜¯å¦å­˜åœ¨äºæ•°ç»„ä¸­ã€‚å¦‚æœnums ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ targetï¼Œåˆ™è¿”å› trueï¼Œå¦åˆ™è¿”å› falseã€‚</p><span id="more"></span><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šnums = [2,5,6,0,0,1,2], target = 0 è¾“å‡ºï¼štrue ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šnums = [2,5,6,0,0,1,2], target = 3 è¾“å‡ºï¼šfalse</p><p>æç¤ºï¼š</p><ul><li>1 &lt;= nums.length &lt;= 5000</li><li>-10<sup>4</sup> &lt;= nums[i] &lt;= 10<sup>4</sup></li><li>é¢˜ç›®æ•°æ®ä¿è¯ nums åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªä¸‹æ ‡ä¸Šè¿›è¡Œäº†æ—‹è½¬</li><li>-10<sup>4</sup> &lt;= target &lt;= 10<sup>4</sup></li></ul></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>æ€è·¯ï¼šåˆ©ç”¨åˆ°æ•°ç»„æ˜¯æ’åºè¿‡çš„æ€§è´¨ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨äºŒåˆ†æ³•ã€‚ç”±äºæ•°ç»„æ˜¯è¿›è¡Œæ—‹è½¬è¿‡çš„æ’åºæ•°ç»„æ‰€ä»¥å¦‚æœnums[i]&gt;nums[j]ï¼Œé‚£ä¹ˆiå’Œjä¸€å®šæ˜¯å¤„äºæ—‹è½¬çš„ä¸‹æ ‡çš„ä¸¤ä¾§çš„ã€‚å®šä¹‰å·¦æŒ‡é’ˆlï¼Œå³æŒ‡é’ˆrï¼Œä¸­é—´æŒ‡é’ˆmidã€‚</p><ul><li>ç¬¬ä¸€ç§æƒ…å†µï¼šnums[l]&lt;=nums[mid]ã€‚è¯´æ˜lå’Œmidéƒ½åœ¨æ—‹è½¬ä¸‹æ ‡çš„å·¦ä¾§ï¼ˆè¿™é‡Œæœ‰ç‰¹æ®Šæƒ…å†µå¾…ä¼šè®¨è®ºï¼‰ï¼Œå¦‚æœæ­¤æ—¶taråœ¨lå’Œmidçš„ä¸­é—´ï¼Œé‚£ä¹ˆå³æŒ‡é’ˆæ›´æ–°ä¸ºmid-1ï¼›å¦åˆ™ï¼Œè¯´æ˜åœ¨midå’Œrä¸­é—´ï¼Œå·¦æŒ‡é’ˆæ›´æ–°ä¸ºmid+1ã€‚</li><li>ç¬¬äºŒç§æƒ…å†µï¼šnums[l]&gt;nums[mid]ã€‚è¯´æ˜lå’Œmidåœ¨æ—‹è½¬ä¸‹æ ‡çš„ä¸åŒä¾§ï¼Œä¹Ÿå°±æ˜¯midå’Œréƒ½åœ¨æ—‹è½¬ä¸‹æ ‡çš„å³ä¾§ï¼Œå¦‚æœæ­¤æ—¶taråœ¨midå’Œrä¸­é—´ï¼Œé‚£ä¹ˆå·¦æŒ‡é’ˆæ›´æ–°ä¸ºmid+1ï¼›å¦åˆ™ï¼Œå³æŒ‡é’ˆæ›´æ–°ä¸ºmid-1ã€‚</li><li>ç‰¹æ®Šæƒ…å†µï¼šè€ƒè™‘ç›¸ç­‰çš„æƒ…å†µï¼Œå¦‚æœnums[l]=nums[mid]ï¼Œæˆ‘ä»¬ä¸ä¸€å®šèƒ½ä¿è¯lå’Œmidåœ¨åŒä¸€ä¾§ï¼Œå› ä¸ºå¦‚æœlå’Œrä¸èƒ½ä¿è¯ä¸ç›¸ç­‰ï¼Œå¦‚æœä¸‰è€…éƒ½ç›¸ç­‰ï¼Œé‚£ä¹ˆå®Œå…¨å¯èƒ½midå’Œréƒ½åœ¨å³ä¾§ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æ’é™¤æ‰å½“å‰lå’Œrï¼ŒåŒæ—¶å‘ä¸­é—´ç§»åŠ¨ä¸€ä½ã€‚</li><li>åˆ†æï¼šåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ•°ç»„çš„æ‰€æœ‰å…ƒç´ éƒ½ç›¸åŒï¼Œé‚£ä¹ˆå°±å®Œå…¨æ²¡æœ‰ç”¨åˆ°äºŒåˆ†æ³•ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œç©ºé—´å¤æ‚åº¦ä¸ºO(1)ã€‚</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>* nums, <span class="type">int</span> numsSize, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (numsSize == <span class="number">0</span>)  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="type">int</span> l = <span class="number">0</span>, r = numsSize - <span class="number">1</span>, mid;</span><br><span class="line">    <span class="keyword">while</span> (l &lt;= r) &#123;</span><br><span class="line">        mid = (l + r) / <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums[mid] == target) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (nums[l] == nums[mid] &amp;&amp; nums[mid] == nums[r]) &#123;</span><br><span class="line">            ++l;</span><br><span class="line">            --r;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (nums[l] &lt;= nums[mid]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[l] &lt;= target &amp;&amp; target &lt; nums[mid]) &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] &lt; target &amp;&amp; target &lt;= nums[numsSize - <span class="number">1</span>]) &#123;</span><br><span class="line">                l = mid + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                r = mid - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ¥æ»‘ç¨½ï¼Œç”±äºè¿™ä¸ªæ•°ç»„çš„å¤§å°ä¸å¤§ï¼Œå¦‚æœé‡‡ç”¨æš´åŠ›è§£æ³•ï¼Œç›´æ¥éå†æœç´¢ç®€å•æ˜äº†ï¼Œå¾—å‡ºçš„ç»“æœä¹Ÿè¿˜ä¸é”™,ç”šè‡³æ¯”é‡‡ç”¨äºŒåˆ†æ³•çš„</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>* nums, <span class="type">int</span> numsSize, <span class="type">int</span> target)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numsSize; i++) <span class="keyword">if</span> (nums[i] == target) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>äºŒåˆ†æ³•ï¼š</p><p>æ‰§è¡Œç”¨æ—¶ï¼š8 ms, åœ¨æ‰€æœ‰ C æäº¤ä¸­å‡»è´¥äº†55.63%çš„ç”¨æˆ·</p><p>å†…å­˜æ¶ˆè€—ï¼š5.7 MB, åœ¨æ‰€æœ‰ C æäº¤ä¸­å‡»è´¥äº†99.68%çš„ç”¨æˆ·</p><p>æš´åŠ›æ³•ï¼š</p><p>æ‰§è¡Œç”¨æ—¶ï¼š4 ms, åœ¨æ‰€æœ‰ C æäº¤ä¸­å‡»è´¥äº†93.57%çš„ç”¨æˆ·</p><p>å†…å­˜æ¶ˆè€—ï¼š5.8 MB, åœ¨æ‰€æœ‰ C æäº¤ä¸­å‡»è´¥äº†84.89%çš„ç”¨æˆ·</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹II</title>
      <link href="/2021/04/06/leetcode/80-shan-chu-you-xu-shu-zu-zhong-de-chong-fu-xiang-ii/"/>
      <url>/2021/04/06/leetcode/80-shan-chu-you-xu-shu-zu-zhong-de-chong-fu-xiang-ii/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ç»™ä½ ä¸€ä¸ªæœ‰åºæ•°ç»„ nums ï¼Œè¯·ä½  åŸåœ° åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´ æœ€å¤šå‡ºç°ä¸¤æ¬¡ ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ åŸåœ° ä¿®æ”¹è¾“å…¥æ•°ç»„ å¹¶åœ¨ä½¿ç”¨ O(1)é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><span id="more"></span><p>è¯´æ˜ï¼š</p><p>ä¸ºä»€ä¹ˆè¿”å›æ•°å€¼æ˜¯æ•´æ•°ï¼Œä½†è¾“å‡ºçš„ç­”æ¡ˆæ˜¯æ•°ç»„å‘¢ï¼Ÿ</p><p>è¯·æ³¨æ„ï¼Œè¾“å…¥æ•°ç»„æ˜¯ä»¥ã€Œå¼•ç”¨ã€æ–¹å¼ä¼ é€’çš„ï¼Œè¿™æ„å‘³ç€åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚</p><p>ä½ å¯ä»¥æƒ³è±¡å†…éƒ¨æ“ä½œå¦‚ä¸‹:</p><p>// nums æ˜¯ä»¥â€œå¼•ç”¨â€æ–¹å¼ä¼ é€’çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹å®å‚åšä»»ä½•æ‹·è´ int len =removeDuplicates(nums);</p><p>// åœ¨å‡½æ•°é‡Œä¿®æ”¹è¾“å…¥æ•°ç»„å¯¹äºè°ƒç”¨è€…æ˜¯å¯è§çš„ã€‚ //æ ¹æ®ä½ çš„å‡½æ•°è¿”å›çš„é•¿åº¦, å®ƒä¼šæ‰“å°å‡ºæ•°ç»„ä¸­ è¯¥é•¿åº¦èŒƒå›´å†… çš„æ‰€æœ‰å…ƒç´ ã€‚ for(int i = 0; i &lt; len; i++) { print(nums[i]); }</p><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼šnums = [1,1,1,2,2,3] è¾“å‡ºï¼š5, nums = [1,1,2,2,3]è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 5, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 1, 1,2, 2, 3 ã€‚ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚ ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šnums = [0,0,1,1,1,1,2,3,3] è¾“å‡ºï¼š7, nums = [0,0,1,1,2,3,3]è§£é‡Šï¼šå‡½æ•°åº”è¿”å›æ–°é•¿åº¦ length = 7, å¹¶ä¸”åŸæ•°ç»„çš„å‰äº”ä¸ªå…ƒç´ è¢«ä¿®æ”¹ä¸º 0, 0,1, 1, 2, 3, 3 ã€‚ ä¸éœ€è¦è€ƒè™‘æ•°ç»„ä¸­è¶…å‡ºæ–°é•¿åº¦åé¢çš„å…ƒç´ ã€‚</p><p>æç¤ºï¼š</p><ul><li>1 &lt;= nums.length &lt;= 3 * 104</li><li>-104 &lt;= nums[i] &lt;= 104</li><li>nums å·²æŒ‰å‡åºæ’åˆ—</li></ul></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>ç”±äºè¿™é“é¢˜æ•°ç»„å·²ç»æ˜¯æœ‰åºæ•°ç»„ï¼Œæ‰€ä»¥å¾ˆå®¹æ˜“æƒ³åˆ°ä½¿ç”¨åŒæŒ‡é’ˆã€‚ä¸€ä¸ªæŒ‡é’ˆä»å¤´åˆ°å°¾éå†æ•°ç»„ï¼Œå¦ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å½“å‰éœ€è¦ä¿®æ”¹çš„ä½ç½®ã€‚å½“å‰æ•°å­—å‡ºç°æ¬¡æ•°å¦‚æœè¶…è¿‡2ï¼Œé‚£ä¹ˆå½“å‰ä½ç½®ä¸éœ€è¦ä¿®æ”¹ï¼›æœªè¶…è¿‡2ï¼Œæ›´æ”¹å½“å‰éœ€è¦æ›´æ”¹çš„ä½ç½®ï¼›è‹¥å½“å‰æ•°å­—å‘ç”Ÿå˜åŒ–ï¼Œæ›´æ–°å‡ºç°æ¬¡æ•°å’Œå½“å‰ä½ç½®ã€‚æ—¶é—´å¤æ‚åº¦O(n)ï¼Œç©ºé—´å¤æ‚åº¦O(1)ï¼Œå’Œé¢˜ç›®è¦æ±‚ä¸€è‡´ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>* nums, <span class="type">int</span> numsSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (numsSize &lt;= <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> currNum = nums[<span class="number">0</span>], freq = <span class="number">1</span>, i;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt; numsSize; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (currNum == nums[i]) &#123;</span><br><span class="line">            <span class="keyword">if</span> (++freq &lt;= <span class="number">2</span>) nums[++len] = nums[i];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            currNum = nums[i];</span><br><span class="line">            freq = <span class="number">1</span>;</span><br><span class="line">            nums[++len] = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> len+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šæ–¹æ³•è¿˜å¯ä»¥è¿›è¡Œæ”¹è¿›ã€‚å¦‚æœåŸæœ¬çš„æ•°ç»„é•¿åº¦å°äºç­‰äº2ï¼Œæœ€å¤šå°±ä¸¤ä¸ªå…ƒç´ ï¼Œä¸éœ€è¦æ›´æ”¹ã€‚æ­¤å¤–ï¼Œè¿™ç§æ–¹æ³•æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé¢å¤–çš„å˜é‡æ¥è®¡ç®—å…ƒç´ å‡ºç°çš„æ¬¡æ•°ï¼Œå®é™…ä¸Šæˆ‘ä»¬å·²ç»çŸ¥é“ä¸€ä¸ªæ•°å­—æœ€å¤šå‡ºç°ä¸¤æ¬¡ï¼Œæ‰€ä»¥å¦‚æœå½“å‰è®¿é—®ä½ç½®å’Œéœ€è¦ä¿®æ”¹çš„å½“å‰ä½ç½®å‰ä¸¤ä¸ªä½ç½®ç›¸åŒçš„è¯ï¼Œé‚£ä¹ˆè¯´æ˜å½“å‰çš„æ•°å­—å·²ç»å‡ºç°äº†å¤šæ¬¡ï¼Œåˆ™ç›´æ¥ç§»åŠ¨åˆ°ä¸‹ä¸€ä½ç½®å³å¯ï¼›å¦åˆ™éœ€è¦ä¿®æ”¹çš„ä½ç½®ä¿®æ”¹ä¸ºå½“å‰éå†åˆ°çš„å€¼ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>* nums, <span class="type">int</span> numsSize)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (numsSize &lt;= <span class="number">2</span>) <span class="keyword">return</span> numsSize;</span><br><span class="line">    <span class="type">int</span> len = <span class="number">2</span>, curr = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (; curr &lt; numsSize; curr++)</span><br><span class="line">        <span class="keyword">if</span> (nums[len<span class="number">-2</span>] != nums[curr])</span><br><span class="line">            nums[len++] = nums[curr];</span><br><span class="line">    <span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>5706. å¥å­ç›¸ä¼¼æ€§IIIï¼ˆç¬¬49åœºåŒå‘¨èµ›ï¼‰</title>
      <link href="/2021/04/04/leetcode/5706-ju-zi-xiang-si-xing-iii/"/>
      <url>/2021/04/04/leetcode/5706-ju-zi-xiang-si-xing-iii/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ä¸€ä¸ªå¥å­æ˜¯ç”±ä¸€äº›å•è¯ä¸å®ƒä»¬ä¹‹é—´çš„å•ä¸ªç©ºæ ¼ç»„æˆï¼Œä¸”å¥å­çš„å¼€å¤´å’Œç»“å°¾æ²¡æœ‰å¤šä½™ç©ºæ ¼ã€‚æ¯”æ–¹è¯´ï¼Œ<code>"Hello World"</code>ï¼Œ<code>"HELLO"</code> ï¼Œ<code>"hello world hello world"</code>éƒ½æ˜¯å¥å­ã€‚æ¯ä¸ªå•è¯éƒ½ <strong>åª</strong> åŒ…å«å¤§å†™å’Œå°å†™è‹±æ–‡å­—æ¯ã€‚</p><p>å¦‚æœä¸¤ä¸ªå¥å­ <code>sentence1</code> å’Œ <code>sentence2</code>ï¼Œå¯ä»¥é€šè¿‡å¾€å…¶ä¸­ä¸€ä¸ªå¥å­æ’å…¥ä¸€ä¸ªä»»æ„çš„å¥å­ï¼ˆ<strong>å¯ä»¥æ˜¯ç©ºå¥å­</strong>ï¼‰è€Œå¾—åˆ°å¦ä¸€ä¸ªå¥å­ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™ä¸¤ä¸ªå¥å­æ˜¯<strong>ç›¸ä¼¼çš„</strong>ã€‚æ¯”æ–¹è¯´ï¼Œ<code>sentence1 = "Hello my name is Jane"</code> ä¸”<code>sentence2 = "Hello Jane"</code> ï¼Œæˆ‘ä»¬å¯ä»¥å¾€<code>sentence2</code> ä¸­ <code>"Hello"</code> å’Œ <code>"Jane"</code>ä¹‹é—´æ’å…¥ <code>"my name is"</code> å¾—åˆ° <code>sentence1</code> ã€‚</p><p>ç»™ä½ ä¸¤ä¸ªå¥å­ <code>sentence1</code> å’Œ <code>sentence2</code> ï¼Œå¦‚æœ<code>sentence1</code> å’Œ <code>sentence2</code> æ˜¯ç›¸ä¼¼çš„ï¼Œè¯·ä½ è¿”å›<code>true</code> ï¼Œå¦åˆ™è¿”å› <code>false</code> ã€‚</p><span id="more"></span><p><strong>ç¤ºä¾‹ 1ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;è¾“å…¥ï¼šsentence1 = &quot;My name is Haley&quot;, sentence2 = &quot;My Haley&quot;</span><br><span class="line">&gt;è¾“å‡ºï¼štrue</span><br><span class="line">&gt;è§£é‡Šï¼šå¯ä»¥å¾€ sentence2 ä¸­ &quot;My&quot; å’Œ &quot;Haley&quot; ä¹‹é—´æ’å…¥ &quot;name is&quot; ï¼Œå¾—åˆ° sentence1 ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 2ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;è¾“å…¥ï¼šsentence1 = &quot;of&quot;, sentence2 = &quot;A lot of words&quot;</span><br><span class="line">&gt;è¾“å‡ºï¼šfalse</span><br><span class="line">&gt;è§£é‡Šï¼šæ²¡æ³•å¾€è¿™ä¸¤ä¸ªå¥å­ä¸­çš„ä¸€ä¸ªå¥å­åªæ’å…¥ä¸€ä¸ªå¥å­å°±å¾—åˆ°å¦ä¸€ä¸ªå¥å­ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 3ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;è¾“å…¥ï¼šsentence1 = &quot;Eating right now&quot;, sentence2 = &quot;Eating&quot;</span><br><span class="line">&gt;è¾“å‡ºï¼štrue</span><br><span class="line">&gt;è§£é‡Šï¼šå¯ä»¥å¾€ sentence2 çš„ç»“å°¾æ’å…¥ &quot;right now&quot; å¾—åˆ° sentence1 ã€‚</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ 4ï¼š</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;è¾“å…¥ï¼šsentence1 = &quot;Luky&quot;, sentence2 = &quot;Lucccky&quot;</span><br><span class="line">&gt;è¾“å‡ºï¼šfalse</span><br></pre></td></tr></table></figure><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= sentence1.length, sentence2.length &lt;= 100</code></li><li><code>sentence1</code> å’Œ <code>sentence2</code>éƒ½åªåŒ…å«å¤§å°å†™è‹±æ–‡å­—æ¯å’Œç©ºæ ¼ã€‚</li><li><code>sentence1</code> å’Œ <code>sentence2</code>ä¸­çš„å•è¯éƒ½åªç”±å•ä¸ªç©ºæ ¼éš”å¼€ã€‚</li></ul></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>æœ¬é¢˜æˆ‘é‡‡ç”¨äº†åŠ¨æ€è§„åˆ’çš„æ€è·¯ã€‚æœç„¶è¿˜æ˜¯å¾ˆä¸ç†Ÿç»ƒï¼Œæ‰¾çŠ¶æ€è½¬ç§»æ–¹ç¨‹æƒ³äº†å¥½ä¹…ï¼Œæƒ³å‡ºæ¥çš„è¿˜æ˜¯æ„Ÿè§‰å¾ˆç¬¨çš„åŠæ³•ï¼Œæœç„¶è¿˜æ˜¯å¾—åŠ å¼ºç»ƒä¹ ã€‚</p><p>æ€è·¯ï¼š<code>dp[i, j]</code>è¡¨ç¤ºsentence1çš„å‰iä¸ªå’Œsentence2çš„å‰jä¸ªwordèƒ½å¦ç»è¿‡ä¸€æ¬¡æ’å…¥è·å¾—ã€‚åˆ†åˆ«è€ƒè™‘ä¸¤ä¸ªå¥å­å½“å‰çš„wordæ˜¯å¦æ˜¯å¯ä»¥æ’å…¥å¦ä¸€ä¸ªsentenceè·å¾—ç›¸åŒçš„sentenceã€‚æƒ…å†µå¦‚ä¸‹ï¼š</p><ol type="1"><li>å¦‚æœsentence1å‰<code>i-1</code>ä¸ªwordå’Œsentence2å‰jä¸ªwordå¯ä»¥é€šè¿‡ä¸€æ¬¡æ’å…¥ç›¸ç­‰ï¼Œå¹¶ä¸”ä¹‹å‰æ’å…¥çš„wordåœ¨sentence1ä¸­å¹¶ä¸”è¿˜å¯ä»¥ç»§ç»­æ’å…¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­åœ¨sentence1ä¸­æ’å…¥ï¼Œæˆ‘ä»¬è®°ä¸º1ã€‚</li><li>å¦‚æœsentence1å‰iä¸ªwordå’Œsentence2å‰j-1ä¸ªwordå¯ä»¥é€šè¿‡ä¸€æ¬¡æ’å…¥ç›¸ç­‰ï¼Œå¹¶ä¸”ä¹‹å‰æ’å…¥çš„wordåœ¨sentence2ä¸­å¹¶ä¸”è¿˜å¯ä»¥ç»§ç»­æ’å…¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç»§ç»­åœ¨sentence2ä¸­æ’å…¥ï¼Œæˆ‘ä»¬è®°ä¸º2ã€‚</li><li>ä»¥ä¸Šä¸¤ç§æƒ…å†µéƒ½ä¸ç¬¦åˆï¼Œå¦‚æœsentence1ç¬¬iä¸ªwordå’Œsentence2ç¬¬jä¸ªwordä¸€è‡´ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦è€ƒè™‘sentence1å‰i-1ä¸ªwordå’Œsentence2å‰j-1ä¸ªwordæ˜¯å¦å¯ä»¥é€šè¿‡ä¸€æ¬¡æ’å…¥ç›¸ç­‰ã€‚å¦‚æœä¹‹å‰æ˜¯åœ¨ç»§ç»­æ’å…¥çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨å°±è¦ç»ˆæ­¢æ’å…¥ï¼Œè®°ä¸º3ï¼Œå¦åˆ™dp[i,j]=dp[i-1,j-1]ã€‚ï¼ˆè¿™é‡Œæˆ‘ä»¬å·²ç»æ’é™¤äº†è™½ç„¶å½“å‰wordç›¸ç­‰ä½†æ˜¯å¯ä»¥æŠŠå½“å‰çš„wordå½“æˆæ’å…¥çš„æƒ…å†µï¼šæ¯”å¦‚sentence1=â€ab câ€œ, sentence2="a b g b c"ä¸­sentence2ä¸­çš„"g b"æ˜¯æ’å…¥çš„ï¼Œè€Œsentence1ä¸­ä¹Ÿå­˜åœ¨bï¼‰</li><li>å‰©ä¸‹çš„æƒ…å†µå°±æ˜¯æˆ‘ä»¬æ— æ³•æ’å…¥ä¸€ä¸ªsentenceä½¿ä¸¤ç»„sentenceç›¸ç­‰ï¼Œè®°ä¸º4</li></ol><p>ä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é¦–å…ˆå°†sentenceè½¬åŒ–ä¸ºwordæ•°ç»„</span></span><br><span class="line"><span class="type">char</span>** <span class="title function_">sentenceToWord</span><span class="params">(<span class="type">char</span> * sentence, <span class="type">int</span> *wordlen)</span> &#123;</span><br><span class="line">    <span class="type">int</span> sen_len = <span class="built_in">strlen</span>(sentence);</span><br><span class="line">    <span class="keyword">if</span> (sen_len == <span class="number">0</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">char</span>** word = (<span class="type">char</span>**)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">char</span>*) * sen_len);</span><br><span class="line">    <span class="type">int</span> wordIdx = <span class="number">0</span>, i = <span class="number">0</span>, charIdx = <span class="number">0</span>;</span><br><span class="line">    word[wordIdx] = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">char</span>) * (sen_len+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (; i &lt; sen_len; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (sentence[i] == <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">            word[wordIdx][charIdx] = <span class="string">&#x27;\0&#x27;</span>; </span><br><span class="line">            word[++wordIdx] = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">char</span>) * sen_len);</span><br><span class="line">            charIdx = <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            word[wordIdx][charIdx++] = sentence[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    word[wordIdx][charIdx] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">    *wordlen = wordIdx + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> word;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">bool</span> <span class="title function_">areSentencesSimilar</span><span class="params">(<span class="type">char</span> * sentence1, <span class="type">char</span> * sentence2)</span>&#123;</span><br><span class="line">    <span class="type">int</span> len1, len2;</span><br><span class="line">    <span class="type">char</span>** word1 = sentenceToWord(sentence1, &amp;len1);</span><br><span class="line">    <span class="type">char</span>** word2 = sentenceToWord(sentence2, &amp;len2);</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="type">int</span> ** dp = (<span class="type">int</span>**)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>*) * (len1+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= len1; i++) dp[i] = (<span class="type">int</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>) * (len2 + <span class="number">1</span>));</span><br><span class="line">    <span class="comment">// 0ä»£è¡¨è¿˜æ²¡æœ‰æ’å…¥</span></span><br><span class="line">    <span class="comment">// 1ä»£è¡¨iæ­£åœ¨æ’å…¥</span></span><br><span class="line">    <span class="comment">// 2ä»£è¡¨jæ­£åœ¨æ’å…¥</span></span><br><span class="line">    <span class="comment">// 3ä»£è¡¨å·²ç»æ’å…¥</span></span><br><span class="line">    <span class="comment">// 4ä»£è¡¨æ— æ³•æ’å…¥</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= len1; i++) dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= len2; i++) dp[<span class="number">0</span>][i] = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= len1; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= len2; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (dp[i<span class="number">-1</span>][j] == <span class="number">1</span> || dp[i<span class="number">-1</span>][j] == <span class="number">0</span>) dp[i][j] = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (dp[i][j<span class="number">-1</span>] == <span class="number">2</span> || dp[i][j<span class="number">-1</span>] == <span class="number">0</span>) dp[i][j] = <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strcmp</span>(word1[i<span class="number">-1</span>], word2[j<span class="number">-1</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (dp[i<span class="number">-1</span>][j<span class="number">-1</span>] == <span class="number">1</span> || dp[i<span class="number">-1</span>][j<span class="number">-1</span>] == <span class="number">2</span>) dp[i][j] = <span class="number">3</span>;</span><br><span class="line">                <span class="keyword">else</span> dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = <span class="number">4</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[len1][len2] != <span class="number">4</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>11. ç››æœ€å¤šæ°´çš„å®¹å™¨</title>
      <link href="/2021/04/03/leetcode/11-sheng-zui-duo-shui-de-rong-qi/"/>
      <url>/2021/04/03/leetcode/11-sheng-zui-duo-shui-de-rong-qi/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ç»™ä½  n ä¸ªéè´Ÿæ•´æ•° a1ï¼Œa2ï¼Œ...ï¼Œanï¼Œæ¯ä¸ªæ•°ä»£è¡¨åæ ‡ä¸­çš„ä¸€ä¸ªç‚¹ (i, ai)ã€‚åœ¨åæ ‡å†…ç”» n æ¡å‚ç›´çº¿ï¼Œå‚ç›´çº¿ i çš„ä¸¤ä¸ªç«¯ç‚¹åˆ†åˆ«ä¸º (i, ai) å’Œ (i, 0)ã€‚æ‰¾å‡ºå…¶ä¸­çš„ä¸¤æ¡çº¿ï¼Œä½¿å¾—å®ƒä»¬ä¸ x è½´å…±åŒæ„æˆçš„å®¹å™¨å¯ä»¥å®¹çº³æœ€å¤šçš„æ°´ã€‚</p><p>è¯´æ˜ï¼šä½ ä¸èƒ½å€¾æ–œå®¹å™¨ã€‚</p><span id="more"></span><p>ç¤ºä¾‹ 1ï¼š</p><figure><img src="https://aliyun-lc-upload.oss-cn-hangzhou.aliyuncs.com/aliyun-lc-upload/uploads/2018/07/25/question_11.jpg" alt="img"><figcaption aria-hidden="true">img</figcaption></figure><p>è¾“å…¥ï¼š[1,8,6,2,5,4,8,3,7] è¾“å‡ºï¼š49 è§£é‡Šï¼šå›¾ä¸­å‚ç›´çº¿ä»£è¡¨è¾“å…¥æ•°ç»„[1,8,6,2,5,4,8,3,7]ã€‚åœ¨æ­¤æƒ…å†µä¸‹ï¼Œå®¹å™¨èƒ½å¤Ÿå®¹çº³æ°´ï¼ˆè¡¨ç¤ºä¸ºè“è‰²éƒ¨åˆ†ï¼‰çš„æœ€å¤§å€¼ä¸º49ã€‚</p><p>ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼šheight = [1,1] è¾“å‡ºï¼š1</p><p>ç¤ºä¾‹ 3ï¼š</p><p>è¾“å…¥ï¼šheight = [4,3,2,1,4] è¾“å‡ºï¼š16</p><p>ç¤ºä¾‹ 4ï¼š</p><p>è¾“å…¥ï¼šheight = [1,2,1] è¾“å‡ºï¼š2</p><p>æç¤ºï¼š</p><ul><li>n = height.length</li><li>2 &lt;= n &lt;= 3 * 104</li><li>0 &lt;= height[i] &lt;= 3 * 104</li></ul></blockquote><h2><span id="è§£æ³•åŒæŒ‡é’ˆ">è§£æ³•ï¼šåŒæŒ‡é’ˆ</span></h2><p>å®šä¹‰ä¸¤ä¸ªå·¦å³æŒ‡é’ˆï¼Œè·å–å…¶ä¸­è¾ƒå°çš„æŒ‡é’ˆï¼Œå°†è¾ƒå°æŒ‡é’ˆå‘ä¸­é—´ç§»åŠ¨ï¼Œé‡æ–°è·å–ä¸¤ä¸ªæŒ‡é’ˆä¸­çš„è¾ƒå°è€…ï¼Œç„¶åæ¯”è¾ƒå½“å‰åŒºåŸŸå¤§å°ä¸ç§»åŠ¨ååŒºåŸŸå¤§å°å¹¶è¿›è¡Œèµ‹å€¼ã€‚é‡å¤ä»¥ä¸Šæ“ä½œç›´åˆ°ä¸¤ä¸ªæŒ‡é’ˆç›¸é‡ã€‚<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">maxArea</span><span class="params">(<span class="type">int</span> *height, <span class="type">int</span> heightSize)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (heightSize == <span class="number">0</span> &amp;&amp; heightSize == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> left = <span class="number">0</span>, right = heightSize - <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> min = height[left] &lt; height[right] ? left : right;</span><br><span class="line">    <span class="type">int</span> area = height[min] * (right - left);</span><br><span class="line">    <span class="keyword">while</span> (left &lt; right)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (min &lt;= left ) left++;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (min &gt;= right ) right--;</span><br><span class="line">        min = height[left] &lt; height[right] ? left : right;</span><br><span class="line">        <span class="keyword">if</span> (area &lt; height[min] * (right - left))</span><br><span class="line">            area = height[min] * (right - left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> area;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://leetcode-cn.com/problems/container-with-most-water/">11.ç››æœ€å¤šæ°´çš„å®¹å™¨ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰ (leetcode-cn.com)</a></p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> åŒæŒ‡é’ˆ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>1143. æœ€é•¿å…¬å…±å­åºåˆ—</title>
      <link href="/2021/04/03/leetcode/1143-zui-chang-gong-gong-zi-xu-lie/"/>
      <url>/2021/04/03/leetcode/1143-zui-chang-gong-gong-zi-xu-lie/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><blockquote><p>ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸² text1 å’Œ text2ï¼Œè¿”å›è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦ã€‚å¦‚æœä¸å­˜åœ¨å…¬å…±å­åºåˆ— ï¼Œè¿”å› 0 ã€‚</p><p>ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­åºåˆ—æ˜¯æŒ‡è¿™æ ·ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼šå®ƒæ˜¯ç”±åŸå­—ç¬¦ä¸²åœ¨ä¸æ”¹å˜å­—ç¬¦çš„ç›¸å¯¹é¡ºåºçš„æƒ…å†µä¸‹åˆ é™¤æŸäº›å­—ç¬¦ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ä»»ä½•å­—ç¬¦ï¼‰åç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚</p><p>ä¾‹å¦‚ï¼Œ"ace" æ˜¯ "abcde" çš„å­åºåˆ—ï¼Œä½† "aec" ä¸æ˜¯ "abcde" çš„å­åºåˆ—ã€‚ä¸¤ä¸ªå­—ç¬¦ä¸²çš„ å…¬å…±å­åºåˆ— æ˜¯è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²æ‰€å…±åŒæ‹¥æœ‰çš„å­åºåˆ—ã€‚</p><span id="more"></span><p>ç¤ºä¾‹ 1ï¼š</p><p>è¾“å…¥ï¼štext1 = "abcde", text2 = "ace" è¾“å‡ºï¼š3<br>è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯ "ace" ï¼Œå®ƒçš„é•¿åº¦ä¸º 3 ã€‚ ç¤ºä¾‹ 2ï¼š</p><p>è¾“å…¥ï¼štext1 = "abc", text2 = "abc" è¾“å‡ºï¼š3 è§£é‡Šï¼šæœ€é•¿å…¬å…±å­åºåˆ—æ˜¯"abc" ï¼Œå®ƒçš„é•¿åº¦ä¸º 3 ã€‚ ç¤ºä¾‹ 3ï¼š</p><p>è¾“å…¥ï¼štext1 = "abc", text2 = "def" è¾“å‡ºï¼š0è§£é‡Šï¼šä¸¤ä¸ªå­—ç¬¦ä¸²æ²¡æœ‰å…¬å…±å­åºåˆ—ï¼Œè¿”å› 0 ã€‚</p><p><strong>æç¤ºï¼š</strong></p><ul><li><code>1 &lt;= text1.length, text2.length &lt;= 1000</code></li><li><code>text1</code> å’Œ <code>text2</code> ä»…ç”±å°å†™è‹±æ–‡å­—ç¬¦ç»„æˆã€‚</li></ul></blockquote><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>ç»å…¸çš„åŠ¨æ€è§„åˆ’ã€‚dp[i][j]è¡¨ç¤ºtext1çš„å‰iä¸ªå­—ç¬¦å’Œtext2çš„å‰jä¸ªå­—ç¬¦çš„æœ€é•¿å…¬å…±å­åºåˆ—ä¸ªæ•°ã€‚å½“æˆ‘ä»¬ç§»åŠ¨åˆ°(i,j)è¿™ä¸ªä½ç½®çš„æ—¶å€™ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul><li>text1[i] == text2[j]ã€‚æ­¤æ—¶dp[i][j]=dp[i-1][j-1]+1;</li><li>text1[i] != text2[j]ã€‚æ­¤æ—¶dp[i][j]=max(dp[i-1][j], dp[i][j-1])</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* åŠ¨æ€è§„åˆ’ */</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">longestCommonSubsequence</span><span class="params">(<span class="type">char</span> * text1, <span class="type">char</span> * text2)</span>&#123;</span><br><span class="line">    <span class="type">int</span> len1 = <span class="built_in">strlen</span>(text1), len2 = <span class="built_in">strlen</span>(text2);</span><br><span class="line">    <span class="type">int</span> dp[<span class="number">1000</span>][<span class="number">1000</span>];</span><br><span class="line">    <span class="type">int</span> i, j;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;= len1; i++) dp[i][<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt;= len2; i++) dp[<span class="number">0</span>][i] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">1</span>; i &lt;= len1; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">1</span>; j &lt;= len2; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (text1[i<span class="number">-1</span>] == text2[j<span class="number">-1</span>]) &#123;</span><br><span class="line">                dp[i][j] = dp[i<span class="number">-1</span>][j<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[i][j] = dp[i<span class="number">-1</span>][j] &gt; dp[i][j<span class="number">-1</span>] ? dp[i<span class="number">-1</span>][j] : dp[i][j<span class="number">-1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[len1][len2];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="æ³¨æ„">æ³¨æ„</span></h2><ul><li>åœ¨ä»£ç ä¸­å°½é‡ä¸è¦ä½¿ç”¨åˆ†é…å†…å­˜çš„æ–¹æ³•ï¼Œå†…å­˜æ¶ˆè€—æ˜æ˜¾å¢åŠ ã€‚</li><li>è°ƒç”¨å‡½æ•°ä¹Ÿä¼šå¢åŠ è¿è¡Œçš„æ—¶é—´ï¼Œå¦‚æœå®šä¹‰maxå‡½æ•°ï¼Œè¿è¡Œæ—¶é—´ä¼šå˜é•¿ã€‚</li><li>åˆå§‹åŒ–dpè¡¨çš„æ—¶å€™ï¼Œå¯ä»¥ç®€å•é€šè¿‡<code>int dp[1000][1000] = &#123;0&#125;;</code>æ¥è¿›è¡Œåˆå§‹åŒ–ï¼Œä½†æ˜¯è¿™æ ·ä¼šåˆå§‹åŒ–ä¸€äº›ä¸éœ€è¦åˆå§‹åŒ–çš„ä½ç½®ï¼Œè¿è¡Œæ—¶é—´ä¼šå¢åŠ ã€‚æ‰€ä»¥åªéœ€è¦é€šè¿‡éå†åˆå§‹åŒ–ç¬¬ä¸€è¡Œå’Œç¬¬ä¸€åˆ—å³å¯ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>10. æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…</title>
      <link href="/2021/04/01/leetcode/10-zheng-ze-biao-da-shi-pi-pei/"/>
      <url>/2021/04/01/leetcode/10-zheng-ze-biao-da-shi-pi-pei/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ pï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ '.' å’Œ '*'çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚</p><ul><li>'.' åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦</li><li>'*' åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ ã€‚æ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›–æ•´ä¸ªå­—ç¬¦ä¸²sçš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 4ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šs = &quot;aab&quot; p = &quot;c*a*b&quot;</span><br><span class="line">è¾“å‡ºï¼štrue</span><br><span class="line">è§£é‡Šï¼šå› ä¸º &#x27;*&#x27; è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ &#x27;c&#x27;ä¸º 0 ä¸ª, &#x27;a&#x27;è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² &quot;aab&quot;ã€‚</span><br></pre></td></tr></table></figure><span id="more"></span><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><blockquote><h3><span id="è§£æ">è§£æ</span></h3><p>ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æ–¹æ³•è¿›è¡Œè§£é¢˜ï¼Œåˆ†ä¸ºä¸¤ç§æƒ…å†µï¼šé¦–å…ˆæ˜¯é*çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦è€ƒè™‘så’Œpå½“å‰å­—ç¬¦æ˜¯å¦åŒ¹é…ï¼Œå¾ˆå®¹æ˜“å¾—å‡ºçŠ¶æ€è½¬ç§»æ–¹ç¨‹ã€‚ç„¶åæ˜¯pä¸º*ï¼Œä¹Ÿå¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯sçš„å½“å‰å­—ç¬¦ä¸pçš„å‰ä¸€ä¸ªå­—ç¬¦ä¸åŒ¹é…ï¼Œé‚£ä¹ˆ*å°±åŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œå¦ä¸€ç§æ˜¯sçš„å½“å‰å­—ç¬¦å¯ä»¥å’Œpçš„å‰ä¸€ä¸ªå­—ç¬¦è¿›è¡ŒåŒ¹é…ï¼Œè¯´æ˜*å¯ä»¥åŒ¹é…å¤šä¸ªå­—ç¬¦ï¼Œä¸¤ç§æƒ…å†µ</p><ul><li>åŒ¹é… sæœ«å°¾çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå°†è¯¥å­—ç¬¦æ‰”æ‰ï¼Œè€Œè¯¥ç»„åˆè¿˜å¯ä»¥ç»§ç»­è¿›è¡ŒåŒ¹é…ï¼›</li><li>ä¸åŒ¹é…å­—ç¬¦ï¼Œå°†è¯¥ç»„åˆæ‰”æ‰ï¼Œä¸å†è¿›è¡ŒåŒ¹é…ã€‚</li></ul><figure><img src="https://raw.githubusercontent.com/Lucas-hao/Picgo-Picture/master/img/image-20220227143444739.png" alt="image-20220227143444739"><figcaption aria-hidden="true">image-20220227143444739</figcaption></figure></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> <span class="title function_">charMatch</span><span class="params">(<span class="type">char</span> s, <span class="type">char</span> p)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (p == <span class="string">&#x27;.&#x27;</span> || s == p) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ä½¿ç”¨æ–¹æ³•ï¼šåŠ¨æ€è§„åˆ’ */</span></span><br><span class="line"><span class="type">bool</span> <span class="title function_">isMatch</span><span class="params">(<span class="type">char</span> * s, <span class="type">char</span> * p)</span>&#123;</span><br><span class="line">    <span class="type">int</span> height = <span class="built_in">strlen</span>(s);</span><br><span class="line">    <span class="type">int</span> width = <span class="built_in">strlen</span>(p);</span><br><span class="line">    <span class="type">bool</span>** table = (<span class="type">bool</span>**)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">bool</span>*) * (height+<span class="number">1</span>));</span><br><span class="line">    <span class="keyword">if</span> (table == <span class="literal">NULL</span>) &#123; <span class="built_in">printf</span>(<span class="string">&quot;Error\n&quot;</span>); <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt;= height; i++) &#123;</span><br><span class="line">        table[i] = (<span class="type">bool</span>*)<span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">bool</span>) * (width+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">if</span> (table[i] == <span class="literal">NULL</span>) &#123; <span class="built_in">printf</span>(<span class="string">&quot;Error\n&quot;</span>); <span class="keyword">return</span> <span class="literal">false</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    table[<span class="number">0</span>][<span class="number">0</span>] = <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= height; i++) table[i][<span class="number">0</span>] = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= width; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p[i<span class="number">-1</span>] == <span class="string">&#x27;*&#x27;</span> &amp;&amp; i &gt;= <span class="number">2</span>) table[<span class="number">0</span>][i] = table[<span class="number">0</span>][i<span class="number">-2</span>];</span><br><span class="line">        <span class="keyword">else</span> table[<span class="number">0</span>][i] = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= height; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">1</span>; j &lt;= width; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= <span class="number">2</span> &amp;&amp; p[j<span class="number">-1</span>] == <span class="string">&#x27;*&#x27;</span> ) &#123;</span><br><span class="line">                <span class="keyword">if</span> (charMatch(s[i<span class="number">-1</span>], p[j<span class="number">-2</span>]))</span><br><span class="line">                    table[i][j] = table[i<span class="number">-1</span>][j] || table[i][j<span class="number">-2</span>];</span><br><span class="line">                <span class="keyword">else</span> table[i][j] = table[i][j<span class="number">-2</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (charMatch(s[i<span class="number">-1</span>], p[j<span class="number">-1</span>])) &#123;</span><br><span class="line">                table[i][j] = table[i<span class="number">-1</span>][j<span class="number">-1</span>];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                table[i][j] = <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> table[height][width];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥æºï¼š<a href="https://leetcode-cn.com/problems/regular-expression-matching/">LeetCode-10</a></p>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>61. æ—‹è½¬é“¾è¡¨</title>
      <link href="/2021/03/27/leetcode/61-xuan-zhuan-lian-biao/"/>
      <url>/2021/03/27/leetcode/61-xuan-zhuan-lian-biao/</url>
      
        <content type="html"><![CDATA[<h2><span id="é¢˜ç›®æè¿°">é¢˜ç›®æè¿°</span></h2><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code>ï¼Œæ—‹è½¬é“¾è¡¨ï¼Œå°†é“¾è¡¨æ¯ä¸ªèŠ‚ç‚¹å‘å³ç§»åŠ¨ <code>k</code> ä¸ªä½ç½®ã€‚</p><span id="more"></span><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 1ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = [1,2,3,4,5], k = 2</span><br><span class="line">è¾“å‡ºï¼š[4,5,1,2,3]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ç¤ºä¾‹ 2ï¼š</span><br><span class="line"></span><br><span class="line">è¾“å…¥ï¼šhead = [0,1,2], k = 4</span><br><span class="line">è¾“å‡ºï¼š[2,0,1]</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æç¤ºï¼š</span><br><span class="line">é“¾è¡¨ä¸­èŠ‚ç‚¹çš„æ•°ç›®åœ¨èŒƒå›´ [0, 500] å†…</span><br><span class="line">-100 &lt;= Node.val &lt;= 100</span><br><span class="line">0 &lt;= k &lt;= 2 * 109</span><br></pre></td></tr></table></figure><h2><span id="é¢˜è§£">é¢˜è§£</span></h2><p>æœ¬é¢˜ä¸éš¾ï¼Œåªéœ€è¦æ‰¾åˆ°newHeadå’ŒnewTailçš„ä½ç½®ï¼Œå°†åŸæ¥çš„tailå’ŒåŸæ¥çš„headè¿æ¥ï¼Œè¿”å›newHeadå°±å¯ä»¥äº†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     struct ListNode *next;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> ListNode* <span class="title function_">rotateRight</span><span class="params">(<span class="keyword">struct</span> ListNode* head, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="literal">NULL</span>;  <span class="comment">// Exception: empty list</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">preHead</span> =</span> head;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">newHead</span> =</span> head;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">newTail</span> =</span> head;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span>* <span class="title">preTail</span> =</span> head;</span><br><span class="line">    <span class="type">int</span> ListSize = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">// get the total size of the list as well as the previous tail of the list</span></span><br><span class="line">    <span class="keyword">for</span> (; preTail-&gt;next != <span class="literal">NULL</span>; preTail = preTail-&gt;next, ListSize++);</span><br><span class="line">    k %= ListSize;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">0</span>) <span class="keyword">return</span> head;</span><br><span class="line">    <span class="comment">// get the new tail of the new list</span></span><br><span class="line">    <span class="comment">// new head of the list is the successor of the new tail</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; ListSize - k - <span class="number">1</span>; i++, newTail = newTail-&gt;next);</span><br><span class="line">    newHead = newTail-&gt;next;</span><br><span class="line">    newTail-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="comment">// connect the previous tail to the previous head;</span></span><br><span class="line">    preTail-&gt;next = preHead;</span><br><span class="line">    <span class="keyword">return</span> newHead;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> LeetCode </category>
          
      </categories>
      
      
        <tags>
            
            <tag> C </tag>
            
            <tag> LeetCode </tag>
            
            <tag> é“¾è¡¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¸¸æˆæ¦‚ç‡æ¨¡å‹</title>
      <link href="/2020/12/26/other/you-xi-chou-qia-mo-xing-fen-xi/"/>
      <url>/2020/12/26/other/you-xi-chou-qia-mo-xing-fen-xi/</url>
      
        <content type="html"><![CDATA[<p>ç›®å‰çš„ä¸­å›½æ¸¸æˆå¸‚åœºï¼Œæœ€çƒ­é—¨çš„è«è¿‡äºå…è´¹æŠ½å¡æ‰‹æ¸¸ã€‚æ¸¸æˆå‚å•†ä¸ºäº†ç›ˆåˆ©ï¼Œè®¾è®¡å‡ºæœ‰ä¸åŒè§„åˆ™çš„å¡æ± ï¼Œè®©ç©å®¶æŠ½å¡è·å–ç¨€æœ‰çš„äººç‰©å’Œæ­¦å™¨ã€‚è¿™ä¸€æœºåˆ¶å¸å¼•äº†å¾ˆå¤šç©å®¶ï¼Œé¦–å…ˆå› ä¸ºæ‰‹æ¸¸æ˜¯å…è´¹çš„ï¼Œå…¥æ‰‹é—¨æ§›è¾ƒä½ï¼Œå…¶æ¬¡å¾ˆå¤šäººå–œæ¬¢æŠ½å¡è·å–è§’è‰²å’Œæ­¦å™¨çš„æˆå°±æ„Ÿã€‚ä¸ºäº†æ›´å¸å¼•ç©å®¶ï¼Œæ¸¸æˆç­–åˆ’å°±å¾—è®¾è®¡å‡ºèƒ½å¤Ÿè®©å¤§éƒ¨åˆ†ç©å®¶ï¼Œæ— è®ºæ˜¯æ¬§çš‡è¿˜æ˜¯éé…‹æ»¡æ„çš„æŠ½å¡æœºåˆ¶ã€‚æœ¬æ–‡å°†ç®€è¦åˆ†æç›®å‰æ¸¸æˆå‚å•†å¯èƒ½ä½¿ç”¨çš„æŠ½å¡æœºåˆ¶ï¼ˆä»…å±äºä¸ªäººçŒœæƒ³åŠ ä¸€äº›ç½‘ä¸Šçš„èµ„æ–™ï¼‰ã€‚</p><span id="more"></span><h3><span id="æŠ½å¡æœºåˆ¶çš„å¤§è‡´åˆ†ç±»">æŠ½å¡æœºåˆ¶çš„å¤§è‡´åˆ†ç±»</span></h3><ol type="1"><li>æœ€ç®€å•çš„æŠ½å¡æ¨¡å‹å°±æ˜¯æ¯æ¬¡æŠ½å¡çš„æ¦‚ç‡éƒ½æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æŠ½å¡çš„æ¦‚ç‡éƒ½æ˜¯<span class="math inline">\(p\)</span>,æˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºçº¯éšæœºã€‚é‚£ä¹ˆç©å®¶ç¬¬<span class="math inline">\(n\)</span>æ¬¡æŠ½ä¸­çš„éšæœºå˜é‡åˆ†å¸ƒå°±æ˜¯ä¸€ä¸ªå‡ ä½•åˆ†å¸ƒã€‚è¿™ç§æŠ½å¡æ¨¡å‹å¾ˆæ˜æ˜¾å¯¹äºéé…‹éå¸¸ä¸å‹å¥½ï¼Œç†è®ºä¸Šå¯èƒ½å­˜åœ¨æŠ½äº†å¾ˆå¤šå¾ˆå¤šæ¬¡ä»ç„¶æ²¡æœ‰æŠ½ä¸­çš„äººå­˜åœ¨ã€‚æ‰€ä»¥çº¯éšæœºæ¨¡å‹åœ¨æŠ½å¡æ¸¸æˆä¸­æ˜¯ä¸ä¼šä½¿ç”¨çš„ã€‚</li><li>å¯¹åº”äºçº¯éšæœºçš„ï¼Œæˆ‘ä»¬å¯ä»¥ç§°ä¹‹ä¸ºä¼ªéšæœºï¼ˆæ³¨æ„è¿™é‡Œçš„ä¼ªéšæœºå’Œè®¡ç®—æœºéšæœºæ•°æ¦‚å¿µä¸­çš„ä¼ªéšæœºä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼‰ã€‚ä¼ªéšæœºå°±æ˜¯è¯´æ¯æ¬¡æŠ½å¡çš„æ¦‚ç‡éƒ½æ˜¯æ˜¯ä¼šè¿›è¡Œæ”¹å˜çš„ã€‚ä¸‹é¢å°±é‡ç‚¹ä»‹ç»å‡ ç§å¯èƒ½çš„ä¼ªéšæœºæ¨¡å‹ã€‚</li></ol><h3><span id="ä¼ªéšæœºæ¨¡å‹">ä¼ªéšæœºæ¨¡å‹</span></h3><ul><li><h4><span id="åè¿ä¿åº•">åè¿ä¿åº•</span></h4><p>åè¿ä¿åº•åº”è¯¥æ˜¯æˆ‘ä»¬åœ¨æ¸¸æˆä¸­æœ€å¸¸è§åˆ°çš„æ¦‚ç‡æ¨¡å‹ã€‚å¦‚æœè¿æŠ½åæ¬¡ï¼Œå‰ä¹æ¬¡éƒ½æ²¡æœ‰æŠ½ä¸­çš„è¯ï¼Œé‚£ä¹ˆç¬¬åæ¬¡å°±å¿…å®šä¼šæŠ½ä¸­ã€‚è¿™ç§æ¦‚ç‡æ¨¡å‹ä¼šå¯¼è‡´å¾ˆå¤šç©å®¶éƒ½æ˜¯ä¾é åè¿ä¿åº•ï¼Œå¹¶ä¸”æ¦‚ç‡è´¨é‡å‡½æ•°å›¾åƒä¼šåœ¨ç¬¬åæ¬¡çªç„¶ä¸Šå‡ï¼Œæ˜¾å¾—ä¸å‡åŒ€ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬è®¾å®šæŠ½åˆ°Aå¡çš„æ¦‚ç‡ä¸º0.1ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾—å‡ºçš„è¯¥æ¦‚ç‡è´¨é‡å‡½æ•°å’Œç´¯ç§¯åˆ†å¸ƒå‡½æ•°çš„å›¾åƒå°±æ˜¯ä¸‹å›¾ã€‚å¯ä»¥ç®—å‡ºæ•°å­¦æœŸæœ›ä¸º6.5ï¼Œå¹¶ä¸”å¤§çº¦60%çš„ç©å®¶åœ¨å‰9æ¬¡æŠ½åˆ°ï¼Œè€Œæ‰€è°“çš„éé…‹ä¹Ÿå°±æ˜¯è§¦å‘ä¿åº•çš„ç©å®¶å åˆ°äº†40%ã€‚</p><p><img src="https://i.loli.net/2021/03/27/i13cMAZSkxavU24.png"></p><p>å¦‚æœæˆ‘ä»¬ç”¨ç¨‹åºæ¨¡æ‹Ÿ10000æ¬¡åœ¨è¿™ç§æ¦‚ç‡æ¨¡å‹ä¸‹çš„æŠ½å¡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä¸‹é¢çš„åˆ†å¸ƒã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¤§éƒ¨åˆ†ç©å®¶æŠ½100æ¬¡ä¼šå¾—åˆ°16-20ä¸ªæƒ³è¦å¾—åˆ°çš„ã€‚</p><p><img src="https://i.loli.net/2021/03/27/MW9EINoerzX2lyO.png"></p><p>è¿™ç§åè¿ä¿åº•çš„æ¨¡å‹ä¸€èˆ¬ç”¨äºå››æ˜Ÿè§’è‰²æˆ–è€…æ­¦å™¨ã€‚å››æ˜Ÿè™½ç„¶æ²¡æœ‰äº”æ˜Ÿç¨€æœ‰ï¼Œä½†æ˜¯ä¹Ÿæ˜¯éœ€è¦ä¸€å®šçš„ä¿éšœä»¥ç¡®ä¿ç©å®¶ç”šè‡³è¿å››æ˜Ÿéƒ½æŠ½ä¸åˆ°ã€‚</p></li><li><h4><span id="æ¦‚ç‡å¢åŠ æ¨¡å‹">æ¦‚ç‡å¢åŠ æ¨¡å‹</span></h4><p>é‚£ä¹ˆå¯¹äºæ›´åŠ ç¨€æœ‰çš„äº”æ˜Ÿè§’è‰²å’Œæ­¦å™¨æ¥è¯´ï¼Œåè¿ä¿åº•è‚¯å®šå°±æ˜¾å¾—å¤ªè¿‡å®¹æ˜“äº†ã€‚è¿™ä¸ªæ—¶å€™ç­–åˆ’ä¸€èˆ¬å¸Œæœ›ç©å®¶å·®ä¸å¤šæŠ½å‡ åå‘å¯ä»¥æŠ½ä¸­ä¸€ä¸ªï¼Œæ‰€ä»¥å°±éœ€è¦æ¯”å¦‚100æŠ½ä¿åº•è¿™æ ·çš„æœºåˆ¶ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸ªæ—¶å€™ç»§ç»­é‡‡ç”¨ä»¥ä¸Šçš„å‰é¢çš„æ¦‚ç‡éƒ½ä¸å˜ï¼Œé‚£ä¹ˆå¾ˆå®¹æ˜“æƒ³åˆ°è¿™æ ·å­çš„è¯å¤§éƒ¨åˆ†ç©å®¶éƒ½ä¼šæ˜¯100å‘ä¿åº•...æ‰€ä»¥å°±éœ€è¦è°ƒæ•´è¯¥æ¦‚ç‡ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è®¾å®šä¸€ä¸ªåˆå§‹æ¦‚ç‡<span class="math inline">\(p\)</span>ï¼Œç„¶åå¦‚æœæ²¡æœ‰æŠ½ä¸­ï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡æŠ½å¡æ¦‚ç‡å°±ç»™ä»–ä¸€ä¸ªå¢é‡<span class="math inline">\(\alpha\)</span>ï¼Œå¦‚æœæŠ½ä¸­ï¼Œé‚£ä¹ˆå°±å›å½’åˆå§‹æ¦‚ç‡ã€‚æ‰€ä»¥ï¼Œç¬¬Xæ¬¡æŠ½ä¸­çš„æ¦‚ç‡å°±æ˜¯<span class="math inline">\(p(x)=p+\alpha\times(x-1)\)</span>ï¼Œæ¦‚ç‡è´¨é‡å‡½æ•°</p><p><span class="math display">\[P(x) =\Pi^{x-1}_{i=1}\lbrack(1-p(i))\rbrack\times p(x)=\Pi^{x-1}_{i=1}[(1-p-\alpha\times(i-1))]\times(p+\alpha\times(x-1))\]</span></p><p>æˆ‘ä»¬è®¾å®š<span class="math inline">\(p=0.01,\alpha=0.01\)</span>ï¼Œç„¶åç”»å‡ºå›¾åƒä¹‹åå‘ç°ï¼Œè¿™ä¸ªå›¾åƒå±…ç„¶å¾ˆåƒæ˜¯ä¸€ä¸ªæ­£æ€åˆ†å¸ƒçš„å›¾åƒï¼Œæ‰€ä»¥é¡ºä¾¿æŠŠæ­£æ€åˆ†å¸ƒçš„å›¾åƒç”»äº†å‡ºæ¥å¯¹æ¯”ï¼Œè™½ç„¶ä¹Ÿä¸çŸ¥é“ä¸ºä»€ä¹ˆè¿™ä¸¤å¼ å›¾è¿™ä¹ˆåƒã€‚</p></li></ul><p><img src="https://i.loli.net/2021/03/27/3mABlhKoPTYfWyQ.png"></p><p>åœ¨è¿™ä¸ªæ¦‚ç‡æ¨¡å‹ä¸‹ï¼Œç”±äº100æ¬¡çš„æ—¶å€™<span class="math inline">\(p(100)=0.01+99\times0.1=1\)</span>ï¼Œæ‰€ä»¥å®ç°äº†ä¸€ä¸ª100æŠ½ä¿åº•çš„æ•ˆæœã€‚ä½†æ˜¯ç­–åˆ’å¸Œæœ›çš„æ˜¯100æŠ½ä¿åº•ï¼Œå¹¶ä¸”å¤§éƒ¨åˆ†äººåº”è¯¥æ˜¯åœ¨äº”å…­åæŠ½çš„æ—¶å€™æŠ½åˆ°çš„ï¼Œè€Œåœ¨è¿™ä¸ªæ¨¡å‹ä¸­ï¼Œè¶…è¿‡90%çš„äººåœ¨å‰äºŒåæŠ½å°±æŠ½åˆ°äº†ï¼Œè¿™æ˜¾ç„¶ä¸ç¬¦åˆé¢„æœŸã€‚æ‰€ä»¥åœ¨è¿™ä¸ªæ¨¡å‹çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç›¸åº”çš„è°ƒæ•´ï¼Œè®©æ¨¡å‹çš„æœ€é«˜ç‚¹å‘å³åç§»ã€‚æˆ‘ä»¬ç”±æ­¤å¯ä»¥ä½¿ç”¨ä¸€ä¸‹æ¨¡å‹ï¼šå‰50æ¬¡æŠ½å¡æ¦‚ç‡å›ºå®šï¼Œå50æ¬¡æŠ½å¡ä½¿ç”¨ä¸Šé¢çš„æ¨¡å‹ï¼Œæ¯æ¬¡æŠ½å¡æ¦‚ç‡å¢åŠ ã€‚è¿™æ ·æˆ‘ä»¬å¾—å‡ºçš„è¯¥æ¦‚ç‡è´¨é‡å‡½æ•°å°±æ˜¯<span class="math display">\[  p(x)=    \begin{cases}    p, &amp; x&lt;50 \\\\    p+\alpha(x-50), &amp;x&gt;=50    \end{cases}\]</span></p><p>å’Œä¸Šé¢ä¸€æ ·ï¼Œå¦‚æœéœ€è¦æ»¡è¶³100æŠ½ä¿åº•çš„è¯ï¼Œè®©<span class="math inline">\(p=0.02,\alpha=0.02\)</span>ã€‚å…¶æ¦‚ç‡è´¨é‡å‡½æ•°å’Œç´¯ç§¯åˆ†å¸ƒå‡½æ•°å›¾åƒå¦‚ä¸‹ï¼š</p><figure><img src="https://i.loli.net/2021/03/27/uxRhTpL34nm21GC.png" alt="æ‹“å±•æ¨¡å‹æ¨¡æ‹Ÿç»“æœ"><figcaption aria-hidden="true">æ‹“å±•æ¨¡å‹æ¨¡æ‹Ÿç»“æœ</figcaption></figure><p>è¿™å¼ å›¾æˆ‘è®¤ä¸ºè¯´å¯ä»¥ç”¨ä½œäº”æ˜Ÿçš„æ¦‚ç‡æ¨¡å‹äº†ã€‚70å‘ä¹‹å‰å¤§éƒ¨åˆ†äººéƒ½èƒ½å¤ŸæŠ½åˆ°ï¼Œå¹¶ä¸”é›†ä¸­åœ¨40å‘åˆ°70å‘ï¼Œå äº†43.69%ã€‚è¿™ä¹Ÿå¯ä»¥è§†ä½œæ¸¸æˆç©å®¶å£ä¸­çš„â€œä½ä¿â€ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨ä¸Šé¢çš„æ¨¡å‹æ¨¡æ‹Ÿ10000æ¬¡100è¿æŠ½ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼š</p><figure><img src="https://i.loli.net/2021/03/27/uxRhTpL34nm21GC.png" alt="æ‹“å±•æ¨¡å‹æ¨¡æ‹Ÿç»“æœ"><figcaption aria-hidden="true">æ‹“å±•æ¨¡å‹æ¨¡æ‹Ÿç»“æœ</figcaption></figure><p>â€‹è¿™ä¸ªç»“æœä¸ªäººè®¤ä¸ºå°±éå¸¸åƒçœŸå®æ¸¸æˆä¸­çš„ç»“æœäº†ï¼Œå¤§éƒ¨åˆ†äººéƒ½åªèƒ½å¤ŸæŠ½åˆ°1-2å‘ï¼Œå¹¶ä¸”å¾ˆå¤šäººéƒ½æ˜¯ä¾é ä½ä¿çš„ï¼ˆè¿™å¾ˆçœŸå®ï¼‰</p><hr><h3><span id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</span></h3><p><a href="https://www.40407.com/zixun/7986.html">æ˜æ—¥æ–¹èˆŸæŠ½å¡æ¦‚ç‡å’Œä¿åº•æœºåˆ¶ç ”</a><a href="https://www.jianshu.com/p/031e53e8553c">æ¸¸æˆæŠ½å¥–æ¦‚ç‡æ¨¡å‹</a></p>]]></content>
      
      
      <categories>
          
          <category> Other </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Math </tag>
            
            <tag> æ¦‚ç‡è®º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Cè¯­è¨€å®ç°å…¨æ’åˆ—</title>
      <link href="/2020/12/25/algorithms/c-yu-yan-shi-xian-quan-pai-lie/"/>
      <url>/2020/12/25/algorithms/c-yu-yan-shi-xian-quan-pai-lie/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨æ–¹æ³•ï¼šå›æº¯æ³•</p><blockquote><p>å›æº¯æ³•ï¼ˆæ¢ç´¢ä¸å›æº¯æ³•ï¼‰æ˜¯ä¸€ç§é€‰ä¼˜æœç´¢æ³•ï¼Œåˆç§°ä¸ºè¯•æ¢æ³•ï¼ŒæŒ‰é€‰ä¼˜æ¡ä»¶å‘å‰æœç´¢ï¼Œä»¥è¾¾åˆ°ç›®æ ‡ã€‚ä½†å½“æ¢ç´¢åˆ°æŸä¸€æ­¥æ—¶ï¼Œå‘ç°åŸå…ˆé€‰æ‹©å¹¶ä¸ä¼˜æˆ–è¾¾ä¸åˆ°ç›®æ ‡ï¼Œå°±é€€å›ä¸€æ­¥é‡æ–°é€‰æ‹©ï¼Œè¿™ç§èµ°ä¸é€šå°±é€€å›å†èµ°çš„æŠ€æœ¯ä¸ºå›æº¯æ³•ï¼Œè€Œæ»¡è¶³å›æº¯<a href="https://baike.baidu.com/item/æ¡ä»¶/1783021">æ¡ä»¶</a>çš„æŸä¸ª<a href="https://baike.baidu.com/item/çŠ¶æ€/33204">çŠ¶æ€</a>çš„ç‚¹ç§°ä¸ºâ€œå›æº¯ç‚¹â€ã€‚â€”â€”ç™¾åº¦ç™¾ç§‘</p></blockquote><span id="more"></span><p>å…¨æ’åˆ—å›æº¯çš„åŸºæœ¬æ€æƒ³ï¼šå¯¹å½“å‰ä½ç½®ä¾æ¬¡è¿›è¡Œä¸åé¢æ‰€æœ‰ä½ç½®çš„ä¸€ä¸ªäº¤æ¢ï¼Œç„¶åå¯¹äº¤æ¢åçš„å½“å‰ä½ç½®ä¹‹åçš„å…ƒç´ è¿›è¡Œä¸€ä¸ªå…¨æ’åˆ—ï¼Œå…¨æ’åˆ—å®Œæ¯•åï¼Œè¿›è¡Œå›æº¯ï¼šå°†å½“å‰ä½ç½®ä¸ä¹‹å‰äº¤æ¢çš„ä½ç½®é‡æ–°è°ƒæ¢ï¼Œå½¢æˆåŸæ¥çš„æ’åˆ—ï¼Œç„¶åç»§ç»­è¿›è¡Œä¸‹ä¸€æ¬¡äº¤æ¢ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æƒ³è¦å¯¹<code>[1, 2, 3, 4, 5]</code>è¿›è¡Œæ’åˆ—ï¼Œé¦–å…ˆç¡®å®šç¬¬ä¸€ä½æ•°ï¼Œå¯ä»¥æ˜¯1ï¼Œ2ï¼Œ 3 ï¼Œ 4ï¼Œ5ä¸­ä»»æ„ä¸€ä¸ªï¼Œä¸‹å›¾ä¸­æˆ‘ä»¬ä¸3è¿›è¡Œäº¤æ¢ï¼Œé‚£ä¹ˆäº¤æ¢åçš„åå››ä¸ªæ•°å°±æ˜¯<code>[2, 1, 4, 5]</code>ï¼Œç„¶åå¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œå…¨æ’åˆ—(é€’å½’)ï¼Œæœ€åå›æº¯ä¹‹åå°±ä¼šå›åˆ°<code>[1, 2, 3, 4, 5]</code>ï¼ˆæ¯æ¬¡æ’åˆ—éƒ½ä¼šå›æº¯ï¼Œæ‰€ä»¥æœ€å¤–å±‚å›æº¯çš„æ—¶å€™çš„æ’åˆ—å’Œèµ·åˆä¸€å®šæ˜¯ä¸€æ ·çš„ï¼‰ï¼Œæ¥ä¸‹æ¥æŠŠ4ä½œä¸ºé¦–ä½ï¼Œéœ€è¦æ’åˆ—çš„æ•°å°±æ˜¯<code>[2, 3, 1, 5]</code>ï¼Œä¾æ¬¡ç±»æ¨ã€‚</p><figure><img src="https://i.loli.net/2021/04/06/hsI6Vv9DzgGatBM.png" alt="image-20210406142817183"><figcaption aria-hidden="true">image-20210406142817183</figcaption></figure><p>å…¨éƒ¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">permute</span><span class="params">(<span class="type">int</span> *<span class="built_in">list</span>, <span class="type">int</span> begin, <span class="type">int</span> size)</span>; <span class="comment">// å®ç°å…¨æ’åˆ—çš„å‡½æ•°</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span>; <span class="comment">// äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªæ•°çš„å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> num = <span class="number">0</span>; <span class="comment">// è®°å½•å…¨æ’åˆ—çš„æ¬¡æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> n;</span><br><span class="line">    <span class="type">int</span> *<span class="built_in">list</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Input the size of the number list: &quot;</span>);</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;n);</span><br><span class="line">    <span class="built_in">list</span> = (<span class="type">int</span>*)<span class="built_in">calloc</span>(n, <span class="keyword">sizeof</span>(<span class="type">int</span>)); <span class="comment">// åŠ¨æ€æ•°ç»„</span></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Input the number list:\n&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%d&quot;</span>, &amp;<span class="built_in">list</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    permute(<span class="built_in">list</span>, <span class="number">0</span>, n);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;The total number of permutation is %d&quot;</span>, num);</span><br><span class="line">    <span class="built_in">free</span>(<span class="built_in">list</span>); <span class="comment">// é‡Šæ”¾</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">permute</span><span class="params">(<span class="type">int</span> *<span class="built_in">list</span>, <span class="type">int</span> begin, <span class="type">int</span> size)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (begin &gt;= size) &#123;</span><br><span class="line">        <span class="comment">// a permutation is found</span></span><br><span class="line">        num++;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>, <span class="built_in">list</span>[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = begin; k &lt; size; k++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (k != begin) swap(&amp;<span class="built_in">list</span>[begin], &amp;<span class="built_in">list</span>[k]);</span><br><span class="line">        permute(<span class="built_in">list</span>, begin+<span class="number">1</span>, size);</span><br><span class="line">        <span class="keyword">if</span> (k != begin) swap(&amp;<span class="built_in">list</span>[begin], &amp;<span class="built_in">list</span>[k]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span> *a, <span class="type">int</span> *b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> temp = *a;</span><br><span class="line">    *a = *b;</span><br><span class="line">    *b = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Algorithms </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å›æº¯æ³• </tag>
            
            <tag> C </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
